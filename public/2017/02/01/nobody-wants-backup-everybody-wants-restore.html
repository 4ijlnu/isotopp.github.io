<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp - Nobody wants backup. Everybody wants restore.</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="site.webmanifest">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">





	



<link rel="stylesheet" href="/style.min.c5e5cd61f54911f9aafd1dbe09c2f90667957bfe1002126c87aace57759f3446.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
	<a class="navbar-brand" href="" rel="home" title=".Site.Title">
	    Die wunderbare Welt von Isotopp
	</a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
		
		
		<li class="nav-item ">
                    <a class="nav-link" href="/about/">
			
			<span>About</span>
			<span class="visually-hidden">(Current)</span>
		    </a>
		    
		</li>
            </ul>
            
	</div>
    </div>
</nav>


        <main role="main" class="container-fluid">

            


<div class="page">
    <article class="nobody-wants-backup.-everybody-wants-restore.-page">
	<h1 class="title">
            Nobody wants backup. Everybody wants restore.
	</h1>

	<p><p class="md__image">
  <img src="/uploads/2017/02/mysql-backup-and-recovery-15-638.jpg" alt=""  />
</p>

</p>
<p>Operations matter. I know the Hipster crowd does not like to
hear that, cloud or not. But reality has a way of making itself
heard, whether you like it or not.</p>
<p><a href="https://docs.google.com/document/d/1GCK53YDcBWQveod9kfzW-VCxIABGiryG7_z_6jHdVik/pub" target="_blank" rel="noopener">Gitlab.com just discovered that.</a>

</p>
<p>So some sysadmin deleted the wrong folder, which in itself
should not be a problem.</p>
<p>But in the process of trying
to restore things, the following discoveries have been made:</p>
<ul>
<li>LVM snapshots are by default only taken once every 24 hours.
YP happened to run one manually about 6 hours prior to the
outage</li>
<li>Regular backups seem to also only be taken once per 24 hours,
though YP has not yet been able to figure out where they are
stored. According to JN these don’t appear to be working,
producing files only a few bytes in size.</li>
<li>SH: It looks like pg_dump may be failing because PostgreSQL
9.2 binaries are being run instead of 9.6 binaries. This
happens because omnibus only uses Pg 9.6 if data/PG_VERSION
is set to 9.6, but on workers this file does not exist. As a
result it defaults to 9.2, failing silently. No SQL dumps were
made as a result. Fog gem may have cleaned out older backups.</li>
<li>Disk snapshots in Azure are enabled for the NFS server, but
not for the DB servers.</li>
<li>The synchronisation process removes webhooks once it has
synchronised data to staging. Unless we can pull these from a
regular backup from the past 24 hours they will be lostThe
replication procedure is super fragile, prone to error, relies
on a handful of random shell scripts, and is badly documented</li>
<li>Our backups to S3 apparently don’t work either: the bucket is
empty</li>
</ul>
<p>If you think your sysadmin is paranoid, let this be your lesson. They are
not. Operations do matter, even (especially) in the cloud.</p>
<p><strong>EDIT:</strong> Michael Renner asks some interesting questions:</p>
<blockquote>
<p>Some thoughts for GitLab: What is WAL shipping? What is pgbouncer? Why
does everyone hate Slony? Why is EC2 so slow?</p>
</blockquote>
<p><a href="https://twitter.com/terrorobe/status/826706562563588098" target="_blank" rel="noopener"><p class="md__image">
  <img src="/uploads/2017/02/Screen-Shot-2017-02-01-at-10.45.07.png" alt=""  />
</p>

</a>

</p>
<p>Tweet: <a href="https://twitter.com/terrorobe/status/826706562563588098" target="_blank" rel="noopener">@Terrorobe</a>

</p>
<p>People using Slony on a Postgres 9.6 deserve everything that
happens to them. Slony is trigger based replication breakage
from the deepest circles of hell, and Postgres has excellent,
stable and fast internal replications for several years now.</p>
<p>Also, what he says about log shipping: There is no reason at all
to lose any write ever on a Postgres, nor to have much downtime
at all with proper replication. Operations do matter. Cloud
ain&rsquo;t gonna change that.</p>
<p><strong>EDIT:</strong> Dedicating 1st of February as &ldquo;Check your Backups Day&rdquo;</p>
<p><a href="http://checkyourbackups.work/" target="_blank" rel="noopener"><p class="md__image">
  <img src="/uploads/2017/02/Screen-Shot-2017-02-01-at-12.53.14.png" alt=""  />
</p>

</a>

</p>
<p><a href="http://checkyourbackups.work/" target="_blank" rel="noopener">Check your Backups Day</a>

</p>

	
    </article>
</div>



            <footer>
    <p>
	&copy; Copyright 2021 Someone or something
    </p>
</footer>


        </main>

	





<script src="/js/bootstrap.js"></script>




<script src="/js/lunr.js"></script>





<script src="/js/app.js"></script>


    </body>
</html>
