<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp - Unlimited Mail Addresses</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="site.webmanifest">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">





	



<link rel="stylesheet" href="/style.min.c5e5cd61f54911f9aafd1dbe09c2f90667957bfe1002126c87aace57759f3446.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
	<a class="navbar-brand" href="" rel="home" title=".Site.Title">
	    Die wunderbare Welt von Isotopp
	</a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
		
		
		<li class="nav-item ">
                    <a class="nav-link" href="/about/">
			
			<span>About</span>
			<span class="visually-hidden">(Current)</span>
		    </a>
		    
		</li>
            </ul>
            
	</div>
    </div>
</nav>


        <main role="main" class="container-fluid">

            


<div class="page">
    <article class="unlimited-mail-addresses-page">
	<h1 class="title">
            Unlimited Mail Addresses
	</h1>

	<p>When people ask for my mail address, they usually get a personalized address from me. That is particularly true for all commercial email. So you don&rsquo;t get to send mail to my main account, but to <a href="mailto:kris-yourbusiness@koehntopp.de">kris-yourbusiness@koehntopp.de</a>, and that will end up going into <code>INBOX.special.yourbusiness</code>. At least until it leaks, receives spam or is otherwise burned. In which case I will short it out and route all incoming mail on that address to <code>/dev/null</code>. Here is how it is done.</p>
<h2 id="mailer-setup">
    <a href="#mailer-setup">
	Mailer setup
    </a>
</h2>
<p>I run <code>exim</code> and in my <code>exim.conf</code> I have</p>
<pre><code class="language-console" data-lang="console">kris_virtuserfile:
  driver = redirect
  domains = +kris_domains
  local_part_suffix = +* : -*
  local_part_suffix_optional
  headers_remove = X-local-part-suffix
  headers_add = X-local-part-suffix: ${original_local_part}
  owners = kris
  allow_fail
  allow_defer
  data= ${lookup{$local_part@$domain}dbm*@{/home/kris/Exim/virtusertable.dbm}}
</code></pre><p>The important part here is the <code>local_part_suffix = +* : -*</code>. This enables amending the local part of a mail address with an extension. So if <code>kris</code> is a valid local user for delivery, <code>kris-yourbusiness</code> and <code>kris+yourbusiness</code> become valid addresses, too, and will be delivered to the local user <code>kris</code>.</p>
<p>I define <code>local_part_suffix_optional</code>, because unfortunately for legacy reasons the actual local user must remain reachable for legacy reasons.</p>
<p>I also define <code>header_remove = X-local-part-suffix</code> to remove this particular X-header from all incoming mail, and then add it back with <code>X-local-part-suffix: ${original_local_part}</code>. This will prevent external mail with a hand-crafted fake <code>X-local-part-suffix</code> header from coming through, and then preserve the original local part for sorting, in exactly this X-header line.</p>
<p>From this config we get the following behavior: <code>kris-yourbusiness@koehntopp.de</code> is being delivered to the local user <code>kris</code>, and with an <code>X-local-part-suffix: kris-yourbusiness</code> header line added to the mail. Note that we get <code>kris-yourbusiness</code>, and not <code>yourbusiness</code> in this header line.</p>
<h2 id="local-delivery">
    <a href="#local-delivery">
	Local delivery
    </a>
</h2>
<p>Local delivery is controlled by the local user, <code>kris</code>. Kris happens to have defined a <code>.forward</code> such as</p>
<pre><code class="language-console" data-lang="console">kris:~ $ cat .forward
|/usr/bin/procmail
</code></pre><p>This will invoke <code>procmail</code> for local delivery. <code>procmail</code> is a rule based local delivery agent with a horrible Syntax.</p>
<p>You can define variables, and later refer to them using <code>$</code> as a prefix. Rules start with a <code>:0</code>, and consist of a Regex for header lines, plus a delivery action (usually a folder name for Maildir format, so make sure it ends in a slash).</p>
<p>The other important but obscure piece of information is that the exit code of <code>procmail</code> defines the delivery success, and controls the mailer behavior. So checking in the obvious place (<code>/usr/include/sysexits.h</code>, of course!) you learn:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">kris:<span style="color:#f92672">~</span> <span style="color:#960050;background-color:#1e0010">$</span> cat <span style="color:#f92672">/</span>usr<span style="color:#f92672">/</span>include<span style="color:#f92672">/</span>sysexits.h
...
<span style="color:#75715e">#define EX_NOINPUT      66      </span><span style="color:#75715e">/* cannot open input */</span><span style="color:#75715e">
</span><span style="color:#75715e">#define EX_NOUSER       67      </span><span style="color:#75715e">/* addressee unknown */</span><span style="color:#75715e">
</span><span style="color:#75715e">#define EX_NOHOST       68      </span><span style="color:#75715e">/* host name unknown */</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>...
</code></pre></div><p>We remember that the magical number <code>67</code> as an exit code makes <code>exim</code> bounce mail with <code>user unknown</code>.</p>
<p>The end result:</p>
<pre><code class="language-console" data-lang="console">kris:~ $ cat .procmailrc
PATH=/bin:/usr/bin:/usr/local/bin
MAILDIR=$HOME/Maildir
LOGFILE=$HOME/Procmail/procmail.log
DEFAULT=$HOME/Maildir/

BOUNCE=/dev/null
SPAM=$MAILDIR/.spam
TRASH=$MAILDIR/.system.trash
BOUNCELOG=$MAILDIR/.system.bounces

# Subrule to define a &quot;user unknown&quot; bounce, as an example.
# Subrule, because we also record the bounce in the bouncelog folder.
:0
* ^X-local-part-suffix: kris-macheist
{
    EXITCODE=67

    :0 i
    $BOUNCELOG/
}

# Rule to route mail to the trash folder
:0
* ^X-local-part-suffix: kris-bitly
$TRASH/

# all mail to kris-yourbusiness goes to INBOX/.special.yourbusiness,
# which becomes the INBOX.special.yourbusiness folder.
#
# We use sed and tr, this could be more efficient. Basically, we clean
# up unwanted characters and transform to lower case.
:0
* ^X-local-part-suffix:.*kris-\/[^@]+
$MAILDIR/.special.`echo $MATCH | sed -e 's!([^)]*)!!g' -e 's![^a-zA-Z0-9_-]!_!g' | tr A-Z a-z`/

# Filter through spamc
:0fw
| /usr/bin/spamc

# If spam detected, deliver to different folders depending on score
:0
* ^X-Spam-Level:.*\*\*\*\*\*\*\*\*\*\*
$SPAM.sure/

:0
* ^X-Spam-Level:.*\*\*\*\*\*
$SPAM/
</code></pre><p>Note how we detect the <code>X-local-part-suffic</code> before we run spam detection and sorting. This allows mail to subaddresses to always go through and bypass all spam filtering, so in exchange for having a personally identifyable mail address you get guarantee delivery. Conversely, if you abuse the privilege you are routed to <code>$TRASH/</code>.</p>
<h2 id="mail-user-agent">
    <a href="#mail-user-agent">
	Mail User Agent
    </a>
</h2>
<p>I used to run Apple Mail.app with this setup, and now on Windows am using <a href="https://www.emclient.com/" target="_blank" rel="noopener">eM Client</a>

. eM Client is a commercial email client, and is available for Windows and Mac, and is easily the best email client I have ever used, with Mail.app being a close second for my workflow.</p>
<p>In my case, I define a smart folder search which will find all unread mail in all folders (except $list of exceptions), and show it in a single folder. I want the search to automatically discover newly generated folders automatically, and I need the folder name shown in the overview.</p>
<p><p class="md__image">
  <img src="/uploads/2021/01/emclient.png" alt=""  />
</p>

</p>
<p><em>A smart folder, finding all unread mail anywhere, and showing it by folder. I made a few mails unread for demonstration.</em></p>
<p>That way, I can see if I get a mail claiming to be from YourBusiness: If it is not in the <code>yourbusiness</code> folder, I am deleting it without reading. Phishers will have to send phishing mail to the correct folder for your personalized business mail address in order to be even considered.</p>
<p>I also can <code>$TRASH/</code> rule burned addresses rather quickly, and that keeps my inbox clean.</p>


	
    </article>
</div>



            <footer>
    <p>
	&copy; Copyright 2021 Someone or something
    </p>
</footer>


        </main>

	





<script src="/js/bootstrap.js"></script>




<script src="/js/lunr.js"></script>





<script src="/js/app.js"></script>


    </body>
</html>
