<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp - Über ENUM (und Fast Alter Table)</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="site.webmanifest">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">





	



<link rel="stylesheet" href="/style.min.c5e5cd61f54911f9aafd1dbe09c2f90667957bfe1002126c87aace57759f3446.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
	<a class="navbar-brand" href="" rel="home" title=".Site.Title">
	    Die wunderbare Welt von Isotopp
	</a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
		
		
		<li class="nav-item ">
                    <a class="nav-link" href="/about/">
			
			<span>About</span>
			<span class="visually-hidden">(Current)</span>
		    </a>
		    
		</li>
            </ul>
            
	</div>
    </div>
</nav>


        <main role="main" class="container-fluid">

            


<div class="page">
    <article class="%C3%BCber-enum-und-fast-alter-table-page">
	<h1 class="title">
            Über ENUM (und Fast Alter Table)
	</h1>

	<p>On 2010-04-08 13:40:57 +0200,</p>
<p><a href="http://groups.google.de/group/de.comp.datenbanken.mysql/msg/e58da1119a2bd53c?dmode=source&amp;output=gplain" target="_blank" rel="noopener">Karsten Wutzke said</a>

:</p>
<blockquote>
<p>gibt es ein sinnvolles Maximum für die Anzahl von Elementen in einem ENUM?</p>
</blockquote>
<p>ENUM hat in MySQL 5.1 einige Eigenschaften, die überraschend sind. Zum
Beispiel</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> t (id integer unsigned <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>, e enum(<span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>) <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> ) engine <span style="color:#f92672">=</span> innodb;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">21</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;&#39;</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

Warning (Code <span style="color:#ae81ff">1265</span>): <span style="color:#66d9ef">Data</span> truncated <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">column</span> <span style="color:#e6db74">&#39;e&#39;</span> <span style="color:#66d9ef">at</span> <span style="color:#66d9ef">row</span> <span style="color:#ae81ff">1</span>

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;c&#39;</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> id, e, hex(e), e<span style="color:#f92672">+</span><span style="color:#ae81ff">0</span> <span style="color:#66d9ef">from</span> t;
<span style="color:#f92672">+</span><span style="color:#75715e">----+---+--------+-----+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> e <span style="color:#f92672">|</span> hex(e) <span style="color:#f92672">|</span> e<span style="color:#f92672">+</span><span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+---+--------+-----+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>   <span style="color:#f92672">|</span>        <span style="color:#f92672">|</span>   <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">c</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">63</span>     <span style="color:#f92672">|</span>   <span style="color:#ae81ff">3</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+---+--------+-----+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Obwohl t.e ein ENUM ist, das per Definition keinen Wert '' zuläßt, hat MySQL
den Wert '' abspeichern können, wenn auch mit einer Warnung.</p>
<p>Bei der Kontrollausgabe sieht man bei der Konvertierung nach INTEGER, daß
ein ENUM intern Zahl gespeichert wird, wobei dem ersten Wert die Zahl 1, dem
nächsten die Zahl 2 und so weiter zugeordnet wird. Der Wert &lsquo;&rsquo;, intern als 0
repräsentiert (und von NULL verschieden) wird immer zugelassen und
verwendet, um ungültige Werte (Werte, die nicht in der ENUM-Wertliste
enthalten sind) abzubilden. '' ist nicht in der Wertliste enthalten und wird
(wie jeder andere ungültige Wert auch) mit einer data truncation warning auf
'' abgebildet.</p>
<p>Abhilfe schaffte hier
<a href="http://dev.mysql.com/doc/refman/5.1/en/server-sql-mode.html" target="_blank" rel="noopener">strict mode</a>

, etwa</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> sql_mode <span style="color:#f92672">=</span> STRICT_ALL_TABLES;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;&#39;</span>);
ERROR <span style="color:#ae81ff">1265</span> (<span style="color:#ae81ff">01000</span>): <span style="color:#66d9ef">Data</span> truncated <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">column</span> <span style="color:#e6db74">&#39;e&#39;</span> <span style="color:#66d9ef">at</span> <span style="color:#66d9ef">row</span> <span style="color:#ae81ff">1</span>
</code></pre></div><p>Die &lsquo;data truncation warning&rsquo; wird dann zum Error und läßt den INSERT
scheitern. Das bringt andere Probleme mit sich, aber das ist eine andere
Geschichte, die ein anderes Mal erzählt werden soll.</p>
<p>Das ENUM wird intern als TINYINT oder SHORTINT repräsentiert, belegt also
entweder einen oder zwei Bytes pro Wert und kann entsprechend maximal 64k
Werte annehmen.</p>
<blockquote>
<p>Ich meine mich daran zu erinnern, dass irgendjemand mal gesagt hat, dass
ENUMs nur für eine eher geringe Anzahl von Elementen Sinn macht.</p>
</blockquote>
<p>Das Problem lag in der Vergangenheit eher bei der Kombination von
Tabellengröße und Änderungshäufigkeit der Definition.</p>
<p>Eine Änderung der Wertemenge ist halt ein DDL-Statement, also ein ALTER
TABLE und MySQL mußte bisher für das Ändern der ENUM-Definition die Tabelle
umkopieren. Wird die Tabelle größer, kann das unangenehm lange dauern, da
die Tabelle während des Umkopieren ein Lock hat, also nicht geschrieben
werden kann.</p>
<p>In MySQL 5.1 und höher gilt jedoch</p>
<blockquote>
<p>In most cases, ALTER TABLE works by making a temporary copy of the
original table. The alteration is performed on the copy, and then the
original table is deleted and the new one is renamed. [&hellip;]In some cases,
no temporary table is necessary:Alterations that modify only table
metadata and not table data can be made immediately by altering the
table&rsquo;s .frm file and not touching table contents. The following changes
are fast alterations that can be made this way: <!-- raw HTML omitted --><!-- raw HTML omitted -->Renaming a column
or index. <!-- raw HTML omitted --><!-- raw HTML omitted -->Changing the default value of a column.</p>
<!-- raw HTML omitted -->
</blockquote>
<p>Die alten Bedenken gegen die Erweiterung eines ENUM- oder SET-Typen wegen
lange dauernder ALTER TABLE-Statements gelten also NICHT mehr, vorausgesetzt
es ist akzeptabel, daß neue Werte für den ENUM am Ende der ENUM-Liste
angehängt werden können, also keine interne Umnummerierung notwendig ist.</p>


	
    </article>
</div>



            <footer>
    <p>
	&copy; Copyright 2021 Someone or something
    </p>
</footer>


        </main>

	





<script src="/js/bootstrap.js"></script>




<script src="/js/lunr.js"></script>





<script src="/js/app.js"></script>


    </body>
</html>
