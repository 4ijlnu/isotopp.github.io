<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp - How I set up my Python</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="site.webmanifest">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">





	



<link rel="stylesheet" href="/style.min.c5e5cd61f54911f9aafd1dbe09c2f90667957bfe1002126c87aace57759f3446.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
	<a class="navbar-brand" href="" rel="home" title=".Site.Title">
	    Die wunderbare Welt von Isotopp
	</a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
		
		
		<li class="nav-item ">
                    <a class="nav-link" href="/about/">
			
			<span>About</span>
			<span class="visually-hidden">(Current)</span>
		    </a>
		    
		</li>
            </ul>
            
	</div>
    </div>
</nav>


        <main role="main" class="container-fluid">

            


<div class="page">
    <article class="how-i-set-up-my-python-page">
	<h1 class="title">
            How I set up my Python
	</h1>

	<p>Because Martin wanted some starting point, here is how I set up my Python. There are a lot of other things one can do, but this is supposed to be just a starting point.</p>
<p>For a new project, make a project directory, usually not with a local git repository.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kk:Python kris$ mkdir project
kk:Python kris$ cd project
kk:project kris$ git init
Initialized empty Git repository in /Users/kris/Python/project/.git/
</code></pre></div><p>We need a virtual environment to keep our modules apart from the system python.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kk:project kris$ python3 -m venv ~/.venv/project
</code></pre></div><p>In my case, I have a bash <code>PROMPT_COMMAND</code> installed that automatically activates the venv when I enter a directory. From the <code>.bashrc</code>, some highly insecure code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">autoenv<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -f ./.venv <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
    nv<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>cat ./.venv<span style="color:#66d9ef">)</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> -f <span style="color:#e6db74">&#34;</span>$nv<span style="color:#e6db74">/bin/activate&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
      <span style="color:#66d9ef">if</span> <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;</span>$VIRTUAL_ENV<span style="color:#e6db74">&#34;</span> !<span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span>$nv<span style="color:#e6db74">&#34;</span> <span style="color:#f92672">]</span>; <span style="color:#66d9ef">then</span>
        source $nv/bin/activate
      <span style="color:#66d9ef">fi</span>
    <span style="color:#66d9ef">fi</span>
  <span style="color:#66d9ef">fi</span>
<span style="color:#f92672">}</span>

PROMPT_COMMAND<span style="color:#f92672">=</span>autoenv
</code></pre></div><p>And then:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kk:project kris$ echo /Users/kris/.venv/project &gt; .venv
<span style="color:#f92672">(</span>project<span style="color:#f92672">)</span> kk:project kris$
</code></pre></div><p>As can be seen from the prompt, the venv already active. Usually, after install the pip is outdated.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>project<span style="color:#f92672">)</span> kk:project kris$ pip install --upgrade pip
...
Successfully installed pip-20.1.1
</code></pre></div><p>We also need wheel for C-Language Extensions, and black, mypy and pre-commit.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>project<span style="color:#f92672">)</span> kk:project kris$ pip install wheel
...
Successfully installed wheel-0.34.2
<span style="color:#f92672">(</span>project<span style="color:#f92672">)</span> kk:project kris$ pip install black mypy pre-commit
...
Installing collected packages: click, attrs, pathspec, regex, toml, appdirs, typed-ast, black, mypy-extensions, typing-extensions, mypy, cfgv, filelock, six, zipp, importlib-metadata, distlib, virtualenv, nodeenv, pyyaml, identify, pre-commit
Successfully installed appdirs-1.4.4 attrs-19.3.0 black-19.10b0 cfgv-3.1.0 click-7.1.2 distlib-0.3.1 filelock-3.0.12 identify-1.4.20 importlib-metadata-1.7.0 mypy-0.782 mypy-extensions-0.4.3 nodeenv-1.4.0 pathspec-0.8.0 pre-commit-2.5.1 pyyaml-5.3.1 regex-2020.6.8 six-1.15.0 toml-0.10.1 typed-ast-1.4.1 typing-extensions-3.7.4.2 virtualenv-20.0.25 zipp-3.1.0

</code></pre></div><p>The last three collect a large number of additional dev-dependencies.</p>
<p>We then need to set-up the pre-commit environment:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#ae81ff">(project) kk:project kris$ cat .pre-commit-config.yaml</span>
<span style="color:#f92672">repos</span>:
-   <span style="color:#f92672">repo</span>: <span style="color:#ae81ff">https://github.com/pre-commit/pre-commit-hooks</span>
    <span style="color:#f92672">rev</span>: <span style="color:#ae81ff">v2.3.0</span>
    <span style="color:#f92672">hooks</span>:
    - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">check-yaml</span>
    - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">end-of-file-fixer</span>
    - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">trailing-whitespace</span>
-   <span style="color:#f92672">repo</span>: <span style="color:#ae81ff">https://github.com/psf/black</span>
    <span style="color:#f92672">rev</span>: <span style="color:#e6db74">&#39;&#39;</span>
    <span style="color:#f92672">hooks</span>:
    - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">black</span>
-   <span style="color:#f92672">repo</span>: <span style="color:#ae81ff">https://github.com/pre-commit/mirrors-mypy</span>
    <span style="color:#f92672">rev</span>: <span style="color:#e6db74">&#39;&#39;</span>
    <span style="color:#f92672">hooks</span>:
    - <span style="color:#f92672">id</span>: <span style="color:#ae81ff">mypy</span>
      <span style="color:#f92672">additional_dependencies</span>: [ ]
<span style="color:#ae81ff">(project) kk:project kris$ pre-commit install</span>
<span style="color:#ae81ff">pre-commit installed at .git/hooks/pre-commit</span>
</code></pre></div><p>Pre-commit is running mypy and black, but in a separate environment, so it will be installed again, elsewhere, and we will also need to declare our mypy dependencies here again, unfortunately.</p>
<p>On the other hand, all our Python will be type-checked and blacken&rsquo;ed automatically on commit.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">(project) kk:project kris<span style="color:#960050;background-color:#1e0010">$</span> cat probe<span style="color:#f92672">.</span>py
<span style="color:#75715e">#! /usr/bin/env python</span>

<span style="color:#f92672">import</span> sys

<span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;{sys.version}&#34;</span>)
</code></pre></div><p>And here we go:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>project<span style="color:#f92672">)</span> kk:project kris$ git add probe.py
<span style="color:#f92672">(</span>project<span style="color:#f92672">)</span> kk:project kris$ git commit -m <span style="color:#e6db74">&#39;testing&#39;</span>
Check Yaml...........................................<span style="color:#f92672">(</span>no files to check<span style="color:#f92672">)</span>Skipped
Fix End of Files.........................................................Passed
Trim Trailing Whitespace.................................................Passed
black....................................................................Passed
mypy.....................................................................Passed
<span style="color:#f92672">[</span>master <span style="color:#f92672">(</span>root-commit<span style="color:#f92672">)</span> c7734e4<span style="color:#f92672">]</span> testing
 <span style="color:#ae81ff">1</span> file changed, <span style="color:#ae81ff">5</span> insertions<span style="color:#f92672">(</span>+<span style="color:#f92672">)</span>
 create mode <span style="color:#ae81ff">100755</span> probe.py
</code></pre></div><p>Now, I usually collect additional project dependencies in <code>requirements.txt</code> and freeze them into <code>requirements-frozen.txt</code> for deployment into a Python Container.</p>
<p>For example, in one project:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#f92672">(</span>bridge<span style="color:#f92672">)</span> kk:bridge kris$ cat requirements.txt
paho-mqtt
influxdb
<span style="color:#f92672">(</span>bridge<span style="color:#f92672">)</span> kk:bridge kris$ cat requirements-frozen.txt
paho-mqtt<span style="color:#f92672">==</span>1.5.0
influxdb<span style="color:#f92672">==</span>5.3.0
<span style="color:#75715e">## The following requirements were added by pip freeze:</span>
certifi<span style="color:#f92672">==</span>2020.4.5.1
chardet<span style="color:#f92672">==</span>3.0.4
idna<span style="color:#f92672">==</span>2.9
msgpack<span style="color:#f92672">==</span>0.6.1
python-dateutil<span style="color:#f92672">==</span>2.8.1
pytz<span style="color:#f92672">==</span>2020.1
requests<span style="color:#f92672">==</span>2.23.0
six<span style="color:#f92672">==</span>1.15.0
urllib3<span style="color:#f92672">==</span>1.25.9
<span style="color:#f92672">(</span>bridge<span style="color:#f92672">)</span> kk:bridge kris$ cat Dockerfile
FROM python:3.8-alpine

LABEL maintainer<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;isotopp&#34;</span> <span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>      description<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;MQTT to InfluxDB Bridge&#34;</span>

COPY requirements-frozen.txt /tmp/requirements.txt
RUN pip install -r /tmp/requirements.txt

COPY . /app
WORKDIR /app

CMD <span style="color:#f92672">[</span> <span style="color:#e6db74">&#34;python3&#34;</span>, <span style="color:#e6db74">&#34;-u&#34;</span>, <span style="color:#e6db74">&#34;bridge.py&#34;</span> <span style="color:#f92672">]</span>
</code></pre></div><p>This is part of a larger deployment in a <code>docker-compose.yml</code> then:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">---
<span style="color:#f92672">version</span>: <span style="color:#e6db74">&#34;3&#34;</span>

<span style="color:#f92672">services</span>:
...
  <span style="color:#f92672">bridge</span>:
    <span style="color:#f92672">build</span>: <span style="color:#e6db74">&#34;./bridge&#34;</span>
    <span style="color:#f92672">image</span>: <span style="color:#e6db74">&#34;isotopp/mqttbridge&#34;</span>
    <span style="color:#f92672">container_name</span>: <span style="color:#e6db74">&#34;mqttbridge&#34;</span>
    <span style="color:#f92672">hostname</span>: <span style="color:#e6db74">&#34;mqttbridge&#34;</span>
    <span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;1000&#34;</span>
    <span style="color:#f92672">depends_on</span>:
      - <span style="color:#e6db74">&#34;influxdb&#34;</span>
      - <span style="color:#e6db74">&#34;mosquitto&#34;</span>
    <span style="color:#f92672">restart</span>: <span style="color:#e6db74">&#34;always&#34;</span>
...
</code></pre></div>

	
    </article>
</div>



            <footer>
    <p>
	&copy; Copyright 2021 Someone or something
    </p>
</footer>


        </main>

	





<script src="/js/bootstrap.js"></script>




<script src="/js/lunr.js"></script>





<script src="/js/app.js"></script>


    </body>
</html>
