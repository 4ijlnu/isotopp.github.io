<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp - MySQL: Basic usage of the JSON data type</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="site.webmanifest">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">





	



<link rel="stylesheet" href="/style.min.c5e5cd61f54911f9aafd1dbe09c2f90667957bfe1002126c87aace57759f3446.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
	<a class="navbar-brand" href="" rel="home" title=".Site.Title">
	    Die wunderbare Welt von Isotopp
	</a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
		
		
		<li class="nav-item ">
                    <a class="nav-link" href="/about/">
			
			<span>About</span>
			<span class="visually-hidden">(Current)</span>
		    </a>
		    
		</li>
            </ul>
            
	</div>
    </div>
</nav>


        <main role="main" class="container-fluid">

            


<div class="page">
    <article class="mysql-basic-usage-of-the-json-data-type-page">
	<h1 class="title">
            MySQL: Basic usage of the JSON data type
	</h1>

	<p>MySQL 8 provides solid support for the JSON data type. The manual has <a href="https://dev.mysql.com/doc/refman/8.0/en/json.html" target="_blank" rel="noopener">an overview of the data type</a>

, a <a href="https://dev.mysql.com/doc/refman/8.0/en/json-functions.html" target="_blank" rel="noopener">JSON function reference</a>

, an <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table-secondary-indexes.html#json-column-indirect-index" target="_blank" rel="noopener">an overview on generated column indexes</a>

, and <a href="https://dev.mysql.com/doc/refman/8.0/en/create-index.html#create-index-multi-valued" target="_blank" rel="noopener">explains multi-values indexes</a>

.</p>
<h2 id="creating-json-columns">
    <a href="#creating-json-columns">
	Creating JSON columns
    </a>
</h2>
<p>Creating JSON columns is easy: Make the column of the JSON data type, fill in valid JSON data.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> t ( id integer <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span> auto_increment, j json);
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">11</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t (j) <span style="color:#66d9ef">values</span> 
<span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;null&#39;</span>),
<span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;true&#39;</span>),
<span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;false&#39;</span>),
<span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;1&#39;</span>),
<span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;&#34;keks&#34;&#39;</span>),
<span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;[&#34;eins&#34;, &#34;zwei&#34;]&#39;</span>),
<span style="color:#f92672">-&gt;</span> (<span style="color:#e6db74">&#39;{&#34;eins&#34;: &#34;one&#34;, &#34;zwei&#34;: &#34;two&#34;}&#39;</span>);
Query OK, <span style="color:#ae81ff">5</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">02</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_type(j) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">type</span>, json_valid(j) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">valid</span>, <span style="color:#66d9ef">isnull</span>(j) <span style="color:#66d9ef">as</span> sqlnull, j, id <span style="color:#66d9ef">from</span> t;
<span style="color:#f92672">+</span><span style="color:#75715e">---------+-------+---------+--------------------------------+----+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span>    <span style="color:#f92672">|</span> <span style="color:#66d9ef">valid</span> <span style="color:#f92672">|</span> sqlnull <span style="color:#f92672">|</span> j                              <span style="color:#f92672">|</span> id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+-------+---------+--------------------------------+----+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>  <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>                           <span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">null</span>                           <span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> BOOLEAN <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span>                           <span style="color:#f92672">|</span>  <span style="color:#ae81ff">3</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> BOOLEAN <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">false</span>                          <span style="color:#f92672">|</span>  <span style="color:#ae81ff">4</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> INTEGER <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">1</span>                              <span style="color:#f92672">|</span>  <span style="color:#ae81ff">5</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> STRING  <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;keks&#34;</span>                         <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> ARRAY   <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> [<span style="color:#e6db74">&#34;eins&#34;</span>, <span style="color:#e6db74">&#34;zwei&#34;</span>]               <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#66d9ef">OBJECT</span>  <span style="color:#f92672">|</span>     <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;eins&#34;</span>: <span style="color:#e6db74">&#34;one&#34;</span>, <span style="color:#e6db74">&#34;zwei&#34;</span>: <span style="color:#e6db74">&#34;two&#34;</span><span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+-------+---------+--------------------------------+----+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">8</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t (j) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#39;[&#34;incomplete&#34;, &#34;array&#34;, &#34;closing bracket&#34;&#39;</span>);
ERROR <span style="color:#ae81ff">3140</span> (<span style="color:#ae81ff">22032</span>): Invalid JSON text: <span style="color:#e6db74">&#34;Missing a comma or &#39;]&#39; after an array element.&#34;</span> <span style="color:#66d9ef">at</span> <span style="color:#66d9ef">position</span> <span style="color:#ae81ff">41</span> <span style="color:#66d9ef">in</span> value <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">column</span> <span style="color:#e6db74">&#39;t.j&#39;</span>.
</code></pre></div><p>We learn several things from this experiment:</p>
<ul>
<li>Literal JSON values are always simple strings.
<ul>
<li>The character set in JSON objects is <code>utf8mb4</code>, the collation is <code>utf8mb4_bin</code>.</li>
<li>Because the collation is a <code>_bin</code> collation, comparison is case sensitive. Charset and collation are fixed and cannot be changed without casting to a non-JSON type.</li>
<li>We enclose them in single quotes, leveraging the fact that MySQL allows both single and double quotes as string terminators. This saves us a lot of quoting.</li>
<li>JSON null is written as the string <code>'null'</code>.</li>
<li>JSON true is written as the string <code>'true'</code>.</li>
<li>JSON false is written as the string <code>'false'</code>.</li>
</ul>
</li>
<li>We allowed NULL values in our JSON column definition by not providing a <code>NOT NULL</code> clause. SQL <code>NULL</code> is different from JSON <code>'null'</code>, but is cast to this.</li>
<li>We can use the <code>JSON_TYPE()</code> function to check the JSON type inside the JSON column.</li>
<li>The JSON is parsed, and checked for validity. The <code>JSON_VALID()</code> function does the checking.
<ul>
<li>It also exposes the difference between SQL <code>NULL</code> and JSON <code>'null'</code>. So does the SQL <code>ISNULL()</code> function (or the <code>IS NULL</code> comparison operator).</li>
</ul>
</li>
</ul>
<h2 id="creating-json-values">
    <a href="#creating-json-values">
	Creating JSON values
    </a>
</h2>
<p>We can see JSON literal notation already from the previous example. There are also two utility functions to construct JSON array and object structures from SQL scalars. They are <code>JSON_ARRAY()</code> and <code>JSON_OBJECT()</code>. Note the handling of SQL <code>NULL</code> values.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_array(<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">NULL</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">as</span> ary, json_object(<span style="color:#e6db74">&#34;eins&#34;</span>, <span style="color:#e6db74">&#34;one&#34;</span>, <span style="color:#e6db74">&#34;null&#34;</span>,
<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#34;zwei&#34;</span>, <span style="color:#e6db74">&#34;two&#34;</span>) <span style="color:#66d9ef">as</span> obj;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+----------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> ary          <span style="color:#f92672">|</span> obj                                          <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+----------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> [<span style="color:#ae81ff">1</span>, <span style="color:#66d9ef">null</span>, <span style="color:#ae81ff">2</span>] <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;eins&#34;</span>: <span style="color:#e6db74">&#34;one&#34;</span>, <span style="color:#e6db74">&#34;null&#34;</span>: <span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#34;zwei&#34;</span>: <span style="color:#e6db74">&#34;two&#34;</span><span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+----------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)
</code></pre></div><p>We can use <code>JSON_MERGE_PRESERVE()</code> and <code>JSON_MERGE_PATCH()</code> to incrementally build complicated structures. <code>JSON_MERGE_PRESERVE()</code> replaces <code>JSON_MERGE()</code>, which is deprecated and should no longer be used.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_merge_preserve(<span style="color:#e6db74">&#39;[3, 4, 5]&#39;</span>, <span style="color:#e6db74">&#39;[1, 2, 3]&#39;</span>) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">preserve</span>, json_merge_patch(<span style="color:#e6db74">&#39;[1, 2, 3]&#39;</span>, <span style="color:#e6db74">&#39;[3, 4, 5]&#39;</span>) <span style="color:#66d9ef">as</span> patch<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
<span style="color:#66d9ef">preserve</span>: [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]
   patch: [<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>]
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_merge_preserve(<span style="color:#e6db74">&#39;{&#34;eins&#34;: &#34;one&#34;, &#34;zwei&#34;: &#34;two&#34;}&#39;</span>, <span style="color:#e6db74">&#39;{&#34;zwei&#34;: &#34;two&#34;, &#34;drei&#34;: &#34;three&#34;}&#39;</span>) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">preserve</span>, json_merge_patch(<span style="color:#e6db74">&#39;{&#34;eins&#34;: &#34;one&#34;, &#34;zwei&#34;: &#34;two&#34;}&#39;</span>, <span style="color:#e6db74">&#39;{&#34;zwei&#34;: &#34;two&#34;, &#34;drei&#34;: &#34;three&#34;}&#39;</span>) <span style="color:#66d9ef">as</span> patch<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
<span style="color:#66d9ef">preserve</span>: <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;drei&#34;</span>: <span style="color:#e6db74">&#34;three&#34;</span>, <span style="color:#e6db74">&#34;eins&#34;</span>: <span style="color:#e6db74">&#34;one&#34;</span>, <span style="color:#e6db74">&#34;zwei&#34;</span>: [<span style="color:#e6db74">&#34;two&#34;</span>, <span style="color:#e6db74">&#34;two&#34;</span>]<span style="color:#960050;background-color:#1e0010">}</span>
   patch: <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;drei&#34;</span>: <span style="color:#e6db74">&#34;three&#34;</span>, <span style="color:#e6db74">&#34;eins&#34;</span>: <span style="color:#e6db74">&#34;one&#34;</span>, <span style="color:#e6db74">&#34;zwei&#34;</span>: <span style="color:#e6db74">&#34;two&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Quotes and quoting can be a bit painful, and even confusing. Let&rsquo;s put the string <code>A so-called &quot;string&quot;.</code> into a JSON string, inside an SQL statement. To turn this text into a JSON string we need to put double quotes around it, quoting our internal double quotes with backslashes. To produce a backslash literal, we need to write a double backslash.</p>
<p>The result:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t (j) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#39;&#34;A so-called \\&#34;string\\&#34;.&#34;&#39;</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">02</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> last_insert_id() <span style="color:#66d9ef">as</span> id<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
id: <span style="color:#ae81ff">9</span>
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>We can get this back as <code>j</code>, or use JSON extractors (<code>JSON_EXTRACT()</code>, or <code>-&gt;</code>). The current document is <code>$</code>, so:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j, j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#39;$&#39;</span> <span style="color:#66d9ef">as</span> jj, j<span style="color:#f92672">-&gt;&gt;</span><span style="color:#e6db74">&#39;$&#39;</span> <span style="color:#66d9ef">as</span> jj_unquoted <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">9</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
          j: <span style="color:#e6db74">&#34;A so-called \&#34;</span>string<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;.&#34;</span>
         jj: <span style="color:#e6db74">&#34;A so-called \&#34;</span>string<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34;.&#34;</span>
jj_unquoted: A so<span style="color:#f92672">-</span><span style="color:#66d9ef">called</span> <span style="color:#e6db74">&#34;string&#34;</span>.
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>This brings us to component access:</p>
<h2 id="json-component-access">
    <a href="#json-component-access">
	JSON component access
    </a>
</h2>
<p>Using the <code>JSON_EXTRACT()</code> function and JSON path syntax, we can access fields in the JSON and select for them, as foreshadowed above.</p>
<p>We get the following selectors:</p>
<ul>
<li><code>$</code>, the current JSON document.</li>
<li><code>.key</code>, select the <code>key</code> from the current object. Use <code>.&quot;key with space&quot;</code> when necessary.</li>
<li><code>[N]</code> selects the element <code>N</code> from a JSON array, starting to count at 0.
<ul>
<li><code>.&quot;equipment-ids&quot;[1]</code> is interesting, because we need to quote <code>&quot;equipment-ids&quot;</code> due to the dash in the key name. We must not put the array index into the quotes, though, or it won&rsquo;t work.</li>
<li>For an array slice, the syntax is <code>[M to N]</code> for the slice from <code>N</code> to <code>M</code> inclusive.</li>
<li>For arrays, the keyword <code>last</code> is the rightmost element in the array.</li>
</ul>
</li>
<li>There are wildcards:
<ul>
<li><code>.*</code> are all values of a JSON object, as an array.</li>
<li><code>[*]</code> are all the values of a JSON array, as an array.</li>
<li><code>**</code> are all paths that lead to a suffix.</li>
</ul>
</li>
</ul>
<p>So, put into practice:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t (id, j) <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;{&#34;id&#34;: 10, &#34;login&#34;: &#34;kris&#34;, &#34;fullname&#34;: &#34;Kristian \\&#34;Isotopp\\&#34; Köhntopp&#34;, &#34;equipment-ids&#34;: [10, 11, 12], &#34;borrowed&#34;:{ &#34;equipment-ids&#34;: [1,2,3]}}&#39;</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_extract(j, <span style="color:#e6db74">&#39;$.fullname&#39;</span>) <span style="color:#66d9ef">as</span> f1, json_value(j, <span style="color:#e6db74">&#39;$.fullname&#39;</span>) <span style="color:#66d9ef">as</span> f2 <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
f1: <span style="color:#e6db74">&#34;Kristian \&#34;</span>Isotopp<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34; Köhntopp&#34;</span>
f2: Kristian <span style="color:#e6db74">&#34;Isotopp&#34;</span> Köhntopp
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_extract(j, <span style="color:#e6db74">&#39;$.&#34;equipment-ids&#34;[1]&#39;</span>) <span style="color:#66d9ef">as</span> jj <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
jj: <span style="color:#ae81ff">11</span>
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_extract(j, <span style="color:#e6db74">&#39;$.&#34;equipment-ids&#34;[1 to 2]&#39;</span>) <span style="color:#66d9ef">as</span> jj <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id
 <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
jj: [<span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>]
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_extract(j, <span style="color:#e6db74">&#39;$.*&#39;</span>) <span style="color:#66d9ef">as</span> jj <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
jj: [<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;kris&#34;</span>, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;equipment-ids&#34;</span>: [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]<span style="color:#960050;background-color:#1e0010">}</span>, <span style="color:#e6db74">&#34;Kristian \&#34;</span>Isotopp<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#34; Köhntopp&#34;</span>, [<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>]]
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_extract(j, <span style="color:#e6db74">&#39;$.&#34;equipment-ids&#34;[*]&#39;</span>) <span style="color:#66d9ef">as</span> jj <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>
<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
jj: [<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>]
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> json_extract(j, <span style="color:#e6db74">&#39;$**.&#34;equipment-ids&#34;&#39;</span>) <span style="color:#66d9ef">as</span> jj <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span><span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
jj: [[<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>], [<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>]]
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>This is cumbersome to write, so we also get <code>colname-&gt;selector</code> as a shorthand for the <code>JSON_EXTRACT(colname, selector)</code> function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#39;$.&#34;equipment-ids&#34;[*]&#39;</span> <span style="color:#66d9ef">as</span> jj <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
jj: [<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>, <span style="color:#ae81ff">12</span>]
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><h2 id="from-json-values-to-sql-values">
    <a href="#from-json-values-to-sql-values">
	From JSON values to SQL values
    </a>
</h2>
<p>With our table from above, we are setting us up like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">truncate</span> <span style="color:#66d9ef">table</span> t;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">06</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t (j) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#39;{&#34;user&#34;: &#34;kris&#34;, &#34;paid&#34;: true, &#34;home&#34;: &#34;/home/kris&#34;}&#39;</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">02</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t (j) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#39;{&#34;user&#34;: &#34;sven&#34;, &#34;paid&#34;: false, &#34;home&#34;: &#34;/home/sven&#34;}&#39;</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">03</span> sec)
</code></pre></div><p>We can ask for the payment status of all our users already, using the syntax from above:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>, j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid <span style="color:#66d9ef">from</span> t;
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">user</span>   <span style="color:#f92672">|</span> paid  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;kris&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;sven&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>We cannot SQL <code>SELECT</code> all users that have paid, yet:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> paid  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span>, <span style="color:#ae81ff">1</span> warning (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

Warning (Code <span style="color:#ae81ff">3986</span>): Evaluating a JSON value <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">SQL</span> boolean context does an <span style="color:#66d9ef">implicit</span> comparison against JSON integer <span style="color:#ae81ff">0</span>; <span style="color:#66d9ef">if</span> this <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">not</span> what you want, consider converting JSON <span style="color:#66d9ef">to</span> a <span style="color:#66d9ef">SQL</span> numeric <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">with</span> JSON_VALUE RETURNING

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>, j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> json_value(j, <span style="color:#e6db74">&#39;$.paid&#39;</span> returning signed);
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">user</span>   <span style="color:#f92672">|</span> paid <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;kris&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>The function <a href="https://dev.mysql.com/doc/refman/8.0/en/json-search-functions.html#function_json-value" target="_blank" rel="noopener"><code>JSON_VALUE()</code></a>

 provides a type cast from JSON to SQL, making extracted JSON values available to SQL comparisons and conditions. Follow the link and look it up. There is no <code>INTEGER</code>, you have to be more specific, <code>SIGNED</code> or <code>UNSIGNED</code>, the types match the ones used in <code>CAST()</code>. There are also <code>ON EMPTY</code> and <code>ON ERROR</code> clauses.</p>
<p>Using <code>JSON_VALUE()</code> we can do the work of <code>JSON_EXTRACT()</code>, <code>JSON_UNQUOTE()</code> and <code>CAST()</code> in one go, and have control about handling of non-existent paths (<code>ON EMPTY</code>) and conversion errors (<code>ON ERROR</code>).</p>
<p>We could have used cast as well:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>,
<span style="color:#f92672">-&gt;</span>   j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid, 
<span style="color:#f92672">-&gt;</span>   <span style="color:#66d9ef">cast</span>(j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> signed) <span style="color:#66d9ef">as</span> casted, 
<span style="color:#f92672">-&gt;</span>   json_value(j, <span style="color:#e6db74">&#34;$.paid&#34;</span> returning signed) <span style="color:#66d9ef">as</span> valued 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">from</span> t;
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+--------+--------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">user</span>   <span style="color:#f92672">|</span> paid  <span style="color:#f92672">|</span> casted <span style="color:#f92672">|</span> valued <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+--------+--------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;kris&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span>  <span style="color:#f92672">|</span>      <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>      <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;sven&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">|</span>      <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>      <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+--------+--------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>,
<span style="color:#f92672">-&gt;</span>   j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">from</span> t
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">cast</span>(j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> signed);
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">user</span>   <span style="color:#f92672">|</span> paid <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;kris&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)


mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>, 
<span style="color:#f92672">-&gt;</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">from</span> t 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">where</span> json_value(j, <span style="color:#e6db74">&#34;$.paid&#34;</span> returning signed);
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">user</span>   <span style="color:#f92672">|</span> paid <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;kris&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Note that I left out the <code>JSON_UNQUOTE()</code> in the <code>CAST()</code> example, because I converted JSON <code>BOOLEAN</code> types to SQL <code>SIGNED</code> types, so no quoted strings needed handling. <code>JSON_VALUE(col, selector RETURNING type)</code> is actually <code>CAST(JSON_UNQUOTE(JSON_EXTRACT(col, selector)) AS type)</code>.</p>
<h2 id="updating-json-values">
    <a href="#updating-json-values">
	Updating JSON values
    </a>
</h2>
<p>Reusing the example above, we can try to update the payment status of a user using the <a href="https://dev.mysql.com/doc/refman/8.0/en/json-modification-functions.html#function_json-set" target="_blank" rel="noopener"><code>JSON_SET()</code></a>

 function. Doing this, we need to be careful.</p>
<p>First, let&rsquo;s check if we can isolate the row we want to see elegantly:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>, 
<span style="color:#f92672">-&gt;</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid,  
<span style="color:#f92672">-&gt;</span> json_type(j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span>) <span style="color:#66d9ef">as</span> paid <span style="color:#66d9ef">from</span> t;
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">user</span>   <span style="color:#f92672">|</span> paid  <span style="color:#f92672">|</span> paid    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;kris&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span>  <span style="color:#f92672">|</span> BOOLEAN <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;sven&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">|</span> BOOLEAN <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>, 
<span style="color:#f92672">-&gt;</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">from</span> t 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">where</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;kris&#34;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">user</span>   <span style="color:#f92672">|</span> paid <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;kris&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">true</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>, 
<span style="color:#f92672">-&gt;</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">from</span> t 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">where</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;KRIS&#34;</span>;
Empty <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>We notice: while this works, it is working with JSON character sets, so it is <code>utf8mb4</code> with a collation of <code>utf8mb4_bin</code>, hence case sensitive comparison.</p>
<p>Using <code>JSON_SET()</code> we update the <code>$.paid</code> field of that user to <code>false</code>, and run into the next problem:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> t 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">set</span> j<span style="color:#f92672">=</span>json_set(j, <span style="color:#e6db74">&#34;$.paid&#34;</span>, <span style="color:#e6db74">&#34;false&#34;</span> ) 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">where</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;kris&#34;</span>;
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)
<span style="color:#66d9ef">Rows</span> matched: <span style="color:#ae81ff">1</span>  Changed: <span style="color:#ae81ff">1</span>  Warnings: <span style="color:#ae81ff">0</span>

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> t;
<span style="color:#f92672">+</span><span style="color:#75715e">----+---------------------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> j                                                       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+---------------------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;home&#34;</span>: <span style="color:#e6db74">&#34;/home/kris&#34;</span>, <span style="color:#e6db74">&#34;paid&#34;</span>: <span style="color:#e6db74">&#34;false&#34;</span>, <span style="color:#e6db74">&#34;user&#34;</span>: <span style="color:#e6db74">&#34;kris&#34;</span><span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;home&#34;</span>: <span style="color:#e6db74">&#34;/home/sven&#34;</span>, <span style="color:#e6db74">&#34;paid&#34;</span>: <span style="color:#66d9ef">false</span>, <span style="color:#e6db74">&#34;user&#34;</span>: <span style="color:#e6db74">&#34;sven&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>   <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+---------------------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">user</span>, 
<span style="color:#f92672">-&gt;</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span> <span style="color:#66d9ef">as</span> paid, 
<span style="color:#f92672">-&gt;</span> json_type(j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.paid&#34;</span>) <span style="color:#66d9ef">as</span> paid 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">from</span> t;
<span style="color:#f92672">+</span><span style="color:#75715e">--------+---------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">user</span>   <span style="color:#f92672">|</span> paid    <span style="color:#f92672">|</span> paid    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+---------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;kris&#34;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;false&#34;</span> <span style="color:#f92672">|</span> STRING  <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;sven&#34;</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">false</span>   <span style="color:#f92672">|</span> BOOLEAN <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+---------+---------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">2</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>That is not what we want. But did we not insert values <code>&quot;false&quot;</code> and <code>&quot;true&quot;</code> into JSON fields earlier and got booleans?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> t (id, j) <span style="color:#66d9ef">values</span> (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;false&#34;</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> id, j, json_type(j) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> j     <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span>    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">3</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">|</span> BOOLEAN <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Well, yes, but…</p>
<p>Functions in MySQL expect types, and convert to these types. <code>JSON_SET()</code> expects JSON, so we do it like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">update</span> t 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">set</span> j<span style="color:#f92672">=</span>json_set(j, <span style="color:#e6db74">&#34;$.paid&#34;</span>, <span style="color:#66d9ef">false</span> ) 
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">where</span> j<span style="color:#f92672">-&gt;</span><span style="color:#e6db74">&#34;$.user&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;kris&#34;</span>;
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)
<span style="color:#66d9ef">Rows</span> matched: <span style="color:#ae81ff">1</span>  Changed: <span style="color:#ae81ff">1</span>  Warnings: <span style="color:#ae81ff">0</span>

mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> id, j, json_type(j) <span style="color:#66d9ef">as</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">from</span> t <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> j     <span style="color:#f92672">|</span> <span style="color:#66d9ef">type</span>    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">false</span> <span style="color:#f92672">|</span> BOOLEAN <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+-------+---------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>There is <a href="https://dev.mysql.com/doc/refman/8.0/en/json-modification-functions.html#function_json-remove" target="_blank" rel="noopener"><code>JSON_REMOVE()</code></a>

, &ldquo;Removes data from a JSON document&rdquo;. There are also <a href="https://dev.mysql.com/doc/refman/8.0/en/json-modification-functions.html#function_json-set" target="_blank" rel="noopener"><code>JSON_SET()</code></a>

, and friends:</p>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/json-modification-functions.html#function_json-set" target="_blank" rel="noopener"><code>JSON_SET()</code></a>

 replaces existing values and adds nonexisting values.</li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/json-modification-functions.html#function_json-insert" target="_blank" rel="noopener"><code>JSON_INSERT()</code></a>

 inserts values without replacing existing values.</li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/json-modification-functions.html#function_json-replace" target="_blank" rel="noopener"><code>JSON_REPLACE()</code></a>

 replaces only existing values.</li>
</ul>
<p>These are the basic tools we need to get JSON into and out of tables. We now just need to make it fast - the stuff for another article.</p>


	
    </article>
</div>



            <footer>
    <p>
	&copy; Copyright 2021 Someone or something
    </p>
</footer>


        </main>

	





<script src="/js/bootstrap.js"></script>




<script src="/js/lunr.js"></script>





<script src="/js/app.js"></script>


    </body>
</html>
