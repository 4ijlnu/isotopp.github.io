<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp - .mylogin.cnf Passworte wiederherstellen</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="site.webmanifest">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">





	



<link rel="stylesheet" href="/style.min.c5e5cd61f54911f9aafd1dbe09c2f90667957bfe1002126c87aace57759f3446.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
	<a class="navbar-brand" href="" rel="home" title=".Site.Title">
	    Die wunderbare Welt von Isotopp
	</a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
		
		
		<li class="nav-item ">
                    <a class="nav-link" href="/about/">
			
			<span>About</span>
			<span class="visually-hidden">(Current)</span>
		    </a>
		    
		</li>
            </ul>
            
	</div>
    </div>
</nav>


        <main role="main" class="container-fluid">

            


<div class="page">
    <article class=".mylogin.cnf-passworte-wiederherstellen-page">
	<h1 class="title">
            .mylogin.cnf Passworte wiederherstellen
	</h1>

	<p>Wie Todd Farmer in
<a href="http://mysqlblog.fivefarmers.com/2012/08/16/understanding-mysql_config_editors-security-aspects/" target="_blank" rel="noopener">Understanding mysql_config_editor’s security aspects</a>


richtig beobachtet, speichert die neue .mylogin.cnf, die von <a href="http://dev.mysql.com/doc/refman/5.6/en/mysql-config-editor.html" target="_blank" rel="noopener">mysql_config_editor</a>


erzeugt wird, Paßworte nicht sicher ab.  Sie verschleiert sie nur.</p>
<p>Das Format der Datei ist wie folgt (am Beispiel von MySQL 5.6.7-RC):</p>
<ul>
<li>4 Bytes Zero (Version Information)</li>
<li>20 Bytes Key Generation Matter</li>
<li>Wiederholend:
<ul>
<li>4 Bytes Länge</li>
<li>Länge Bytes Ciphertext. Die Verschlüsselung erfolgt mit
<a href="//dev.mysql.com/doc/refman/5.5/en//encryption-functions.html#function_aes-encrypt">AES Encrypt</a>

,
und diese Funktion ist selbst auch nicht sicher: Es handelt sich um einen aes-128-ecb mit einem NULL IV.</li>
</ul>
</li>
</ul>
<p>Der Schlüssel, der in AES 128 rein geht, muß BINARY(16) sein, aber die
Funktion nimmt Strings beliebiger Länge.  Sie erzeugt den tatsächlich
verwendeten Key, indem sie den mitgegebenen String zyklisch in einen
BINARY(16) Puffer rein XOR&rsquo;t, der mit Nullbytes initialisiert worden ist.</p>
<p>In Code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">#! /usr/bin/php  -q
</span><span style="color:#75715e"></span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
$fp <span style="color:#f92672">=</span> <span style="color:#a6e22e">fopen</span>(<span style="color:#e6db74">&#34;.mylogin.cnf&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>);
<span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$fp) {
  <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;Cannot open .mylogin.cnf&#34;</span>);
}

<span style="color:#75715e"># read key
</span><span style="color:#75715e"></span><span style="color:#a6e22e">fseek</span>($fp, <span style="color:#ae81ff">4</span>);
$key <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($fp, <span style="color:#ae81ff">20</span>);

<span style="color:#75715e"># generate real key
</span><span style="color:#75715e"></span>$rkey <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#66d9ef">for</span> ($i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $i <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">strlen</span>($key); $i<span style="color:#f92672">++</span>) {
 $rkey[$i <span style="color:#f92672">%</span> <span style="color:#ae81ff">16</span>] <span style="color:#f92672">=</span> ( $rkey[$i <span style="color:#f92672">%</span> <span style="color:#ae81ff">16</span>] <span style="color:#f92672">^</span> $key[$i] );
}

<span style="color:#75715e"># for each line
</span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span> ($len <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($fp, <span style="color:#ae81ff">4</span>)) {
  <span style="color:#75715e"># as integer
</span><span style="color:#75715e"></span>  $len <span style="color:#f92672">=</span> <span style="color:#a6e22e">unpack</span>(<span style="color:#e6db74">&#34;V&#34;</span>, $len);
  $len <span style="color:#f92672">=</span> $len[<span style="color:#ae81ff">1</span>];

  <span style="color:#75715e"># decrypt  
</span><span style="color:#75715e"></span>  $crypt <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($fp, $len);
  $plain <span style="color:#f92672">=</span> <span style="color:#a6e22e">openssl_decrypt</span>($crypt, <span style="color:#e6db74">&#39;aes-128-ecb&#39;</span>, $rkey, <span style="color:#66d9ef">true</span>);

  <span style="color:#75715e"># print
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">print</span> $plain;
}
</code></pre></div><p>Die Datei selber ist dann ein simples Textfile, nicht unähnlich einer
.my.cnf:</p>
<pre><code class="language-console" data-lang="console">server:~ # ./p.php
[default]
user = root
password = s3cret
host = localhost
[localhost]
user = root
password = s3cret
host = 127.0.0.1
</code></pre><p>Teil des Problems ist die Tatsache, daß das MySQL Protokoll das
Klartextpaßwort auf dem Client in lesbar braucht, um ein Login zu
ermöglichen.  Wir haben Alternativen in
<a href="http://mysqldump.azundris.com/archives/96-pam-modules-for-MySQL-What-is-wrong-with-these-people.html" target="_blank" rel="noopener">diesem Artikel</a>


diskutiert.  SSL Client Certs würden auch helfen.</p>


	
    </article>
</div>



            <footer>
    <p>
	&copy; Copyright 2021 Someone or something
    </p>
</footer>


        </main>

	





<script src="/js/bootstrap.js"></script>




<script src="/js/lunr.js"></script>





<script src="/js/app.js"></script>


    </body>
</html>
