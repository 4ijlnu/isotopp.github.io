<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp - MySQL: Zeichensatz-Grundlagen</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="site.webmanifest">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">





	



<link rel="stylesheet" href="/style.min.c5e5cd61f54911f9aafd1dbe09c2f90667957bfe1002126c87aace57759f3446.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
	<a class="navbar-brand" href="" rel="home" title=".Site.Title">
	    Die wunderbare Welt von Isotopp
	</a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
		
		
		<li class="nav-item ">
                    <a class="nav-link" href="/about/">
			
			<span>About</span>
			<span class="visually-hidden">(Current)</span>
		    </a>
		    
		</li>
            </ul>
            
	</div>
    </div>
</nav>


        <main role="main" class="container-fluid">

            


<div class="page">
    <article class="mysql-zeichensatz-grundlagen-page">
	<h1 class="title">
            MySQL: Zeichensatz-Grundlagen
	</h1>

	<p>Markus fragt:</p>
<blockquote>
<p>Durch  &hellip; wechseln wir gerade unseren Root-Server. Dort habe ich bereits
das Gentoo-Basissystem am fluppen. Bei der Umstellung möchte ich gleich
von MySQL 4 auf 5 wechseln.Dabei stellt sich die Frage, ob ich das System
nicht gleich von latin1 auf utf-8 umstellen soll. Sollte ich lieber bei
latin1 bleiben und alles so migrieren oder doch den großen Wurf zu utf-8
wagen?</p>
</blockquote>
<p>Die Frage habe ich ihm schon beantwortet, aber versprochen, das Thema noch
einmal im Blog &ldquo;in groß&rdquo; durchzudeklinieren. Hier also der
[Zeichensatz-Artikel]({% link _posts/2006-08-06-zeichensatz-rger.md %})
redone.</p>
<h3 id="zeichensatztheorie">
    <a href="#zeichensatztheorie">
	Zeichensatztheorie
    </a>
</h3>
<p><p class="md__image">
  <img src="/uploads/charset.png" alt=""  />
</p>

</p>
<p>Zusammenhänge zwischen den Begriffen.</p>
<p>Ein Zeichensatz (&ldquo;CHARACTER SET&rdquo;) ist eigentlich ein Symbolvorrat, also eine
Liste von Symbolen, die in einer bestimmten Sammlung enthalten sind. Ein
Zeichensatz ist damit ein ganz und gar abstraktes und nahezu nutzloses Ding.
Das einzige, was man mit einem Zeichensatz alleine tun kann, ist zu
entscheiden, ob ein bestimmtes Symbol in einem bestimmten Kontext erlaubt
ist oder nicht.</p>
<p>Damit die Symbole druckbar werden, benötigt man einen Font. So ist zum
Beispiel dies hier &ldquo;<!-- raw HTML omitted -->ö<!-- raw HTML omitted -->&rdquo; ein LOWER CASE O-UMLAUT in Arial und &ldquo;<!-- raw HTML omitted -->ö<!-- raw HTML omitted -->&rdquo; dasselbe Symbol in einem anderen Font, Times New Roman.</p>
<p>Damit Symbole von Computern verarbeitbar werden, benötigen sie eine binäre
Repräsentation, ein Encoding. In meinem Terminal, konsole, wird
standardmäßig das utf8-Encoding verwendet. Der Text &ldquo;Köhntopp&rdquo; wird dabei
durch die Hex-Folge &ldquo;4b c3 b6 68 6e 74 6f 70 70&rdquo; repräsentiert, das LOWER
CASE o-UMLAUT wird als C3 B6 codiert.</p>
<pre><code class="language-console" data-lang="console">kris@linux:~&gt; od -t x1a
Köhntopp
0000000 4b c3 b6 68 6e 74 6f 70 70 0a
          K   C   6   h   n   t   o   p   p  nl
0000012
</code></pre><p>Nach dem Aufruf von Settings-&gt;Encoding-&gt;Iso-8859-1 hat sich das Encoding
geändert und derselbe Text wird jetzt durch die Bytes &ldquo;4b f6 68 6e 74 6f 70
70 0a&rdquo; repräsentiert. Der LOWER CASE o-UMLAUTE ist nun also ein F6-Byte.</p>
<pre><code class="language-console" data-lang="console">kris@linux:~&gt; od -t x1a
Köhntopp
0000000 4b f6 68 6e 74 6f 70 70 0a
          K   v   h   n   t   o   p   p  nl
0000011
</code></pre><p>Wenn man zwei Zeichenfolgen vergleichen oder ordnen (sortieren) will, dann
braucht man eine zu dem Encoding passende Collation. Eine Collation kann man
sich als eine normierte Codierung eines Encodings vorstellen, das für
Vergleichs- und Sortierzwecke verwendet wird.</p>
<p>Die MySQL-Collation latin1_german1_ci erzeugt aus &ldquo;Köhntopp&rdquo; zum Beispiel
&ldquo;kohntopp&rdquo; und verwendet diesen String dann, um ihn mit anderen Strings zu
vergleichen und zu sortieren. Abgespeichert wird allerdings immer der
Originalwert, also &ldquo;Köhntopp&rdquo;. Eine andere Collation, latin1_german2_ci,
würde den Text &ldquo;Köhntopp&rdquo; stattdessen intern in &ldquo;koehntopp&rdquo; umwandeln, bevor
verglichen und sortiert wird (aber ebenso &ldquo;Köhntopp&rdquo; abspeichern).</p>
<h3 id="zeichensätze-im-server">
    <a href="#zeichens%c3%a4tze-im-server">
	Zeichensätze im Server
    </a>
</h3>
<p>Aus irgendeinem Grund nennt MySQL ein Encoding einen CHARACTER SET oder
CHARSET. Die im Server verfügbaren Encodings können mit SHOW CHARSET
aufgelistet werden. Sie sind auch in INFORMATION_SCHEMA.CHARACTER_SETS
verfügbar. In beiden Fällen gibt die Spalte &ldquo;Maxlen&rdquo; an, wieviele Bytes ein
Zeichen in diesem Zeichensatz maximal verbrauchen kann.</p>
<p>Die Liste der vom Server unterstützten Collations kann man mit SHOW
COLLATION anzeigen. Sie ist auch als INFORMATION_SCHEMA.COLLATIONS abrufbar.
Eine Collation ist nur im Zusammenhang mit einem Encoding sinnvoll, daher
muß diese Tabelle mit der INFORMATION_SCHEMA.CHARACTER_SETS über die n:m
Beziehung INFORMATION_SCHEMA. COLLATION_CHARACTER_SET_APPLICABILITY
verknüpft werden (oder man verwendet SHOW COLLATION LIKE &lsquo;&hellip;%').</p>
<h3 id="encoding-und-collation-festlegen">
    <a href="#encoding-und-collation-festlegen">
	Encoding und Collation festlegen
    </a>
</h3>
<p>Jeder String in MySQL ist mit einem Encoding und einer Collation markiert.
Für Datenbankobjekte geschieht dies auf der Spaltenebene: Eine Spalte mit
CHAR, VARCHAR oder einem TEXT-Typ ist immer auch mit einem CHARSET und einer
COLLATION versehen.</p>
<p>Gibt man diese nicht ausdrücklich an, so wird der CHARSET und die COLLATION
der Tabelle, in der diese Spalte enthalten ist, nach unten vererbt. Und
natürlich erbt die Tabelle CHARSET und COLLATION von der DATABASE, die diese
wiederum von den Server Defaults vererbt.</p>
<p>Man kann also in der my.cnf festlegen:</p>
<pre><code class="language-console" data-lang="console">[mysqld]
default-character-set=latin1
default-collation=latin1_german1_ci
</code></pre><p>Man kann auch beim Anlegen eines Schemas (einer logischen Datenbank)
festlegen:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [(<span style="color:#66d9ef">none</span>)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> kris charset latin1 <span style="color:#66d9ef">collate</span> latin1_german1_ci;
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [(<span style="color:#66d9ef">none</span>)]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">database</span> kris<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
       <span style="color:#66d9ef">Database</span>: kris
<span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">Database</span>: <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#f92672">`</span>kris<span style="color:#f92672">`</span>
   <span style="color:#75715e">/*!40100 DEFAULT CHARACTER SET latin1 
</span><span style="color:#75715e">    COLLATE latin1_german1_ci */</span>
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Für eine Tabelle und deren Spalten kann man bestimmen:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> t (
  id integer unsigned <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">null</span> auto_increment <span style="color:#66d9ef">primary</span> <span style="color:#66d9ef">key</span>, 
  <span style="color:#66d9ef">c</span> char(<span style="color:#ae81ff">20</span>) charset utf8 <span style="color:#66d9ef">collate</span> utf8_general_ci, 
  d varchar(<span style="color:#ae81ff">20</span>) charset cp850 <span style="color:#66d9ef">collate</span> cp850_general_ci, 
  t text charset latin1 <span style="color:#66d9ef">collate</span> latin1_german1_ci 
) charset latin1 <span style="color:#66d9ef">collate</span> latin1_general_ci;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">01</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">show</span> <span style="color:#66d9ef">create</span> <span style="color:#66d9ef">table</span> t<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
       <span style="color:#66d9ef">Table</span>: t
<span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">Table</span>: <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>t<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> auto_increment,
  <span style="color:#f92672">`</span><span style="color:#66d9ef">c</span><span style="color:#f92672">`</span> char(<span style="color:#ae81ff">20</span>) character <span style="color:#66d9ef">set</span> utf8 <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>d<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) character <span style="color:#66d9ef">set</span> cp850 <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>t<span style="color:#f92672">`</span> text character <span style="color:#66d9ef">set</span> latin1 <span style="color:#66d9ef">collate</span> latin1_german1_ci,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>  (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
) ENGINE<span style="color:#f92672">=</span>MyISAM 
<span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>latin1 
<span style="color:#66d9ef">COLLATE</span><span style="color:#f92672">=</span>latin1_general_ci
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Die Verbindung, die der Client zur Datenbank aufbaut, muß ebenfalls mit
einem Encoding und einer Collation getagged sein, denn wenn man
beispielsweise ein LOWER CASE o-UMLAUT von einem utf8-Terminal in kirs.t.t
einfügen will, dann muß dieses Symbol ja von utf8 (C3B6) nach latin1 (F6)
gewandelt werden.</p>
<p>Man kann default-character-set und default-encoding in der [mysql]-Sektion
seiner my.cnf festlegen, oder sie mit SET NAMES später umstellen.</p>
<p>Indem ich in konsole Settings-&gt;Encoding-&gt;utf8 einstelle und dann SET NAMES
utf8 im Kommandozeilenclient von MySQL mache, sende ich nicht nur utf8,
sondern habe den Client auch über diese Tatsache informiert.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">names</span> utf8;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> hex(<span style="color:#e6db74">&#34;ö&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> hex(<span style="color:#e6db74">&#34;ö&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> C3B6      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Stelle ich in konsole Settings-&gt;Encoding-&gt;latin1 ein und sende SET NAMES
latin1, dann bekomme ich:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">names</span> latin1;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> hex(<span style="color:#e6db74">&#34;ö&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> hex(<span style="color:#e6db74">&#34;ö&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> F6       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Warum ist das wichtig und nützlich? Nun, wenn ich mit meinem utf8-Client an
die Datenbank gehe und Daten nach kris.t.t speichere, was wird dann
geschehen?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">set</span> <span style="color:#66d9ef">names</span> utf8;
Query OK, <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">rows</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> hex(<span style="color:#e6db74">&#34;ö&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> hex(<span style="color:#e6db74">&#34;ö&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> C3B6      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">insert</span> <span style="color:#66d9ef">into</span> kris.t (t) <span style="color:#66d9ef">values</span> (<span style="color:#e6db74">&#34;ö&#34;</span>);
Query OK, <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> affected (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> hex(t), t <span style="color:#66d9ef">from</span> kris.t;
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> hex(t) <span style="color:#f92672">|</span> t    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> F6     <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">ö</span>    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------+------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Ich habe also einen Client, der utf8 spricht und sendet. Das kann ich
kontrollieren (&ldquo;set names utf8&rdquo;) und beweisen (Ich bekomme ein C3B6).
Speichere ich dieses utf8-codierte Symbol in eine Spalte, die als
latin1-codiert markiert ist, wird MySQL das Encoding des Symbols anpassen
und den richtigen Code (F6) speichern. Ich kann das beweisen, indem ich
hex(spaltenname) und spaltenname aus der Tabelle selektiere: Es wurde
tatsächlich ein LOWER CASE o-UMLAUT in latin1 encoding gespeichert, und
obwohl das so gespeichert wurde, wird mir ein ö in meinem utf8-Terminal
angezeigt - der Wert wurde also für meine Verbindung auch wieder zurück
gewandelt!</p>
<h3 id="einen-dump-laden">
    <a href="#einen-dump-laden">
	Einen Dump laden
    </a>
</h3>
<p>Wenn man einen alten MySQL 4.0 mysqldump hat, dann sind in diesem Datenbank-
und Tabellendefinitionen ohne Zeichensatzangaben enthalten. Man muß in
diesem Fall vor dem Import in einen neueren Server die Defaults korrekt
setzen. Korrekt bedeutet hier: So, daß die Datenbanken und Tabellen mit den
Character Sets und Collations anlegegt werden, die man haben will. Am
einfachsten erreicht man das, indem man das CREATE DATABASE-Statement im
Dump sucht und passend editiert. Diese Defaults werden dann ja auf alle
anderen Objekte herunter vererbt.</p>
<p>Die Connection, mit der der Dump eingelesen wird, muß außerdem mit der
passenden Character Set-Information versehen werden. Dazu bestimmt man den
Character Set im Dumpfile, indem man dieses durch &ldquo;od -t x1a&rdquo; filtert und
mal nach einigen Umlauten sucht. Welcher Zeichensatz wird im Dumpfile
verwendet?</p>
<p>Dieser Zeichensatz muß dann für das Einlesen des Dumps verwendet werden. Am
einfachsten fügt man ein passendes SET NAMES-Statement in das Dumpfile ein.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">--
</span><span style="color:#75715e">-- Table structure for table `t`
</span><span style="color:#75715e">--
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#f92672">`</span>t<span style="color:#f92672">`</span>;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>t<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> int(<span style="color:#ae81ff">10</span>) unsigned <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span><span style="color:#66d9ef">c</span><span style="color:#f92672">`</span> char(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>d<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">default</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>t<span style="color:#f92672">`</span> text,
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>  (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
) <span style="color:#66d9ef">TYPE</span><span style="color:#f92672">=</span>MyISAM;

<span style="color:#75715e">--
</span><span style="color:#75715e">-- Dumping data for table `t`
</span><span style="color:#75715e">--
</span><span style="color:#75715e"></span>

<span style="color:#75715e">/*!40000 ALTER TABLE `t` DISABLE KEYS */</span>;
<span style="color:#66d9ef">LOCK</span> TABLES <span style="color:#f92672">`</span>t<span style="color:#f92672">`</span> <span style="color:#66d9ef">WRITE</span>;
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">`</span>t<span style="color:#f92672">`</span> <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">1</span>,<span style="color:#66d9ef">NULL</span>,<span style="color:#66d9ef">NULL</span>,<span style="color:#e6db74">&#39;ö&#39;</span>);
UNLOCK TABLES;
<span style="color:#75715e">/*!40000 ALTER TABLE `t` ENABLE KEYS */</span>;
...
linux:<span style="color:#f92672">/</span>export<span style="color:#f92672">/</span><span style="color:#66d9ef">data</span><span style="color:#f92672">/</span>charset <span style="color:#f92672">#</span> od <span style="color:#f92672">-</span>t x1a kris.<span style="color:#66d9ef">sql</span>
...
<span style="color:#ae81ff">0001560</span> <span style="color:#ae81ff">53</span> <span style="color:#ae81ff">20</span> <span style="color:#ae81ff">28</span> <span style="color:#ae81ff">31</span> <span style="color:#ae81ff">2</span><span style="color:#66d9ef">c</span> <span style="color:#ae81ff">4</span>e <span style="color:#ae81ff">55</span> <span style="color:#ae81ff">4</span><span style="color:#66d9ef">c</span> <span style="color:#ae81ff">4</span><span style="color:#66d9ef">c</span> <span style="color:#ae81ff">2</span><span style="color:#66d9ef">c</span> <span style="color:#ae81ff">4</span>e <span style="color:#ae81ff">55</span> <span style="color:#ae81ff">4</span><span style="color:#66d9ef">c</span> <span style="color:#ae81ff">4</span><span style="color:#66d9ef">c</span> <span style="color:#ae81ff">2</span><span style="color:#66d9ef">c</span> <span style="color:#ae81ff">27</span>
          S  sp   (   <span style="color:#ae81ff">1</span>   ,   N   U   L   L   ,   N   U   L   L   ,   <span style="color:#e6db74">&#39;
</span><span style="color:#e6db74">0001600 f6 27 29 3b 0a 55 4e 4c 4f 43 4b 20 54 41 42 4c
</span><span style="color:#e6db74">          v   &#39;</span>   )   ;  nl   U   N   L   O   <span style="color:#66d9ef">C</span>   K  sp   T   A   B   L
...

</code></pre></div><p>Wir können nun leicht dieses Dumpfile um ein &ldquo;CREATE DATABASE kris CHARSET
utf8 COLLATE utf8_general_ci&rdquo; ergänzen und ein &ldquo;SET NAMES latin1&rdquo; zufügen.
Dadurch bekommen wir eine Datenbank kris, die Zeichen in utf8 speichert. Da
die Verbindung auf latin1 gesetzt wird, wird beim Einlesen der korrekte
Zeichensatz für den Dump verwendet und alle Daten werden beim Lesen und
Speichern von latin1 nach utf8 gewandelt. Für die Clients, die die Daten
später verwenden, ist dies irrelevant: Sie legen mit SET NAMES fest, in
welchem Zeichensatz sie die Ergebnisse bekommen wollen und MySQL wird die
Zeichen bei der Ausgabe entsprechend den Wünschen der Clients umwandeln.</p>
<h3 id="selber-wandeln">
    <a href="#selber-wandeln">
	Selber wandeln
    </a>
</h3>
<p>Eine Stringkonstante kann in MySQL mit einem Encoding prefixed werden.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> _utf8<span style="color:#e6db74">&#39;Köhntopp&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Köhntopp <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Köhntopp  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>Dies ist dasselbe wie &ldquo;SELECT &lsquo;Köhntopp&rsquo;&rdquo;, nur daß der Zeichensatz
ausdrücklich an den Ausdruck geklebt wird und nun vom SET NAMES verschieden
sein kann.</p>
<p>Wir können auch Daten in andere Zeichensätze umwandeln:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> hex(<span style="color:#66d9ef">convert</span>(<span style="color:#e6db74">&#39;Köhntopp&#39;</span> <span style="color:#66d9ef">using</span> latin1)) <span style="color:#66d9ef">as</span> Beispiel;
<span style="color:#f92672">+</span><span style="color:#75715e">------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Beispiel         <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">4</span>BF6686E746F7070 <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">03</span> sec)
</code></pre></div><p>Hier ist mein utf8-Köhntopp aus der Connection in ein latin1-Köhntopp mit
F6-Umlaut umgewandelt worden.</p>
<h3 id="die-kosten-von-utf8">
    <a href="#die-kosten-von-utf8">
	Die Kosten von utf8
    </a>
</h3>
<p>Unicode ist ein Zeichensatz mit mehr als 256 Zeichen und utf8 ist ein
Multibyte-Encoding für diesen Zeichensatz, in dem Zeichen eine variable
Länge haben können. Einige Symbole (&ldquo;a&rdquo;, &ldquo;Z&rdquo;) werden als einzelne Bytes
codiert, andere (&ldquo;ö&rdquo;) als Folgen von Bytes. Der Subset von Unicode, der von
MySQL unterstützt wird, kann bis zu 3 Byte für ein Zeichen verbrauchen.
Daher wird der Zeichensatz mit einer Maxlen von 3 in &ldquo;SHOW CHARSET&rdquo;
markiert.</p>
<p>Ein anderes Encoding von Unicode ist ucs2: Während utf8 von Unix und Java
verwendet wird, wird ucs2 von Windows-Systemen bevorzugt. ucs2 codiert alle
Unicode-Zeichen gleich lang, und verwendet für den Subset von Unicode, der
hier unterstützt wird, immer 2 Bytes. Die angezeigte Maxlen ist also 2.</p>
<p>Hier alle drei Encodings im Vergleich:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> hex(<span style="color:#66d9ef">convert</span>(<span style="color:#e6db74">&#34;Köhntopp&#34;</span> <span style="color:#66d9ef">using</span> ucs2)) <span style="color:#66d9ef">as</span> x;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> x <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">004</span>B00F60068006E0074006F00700070     <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> hex(<span style="color:#66d9ef">convert</span>(<span style="color:#e6db74">&#34;Köhntopp&#34;</span> <span style="color:#66d9ef">using</span> latin1)) <span style="color:#66d9ef">as</span> x;
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> x <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">4</span>BF6686E746F7070                       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

root<span style="color:#f92672">@</span>localhost [kris]<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">select</span> hex(<span style="color:#e6db74">&#34;Köhntopp&#34;</span>) <span style="color:#66d9ef">as</span> x;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> x  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">4</span>BC3B6686E746F7070 <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)
</code></pre></div><p>In MySQL wird ein CHAR(20) definiert als ein String von Zeichen Zeichen. Ein
Zeichen kann mehr als ein Byte haben, also werden maxlen * Stringlänge Bytes
Platz verbraucht. Ein utf8-CHAR(20) braucht also 60 Byte.</p>
<p>Ein VARCHAR(20) ist ein String mit einer Längenkennung und dann so vielen
Bytes Speicher, wie der String tatsächlich lang ist. Ein utf8-VARCHAR(20)
kann also zwischen 1 und 60 Byte Speicher plus die Längenkennung (1 Byte,
ggf. 2 Bytes) verbrauchen.</p>
<p>Indexrecords in MyISAM haben jedoch eine feste Länge. Ein Index auch ein
utf8-VARCHAR(20) belegt also immer 60 Byte plus die Länge für den Row
Pointer (per Default 6 Byte pro zu bezeigendem Record).</p>
<p>Außerdem ist die Anzahl der Bytes, nicht Zeichen in einem Index limitiert:
Generell kann ein Index bis zu 1024 Bytes, in InnoDB sogar nur 767 Bytes
enthalten. In utf8 wird dies also zu 343 bzw. zu 255 Zeichen.</p>
<p>Die Empfehlung lautet also:</p>
<ul>
<li>Definiere den Server, das Schema und
jede Tabelle immer mit einem passenden Einbyte-Zeichensatz, z.B. latin1.</li>
<li>Definiere dann die Connection mit welchem Zeichensatz auch immer. Das kann
auch utf8 sein, obwohl das Schema latin1 verwendet.</li>
<li>Definiere alle Spalten, die einen anderen als den latin1-Zeichensatz
benötigen, wenn möglich mit dem passenden Einbyte-Zeichensatz der Sprache -
türkische Spalten also als latin5 und russische Spalten als latin2.</li>
<li>Definiere Spalten, die wirklich mehrsprachig sind, und nur diese, als
utf8. Beachte den Mehrverbrauch an Speicher für Indices und CHAR.</li>
</ul>


	
    </article>
</div>



            <footer>
    <p>
	&copy; Copyright 2021 Someone or something
    </p>
</footer>


        </main>

	





<script src="/js/bootstrap.js"></script>




<script src="/js/lunr.js"></script>





<script src="/js/app.js"></script>


    </body>
</html>
