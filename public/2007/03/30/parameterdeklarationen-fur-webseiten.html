<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>Die wunderbare Welt von Isotopp - Parameterdeklarationen für Webseiten</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="manifest" href="site.webmanifest">
<link rel="apple-touch-icon" href="icon.png">
<link rel="favicon.ico" rel="icon" type="image/ico">





	



<link rel="stylesheet" href="/style.min.c5e5cd61f54911f9aafd1dbe09c2f90667957bfe1002126c87aace57759f3446.css">


    </head>
    <body>
        

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
	<a class="navbar-brand" href="" rel="home" title=".Site.Title">
	    Die wunderbare Welt von Isotopp
	</a>
	<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
		
		
		<li class="nav-item ">
                    <a class="nav-link" href="/about/">
			
			<span>About</span>
			<span class="visually-hidden">(Current)</span>
		    </a>
		    
		</li>
            </ul>
            
	</div>
    </div>
</nav>


        <main role="main" class="container-fluid">

            


<div class="page">
    <article class="parameterdeklarationen-f%C3%BCr-webseiten-page">
	<h1 class="title">
            Parameterdeklarationen für Webseiten
	</h1>

	<p>Es ist mal wieder Zeit, sehr alte Hüte rauszukramen. Heute habe ich mir dienstlich eine Datenbank angesehen, die von PHP aus angesprochen wird. Das PHP, das dort verwendet wird, ist sehr loses PHP, also ohne die Verwendung eines großartiges Frameworks geschrieben. Entsprechend bin ich quasi sofort über SQL-Injections und XSS gefallen.</p>
<p>Denn schon nach kurzem Suchen findet man Code wie den folgenden:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$theValue <span style="color:#f92672">=</span> $_REQUEST[<span style="color:#e6db74">&#39;theValue&#39;</span>];
<span style="color:#f92672">...</span>
<span style="color:#66d9ef">if</span> ($theValue <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span>) {
  $where <span style="color:#f92672">.=</span> <span style="color:#e6db74">&#34; where theColumn = &#39;</span><span style="color:#e6db74">$theValue</span><span style="color:#e6db74">&#39;&#34;</span>;
}
</code></pre></div><p>Eigentlich hat der betrachtete Code eine <code>cleanup()</code>-Funktion, die für jeden Wert aufgerufen werden soll, und die nicht nur den Typ des Wertes deklariert, sondern auch das notwendige Escapen der Werte &ldquo;in place&rdquo; vornimmt.</p>
<p>Das ist aber in mehrfacher Hinsicht unschön.</p>
<p>Wenn man Code wie</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$_REQUEST[<span style="color:#e6db74">&#39;theValue&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">cleanup</span>($_REQUEST[<span style="color:#e6db74">&#39;theValue&#39;</span>], <span style="color:#e6db74">&#39;text&#39;</span>)
</code></pre></div><p>schreibt, und vergisst diesen Cleanup-Aufruf einzufügen, dann haben wir keinen bemerkbaren Fehler: Der Folgecode, der auf <code>$_REQUEST['theValue']</code> zugreift, bekommt Werte zu sehen und bleibt nicht mit einer Fehlermeldung &ldquo;Keine Inputreinigung vorgenommen!&rdquo; stehen.</p>
<p>Außerdem sind die angewendeten Typprüfungen nicht flexibel genug und gehen nicht weit genug. &lsquo;text&rsquo; erzeugt im betrachteten Code gerade mal ein <code>mysql_real_escape_string()</code>, aber wendet keine weitergehenden Prüfungen auf den Eingabewert ein. Außerdem werden Eingabewerte, die für die Seite gar nicht da sein dürfen, trotzdem akzeptiert und dann vielleicht ignoriert – vielleicht aber auch nicht.</p>
<p>(Das folgende Codebeispiel zum Runterladen: [input_validation.php.txt](/uploads/input_validation.php.txt&quot; title=&ldquo;input_validation.php.txt&rdquo; target=&quot;_blank))</p>
<p>Kurz gesagt: Was ich möchte ist eigentlich eine Typdeklaration für eine PHP-Seite, die die Eingabeparameter mit Namen und Typprüfungen deklariert.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$cleaners <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
  <span style="color:#e6db74">&#34;county&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>( <span style="color:#e6db74">&#34;check&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;text_regex&#34;</span>, <span style="color:#e6db74">&#34;pattern&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;[a-zA-Z0-9]+&#34;</span> ),
  <span style="color:#e6db74">&#34;year&#34;</span>   <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>( <span style="color:#e6db74">&#34;check&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;int_minmax&#34;</span>, <span style="color:#e6db74">&#34;min&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1834</span>, <span style="color:#e6db74">&#34;max&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1864</span>),
  <span style="color:#e6db74">&#34;quarter&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>( <span style="color:#e6db74">&#34;check&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;int_enum&#34;</span>, <span style="color:#e6db74">&#34;values&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span>) )
);
</code></pre></div><p>Ich will dann eine Eingabeprüfung, die ein Input-Array durchgeht und die Cleaners der Reihe nach anwendet. Das Resultat ist eine optionale Liste von Fehlern und ein gesäubertes Input-Array <code>$_CLEAN</code>, das vom <code>$_REQUEST</code>-Array verschieden ist.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">// simulated input
</span><span style="color:#75715e"></span>$_REQUEST <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(
  <span style="color:#e6db74">&#34;county&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;someword&#34;</span>,
  <span style="color:#e6db74">&#34;year&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">1900</span>,
  <span style="color:#e6db74">&#34;quarter&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#ae81ff">3</span>,
  <span style="color:#e6db74">&#34;bogus&#34;</span> <span style="color:#f92672">=&gt;</span> <span style="color:#e6db74">&#34;value&#34;</span>
);

<span style="color:#75715e">// collect error messages
</span><span style="color:#75715e"></span>$_ERROR <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();

<span style="color:#75715e">// clean it up
</span><span style="color:#75715e"></span>$_CLEAN <span style="color:#f92672">=</span> <span style="color:#a6e22e">clean</span>($_REQUEST, $cleaners, $_ERROR);

<span style="color:#75715e">// the cleaned input
</span><span style="color:#75715e"></span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;cleaned input</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#a6e22e">var_dump</span>($_CLEAN);

<span style="color:#75715e">// the error messages
</span><span style="color:#75715e"></span><span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;collected errors</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
<span style="color:#a6e22e">var_dump</span>($_ERROR);
</code></pre></div><p>Fehlt der <code>clean()</code>-Aufruf am Anfang einer Seite, ist <code>$_CLEAN</code> leer und späterer Code, der <code>$_CLEAN</code> referenziert, kann nicht funktionieren – der Fehler wird sofort bemerkt.</p>
<p><code>$_CLEAN</code> kann nur Werte enthalten, deren Namen als Keys in <code>$cleaners</code> deklariert sind – undeklarierte Eingabewerte existieren nicht mehr in unserem Programm. <code>$_CLEAN</code> kann außerdem nur Werte enthalten, für die die in <code>$cleaners[$k]['check']</code> deklarierten Checkerfunktionen existieren – Deklarationsfehler bei Checkerfunktionen führen zu Programmabbruch und werden so sofort bemerkt. Schließlich kann <code>$_CLEAN</code> nur Werte enthalten, für die die angegebenen Checkerfunktionen erfolgreich waren.</p>
<p>Eine Checkerfunktion hat den Namen <code>check_...</code> und gibt ein Paar (Wert, Fehlermeldung) zurück. Wenn der Wert <code>NULL</code> ist, ist eine Fehlermeldung vorhanden und kann eingesammelt werden – der Checker ist fehlgeschlagen. In allen anderen Fällen ist der Checker erfolgreich.</p>
<p>Diese Bedingungen sind schnell runtergeschrieben und sehen in Code dann so aus:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">clean</span>($R, $cleaners, <span style="color:#f92672">&amp;</span>$E <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>) {
  <span style="color:#75715e">// collected results in $C, collect errors in $E (which is optional)
</span><span style="color:#75715e"></span>  $C <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>();

  <span style="color:#75715e">// scan the request variables
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">foreach</span> ($R <span style="color:#66d9ef">as</span> $k <span style="color:#f92672">=&gt;</span> $v) {
    <span style="color:#75715e">// Check for bogus values.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span> <span style="color:#a6e22e">array_key_exists</span>($k, $cleaners)) {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">DEBUG</span>) <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;*** WARNING: Skipped bogus value </span><span style="color:#e6db74">$k</span><span style="color:#e6db74"> =&gt; </span><span style="color:#e6db74">$v\n</span><span style="color:#e6db74">&#34;</span>;
      <span style="color:#66d9ef">continue</span>;
    }
    <span style="color:#75715e">// If we make it to here, the value should be imported.
</span><span style="color:#75715e"></span>
    <span style="color:#75715e">// generic cleanup
</span><span style="color:#75715e"></span>    $v <span style="color:#f92672">=</span> <span style="color:#a6e22e">get_magic_quotes_gpc</span>() <span style="color:#f92672">?</span> <span style="color:#a6e22e">stripslashes</span>($v) <span style="color:#f92672">:</span> $v;
    $v <span style="color:#f92672">=</span> <span style="color:#a6e22e">function_exists</span>(<span style="color:#e6db74">&#34;mysql_real_escape_string&#34;</span>) <span style="color:#f92672">?</span>
               <span style="color:#a6e22e">mysql_real_escape_string</span>($v) <span style="color:#f92672">:</span> 
               <span style="color:#a6e22e">mysql_escape_string</span>($v);
    <span style="color:#75715e">// The value can be imported only, if the specified cleaner exists.
</span><span style="color:#75715e"></span>    $checkfun <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;check_&#34;</span> <span style="color:#f92672">.</span> $cleaners[$k][<span style="color:#e6db74">&#39;check&#39;</span>];
    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">function_exists</span>($checkfun)) {
      <span style="color:#75715e">// $c will then be the sanitized value
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">list</span>($c, $e) <span style="color:#f92672">=</span> $checkfun($k, $v, $cleaners[$k]);
    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#34;*** ERROR: </span><span style="color:#e6db74">$k</span><span style="color:#e6db74"> =&gt; </span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> fails &#34;</span><span style="color:#f92672">.</span>
        <span style="color:#e6db74">&#34;because specified checkfun </span><span style="color:#e6db74">$checkfun</span><span style="color:#e6db74"> does not exist.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
    }
    
    <span style="color:#75715e">// The value can be imported only, if the specified cleaner succeeded.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($c)) {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">DEBUG</span>) <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Import </span><span style="color:#e6db74">$k</span><span style="color:#e6db74">&#39;s value of </span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> as </span><span style="color:#e6db74">$c\n</span><span style="color:#e6db74">&#34;</span>; 
      $C[$k] <span style="color:#f92672">=</span> $c;
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($e)) $E[$k] <span style="color:#f92672">=</span> $e; <span style="color:#75715e">// collect error anyway
</span><span style="color:#75715e"></span>    } <span style="color:#66d9ef">else</span> {
      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">DEBUG</span>) <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;*** WARNING: Not importing </span><span style="color:#e6db74">$k</span><span style="color:#e6db74">, &#34;</span><span style="color:#f92672">.</span>
        <span style="color:#e6db74">&#34;because </span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> failed </span><span style="color:#e6db74">$checkfun</span><span style="color:#e6db74">().</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
      $E[$k] <span style="color:#f92672">=</span> $e; <span style="color:#75715e">// collect error
</span><span style="color:#75715e"></span>    }
  }
  
  <span style="color:#66d9ef">return</span> $C;
}
</code></pre></div><p>Jetzt müssen wir nur noch Checkfunktionen schreiben, die die eigentlichen Prüfungen ausführen. In unserem Fall wollen wir noch die folgenden Konventionen gelten lassen:</p>
<ul>
<li>Jede <code>checkfun</code> hat einen Parameter <code>default</code>, der einen von <code>NULL</code> verschiedenen Default-Wert definieren kann. In diesem Fall schlägt der Check nie fehl, sondern returned den spezifizierten Default-Wert. Eine eventuell erzeugte Fehlermeldung wird dennoch eingesammelt, hat dann aber mehr den Character einer Warnung.</li>
<li>Für jeden Parameter <code>p</code> einer checkfun wollen wir optional auch die Definition eines Fehlermeldungs-Parameters <code>p_err</code> zulassen, mit dem die Fehlermeldung überschrieben werden kann, den die checkfun generiert, wenn der Test für <code>p</code> fehlschlägt. Einige Beispiele werden das klarer machen.</li>
</ul>
<p>Hier ist der <code>regexp</code>-Test:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">check_text_regex</span>($k, $v, $par) {
  $pattern     <span style="color:#f92672">=</span> $par[<span style="color:#e6db74">&#39;pattern&#39;</span>];
  $pattern_err <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;check_text_regex: &#34;</span><span style="color:#f92672">.</span>
                 (<span style="color:#a6e22e">array_key_exists</span>(<span style="color:#e6db74">&#39;pattern_err&#39;</span>, $par)<span style="color:#f92672">?</span>
                 $par[<span style="color:#e6db74">&#39;pattern_err&#39;</span>]<span style="color:#f92672">:</span>
                 <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> did not match </span><span style="color:#e6db74">$pattern</span><span style="color:#e6db74">.&#34;</span>);
  $default     <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_key_exists</span>(<span style="color:#e6db74">&#39;default&#39;</span>, $par)<span style="color:#f92672">?</span>$par[<span style="color:#e6db74">&#39;default&#39;</span>]<span style="color:#f92672">:</span><span style="color:#66d9ef">NULL</span>;

  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">DEBUG</span>) <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;In check_text_regex: k=</span><span style="color:#e6db74">$k</span><span style="color:#e6db74"> v=</span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> pattern= </span><span style="color:#e6db74">$pattern\n</span><span style="color:#e6db74">&#34;</span>;
  
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#34;/^</span><span style="color:#e6db74">$pattern\</span><span style="color:#e6db74">$/&#34;</span>, $v))
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>($v, <span style="color:#66d9ef">NULL</span>);
  <span style="color:#66d9ef">else</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>($default, $pattern_err);
}
</code></pre></div><p>Der Test prüft, ob der Wert <code>$v</code> dem regulären Ausdruck <code>$par['pattern']</code> genügt. Wenn ja, wird <code>$v</code> ohne Fehlermeldung zurückgegeben. Wenn nein, wird <code>$par['default']</code> zusammen mit der Fehlermeldung <code>$par['pattern_err']</code> zurückgegeben.</p>
<p>Entsprechend der <code>minmax</code>-Test:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">check_int_minmax</span>($k, $v, $par) {
  $min     <span style="color:#f92672">=</span> $par[<span style="color:#e6db74">&#39;min&#39;</span>];
  $min_err <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;check_int_minmax: &#34;</span><span style="color:#f92672">.</span> 
             (<span style="color:#a6e22e">array_key_exists</span>(<span style="color:#e6db74">&#39;min_err&#39;</span>, $par)<span style="color:#f92672">?</span>
             $par[<span style="color:#e6db74">&#39;min_err&#39;</span>]<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> &lt; </span><span style="color:#e6db74">$min</span><span style="color:#e6db74">.&#34;</span>);
  $max <span style="color:#f92672">=</span> $par[<span style="color:#e6db74">&#39;max&#39;</span>];
  $max_err <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;check_int_minmax: &#34;</span><span style="color:#f92672">.</span> 
             (<span style="color:#a6e22e">array_key_exists</span>(<span style="color:#e6db74">&#39;max_err&#39;</span>, $par)<span style="color:#f92672">?</span>
             $par[<span style="color:#e6db74">&#39;max_err&#39;</span>]<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> &gt; </span><span style="color:#e6db74">$max</span><span style="color:#e6db74">.&#34;</span>);
  $default <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_key_exists</span>(<span style="color:#e6db74">&#39;default&#39;</span>, $par)<span style="color:#f92672">?</span>$par[<span style="color:#e6db74">&#39;default&#39;</span>]<span style="color:#f92672">:</span><span style="color:#66d9ef">NULL</span>;
  
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">DEBUG</span>) <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;In check_int_minmax: k=</span><span style="color:#e6db74">$k</span><span style="color:#e6db74"> v=</span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> min=</span><span style="color:#e6db74">$min</span><span style="color:#e6db74"> max=</span><span style="color:#e6db74">$max\n</span><span style="color:#e6db74">&#34;</span>;
  $v <span style="color:#f92672">=</span> <span style="color:#a6e22e">intval</span>($v);
  <span style="color:#66d9ef">if</span> ($v <span style="color:#f92672">&lt;</span> $min)
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>($default, $min_err);
  <span style="color:#66d9ef">if</span> ($v <span style="color:#f92672">&gt;</span> $max)
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>($default, $max_err);

  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>($v, <span style="color:#66d9ef">NULL</span>);
}
</code></pre></div><p>Dieser Test folgt demselben System: Wenn der Wert <code>$v</code> zwischen <code>$min</code> und <code>$max</code> liegt, wird er ohne Fehlermeldung zurückgegeben. Andernfalls wird $default und eine Fehlermeldung erzeugt. Die Fehlermeldungen können dabei als <code>$min_err</code> und <code>$max_err</code> spezifiziert werden, der <code>$default</code> ist <code>NULL</code>.</p>
<p>Und der <code>int_enum</code>-Test, um das Beispiel vollständig zu machen:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">check_int_enum</span>($k, $v, $par) {
  $values      <span style="color:#f92672">=</span> $par[<span style="color:#e6db74">&#39;values&#39;</span>];
  $valuestring <span style="color:#f92672">=</span> <span style="color:#a6e22e">join</span>(<span style="color:#e6db74">&#34;,&#34;</span>, $values);
  $values_err  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;check_int_enum: &#34;</span><span style="color:#f92672">.</span>
                 (<span style="color:#a6e22e">array_key_exists</span>(<span style="color:#e6db74">&#39;values_err&#39;</span>, $par)<span style="color:#f92672">?</span>
                 $par[<span style="color:#e6db74">&#39;values_err&#39;</span>]<span style="color:#f92672">:</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> not in </span><span style="color:#e6db74">$valuestring</span><span style="color:#e6db74">.&#34;</span>);
  $default     <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_key_exists</span>(<span style="color:#e6db74">&#39;default&#39;</span>, $par)<span style="color:#f92672">?</span>$par[<span style="color:#e6db74">&#39;default&#39;</span>]<span style="color:#f92672">:</span><span style="color:#66d9ef">NULL</span>;
  
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">DEBUG</span>) <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;In check_int_enum: k=</span><span style="color:#e6db74">$k</span><span style="color:#e6db74"> v=</span><span style="color:#e6db74">$v</span><span style="color:#e6db74"> values=(</span><span style="color:#e6db74">$valuestring</span><span style="color:#e6db74">)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
  $v <span style="color:#f92672">=</span> <span style="color:#a6e22e">intval</span>($v);
  
  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">array_search</span>($v, $values) <span style="color:#f92672">===</span> <span style="color:#66d9ef">false</span>)
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>($default, $values_err);

  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">array</span>($v, <span style="color:#66d9ef">NULL</span>);
  
}
</code></pre></div><p>Auch hier werden die Konventionen befolgt: <code>$default</code> und die Fehlermeldung <code>$values_err</code>, wenn der gegebene Wert <code>$v</code> nicht im <code>$values</code>-Array vorkommt, sonst <code>$v</code> und keine Fehlermeldung.</p>
<p>Mit diesem Code und ein wenig Suchen und Ersetzen sollte sich jede framework-freie PHP-Seite schnell auf eine harte Deklaration von Eingabeparametern umstellen lassen:</p>
<ul>
<li><code>$cleaners</code> definieren</li>
<li>Alle Vorkommen von <code>$_REQUEST</code> durch <code>$_CLEAN</code> ersetzen</li>
<li>globals <code>$_CLEAN</code> nachrüsten, weil <code>$_CLEAN</code> kein Superglobal ist</li>
<li>Aufruf von <code>clean()</code> an passender Stelle einfügen, ggf. Fehlerbehandlung in <code>$_ERROR</code> vornehmen</li>
</ul>
<p>Nein, auch das ist nicht 100% wasserdicht, dürfte aber das meiste Feld-, Wald- und Wiesen-PHP schon mal gründlich gegen die größten Dummheiten schützen.</p>
<p>Und das alles mit weniger als 60 Minuten Codieraufwand. Vielleicht sollte man eine Extension draus machen, und die so konfigurieren, daß sie die echten <code>$_REQUEST</code>, <code>$_GET</code>, <code>$_POST</code>, <code>$_FILES</code> und <code>$_COOKIE</code> verbirgt und durch zwangsweise von <code>clean()</code> generierte Arrays gleichen Namens ersetzt.PHP-Seiten ohne <code>$cleaners[]</code>-Array können dann gar keine Parameter mehr im Zugriff haben.</p>


	
    </article>
</div>



            <footer>
    <p>
	&copy; Copyright 2021 Someone or something
    </p>
</footer>


        </main>

	





<script src="/js/bootstrap.js"></script>




<script src="/js/lunr.js"></script>





<script src="/js/app.js"></script>


    </body>
</html>
