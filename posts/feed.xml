<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts on Die wunderbare Welt von Isotopp</title>
    <link>https://blog.koehntopp.info/posts.html</link>
    <description>Recent content in Posts on Die wunderbare Welt von Isotopp</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Tue, 25 Jun 2024 14:03:23 +0000</lastBuildDate><atom:link href="https://blog.koehntopp.info/posts/feed.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>No LLM for you, come back one year</title>
      <link>https://blog.koehntopp.info/2024/06/22/no-llm-for-you-come-back-one-year.html</link>
      <pubDate>Sat, 22 Jun 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/06/22/no-llm-for-you-come-back-one-year.html</guid>
      <description>&lt;p&gt;Es war Samstag, ich las die Nachrichten und ich mußte dazu was im Fedi sagen.
Hier ist der Aufschrieb davon:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=RqlQYBcsq54&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;No Soup for you!&lt;/a&gt;

 ist, was Apple der EU sagt:
&lt;a href=&#34;https://www.heise.de/news/Apple-verweist-auf-neue-Regeln-vorerst-keine-Apple-Intelligence-fuer-EU-iPhones-9774039.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Apple vs. EU: Apple Intelligence soll vorerst nicht nach Deutschland kommen&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Aufgrund &amp;ldquo;regulatorischer Unsicherheiten&amp;rdquo; durch den Digital Markets Act (DMA) gehe das Unternehmen davon aus,
bestimmte Funktionen in diesem Jahr nicht mehr für Kunden in Deutschland
und anderen EU-Mitgliedsstaaten einführen zu können,
wie Apple am Freitagabend überraschend in einer Stellungnahme mitteilte.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Dieser Seitenhieb auf den Marktregulator ist amüsant,
aber Apple könnte &amp;ldquo;Apple Intelligence&amp;rdquo; nicht weltweit zeitgleich einführen, selbst wenn Apple das wollte.&lt;/p&gt;
&lt;h1 id=&#34;keine-apple-intelligence-in-der-eu&#34;&gt;
    &lt;a href=&#34;#keine-apple-intelligence-in-der-eu&#34;&gt;
	Keine Apple Intelligence in der EU
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Der wahre Grund ist: Die Features sind unfertig.
Normalerweise liefern iOS Betaversionen relativ vollständige Blicke auf das Release,
alle Features sind vorhanden und funktionieren modulo noch existierende Fehler auf eine Weise,
wie man sie im Produkt-Release später erwarten können wird.
&lt;a href=&#34;https://www.lifewire.com/apple-betas-missing-cool-features-8662016&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;In der iOS 18 Beta ist das nicht der Fall.&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;But this year, there&amp;rsquo;s less incentive to hop on early because none of the AI tools are there,
and those are surely the features people most want to try out.
The Apple Intelligence features, like better Siri, won&amp;rsquo;t be arriving until later,
perhaps not until after the OS updates have actually launched in the fall.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Das ist einerseits so, weil diese Features nicht auf eine Weise funktionieren können,
dass sie Apples Ansprüchen an Qualität genügen.
&lt;a href=&#34;https://techinformed.com/mcdonalds-ditches-ai-order-system-after-bacon-ice-cream-mix-up/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;McDonalds hat das schon mal ausprobiert.&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In one TikTok video –
posted with the caption “Fighting with McDonald’s robot” –
a woman is seen struggling to order vanilla ice cream and a bottle of water,
and instead ends up with multiple sundaes, ketchup sachets, and two portions of butter.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Nun war das keine Apple-KI, aber diese Sorte Problem ist systematisch die Sorte Fehler, die LLMs machen,
und es gibt keinen Grund, warum es bei Apple besser sein sollte.&lt;/p&gt;
&lt;p&gt;Und das ist nur die oberste Lage Probleme.
Ein wichtiger Werbepunkt von Apple ist, dass die KI-Features &amp;ldquo;on device&amp;rdquo; laufen, statt Daten in eine Cloud zu pumpen.
Das geht auch nicht, jedenfalls nicht so, wie der Kunde es erwartet.&lt;/p&gt;
&lt;p&gt;Der aktuelle KI-Hype basiert auf LLMs,
einer besonderen Art neuronaler Netze, die unter anderem Milliarden von &amp;ldquo;Parametern&amp;rdquo; brauchen.
Das sind Haufen von Zahlen, die als Vektoren mit tausenden Dimensionen angeordnet &amp;ldquo;Wissen codieren&amp;rdquo;
und in der Berechnung von Antworten auf Benutzeranfragen verwendet werden.&lt;/p&gt;
&lt;p&gt;Nun, jeder dieser Vektoren braucht eine gewisse Menge Speicherplatz und wenn man &amp;ldquo;Milliarden von Parametern&amp;rdquo; haben will,
dann braucht man schnell auch einmal zweistellige Mengen an Gigabyte RAM zum Ausrechnen der Antwort.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/apple-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Auswahl von Größenangaben beliebter öffentlicher LLMs.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/apple-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Standardversion von Metas llama3 mit 70 Milliarden Parametern und 40 GB Größe.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Ein Modell mit 8 Milliarden Parametern braucht ca. 5 GB RAM, ein Modell mit 14 Milliarden Parametern ca. 8 GB,
und ein Modell mit 70 Milliarden Parametern je nach Quantisierung zwischen 26 GB und 40 GB.&lt;/p&gt;
&lt;p&gt;Dazu kommt noch einmal Speicher für den Kontext,
der bei großen Kontext-Definitionen schnell noch einmal die Größenordnung des Modells erreicht.&lt;/p&gt;
&lt;p&gt;Apple selbst dokumentiert in
&lt;a href=&#34;https://machinelearning.apple.com/research/introducing-apple-foundation-models&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Introducing Apple’s On-Device and Server Foundation Models&lt;/a&gt;


wann sie Modelle lokal rechnen:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In the following overview, we will detail how two of these models — a ~3 billion parameter on-device language model,
and a larger server-based language model available with Private Cloud Compute and running on Apple Silicon servers —
have been built and adapted to perform specialized tasks efficiently, accurately, and responsibly.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Ein Modell mit 3 Milliarden Parametern wie &lt;a href=&#34;https://ollama.com/library/phi3&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Phi3&lt;/a&gt;

 belegt circa 2.5 GB Speicher und
das ist in der Tat eine Größe, die auf einem iPhone mit 6 GB RAM ausgeführt werden kann.
Größere Modelle passen schlicht nicht in den Speicher und werden daher in der Cloud berechnet.&lt;/p&gt;
&lt;p&gt;Die Qualität und Komplexität der Antworten eines LLM ist aber sehr stark von der Anzahl der Parameter des Modells abhängig.
Ein 3b-Modell kann schlicht nicht mit einem 70b- oder gar noch größeren Modellen mithalten.
Das ist aber das, was Benutzer von Online-GPTs wie ChatGPT gewohnt sind.&lt;/p&gt;
&lt;p&gt;Es ist also eher davon auszugehen,
dass wenig Inferenz (das Ausrechnen von Antworten mit einem austrainierten LLM) &amp;ldquo;on device&amp;rdquo; geht,
und viel in die Cloud ausgelagert wird.
Die Rechenzentren dazu gibt es noch nicht, und das Bauen von Rechenzentren dauert in der Regel einige Zeit.
Wir können davon ausgehen, dass die Vorlaufzeit circa 2 Jahre beträgt:
Das Rechenzentrum wird vermutlich sehr uniform bestückt sein, was die Planung vereinfacht.
Die Energiedichte wird sehr hoch sein, und die Hardware wird schwer zu beschaffen sein, was die Planung verkompliziert.&lt;/p&gt;
&lt;p&gt;Die Hardware, die in dieses Rechenzentrum herein kann, wird derzeit meist von Nvidia hergestellt.
Wer Apple kennt, der weiß, wie sehr es die Firma schmerzt, einer Firma wie Nvidia Geld zu geben.
Viel lieber würde Apple den Kram auf eigenen, selbst entworfenen, auf Inferenz spezialisierten Chip laufen lassen.
Auch diese existieren nicht und es würde jedermann überraschen,
wenn es solche Chips vor 2026 gäbe (oder nach 2028 noch nicht gäbe).&lt;/p&gt;
&lt;p&gt;Wir können an dieser Stelle vermutlich glaubhaft herleiten,
dass &amp;ldquo;Apple Intelligence&amp;rdquo; zu diesem Zeitpunkt lediglich lanciert wird, um den Kurs von AAPL zu stabilisieren.
Aber natürlich ist es billig, da noch einmal FOMO gegenüber Kunden in Europa zu pflegen und die EU zu dissen.&lt;/p&gt;
&lt;h1 id=&#34;warum-die-hardware-und-warum-so-viel-speicher&#34;&gt;
    &lt;a href=&#34;#warum-die-hardware-und-warum-so-viel-speicher&#34;&gt;
	Warum die Hardware und warum so viel Speicher?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Die lineare Algebra in Computerspielen und die Mathematik in LLMs sind zum Großteil Matrix-Multiplikationen.
Daher werden Grafikkarten, superschnelle Matrix-Multiplizierer, vielfach für LLMs &amp;ldquo;mißbraucht&amp;rdquo;.
Sie implementieren die benötigte Operation sehr flink, in Hardware und parallel ausführbar.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=-P28LKWTzrI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/apple-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=-P28LKWTzrI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nvidia Werbevideo mit den Mythbusters&lt;/a&gt;

,
das die Parallelität von Grafikkarten korrekt veranschaulicht.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Mythbusters haben die Wirkmächtigkeit der parallelen Ausführung für ein Nvidia Werbevideo einmal korrekt visualisiert.&lt;/p&gt;
&lt;p&gt;Zur Geschichte und dem Aufbau von Grafikkarten habe ich vor sieben Jahren einen Link-Artikel geschrieben:
&lt;a href=&#34;https://blog.koehntopp.info/2017/11/25/d-abc-at-scale.html&#34;&gt;d = a*b+c at scale&lt;/a&gt;

,
der die Entwicklung von Grafik-Hardware in den 20 Jahren vor 2017 beschreibt,
weil ich beruflich Anlass hatte, das herauszufinden.
Es ist ein Link-Artikel, ihr müßt die blauen Dinger auch anklicken.&lt;/p&gt;
&lt;p&gt;Wikipedia erklärt
&lt;a href=&#34;https://de.wikipedia.org/wiki/Matrizenmultiplikation#Beispiel&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matrix-Multiplikation als superlange Summe von Produkten&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/apple-04.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Relevanter Auszug aus der Wikipedia, der Matrix-Multiplikation erläutert.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wir berechnen die Position Zeile 1, Spalte 2 der Ergebnis-Matrix
also durch Multiplikation des Zeilenvektors 1 der Matrix A
mit dem Spaltenvektor 2 der Matrix B,
sodass sich im Beispiel&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(3, 2, 1) * (2, 1, 0) = (3*2 + 2*1 + 1*0) = 8
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ergibt. In &lt;code&gt;d = a*b + c&lt;/code&gt; ist die Zwischensumme &lt;code&gt;c&lt;/code&gt; zunächst 0, und es wird &lt;code&gt;3*2&lt;/code&gt; berechnet.
Das Ergebnis, &lt;code&gt;d = 6&lt;/code&gt; wird im nächsten Schritt als &lt;code&gt;c&lt;/code&gt; verwendet, sodass wir &lt;code&gt;d = 2*1 + 6&lt;/code&gt; erhalten.
Im letzten Schritt wird dies wieder als &lt;code&gt;c&lt;/code&gt; verwendet, sodass wir das Endergebnis &lt;code&gt;d = 1*0 + 8&lt;/code&gt; bekommen.&lt;/p&gt;
&lt;p&gt;Grafikkarten haben spezielle Hardware, die mit einer bestimmten Hardware-Darstellung von Zahlen solche Berechnungen
auf rechteckigen Zahlenfeldern beliebige Größe parallel durchführen können.
&amp;ldquo;NPUs&amp;rdquo;, Neuralprozessoren, tun genau dasselbe.&lt;/p&gt;
&lt;p&gt;In dem Unterrichtsabschnitt &amp;ldquo;Vektor- und Matrizenrechnung&amp;rdquo; in der Schule,
oder gar in &amp;ldquo;Lineare Algebra und Vektorräume&amp;rdquo; an der Uni aufgepasst zu haben zahlt sich also jetzt,
30 Jahre später, groß aus.
Aber keine Angst, es hat sich nichts getan, die Mathematik ist immer noch dieselbe wie damals in der Schule,
und es ist nichts Fieseres dabei als Summen von Produkten: Plus und Malnehmen, komplizierter wird&amp;rsquo;s nicht.&lt;/p&gt;
&lt;h1 id=&#34;ki-und-grafikkarten-laufen-auseinander&#34;&gt;
    &lt;a href=&#34;#ki-und-grafikkarten-laufen-auseinander&#34;&gt;
	KI und Grafikkarten laufen auseinander
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Aber die Matrix-Multiplikation in einer NPU und in einer Grafikkarte laufen langsam auseinander.
Das hat aber nichts mit der Mathematik zu tun, sondern mit der Darstellung von Zahlen.&lt;/p&gt;
&lt;p&gt;Wir können uns einmal Fließkommazahlen im Computer angucken:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://float.exposed/0x400921fb4d12d84a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;3.1415926 als Double (64 Bit)&lt;/a&gt;

:
Stellt man eine beliebte Näherung der Zahl Pi als &lt;code&gt;double&lt;/code&gt; dar, bekommt man dies:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 Bit Vorzeichen&lt;/li&gt;
&lt;li&gt;10 Bit Exponenten&lt;/li&gt;
&lt;li&gt;53 Bit &amp;ldquo;Mantisse&amp;rdquo; oder &amp;ldquo;Significand&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;und die Zahl ist nicht der gewünschte Wert, sondern der dichteste Wert, der dargestellt werden kann:
3.14159260000000006841.&lt;/p&gt;
&lt;p&gt;Das ist einen Tick zu groß.
Klickt man den &amp;ldquo;Significand&amp;rdquo; jetzt ein Bit kleiner, bekommt man
&lt;a href=&#34;https://float.exposed/0x400921fb4d12d849&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;3.14159259999999962432&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Das ist das Kreuz mit &lt;em&gt;diskreter Mathematik&lt;/em&gt;: Zwischen den Zahlen,
die wir darstellen können liegen unendlich viele Zahlen, die existieren,
aber nicht diskret in der gewählten Auflösung darstellbar sind.&lt;/p&gt;
&lt;p&gt;In der diskreten Mathematik gibt es eine Schrittweite zwischen zwei darstellbaren Fließkommazahlen.
Diese nennt man &amp;ldquo;eps&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;epsilon&amp;rdquo; ist in der Analysis (eine Disziplin der Mathematik) ein unendlich kleiner Schritt.
In der diskreten Mathematik, also der Mathematik, die sich mit Zahlen in Computern befasst,
gibt es keine unendlich kleinen Schritte.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;eps&amp;rdquo; ist der Schritt, den ein Bit macht.
Bei Fließkommazahlen ist &amp;ldquo;eps&amp;rdquo; variabel, denn es wird mit dem anderen Teil der Fließkommazahl, dem Exponenten skaliert.
Zahlen um 0 herum können sehr genau dargestellt werden,
aber je weiter man von 0 weg kommt, umso größer wird der Exponent und umso größer wird eps.&lt;/p&gt;
&lt;p&gt;In KI-Mathematik normalisieren wir Zahlen oft auf das Intervall von 0 bis 1
oder von -1 bis 1.
Wir brauchen also nicht so große Exponenten und können mit weniger Bits auskommen.&lt;/p&gt;
&lt;p&gt;Das ist wichtig, denn wenn wir von &lt;code&gt;double&lt;/code&gt; auf &lt;code&gt;float&lt;/code&gt; heruntergehen,
dann gehen wir von 64 Bit pro Zahl auf 32 Bit runter – doppelt so viel Modell im selben Speicher!
Ein 32-Bit &lt;code&gt;float&lt;/code&gt; hat bei Werten um Zehntausend herum schon ein eps von 0.01 (bei 10k Euro ein eps von 1 cent).&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://float.exposed/0x461c400a&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;10000.009765625&lt;/a&gt;

 als &lt;code&gt;float&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Aber für Werte zwischen 0 und 1 sieht es gut aus:
&lt;a href=&#34;https://float.exposed/0x3f000000&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;0.5&lt;/a&gt;

 und am Significand spielen.&lt;/p&gt;
&lt;p&gt;Wir können auch noch weiter heruntergehen:
&lt;a href=&#34;https://float.exposed/b0x3f00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;0.5&lt;/a&gt;

 als &lt;code&gt;bfloat16&lt;/code&gt;.
Das belegt noch einmal halb so viel Speicher, 16 Bit, verbrennt aber zu viele Bits auf den Exponenten:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 Bit Vorzeichen&lt;/li&gt;
&lt;li&gt;8 Bit Exponent&lt;/li&gt;
&lt;li&gt;7 Bit auf die &amp;ldquo;Mantisse&amp;rdquo;, den &amp;ldquo;Significand&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Wir können auch das 16-Bit &lt;code&gt;half&lt;/code&gt; nehmen:
&lt;a href=&#34;https://float.exposed/0x3800&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;0.5&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Hier werden&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1 Bit Vorzeichen&lt;/li&gt;
&lt;li&gt;5 Bit Exponent&lt;/li&gt;
&lt;li&gt;10 Bit Significand&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;verwendet. Je nach Anwendungsfall kann das vorteilhaft sein.&lt;/p&gt;
&lt;p&gt;Ist es schlimm, ein LLM mit weniger Auflösung zu trainieren oder zu benutzen?
Artikel über &amp;ldquo;Quantisierung&amp;rdquo; von LLMs diskutieren das, und auch &lt;em&gt;wann&lt;/em&gt; im Herstellungsprozeß das Modell eingekürzt wird.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/@techresearchspace/what-is-quantization-in-llm-01ba61968a51&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is Quantization in LLM&lt;/a&gt;


diskutiert ganz allgemein was Quantisierung bei LLMs ist – also mit welchen Zahlen beim Training gerechnet wird
und wann auf Auslieferungs-Zahlenformat umgerechnet wird.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://symbl.ai/developers/blog/a-guide-to-quantization-in-llms/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;A Guide to Quanitization in LLMs&lt;/a&gt;


erklärt dasselbe, aber mit mehr Details betreffend die Integer-Formate, also &lt;code&gt;Qx_y&lt;/code&gt;, die man oft sieht.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Quantisierung hat mitunter Auswirkungen auf die Qualität der Antworten, die das LLM generiert,
aber sie spart Speicher und ermöglicht oft erst die Ausführung von LLMs auf Rechnern,
die man im Haus oder gar in der Hand hat.&lt;/p&gt;
&lt;p&gt;Wenn man zig Milliarden Parameter in den verfügbaren Speicher einer Nvidia 4070 Ti quetschen will,
dann braucht man nun einmal kürzere Zahlendarstellungen.
Und wenn es im iPhone passieren soll, dann noch kürzer.&lt;/p&gt;
&lt;p&gt;Damit man von der Beschleunigung einer Nvidia profitiert kann man aber nur Darstellungen nehmen,
die die Nvidia kennt, also in Hardware beschleunigt parallel rechnen kann.
Sonst kann man auch &amp;ldquo;zu Fuß&amp;rdquo;, also mit der CPU, rechnen.&lt;/p&gt;
&lt;p&gt;Das ist das Problem mit dem M1 Apple Silicon, das &lt;code&gt;bfloat16&lt;/code&gt; nicht in Hardware kann, und das ab M2 korrigiert ist.
Ich würde erwarten, dass neuere Apple CPUs auch andere, noch härtere Quantisierungen parallel in Hardware rechnen können,
aber ich habe nicht nachgesehen, was ab wann das wie realisiert wird.&lt;/p&gt;
&lt;h1 id=&#34;qualität-von-kleinen-llms&#34;&gt;
    &lt;a href=&#34;#qualit%c3%a4t-von-kleinen-llms&#34;&gt;
	Qualität von kleinen LLMs
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Apple behauptet, dass ihre 3B Modelle in Benchmarks besser sind als die Konkurrenz:
&lt;a href=&#34;https://machinelearning.apple.com/research/introducing-apple-foundation-models&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Introducing Apple’s On-Device and Server Foundation Models&lt;/a&gt;

,
die Benchmarks am Ende.&lt;/p&gt;
&lt;p&gt;Aber 3 Milliarden Parameter sind sehr klein.
Das ist jedoch das, was Apple lokal rechnen kann.
Größere Modelle werden &amp;ldquo;in der Cloud&amp;rdquo; ausgeführt, wo mehr Speicher verfügbar ist.&lt;/p&gt;
&lt;p&gt;Benchmarks bei KI-Anwendungen sind jedoch wenig aussagekräftig, damit ein Endkunde Qualität beurteilen kann.
Sie vergleichen Antworten verschiedener Modelle miteinander, aber die Ergebnisse sind nicht so,
wie ein Mensch Qualität erfahren würde.
Das liegt daran, dass Menschen Antworten von Computern nehmen, um ihre eigenen Entscheidungen zu treffen,
oder um sie mit ihren eigenen Entscheidungen zu vergleichen.&lt;/p&gt;
&lt;p&gt;Menschen haben aber ein Weltmodell.&lt;/p&gt;
&lt;p&gt;Das heißt im Wesentlichen, dass an jeder Entscheidung eine Gewichtung für Fehlschlag und Erfolg hängt,
eine Risikobewertung.
Eine falsche Antwort und eine andere, ebenfalls falsche Antwort sind für einen Menschen also nicht gleich:
Bei einer würde er eine kleine Summe Geld verlieren, bei der anderen sterben.
Im Benchmark aber sind beide gleich &amp;ldquo;falsch&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Der Effekt ist, dass ein schlechtes Modell im Benchmark in der Realität eventuell als besser empfunden werden kann,
weil es nie mörderische Antworten liefert.&lt;/p&gt;
&lt;h1 id=&#34;apple-mit-mehr-ram&#34;&gt;
    &lt;a href=&#34;#apple-mit-mehr-ram&#34;&gt;
	Apple mit mehr RAM
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Wenig überraschend beginnt Apple nun Rechner mit mehr RAM zu bauen,
oder für LLM-Features Geräte mit mehr RAM zu verlangen:&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.golem.de/news/apple-8-gbyte-ram-im-macbook-reichen-nicht-mehr-2406-186433.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Golem: 8 GByte RAM im Macbook reichen nicht mehr&lt;/a&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Das Unternehmen stellte die Beta der Entwicklungsumgebung XCode 16 vor.
In ihr enthalten ist ein neues Feature: Predictive Code Completion:
Diese nutzt KI, um Codeschnipsel zu analysieren und passende Vorschläge in Echtzeit auszugeben.
Allerdings wird dafür laut Apple ein Mac mit mindestens 16 GByte Arbeitsspeicher benötigt.&lt;/p&gt;
&lt;/blockquote&gt;
</description>
    </item>
    
    <item>
      <title>MySQL: Add missing IDs</title>
      <link>https://blog.koehntopp.info/2024/06/12/mysql-add-missing-ids.html</link>
      <pubDate>Sun, 21 Apr 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/06/12/mysql-add-missing-ids.html</guid>
      <description>&lt;p&gt;A support question:
Somebody had a WordPress installation, in which a table had entries with an &lt;code&gt;id&lt;/code&gt; column
that contained multiple entries with &lt;code&gt;0&lt;/code&gt;.
The table was supposed to undergo a schema change where &lt;code&gt;id&lt;/code&gt; becomes an actual primary key,
and &lt;code&gt;auto_increment&lt;/code&gt;.
They needed to find all rows &lt;code&gt;WHERE id=0&lt;/code&gt; and assign them unique &lt;code&gt;id&lt;/code&gt; values.&lt;/p&gt;
&lt;p&gt;Here is a test table:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;create&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;integer&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;not&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;varchar&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;));&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;affected&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;25&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kris&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;insert&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;values&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;3&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;affected&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;06&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Records&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Duplicates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Warnings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;kris&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;the-old-procedural-fix&#34;&gt;
    &lt;a href=&#34;#the-old-procedural-fix&#34;&gt;
	The old, procedural fix
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Define a variable &lt;code&gt;@x&lt;/code&gt; and select the max value into it.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;max&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;into&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;affected&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now assign values to all &lt;code&gt;id&lt;/code&gt; columns that are zero:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;update&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;affected&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;warning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;matched&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Changed&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Warnings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;Warning&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Code&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1287&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Setting&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;user&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;variables&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;within&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;expressions&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;is&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;deprecated&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;and&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;will&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;be&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;removed&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;future&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;release&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Consider&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alternatives&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;SET variable=expression, ...&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;or&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;SELECT expression(s) INTO variables(s)&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;While this still worked, not only is it butt ugly, it is also deprecated and will stop to work in the future.
But it is fast, and with an index on &lt;code&gt;id&lt;/code&gt; can profit from that for a speedup.&lt;/p&gt;
&lt;h1 id=&#34;using-window-functions&#34;&gt;
    &lt;a href=&#34;#using-window-functions&#34;&gt;
	Using Window Functions
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;We will be defining a Common Table Expression that defines the currently maximum &lt;code&gt;id&lt;/code&gt; value,
and that assigns row numbers to all rows with &lt;code&gt;id=0&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;A query that finds the maximum id:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;max&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;as&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+--------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+--------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+--------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;row&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A query that assigns rows numbers using window functions:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;row_number&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;over&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;order&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;by&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;as&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;from&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+----+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+----+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+------+----+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;A CTE that combines all this with an update statement:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id_cte&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;MAX&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows_with_id_zero&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;ROW_NUMBER&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;OVER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ORDER&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;BY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WHERE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;JOIN&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;SELECT&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rn&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;FROM&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows_with_id_zero&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;max_id_cte&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AS&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subquery&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ON&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subquery&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;AND&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subquery&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;SET&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;subquery&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;new_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This defines a &lt;code&gt;WITH&lt;/code&gt; statement (a common table expression) defining a single row,
single column query that holds the maximum id value &lt;code&gt;max_id_cte.max_id&lt;/code&gt;,
and a second column that holds all rows with &lt;code&gt;id=0&lt;/code&gt; with a row number &lt;code&gt;rows_with_id_zero.rn&lt;/code&gt; using window functions.&lt;/p&gt;
&lt;p&gt;These values are used in a &lt;code&gt;UPDATE&lt;/code&gt; statement, with a join against a subquery containing &lt;code&gt;rows_with_id_zero&lt;/code&gt;.
This has to do a full row comparison for the join (&lt;code&gt;ON b.col = subquery.col&lt;/code&gt; for all columns),
because the table has no primary key, so value comparison is the only option.&lt;/p&gt;
&lt;p&gt;It then assigns the row number calculated based on &lt;code&gt;max_id + rn&lt;/code&gt; to &lt;code&gt;b.id&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;The plan for that is straight out of hell, though.
The procedural method is much better.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+------+------+----------+-----------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;select_type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partitions&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;possible_keys&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_len&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ref&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filtered&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Extra&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+------+------+----------+-----------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;derived4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;derived3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DERIVED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DERIVED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filesort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+------+------+----------+-----------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;warnings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;04&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There must be a way to get a plan that is linear,
as the job can be done linearly – we have shown that with the &lt;code&gt;set&lt;/code&gt; method above.&lt;/p&gt;
&lt;p&gt;We define an index on all non-&lt;code&gt;id&lt;/code&gt; columns (here: &lt;code&gt;d&lt;/code&gt;), with &lt;code&gt;id&lt;/code&gt; as the implicit suffix, because InnoDB:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;alter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;-- add index(d, id)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;affected&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;23&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Records&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Duplicates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Warnings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;with&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+---------------------+------+----------+-----------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;select_type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partitions&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;possible_keys&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_len&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ref&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filtered&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Extra&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+---------------------+------+----------+-----------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;derived4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;derived3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ref&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;             &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1023&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows_with_id_zero&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                 &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DERIVED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DERIVED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;33&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filesort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+---------------------+------+----------+-----------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;warnings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;03&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Better, but not good enough.
We define an index on the entire table, duplicating it in the index in sorted order:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-mysql&#34; data-lang=&#34;mysql&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;alter&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;drop&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Query&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;OK&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;affected&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;23&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Records&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Duplicates&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Warnings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;mysql&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;explain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;WITH&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+------------------------------------------+------+----------+------------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;select_type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;table&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partitions&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;possible_keys&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;key&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;key_len&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ref&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filtered&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Extra&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                        &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+------------------------------------------+------+----------+------------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;derived4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;system&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;PRIMARY&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;derived3&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;ALL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;where&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;UPDATE&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;      &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ref&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1027&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows_with_id_zero&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows_with_id_zero&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                         &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DERIVED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Select&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kp&#34;&gt;tables&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;optimized&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;away&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;3&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DERIVED&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;     &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;b&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;          &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;no&#34;&gt;NULL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ref&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;id&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;       &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;const&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;                                    &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;   &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;100&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;00&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;index&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;Using&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;filesort&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;  &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;|&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+----+-------------+------------+------------+--------+---------------+------+---------+------------------------------------------+------+----------+------------------------------+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rows&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;in&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;set&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;warnings&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;01&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sec&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That&amp;rsquo;s decent, but creating that index is hellishly expensive compared to a simple counter and a single full table scan.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Die Welt Deiner Kindheit existiert nicht mehr</title>
      <link>https://blog.koehntopp.info/2024/06/10/die-welt-deiner-kindheit-existiert-nicht-mehr.html</link>
      <pubDate>Mon, 10 Jun 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/06/10/die-welt-deiner-kindheit-existiert-nicht-mehr.html</guid>
      <description>&lt;p&gt;Ich schrieb einige Dinge im Fedi, und wurde gebeten, die hier in einen Blogpost zu kippen.
Dies ist größtenteils eine unbearbeitete Kopie der Postings, und nicht die übliche Form Fließtext für das Blog.
Das tut mir leid.&lt;/p&gt;
&lt;p&gt;Veränderung nicht verstehen ist leicht.
Wenn man 16 Jahre Kohl, 7 Jahre Schröder und 16 Jahre Merkel gesehen hat, dann sind das fast 40 Jahre Stagnation,
die Abwesenheit von Veränderung in der Politik.&lt;/p&gt;
&lt;p&gt;Aber die Welt hat sich verändert. Sehr.&lt;/p&gt;
&lt;p&gt;Zum Beispiel:
Die Anzahl der PKW in Deutschland hat sich seit 1985 von 25 Millionen auf 50 Millionen verdoppelt.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://de.statista.com/statistik/daten/studie/12131/umfrage/pkw-bestand-in-deutschland/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;


&lt;em&gt;&lt;a href=&#34;https://de.statista.com/statistik/daten/studie/12131/umfrage/pkw-bestand-in-deutschland/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Und die Autos selbst haben sich auch verdoppelt.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;700 kg Mini vs. 1200 kg Mini,&lt;/li&gt;
&lt;li&gt;800 kg Golf vs. 1700 kg ID.3&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;a href=&#34;https://www.carsized.com/en/cars/compare/volkswagen-golf-1983-5-door-hatchback-vs-volkswagen-id3-2019-5-door-hatchback/rear/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://www.carsized.com/en/cars/compare/volkswagen-golf-1983-5-door-hatchback-vs-volkswagen-id3-2019-5-door-hatchback/rear/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

 Golf vs. ID.3&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.carsized.com/en/cars/compare/mini-cooper-1990-3-door-hatchback-vs-mini-cooper-2013-3-door-hatchback/rear/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-03.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://www.carsized.com/en/cars/compare/mini-cooper-1990-3-door-hatchback-vs-mini-cooper-2013-3-door-hatchback/rear/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

 Mini vs. Mini&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;CO₂-Level haben sich von einer vorindustriellen Baseline von 285 ppm auf 420 ppm in 2024 erhöht.
Das ist eine Veränderung von 135 ppm, und eine Verdoppelung des menschlichen CO₂-Eintrages seit 1985,
von 352 ppm auf 420 ppm.&lt;/p&gt;
&lt;p&gt;Das mit der Klimakatastrophe waren wir, nicht unsere Eltern oder Großeltern.
Wir haben das menschengemachte CO₂ in der Atmosphäre seit 1985 verdoppelt.
Im vollen Wissen um die Folgen.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/co2-long-term-concentration?time=1800..latest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-04.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/co2-long-term-concentration?time=1800..latest&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

 285 ppm vorindustriell,
352 ppm in 1965, 420 ppm jetzt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Bevölkerung der Welt hat sich von 1974 bis heute verdoppelt,
von 4 Milliarden auf 8 Milliarden Menschen.
Sie wächst nicht mehr und wird laut Modell in 2086 oder so einen Spitzenwert von 10 Milliarden erreichen,
aber das Modell berücksichtigt keine Klimakatastrophe oder andere Einwirkungen,
die Mortalität erhöhen oder die Geburtenrate senken.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/population?time=1800..latest&amp;amp;country=~OWID_WRL&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-05.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/population?time=1800..latest&amp;amp;country=~OWID_WRL&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

,
die Weltbevölkerung war 4 Milliarden in 1974, und liegt jetzt bei 8 Milliarden.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Welt, in der ihr groß geworden seid, bzw. die Welt mit der Struktur der Arbeit und den Methoden,
die mal funktioniert haben, existiert nicht mehr.
Die Politik, die ihr kennt, könnt Ihr nicht fortsetzen, weil ihre Methoden nicht mehr adäquat sind.
Wenn man sich hinstellt, mit dem Fuß aufstampft und &amp;ldquo;Ich will aber&amp;rdquo; wählt,
dann wird das nicht funktionieren, weil die Methode nicht mehr zum Problem paßt.&lt;/p&gt;
&lt;p&gt;Aber das werden wir jetzt im Detail ausprobieren.&lt;/p&gt;
&lt;h1 id=&#34;es-ist-nicht-alles-schlimm&#34;&gt;
    &lt;a href=&#34;#es-ist-nicht-alles-schlimm&#34;&gt;
	Es ist nicht alles schlimm
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Teile der Welt verändern sich übrigens noch schneller.&lt;/p&gt;
&lt;p&gt;So hat sich die installierte Solarleistung zwischen 2019 und 2022 einfach mal eben so verdoppelt
&lt;em&gt;und der Trend beschleunigt sich&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/installed-solar-pv-capacity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-06.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/installed-solar-pv-capacity&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

. PV Installation in der Welt, Summe über Zeit.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Kosten haben sich seit 2012 geviertelt, und seit 2017 halbiert.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/solar-pv-prices&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-07.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://ourworldindata.org/grapher/solar-pv-prices&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

.
Die PV Kosten sinken exponentiell (gerade Linie in einem Log-Y Graphen) seit 1975, und bisher ist das Ende noch nicht in Sicht.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Für Batterien sieht es genauso aus:
Die Kosten für LiIon Batterien sind in 30 Jahren um 97 % auf 3 % gefallen,
aber wir brauchen inzwischen kein Lithium mehr in Batterien, sondern können Natrium verwenden.
Das ist aber genau überhaupt kein kritischer Rohstoff, sondern in Massen verfügbar.&lt;/p&gt;
&lt;p&gt;Genau wird auch Kobalt nicht mehr gebraucht und viele andere seltene oder schwierige Rohstoffe sind ersetzbar geworden.
&lt;a href=&#34;https://www.weltderphysik.de/gebiet/technik/nachrichten/2023/energiespeicher-lithium-ionen-batterie-ohne-kobalt/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Entsprechend hat sich die Anzahl der installierten PV Batteriesysteme in einem Jahr, in 2023, mehr als verdoppelt,
&lt;em&gt;und der Trend beschleunigt sich.&lt;/em&gt; &lt;a href=&#34;https://renewablesnow.com/news/germanys-solar-battery-capacity-doubles-in-2023-846621/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Quelle&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Alles, was ihr über die Probleme und die Kosten einer Energietransition wißt oder an Artikeln lest,
das älter als 12 Monate ist, ist wahrscheinlich falsch und basiert auf veralteten Annahmen.
Der Wandel passiert schneller, ist einfacher und gefahrloser und sehr, sehr viel billiger als ihr denkt.&lt;/p&gt;
&lt;h1 id=&#34;das-ist-nicht-das-erste-mal-so&#34;&gt;
    &lt;a href=&#34;#das-ist-nicht-das-erste-mal-so&#34;&gt;
	Das ist nicht das erste Mal so
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Das ist übrigens nicht spezifisch für unsere Zeit.&lt;/p&gt;
&lt;p&gt;Auch zur Zeit der industriellen Revolution kam es zu gravierenden Veränderungen, einer Landflucht und Verstädterung,
und damit einhergehenden echten und eingebildeten Problemen.&lt;/p&gt;
&lt;p&gt;Die Stadt Kiel, meine Heimatstadt, ist damals zum Beispiel in 30 Jahren um den Faktor 10 gewachsen.&lt;/p&gt;
&lt;p&gt;Berlin ebenso.
Ich habe in Berlin in einer Wohnung nahe der U6 Kaiserin-Augusta-Straße gewohnt.
Die Wohnung war von 1908, und man kann dort durch die Straßen gehen stadtauswärts bis Mariendorf,
und die Querstraßen sind wie Jahresringe:
Vom Tempelhofer Feld bis Mariendorf wird die Bausubstanz mit dem Ausbau der U6
bis zur Endstation wie Jahresringe Querstraße um Querstraße immer jünger.&lt;/p&gt;
&lt;p&gt;Auch damals hatte man eine Menge &amp;ldquo;Probleme&amp;rdquo;:&lt;/p&gt;
&lt;p&gt;Die Dienstbotenfrage zum Beispiel ist eine Folge dieser Landflucht–Haushaltsführung war weitgehend manuell,
und auf das Vorhandensein großer Mengen abhängiger und niedrig ausgebildeter Arbeitskräfte angewiesen.
Die waren dann aber schlagartig nicht zu kriegen.&lt;/p&gt;
&lt;p&gt;Während die Politik das Problem noch diskutierte,
hatte man den Haushalt automatisiert–Waschmaschinen und Staubsauger,
basierend auf dem Siemens-Elektromotor,
haben sehr große Teile der anfallenden Arbeiten mechanisiert.&lt;/p&gt;
&lt;p&gt;Genau dasselbe Problem hatte man in der Landwirtschaft:
Durch die Landflucht hatte man ein Personalproblem.
Aber auf einmal gab es Traktoren und eine mechanisierte Landwirtschaft.&lt;/p&gt;
&lt;p&gt;Um 1900 herum schien es,
als ob dieselbe Landwirtschaft auf der vorhandenen Fläche die wachsende Bevölkerung nicht ernähren würde können.
Aber auf einmal gab es chemische Düngemittel und das Haber-Bosch-Verfahren (1913), und etwa um dieselbe Zeit
entwickelte Bayer Pestizide und Herbizide (Dinitrol und andere),
sodass Ernteausfälle und Hungersnöte aus anderen Gründen als Krieg in Europa der Vergangenheit angehörten.&lt;/p&gt;
&lt;p&gt;Die Politik hat dennoch bis in den 2. Weltkrieg rein von notwendigem Lebensraum für das Volk geschwafelt.
Das ist auch ein Fall von Leuten,
die ihr Gehirn mit den Problemen ihrer Jugend belasten und ihr Weltbild nicht aktualisiert haben.&lt;/p&gt;
&lt;h1 id=&#34;wir-können-das-nicht&#34;&gt;
    &lt;a href=&#34;#wir-k%c3%b6nnen-das-nicht&#34;&gt;
	Wir können das nicht
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Vermutlich sind Menschen nicht gut gemacht für Veränderungen, die schneller als in 30 Jahren ablaufen.
Oder wir haben noch keine funktional wirksamen Kulturtechniken entwickelt und Prozesse etabliert,
mit denen wir solche Veränderungen zuverlässig kommunizieren und managen können.&lt;/p&gt;
&lt;p&gt;Wie gesagt, gegenwärtig sind wir bei 3 Jahren Zykluszeit mit Leuten,
deren Weltbild 30 Jahre und länger in Bernstein konserviert worden ist.
Das ist ein Problem.&lt;/p&gt;
&lt;p&gt;Man muss sich selbst da aktiv einbringen und aktualisieren.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/welt-08.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ich hatte, wie viele Kinder meiner Generation,
in meinem Regal hier gut 50 Was-ist-Was-Bücher aus den 1980er Jahren stehen.
Hier sind die überlebenden Bände zu sehen.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Man kann sich diese Was-ist-Was Bände nehmen und mit einem großen orangen Textmarker durchgehen.
Markiert man veraltete, falsche oder überholte Informationen, kommt da schon eine ganze Menge zusammen.
Markiert man auch inzwischen gelöste Probleme, noch weitaus mehr.
Die Teile sind nicht falsch per se, aber sie sind 40 oder 50 Jahre alt, und wir haben seit damals viel gelernt.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://www.youtube.com/watch?v=UwLjK9LFpeo&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Reality has a well-known liberal bias&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Das Problem ist: Es handelt sich um lebendige Geschichte.
Die Leute, die mit diesen Informationen groß geworden sind, leben noch und sind heute in Entscheidungspositionen.
Und machen da gefährlichen Quatsch, der auf falschen oder veralteten Daten beruht.
Das ist schlecht.&lt;/p&gt;
&lt;p&gt;Wenn Stephen Colbert scherzhaft sagt &amp;ldquo;Reality has a well-known liberal bias&amp;rdquo;, dann bezeichnet das auch genau das:
Leute mit konservativem, veraltetem Weltbild scheitern an einer sich ändernden, progressiven Realität.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Beyond rwx: Linux permissions</title>
      <link>https://blog.koehntopp.info/2024/06/07/beyond-rwx.html</link>
      <pubDate>Fri, 31 May 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/06/07/beyond-rwx.html</guid>
      <description>&lt;p&gt;I wrote this article before, in 1996, in german:
&lt;a href=&#34;https://blog.koehntopp.info/1996/03/01/rwx-sonst-nix.html&#34;&gt;rwx–sonst nix?&lt;/a&gt;

,
and in 2005, in german:
&lt;a href=&#34;https://blog.koehntopp.info/2005/11/01/user-und-gruppen-prozesse-und-dateien.html&#34;&gt;User und Gruppen, Prozesse und Dateien&lt;/a&gt;

.
This is not a translation because some things changed.&lt;/p&gt;
&lt;p&gt;A file in Linux has three permissions, &lt;code&gt;rwx&lt;/code&gt;,
which are applied to three categories, the owner, their group and everyone else.
To read a file you need &lt;code&gt;r&lt;/code&gt; permission, to write it you need &lt;code&gt;w&lt;/code&gt;, and to run it &lt;code&gt;x&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s it, right?&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/opening-files-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;A developer opening a file. (ChatGPT)&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;you-do-not-open-files&#34;&gt;
    &lt;a href=&#34;#you-do-not-open-files&#34;&gt;
	You do not open files
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Most people say &amp;ldquo;I&amp;rsquo;m reading this file&amp;rdquo; or &amp;ldquo;I&amp;rsquo;m opening this file for writing&amp;rdquo; without thinking much about it.
But in fact, nobody in the history of Unix has ever opened or deleted a file.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;You&amp;rdquo; as a person are being represented in Linux as a user.
You have a username, which is translated on login into a UID, a number.
In the language of identity and access management, this number is &amp;ldquo;a principal,&amp;rdquo;
a token that represents your identity in the system for permission management.&lt;/p&gt;
&lt;p&gt;This token is assigned to initially one single process that can perform actions on the system on your behalf.
The process can also create more processes with
&lt;a href=&#34;https://blog.koehntopp.info/2020/12/28/fork-exec-wait-and-exit.html&#34;&gt;fork and exec&lt;/a&gt;

, which inherit the UID.&lt;/p&gt;
&lt;p&gt;So, strictly speaking, you do not open files.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A Linux process with your UID tries to open files on your behalf,
and if it succeeds, gains access to a file descriptor (fd) that allows this process to perform actions on that file.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Access control, the checking if a process is allowed to do things, happens only on file open.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;File descriptors can also be passed along between processes.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;As long as that fd is kept open, the file exists,
and any process having access to that fd can do the operations on that fd that it allows.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That has a lot of implications.&lt;/p&gt;
&lt;p&gt;For example, it is possible to delete all names of a file, and still use it – as long as any process has a fd open,
the file exists (even when it has no name).
Disk space is not freed.
The file descriptor can be used to give the file a name again (in Linux, with &lt;code&gt;linkat(2)&lt;/code&gt; and the &lt;code&gt;/proc&lt;/code&gt; file system).&lt;/p&gt;
&lt;p&gt;That is, for example,
while programs such as &lt;code&gt;logrotate&lt;/code&gt; have to send a &lt;code&gt;SIGHUP&lt;/code&gt; signal to syslog after rotating logfiles.
Syslog then closes and reopens all file descriptors, ensuring that the logs go into new, not deleted files.&lt;/p&gt;
&lt;p&gt;That is also why programs such as &lt;code&gt;lsof&lt;/code&gt; sometimes list files with no name, marked as &lt;code&gt;(DELETED)&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;how-do-you-get-a-file-descriptor&#34;&gt;
    &lt;a href=&#34;#how-do-you-get-a-file-descriptor&#34;&gt;
	How do you get a file descriptor?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The answer used to be &amp;ldquo;with the &lt;code&gt;open(2)&lt;/code&gt; syscall, of course.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;But running &lt;code&gt;strace&lt;/code&gt; on a modern Linux you will see that it is &lt;code&gt;openat(2)&lt;/code&gt; now.
This call is a generalization of &lt;code&gt;open()&lt;/code&gt;, and &lt;code&gt;open(3)&lt;/code&gt; could be a library function that calls &lt;code&gt;openat(2)&lt;/code&gt;,
but for compatibility and ABI stability, &lt;code&gt;open(2)&lt;/code&gt; still exists in parallel.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In old Unix, 40 years ago, the system manual had chapters.
Chapter 1 was user commands,
chapter 8 was sysadmin commands,
chapter 2 was syscalls (kernel functions),
and chapter 3 was library functions.
By looking at the chapter number to a manual page reference,
you could see if a thing was a native kernel call from chapter 2.
A library function from chapter 3 would internally use a different kernel function to perform its action.&lt;/p&gt;
&lt;p&gt;Kernel functions are wrapped in library functions for convenience,
which are then wrapped in command line programs to make them available from the shell.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;what-can-a-fd-do&#34;&gt;
    &lt;a href=&#34;#what-can-a-fd-do&#34;&gt;
	What can a &lt;code&gt;fd&lt;/code&gt; do?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The Linux manpage for the &lt;code&gt;openat(2)&lt;/code&gt; syscall lists a number of flags for the syscall, all starting with &lt;code&gt;O_&lt;/code&gt;.
Using these flags, a process declares what it intends to be able to do with the file.
On checking the intent against the permissions that a file has,
the kernel decides to grant access.
This is done by handing out a file descriptor.
If access is not granted, an error is returned instead.&lt;/p&gt;
&lt;p&gt;An error from insufficient permissions usually is an &lt;code&gt;EPERM&lt;/code&gt; (error code 13),
but Linux has become complicated.
&lt;code&gt;EPERM&lt;/code&gt; may also come from other subsystems (such as AppArmor or SELinux),
and there may be other error codes that ultimately have permissions as a root cause.&lt;/p&gt;
&lt;p&gt;In any case, here is what a process can declare that it wants to do with a file:&lt;/p&gt;
&lt;p&gt;In traditional Unix, there were three basic flags.&lt;/p&gt;
&lt;dl&gt;
&lt;dt&gt;O_RDONLY&lt;/dt&gt;
&lt;dd&gt;The fd is to be used read-only.&lt;/dd&gt;
&lt;dt&gt;O_WRONLY&lt;/dt&gt;
&lt;dd&gt;The fd is to be used write-only.&lt;/dd&gt;
&lt;dt&gt;O_RDWR&lt;/dt&gt;
&lt;dd&gt;The fd is to be used for reading and writing.&lt;/dd&gt;
&lt;dt&gt;O_PATH&lt;/dt&gt;
&lt;dd&gt;Since Linux 2.6.39, there is also &lt;code&gt;O_PATH&lt;/code&gt;:
the fd is to be used for reference only.
Reading or writing will fail with &lt;code&gt;EBADF&lt;/code&gt;, as will any operations that modify metadata such as &lt;code&gt;fchown(2)&lt;/code&gt;.
But you can use it as a base to open other files with &lt;code&gt;openat(2)&lt;/code&gt;,
as a base to try to execute a file (if you have &lt;code&gt;x&lt;/code&gt; on that file),
and for a few other operations documented in the &lt;code&gt;openat(2)&lt;/code&gt; manual page.&lt;/dd&gt;
&lt;/dl&gt;
&lt;p&gt;These basic flags can be &amp;ldquo;or&amp;quot;ed together with additional flags that modify the behavior of the file open operation.&lt;/p&gt;
&lt;p&gt;The most important ones are &lt;code&gt;O_CREAT&lt;/code&gt; (&amp;ldquo;make me a new file, if it does not exist when I try to open it&amp;rdquo;),
and &lt;code&gt;O_EXCL&lt;/code&gt; (&amp;ldquo;fail if that file already exists, when I try to open it with &lt;code&gt;O_WRONLY|O_CREAT&lt;/code&gt;,
to make sure it is actually a new file&amp;rdquo;).&lt;/p&gt;
&lt;h1 id=&#34;permission-checks&#34;&gt;
    &lt;a href=&#34;#permission-checks&#34;&gt;
	Permission checks
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;&amp;ldquo;Authorization&amp;rdquo; schemes in computer systems take your principal (that UID)
and determine what you can do with it, by performing operations on other system objects.
This can be written as simple &amp;ldquo;three-word sentences&amp;rdquo; in subject-predicate-object form,
or &lt;a href=&#34;https://en.wikipedia.org/wiki/Semantic_triple&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;RDF triples&lt;/a&gt;

:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&amp;ldquo;Kris&amp;rdquo; &amp;ldquo;can read and write&amp;rdquo; &amp;ldquo;/home/kris/notes.txt&amp;rdquo;&lt;/li&gt;
&lt;li&gt;&amp;ldquo;Kris&amp;rdquo; &amp;ldquo;can read&amp;rdquo; &amp;ldquo;/etc/passwd&amp;rdquo;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For storage, we need to cut these triples along the subject axis or the object axis.
That is, we either store with each file which user can do things with the file,
or we store with each user what files that user can work on.&lt;/p&gt;
&lt;p&gt;Storing the data in the object yields a &lt;strong&gt;permission system&lt;/strong&gt; as we have in Unix:
Each file contains a record (the inode and the access control list records)
that lists which users can do what with this file.&lt;/p&gt;
&lt;p&gt;It is also possible to store this data with the user.
Storing authorizations with the user generates a &lt;strong&gt;capability system&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;AppArmor is an example for a capability-based system to limit what file accesses and system calls a process
is allowed to do.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/opening-files-04.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Slicing RDF triples with authorizations by object,
creating a permission system, or by subject, creating a capability system.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Normal processes are subject to these access control checks:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;To be able to execute &lt;code&gt;open(&amp;quot;./somefile.txt&amp;quot;, O_RDONLY)&lt;/code&gt; on a file, a process needs &lt;code&gt;r&lt;/code&gt;-permission on that file.&lt;/li&gt;
&lt;li&gt;To be able to execute &lt;code&gt;open(&amp;quot;./somefile.txt&amp;quot;, O_WRONLY)&lt;/code&gt; on a file, a process needs &lt;code&gt;w&lt;/code&gt;-permission on that file.&lt;/li&gt;
&lt;li&gt;To be able to execute &lt;code&gt;open(&amp;quot;./somefile.txt&amp;quot;, O_RDWR)&lt;/code&gt; on a file, a process needs both &lt;code&gt;r&lt;/code&gt; and &lt;code&gt;w&lt;/code&gt;-permission on that file.&lt;/li&gt;
&lt;li&gt;To be able to run a variant of the &lt;code&gt;exec(2)&lt;/code&gt; syscall on a file, a process needs &lt;code&gt;x&lt;/code&gt;-permission on that file.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;where-do-we-get-permissions-from&#34;&gt;
    &lt;a href=&#34;#where-do-we-get-permissions-from&#34;&gt;
	Where do we get permissions from?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Okay, what have we learned?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Users, the people, are being represented in the system as principals, UIDs.&lt;/li&gt;
&lt;li&gt;These UIDs are being held by processes, which execute system calls.&lt;/li&gt;
&lt;li&gt;Certain system calls normally perform permission checks, and if they succeed, they do work for us.&lt;/li&gt;
&lt;li&gt;If the UID is associated with certain capabilities, these permission checks are bypassed, and they &amp;ldquo;always work&amp;rdquo;
(They can still fail, but not for permission reasons).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Users without special capabilities are subject to permission checks.
Permissions are stored with the objects, the files being operated on.&lt;/p&gt;
&lt;p&gt;So where exactly are permissions stored, and how can we see them?&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r--+ 1 kris kris 0 Jun  7 06:15 somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ln somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r--+ 1 1000 1000 0 Jun  7 06:15 somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;uid=1000(kris) gid=1000(kris) 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  groups=1000(kris),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),122(lpadmin),134(lxd),135(sambashare),143(docker)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The Linux command &lt;code&gt;ls -l&lt;/code&gt; shows us a file, and some file metadata in a concise single line form.
The first block, &lt;code&gt;-rw-rw-r--+&lt;/code&gt; shows us the file permissions, followed by the link count (the number of names the file has),
followed by the files owner (kris) and the files group (also kris).
Using the &lt;code&gt;-n&lt;/code&gt; flag, we get the UID and GID numbers unresolved, instead of the names of the user and group.&lt;/p&gt;
&lt;p&gt;The permission bits &lt;code&gt;rwx&lt;/code&gt; are shown three times, with the letter if set, and with a &lt;code&gt;-&lt;/code&gt; if not.
The first three permissions are the user permissions,
the next three are the group permissions, and the final three are the other permissions.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;id&lt;/code&gt; command shows us the UID and the GIDs of our process (one of the GIDs is a primary GID for that process).&lt;/p&gt;
&lt;h3 id=&#34;standard-unix-file-access-checks&#34;&gt;
    &lt;a href=&#34;#standard-unix-file-access-checks&#34;&gt;
	Standard Unix File Access Checks
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;In traditional Unix, the logic was as follows:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Do the file UID and the process UID match? If yes, use the user permissions.
In our example, the UID 1000 on the file and the UID 1000 from &lt;code&gt;id&lt;/code&gt; match, so this is what is being used.&lt;/li&gt;
&lt;li&gt;Do the file GID and any of the GIDs from the process GID set match? If yes, use the group permissions.
In our example, the file GID is 1000, and the process GID set is 1000, 4, 24, 27, 30, 46, 122, 134, 135 and 143.
Any user being in any of these groups gets to use the second set of permission bits.&lt;/li&gt;
&lt;li&gt;All other users get to use the other permissions.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/opening-files-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;A different example:&lt;/strong&gt; A process wants to open a file. The UID does not match, the GID does match. Group permissions are granted.&lt;/em&gt;&lt;/p&gt;
&lt;h3 id=&#34;linux-file-access-checks-with-acls&#34;&gt;
    &lt;a href=&#34;#linux-file-access-checks-with-acls&#34;&gt;
	Linux File Access Checks with ACLs
    &lt;/a&gt;
&lt;/h3&gt;
&lt;p&gt;In modern Linux, this is still the case, &lt;strong&gt;but&lt;/strong&gt; we get to define optional, additional permission sets.
If they are present, a trailing &lt;code&gt;+&lt;/code&gt; is shown, as is in our example file.&lt;/p&gt;
&lt;p&gt;We can read these additional permission with &lt;code&gt;getfacl&lt;/code&gt; and set them with &lt;code&gt;setfacl&lt;/code&gt;.
A &amp;ldquo;facl&amp;rdquo; is a &lt;em&gt;file access control list&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;We are reading the files facl with &lt;code&gt;getfacl&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ getfacl ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; file: somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; owner: kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; group: kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;user::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;user:sammy:r--
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;group::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;mask::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;other::r--
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We get to see the standard three entries as &lt;code&gt;user&lt;/code&gt;, &lt;code&gt;group&lt;/code&gt; and &lt;code&gt;other&lt;/code&gt;.
We also get to see a mask, which we have not mentioned yet, and which can be used to set maximum allowed permissions.
And we get to see a named entry, for a &lt;code&gt;user&lt;/code&gt; named &lt;code&gt;sammy&lt;/code&gt; which has only &lt;code&gt;r&lt;/code&gt; permissions.&lt;/p&gt;
&lt;p&gt;The ACL check is done as step 1b.
It is performed after the UID check, and before the GID check.&lt;/p&gt;
&lt;p&gt;1b. For each named ACL entry:&lt;/p&gt;
&lt;p&gt;Is this a &lt;code&gt;user&lt;/code&gt; ACL?
If so, does the UID in the ACL match the UID from the process?
If so, use the permission &lt;code&gt;rwx&lt;/code&gt; triplet from this ACL entry.&lt;/p&gt;
&lt;p&gt;Is this a &lt;code&gt;group&lt;/code&gt; ACL?
If so, does the GID in the ACL match any GID from the processes HID set?
If so, use the permission &lt;code&gt;rwx&lt;/code&gt; triplet from this ACL entry.&lt;/p&gt;
&lt;p&gt;Because this is done as 1b, it happens before the GID check in step 2.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris$ getfacl ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; file: somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; owner: kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt; group: kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;user::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;user:sammy:r--
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;group::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;mask::rw-
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;other::r--
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris$ id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;uid=1002(sammy) gid=1000(kris) groups=1000(kris)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris$ ls -l ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r--+ 1 kris kris 0 jun  7 06:33 ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris$ &amp;gt; ./somefile.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-bash: ./somefile.txt: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With the &lt;code&gt;getfacl&lt;/code&gt; output we can see that a special named entry for &lt;code&gt;user:sammy&lt;/code&gt; exists.
This entry grants only &lt;code&gt;r&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Sammy is also member of the group &lt;code&gt;kris (1000)&lt;/code&gt;, so the file GID and the process GID match (both are 1000, kris).
Because of this group membership, the group permissions &lt;code&gt;rw-&lt;/code&gt; should be applied.&lt;/p&gt;
&lt;p&gt;But because the named entry for sammy is checked before the GID entry, and matches,
sammy is only granted &lt;code&gt;r--&lt;/code&gt; permission on this file.
Trying to write to the file with &lt;code&gt;&amp;gt; ./somefile.txt&lt;/code&gt; fails.&lt;/p&gt;
&lt;h1 id=&#34;pathnames&#34;&gt;
    &lt;a href=&#34;#pathnames&#34;&gt;
	Pathnames
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;In Unix, directories have permissions, too.&lt;/p&gt;
&lt;p&gt;For files, having &lt;code&gt;r&lt;/code&gt; means you can read the file, having &lt;code&gt;w&lt;/code&gt; means you can write to the file,
and having &lt;code&gt;x&lt;/code&gt; means you can execute the file.&lt;/p&gt;
&lt;p&gt;For directories, the same bits exist, but mean subtly different things:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;r&lt;/code&gt; on a directory allows you to run &lt;code&gt;readdir&lt;/code&gt; on the directory. You can see the filenames in the directory.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;w&lt;/code&gt; on a directory allows you to modify directory names in the directory. You can remove or add filenames in the directory.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;x&lt;/code&gt; on a directory means you can resolve names of files in this directory.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Wait, what? Let&amp;rsquo;s have a more detailed look at that.&lt;/p&gt;
&lt;p&gt;But first:
Permissions are being checked according to the pathname.&lt;/p&gt;
&lt;p&gt;So if you write a pathname such as &lt;code&gt;./somefile.txt&lt;/code&gt; (or &lt;code&gt;somefile.txt&lt;/code&gt;, which is exactly the same), this is&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the permission check of the current directory, &lt;code&gt;.&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;the permission check of the file &lt;code&gt;somefile.txt&lt;/code&gt; in that directory.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you write &lt;code&gt;../../bin/ls&lt;/code&gt;, this is&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ pwd
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/home/kris
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l ../../bin/ls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rwxr-xr-x 1 root root 138216 Feb  8 04:46 ../../bin/ls
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;the permission check for &lt;code&gt;..&lt;/code&gt; (traversing &lt;code&gt;/home&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;the permission check for &lt;code&gt;..&lt;/code&gt; (traversing &lt;code&gt;/&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;the permission check for &lt;code&gt;bin&lt;/code&gt; (traversing &lt;code&gt;/bin&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;the permission check for the file &lt;code&gt;ls&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Or, in other words,
a file&amp;rsquo;s effective permission is the sequence of permissions along the path plus the permission on the file,
individual permissions and file access control lists and all.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;But if you write &lt;code&gt;/bin/ls&lt;/code&gt;, this is&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;the permission check for &lt;code&gt;/&lt;/code&gt;,&lt;/li&gt;
&lt;li&gt;the permission check for &lt;code&gt;/bin&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;and the permission check for the file &lt;code&gt;ls&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;and that is a subtly different set of permissions,
because it is a different path to the same file, but we check along the path.&lt;/p&gt;
&lt;p&gt;Now, let&amp;rsquo;s look at directory permissions in detail:&lt;/p&gt;
&lt;h2 id=&#34;directory-r-permission-but-no-x&#34;&gt;
    &lt;a href=&#34;#directory-r-permission-but-no-x&#34;&gt;
	Directory &lt;code&gt;r&lt;/code&gt; permission (but no &lt;code&gt;x&lt;/code&gt;)
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Let&amp;rsquo;s create a directory and a file in that directory:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo schokokeks &amp;gt;  cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drwxrwxr-x 2 kris kris  3 Jun  7 06:57 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris kris 11 Jun  7 06:58 cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now let&amp;rsquo;s remove the &lt;code&gt;x&lt;/code&gt; permission from the directory.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chmod a-x cookie/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I have no &lt;code&gt;x&lt;/code&gt;, and that means I cannot get to any of these files:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drw-rw-r-- 2 kris kris 3 Jun  7 06:57 cookie/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ls: cannot access &amp;#39;cookie/choc&amp;#39;: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ cat cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;cat: cookie/choc: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I still have &lt;code&gt;r&lt;/code&gt;, so I can list the names.
I would need access to the files to get more than the name, for example file length or permissions with &lt;code&gt;stat(2)&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo cookie/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ls: cannot access &amp;#39;cookie/choc&amp;#39;: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;total 0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-????????? ? ? ? ?            ? choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Restoring &lt;code&gt;x&lt;/code&gt; permission fixes things.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Destructive Sysadmin Exercise:&lt;/strong&gt; Get yourself a throwaway virtual machine.
As root, run &lt;code&gt;chmod a-x /&lt;/code&gt;.
&lt;em&gt;Do not do this with a production machine.&lt;/em&gt;
Predict what will happen.
What actually happens?
Can you fix it?&lt;/p&gt;
&lt;h2 id=&#34;directory-x-permission-but-no-r&#34;&gt;
    &lt;a href=&#34;#directory-x-permission-but-no-r&#34;&gt;
	Directory &lt;code&gt;x&lt;/code&gt; permission (but no &lt;code&gt;r&lt;/code&gt;)
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Let&amp;rsquo;s recreate the setup and then remove the &lt;code&gt;r&lt;/code&gt; permission, keeping &lt;code&gt;x&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo &amp;#34;schokokeks&amp;#34; &amp;gt; cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chmod 111 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;d--x--x--x 2 kris kris  3 Jun  7 07:06 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris kris 11 Jun  7 07:06 cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ cat cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;schokokeks
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Kris can still access the files in the directory and their contents.
But:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ls: cannot open directory &amp;#39;cookie&amp;#39;: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;While &lt;code&gt;ls -ld cookie cookie/choc&lt;/code&gt; tries to directly list files with known names,
&lt;code&gt;ls -l&lt;/code&gt; tries to open the directory for reading with &lt;code&gt;opendir&lt;/code&gt;
and then discover the content (the file names) using &lt;code&gt;readdir&lt;/code&gt;.
This fails.&lt;/p&gt;
&lt;p&gt;Running &lt;code&gt;stat&lt;/code&gt; system calls on files with known names traverses the directory
and requires &lt;code&gt;x&lt;/code&gt; permission on the directory containing the files.
Running &lt;code&gt;opendir&lt;/code&gt; and &lt;code&gt;readdir&lt;/code&gt; calls to discover filenames requires &lt;code&gt;r&lt;/code&gt; permission.
We have &lt;code&gt;x&lt;/code&gt;, but not &lt;code&gt;r&lt;/code&gt;, so one operation succeeds, the other does not.&lt;/p&gt;
&lt;h2 id=&#34;directory-w-permission&#34;&gt;
    &lt;a href=&#34;#directory-w-permission&#34;&gt;
	Directory &lt;code&gt;w&lt;/code&gt; permission
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Let&amp;rsquo;s create a directory with &lt;code&gt;w&lt;/code&gt; permission for the group:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo &amp;#34;schokokeks&amp;#34; &amp;gt; cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chmod 730 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drwx-wx--- 2 kris kris 3 Jun  7 07:12 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now, as a different user, let&amp;rsquo;s do things:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ id
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;uid=1002(sammy) gid=1000(kris) groups=1000(kris)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:~$ cd ~kris/cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ls: cannot open directory &amp;#39;.&amp;#39;: Permission denied
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ cat choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;schokokeks
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris kris 11 jun  7 07:12 choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ echo butter &amp;gt; butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-r--r-- 1 sammy kris 7 jun  7 07:15 butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ rm choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Sammy, being member of the group kris, can enter the directory with &lt;code&gt;cd&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Sammy has no &lt;code&gt;r&lt;/code&gt; permission, so she cannot list the directory contents.&lt;/p&gt;
&lt;p&gt;Sammy has &lt;code&gt;x&lt;/code&gt; permission, so she can access files in the directory, if the file permission allows this.
She can also &lt;code&gt;stat(2)&lt;/code&gt; files with known names to learn the files&amp;rsquo; metadata.&lt;/p&gt;
&lt;p&gt;Having &lt;code&gt;w&lt;/code&gt; permission, sammy can create filenames in this directory, here &lt;code&gt;butter_cookie&lt;/code&gt;.
The new file has her UID and the parent directories GID (what?).&lt;/p&gt;
&lt;p&gt;Having &lt;code&gt;w&lt;/code&gt; permission, sammy can also remove filenames in this directory, here &lt;code&gt;choc&lt;/code&gt;, which she does not own (what?).&lt;/p&gt;
&lt;h1 id=&#34;deleting-files&#34;&gt;
    &lt;a href=&#34;#deleting-files&#34;&gt;
	Deleting files
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Let&amp;rsquo;s address the second &amp;ldquo;What?&amp;rdquo; first: Nobody in Unix has ever deleted a file.&lt;/p&gt;
&lt;p&gt;Unix garbage collects files automatically when the number of their names is zero (their link count is zero),
and the number of open file descriptors is zero.&lt;/p&gt;
&lt;p&gt;You knew this: The syscall is called &lt;code&gt;unlink(2)&lt;/code&gt; and not &lt;code&gt;delete&lt;/code&gt;.
&lt;code&gt;unlink&lt;/code&gt; will remove one of potentially many names of a file.
Even the last one.&lt;/p&gt;
&lt;p&gt;Giving &lt;code&gt;w&lt;/code&gt;-permission allows people to create or remove filenames in a directory.
The file is never involved with this, hence permissions are not checked.&lt;/p&gt;
&lt;p&gt;That&amp;rsquo;s bad.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s fix that.&lt;/p&gt;
&lt;p&gt;I lied. There are not nine permission bits to a file, there are 12. It&amp;rsquo;s not &lt;code&gt;rwxrwxrwx&lt;/code&gt;, it&amp;rsquo;s &lt;code&gt;sstrwxrwxrwx&lt;/code&gt;.
The &lt;code&gt;sst&lt;/code&gt; is rarely set, so it is not shown unless it is set.
When it is set, it is shown instead of the three &lt;code&gt;x&lt;/code&gt;, in lower case if the &lt;code&gt;x&lt;/code&gt; below is set, else in upper case.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/06/opening-files-03.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;What are the &lt;code&gt;sst&lt;/code&gt; bits and why don&amp;rsquo;t we see them?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;t&lt;/code&gt;-bit is called &amp;ldquo;sticky bit&amp;rdquo; because of an obscure function (for files) for a computer type that no longer exists.
You can interpret is as &amp;ldquo;this thing needs special treatment&amp;rdquo; in modern Unix.
If you set it on directories, it will prevent a user from deleting files they do not own.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo &amp;#34;schokokeks&amp;#34; &amp;gt; cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chmod 1730 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drwx-wx--T 2 kris kris 3 Jun  7 07:25 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We have set the permissions &lt;code&gt;1730&lt;/code&gt; aka &lt;code&gt;--trwx-wx--T&lt;/code&gt; on this directory.
The &lt;code&gt;T&lt;/code&gt; is shown instead of the last &lt;code&gt;x&lt;/code&gt; and it is uppercase because the &lt;code&gt;x&lt;/code&gt; beneath it is not there.&lt;/p&gt;
&lt;p&gt;And now&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:~$ cd ~kris/cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris kris 11 jun  7 07:25 choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ rm choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;rm: cannot remove &amp;#39;choc&amp;#39;: Operation not permitted
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;but&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ echo butter &amp;gt; butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ ls -l butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-r--r-- 1 sammy kris 7 jun  7 07:28 butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$ rm butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sammy@server:/home/kris/cookie$
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;So sammy can still create files, which she then owns, and which she can delete.&lt;/p&gt;
&lt;p&gt;But sammy can no longer delete files that she does not own.&lt;/p&gt;
&lt;p&gt;Remember to set &lt;code&gt;t&lt;/code&gt; on a directory that is also writeable by other persons.&lt;/p&gt;
&lt;h1 id=&#34;who-owns-new-files&#34;&gt;
    &lt;a href=&#34;#who-owns-new-files&#34;&gt;
	Who owns new files?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;When creating new files, the new file gets an owner UID, a file GID and a default ACL.&lt;/p&gt;
&lt;p&gt;Let&amp;rsquo;s try this:&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-conosle&#34; data-lang=&#34;conosle&#34;&gt;kris@server:~$ id
uid=1000(kris) gid=1000(kris) 
  groups=1000(kris),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),122(lpadmin),134(lxd),135(sambashare),143(docker)

kris@server:~$ mkdir cookie
kris@server:~$ echo &amp;#34;schokokeks&amp;#34; &amp;gt; cookie/choc

kris@server:~$ ls -l cookie/choc
-rw-rw-r-- 1 kris kris  11 Jun  7 07:31 cookie/choc
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;I can try to give the file to a different group.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chgrp doesnotexist cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;chgrp: invalid group: ‘doesnotexist’
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chgrp scanner cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;chgrp: changing group of &amp;#39;cookie/choc&amp;#39;: Operation not permitted
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chgrp sambashare cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris sambashare 11 Jun  7 07:31 cookie/choc
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I can&amp;rsquo;t give the file to a group that does not exist.&lt;/p&gt;
&lt;p&gt;I can&amp;rsquo;t give the file to a group that I am not a member of.
That is, because that file will count against that groups&amp;rsquo; quota,
and I am not allowed to book this file on a foreign groups&amp;rsquo; quota.&lt;/p&gt;
&lt;p&gt;I can give the file to any group that I am a member of.
That is how the GID set of a process matters.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ mkdir cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ chgrp sambashare cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -ld cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;drwxrwxr-x 2 kris sambashare 2 Jun  7 07:37 cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ echo butter &amp;gt; cookie/butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kris@server:~$ ls -l cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;total 1
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-rw-rw-r-- 1 kris sambashare 7 Jun  7 07:38 butter_cookie
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;When I create files in a directory, the file will inherit the group of the directory.
That makes it easier for a group of people working together in a group,
because shared group directories will now automatically behave properly.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Normal users are being created with a group after them, and ideally with the name GID and UID.
Effectively, they do no longer need to care about groups because they are the only members of their own group.&lt;/li&gt;
&lt;li&gt;Additional groups can be created for cooperation.
A sysadmin adds members to these groups effectively.&lt;/li&gt;
&lt;li&gt;Directories that belong to a group will contain newly created files, which are created with a GID of that share group.&lt;/li&gt;
&lt;li&gt;That is what you want:
If you put files into a share directory for a group, they should be UID you, GID the share group.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This happens, because the file system is mounted with the option &lt;code&gt;bsdgroups&lt;/code&gt;.
For file systems that are mounted without this option, the primary GID of the user is chosen.
All file systems should always be mounted with &lt;code&gt;bsdgroups&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;If you need the opposite behavior for a single directory, &lt;code&gt;chmod g+s my_directory&lt;/code&gt; on it.
For a filesystem without &lt;code&gt;bsdgroups&lt;/code&gt;, this one directory will have &lt;code&gt;bsdgroups&lt;/code&gt; semantics.
For a filesystem with &lt;code&gt;bsdgroups&lt;/code&gt;, this one directory will have no &lt;code&gt;bsdgroups&lt;/code&gt; semantics.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>LLMs daheim mit Ollama</title>
      <link>https://blog.koehntopp.info/2024/05/31/llms-daheim-mit-ollama.html</link>
      <pubDate>Fri, 31 May 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/05/31/llms-daheim-mit-ollama.html</guid>
      <description>&lt;p&gt;Dieser Text ist eine Art Follow-up für &lt;a href=&#34;https://blog.koehntopp.info/2024/02/06/wie-chatgpt-funktioniert.html&#34;&gt;Wie ChatGPT funktioniert&lt;/a&gt;

.
Es geht darum, ein LLM lokal auszuführen und damit zu experimentieren.&lt;/p&gt;
&lt;p&gt;Wer mit LLMs daheim experimentieren möchte, der steht vor dem Problem,
einen Haufen furchtbar empfindlicher und schlecht zu aktualisierender Abhängigkeiten in Python zu installieren,
monströse Downloads zu verwalten und die Ausführung für die eigene Maschine zu optimieren.
Das wird ein bisschen verbessert mit &lt;a href=&#34;https://github.com/ggerganov/llama.cpp&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;llama.cpp&lt;/a&gt;

,
einer C++/C Bibliothek, die einem einen Teil der Arbeit abnimmt,
aber man hat immer noch kein Paket, mit dem man einfach Ergebnisse bekommt.&lt;/p&gt;
&lt;p&gt;Abhilfe schafft hier &lt;a href=&#34;https://github.com/ollama/ollama&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ollama&lt;/a&gt;

,
eine in Golang geschriebene Anwendung,
die llama.cpp integriert und den Download, die Verwaltung und die Ausführung von LLMs automatisiert.
Die &lt;a href=&#34;https://ollama.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Website&lt;/a&gt;

 verweist auf das Blog,
den Discord und das Github von Ollama, und hat eine Suche,
mit der man auf Ollama angepasste LLms finden und herunterladen kann.&lt;/p&gt;
&lt;h1 id=&#34;installation&#34;&gt;
    &lt;a href=&#34;#installation&#34;&gt;
	Installation
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;LLMs sind rechenintensive Monster, die eine große Maschine zur Ausführung brauchen.
Aber eingedampfte Spezialversionen kann man schon auf einem großen Raspi ausführen.
Größe ist jedoch ein qualitativer Unterschied:
Ein LLM mit 0.3 Mrd. Parameters verhält sich ganz anders als eines mit 8 Mrd. Parametern,
und dieses wiederum wird von einem LLM mit 70 Mrd. Parameters vollkommen deklassiert.
Ersteres kann man auf einem Raspi ausführen,
die 8 Mrd. Parameter-Modelle oft auf einem Mac oder Windows-Rechner mit 32 GB RAM oder 12 GB VRAM in der Grafikkarte,
und die 70 Mrd. Parameter-Modelle brauchen in der Regel Spezialrechner mit 128 GB RAM und zwei 24 GB Nvidia-Karten kombiniert.&lt;/p&gt;
&lt;p&gt;In meinem Fall steht mir&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ein Mac mini M2pro mit 32 GB RAM und 8+4 Cores&lt;/li&gt;
&lt;li&gt;ein Windows 11 Rechner mit 64 GB RAM und Nvidia 4070Ti (12 GB VRAM)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;zur Verfügung. Beide Maschinen haben ausreichend Plattenplatz auf NVME.&lt;/p&gt;
&lt;p&gt;Man kann sich Ollama von der Website herunterladen und installieren,
oder das Golang Projekt selbst clonen und compilieren,
aber die einfachste Weise der Installation sind Paketmanager für MacOS und Windows.&lt;/p&gt;
&lt;p&gt;Auf dem Mac habe ich Homebrew, und &lt;code&gt;brew install ollama&lt;/code&gt; ist die schnellste und einfachste Methode,
Ollama zu installieren und aktuell zu halten.
Auf Windows geht dasselbe mit &lt;a href=&#34;https://scoop.sh/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Scoop&lt;/a&gt;

, &lt;code&gt;scoop install ollama&lt;/code&gt; regelt die Details.&lt;/p&gt;
&lt;h1 id=&#34;ollama-serve-ausführen&#34;&gt;
    &lt;a href=&#34;#ollama-serve-ausf%c3%bchren&#34;&gt;
	&lt;code&gt;ollama serve&lt;/code&gt; ausführen
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Ollama wird als Server ausgeführt.
Dazu muss man &lt;code&gt;ollama serve&lt;/code&gt; starten.&lt;/p&gt;
&lt;p&gt;Alle weiteren Operationen setzen voraus, daß in einem Fenster irgendwo &lt;code&gt;ollama serve&lt;/code&gt; aktiv ist,
denn alle weiteren Operationen tun nichts anderes als REST-Requests an &lt;code&gt;ollama serve&lt;/code&gt; zu senden.
Dies kann mit der &lt;code&gt;ollama&lt;/code&gt;-Kommandozeile passieren, oder man schreibt sich eigene Python-Programme, die das tun&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; ollama serve
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama serve
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;2024/05/31 09:52:25 routes.go:1008: INFO server config 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  env=&amp;#34;map[OLLAMA_DEBUG:false OLLAMA_LLM_LIBRARY: OLLAMA_MAX_LOADED_MODELS:1 OLLAMA_MAX_QUEUE:512
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;   OLLAMA_MAX_VRAM:0 OLLAMA_NOPRUNE:false OLLAMA_NUM_PARALLEL:1 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;   OLLAMA_ORIGINS:[http://localhost ... https://0.0.0.0:*] 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;   OLLAMA_RUNNERS_DIR: OLLAMA_TMPDIR:]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;time=2024-05-31T09:52:25.124+02:00 level=INFO source=images.go:704 msg=&amp;#34;total blobs: 28&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;time=2024-05-31T09:52:25.131+02:00 level=INFO source=images.go:711 msg=&amp;#34;total unused blobs removed: 0&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;time=2024-05-31T10:02:15.032+02:00 level=INFO source=payload.go:44 msg=&amp;#34;Dynamic LLM libraries [metal]&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;time=2024-05-31T10:02:15.090+02:00 level=INFO source=types.go:71 msg=&amp;#34;inference compute&amp;#34; 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  id=0 library=metal compute=&amp;#34;&amp;#34; driver=0.0 name=&amp;#34;&amp;#34; total=&amp;#34;21.3 GiB&amp;#34; available=&amp;#34;21.3 GiB&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Ollama lädt später Parameterdaten für die LLMs herunter. Diese nehmen einige Gigabyte Plattenplatz ein.
Per Default legt das MacOS Ollama dies im Home des Benutzers ab, in &lt;code&gt;$HOME/.ollama/models&lt;/code&gt;.
Man kann dies mit einer Umgebungsvariable umstellen.&lt;/p&gt;
&lt;p&gt;In diesem Fall muss man &lt;code&gt;OLLAMA_MODELS&lt;/code&gt; setzen:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama serve --help
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Start ollama
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Usage:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  ollama serve [flags]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Aliases:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  serve, start
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Flags:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  -h, --help   help for serve
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;Environment Variables:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_HOST         The host:port to bind to (default &amp;#34;127.0.0.1:11434&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_ORIGINS      A comma separated list of allowed origins
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_MODELS       The path to the models directory (default &amp;#34;~/.ollama/models&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_KEEP_ALIVE   The duration that models stay loaded in memory (default &amp;#34;5m&amp;#34;)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    OLLAMA_DEBUG        Set to 1 to enable additional debug logging
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; kk:~ kris$ mkdir /Volumes/Ablage/Torch/ollama-models/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;OLLAMA_MODELS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/Volumes/Ablage/Torch/ollama-models/ ollama serve
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Der Speicher dort sollte schnell sein und ausreichend Raum bereitstellen:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ df -h /Volumes/Ablage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Filesystem      Size    Used   Avail Capacity iused ifree %iused  Mounted on
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/dev/disk9s1   3.6Ti   804Gi   2.9Ti    22%    360k   31G    0%   /Volumes/Ablage
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ du -sh /Volumes/Ablage/Torch/ollama-models
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; 54G	/Volumes/Ablage/Torch/ollama-models
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama list
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;NAME                    	ID          	SIZE  	MODIFIED
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llama3:70b-instruct-q2_K	693db6efd8f9	26 GB 	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llama3:instruct         	365c0bd3c000	4.7 GB	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;mistral:instruct        	2ae6f6dd7a3d	4.1 GB	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;gemma:instruct          	a72c7f4d0a15	5.0 GB	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llama3-gradient:instruct	5d1398df5b8b	4.7 GB	6 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;phi3:14b                	1e67dff39209	7.9 GB	7 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llava-llama3:latest     	44c161b1f465	5.5 GB	7 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;llama3-gradient:latest  	5d1398df5b8b	4.7 GB	7 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;phi3:14b-instruct       	1e67dff39209	7.9 GB	7 days ago
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Der Ollama-Server bindet sich an localhost, Port 11434 und lauscht nun auf eingehende REST-Requests.
Diese können dazu führen, daß ein Model geladen und ausgeführt wird.
Das kann beim ersten Mal einige Zeit dauern, da viele Gigabyte Daten geladen werden müssen.&lt;/p&gt;
&lt;p&gt;Der Server hält das Model einige Zeit im Speicher, &lt;code&gt;OLLAMA_KEEP_ALIVE&lt;/code&gt; viele Minuten.
Der Default ist 5 m.
Danach wird der Speicher wieder freigegeben.&lt;/p&gt;
&lt;h1 id=&#34;modelle-aus-dem-internet-laden&#34;&gt;
    &lt;a href=&#34;#modelle-aus-dem-internet-laden&#34;&gt;
	Modelle aus dem Internet laden
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;LLMs sind recht komplizierte Konstrukte mit der eigentlichen Parameter-Datei, die den Großteil der Daten aus macht,
einem Systemprompt und weiteren Layers, die meist eher nicht so groß sind.
Auf einem handelsüblichen Desktop-Rechner kann man erwarten, ein &amp;ldquo;7B&amp;rdquo; oder &amp;ldquo;8B&amp;rdquo;-Modell auszuführen.
Dies belegt zwischen 5 GB und 9 GB an Speicher, im RAM oder auf der Grafikkarte.&lt;/p&gt;
&lt;p&gt;Richtig große Modelle, 70B-Modelle, brauchen wesentlich mehr Speicher und eine Hardware,
die für die Ausführung von LLMs auf mehreren Grafikkarten vorbereitet ist.&lt;/p&gt;
&lt;p&gt;Ein guter Startpunkt ist das Mistral AI-Model &lt;a href=&#34;https://ollama.com/library/mistral&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mistral&lt;/a&gt;

.
Man lädt es mit &lt;code&gt;ollama pull mistral:instruct&lt;/code&gt; herunter.
Das wird Zeit lang dauern und das Model-Directory entsprechend voll machen.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;HINWEIS:&lt;/strong&gt; Noch einmal die Erklärung, daß alle Arbeit von &lt;code&gt;ollama serve&lt;/code&gt; erledigt wird.
Wenn dieses Kommando nicht aktiv ist, funktioniert keines der anderen Kommandos.
&lt;code&gt;ollama pull&lt;/code&gt;, &lt;code&gt;ollama run&lt;/code&gt; und auch &lt;code&gt;ollama rm&lt;/code&gt; senden lediglich REST-Requests an den Server,
der dann die Arbeit macht.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama pull mistral:instruct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling manifest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling ff82381e2bea... 100% ▕████████████████▏ 4.1 GB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling 43070e2d4e53... 100% ▕████████████████▏  11 KB
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling c43332387573... 100% ▕████████████████▏   67 B
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling ed11eda7790d... 100% ▕████████████████▏   30 B
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pulling 42347cd80dc8... 100% ▕████████████████▏  485 B
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;verifying sha256 digest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;writing manifest
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;removing any unused layers
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;success
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;modelle-ausführen&#34;&gt;
    &lt;a href=&#34;#modelle-ausf%c3%bchren&#34;&gt;
	Modelle ausführen
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Das Modell kann man mit &lt;code&gt;ollama run mistral:instruct&lt;/code&gt; testen.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; /set verbose
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Set &amp;#39;verbose&amp;#39; mode.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; Explain in a single sentence &lt;span class=&#34;s2&#34;&gt;&amp;#34;Why is the sky blue?&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt; The sky appears blue because molecules in the Earth&amp;#39;s atmosphere scatter
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;sunlight in all directions, and blue light is scattered more because it
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;travels in shorter, smaller waves.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;total duration:       1.559908875s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;load duration:        2.719417ms
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval count:    23 token(s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval duration: 303.421ms
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval rate:     75.80 tokens/s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval count:           41 token(s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval duration:        1.245361s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval rate:            32.92 tokens/s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wir sehen hier, daß mein M2 pro mini 32 GB 1.56 Sekunden gebraucht hat, um diese Antwort zu generieren.
Die Frage hat &amp;ldquo;23 Token&amp;rdquo; belegt, die mit 75 Token/s analysiert worden sind.&lt;/p&gt;
&lt;p&gt;Die Generierung der Ausgabe hat 41 Token erzeugt, 1.25s gedauert und ist mit 33 Token/s gelaufen.
Der Rechner hat dabei ca. 50 Watt gezogen. Normal verbraucht er circa 7 Watt, also werden 43 Watt mehr verbraucht.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/05/ollama-3.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ausgabe der MacOS App Stats (&lt;code&gt;brew install stats&lt;/code&gt;), der Rechner verbraucht normal ca. 7 Watt, mit dem LLM aktiv 50 Watt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/05/ollama-1.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ausgabe der MacOS App Stats, hier: GPU Auslastung. Dies ist die einzige Anwendung, die die Mac mini GPU an den Anschlag bringt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Die Nvidia 4070Ti kommt auf mehr als 70 Token/s, zieht aber über 400 W.&lt;/p&gt;
&lt;p&gt;Der &lt;code&gt;ollama run&lt;/code&gt;-Prompt kann mit &lt;code&gt;/bye&lt;/code&gt; verlassen werden.&lt;/p&gt;
&lt;p&gt;Die vorhandenen Modelle können mit &lt;code&gt;ollama list&lt;/code&gt; aufgelistet werden.
Mit &lt;code&gt;ollama rm&lt;/code&gt; löscht man ein lokales Modell und gibt den Plattenplatz frei.
Es muss dann neu heruntergeladen werden.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama rm llama3:instruct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;deleted &amp;#39;llama3:instruct&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;arbeiten-mit-ollama-run-texte-zusammenfassen&#34;&gt;
    &lt;a href=&#34;#arbeiten-mit-ollama-run-texte-zusammenfassen&#34;&gt;
	Arbeiten mit &lt;code&gt;ollama run&lt;/code&gt;: Texte zusammenfassen
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Für das folgende Beispiel ist ein laufender Server &lt;code&gt;ollama serve&lt;/code&gt; erforderlich,
das Modell &lt;code&gt;mistral:instruct&lt;/code&gt; muss bereitstehen (d.h. &lt;code&gt;ollama list&lt;/code&gt; zeigt es an),
und wir verwenden den Text &lt;a href=&#34;https://www.gutenberg.org/files/61213/61213.txt&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The 64-Square Madhouse&lt;/a&gt;

 von Fritz Leiber.&lt;/p&gt;
&lt;p&gt;Das Ziel ist es, Ollama diesen Text mithilfe von Llama 3 zusammenfassen zu lassen.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Den Text von Fritz Leiber vom Projekt Gutenberg herunterladen.
Es ist hilfreich, allen Copyright-Text am Anfang und am Ende wegzuschneiden,
um dem Modell nur die Story selbst zu füttern.&lt;/li&gt;
&lt;li&gt;Server starten: &lt;code&gt;ollama serve&lt;/code&gt;.
Dabei sind ggf. die notwendigen Parameter als Umgebungsvariablen zu setzen, damit die Modelle gefunden werden.&lt;/li&gt;
&lt;li&gt;Modell prüfen: &lt;code&gt;ollama list&lt;/code&gt; zeigt das Modell &lt;code&gt;mistral:instruct&lt;/code&gt; als vorhanden an.
Ansonsten muss es mit &lt;code&gt;ollama pull mistral:instruct&lt;/code&gt; heruntergeladen werden.&lt;/li&gt;
&lt;li&gt;Den Prompt mit &lt;code&gt;ollama run mistral:instruct&lt;/code&gt; starten.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Wir verwenden hier das Modell &lt;code&gt;mistral:instruct&lt;/code&gt; von &lt;a href=&#34;https://en.wikipedia.org/wiki/Mistral_AI&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mistral AI&lt;/a&gt;

.
Das ist eine Firma von ehemaligen Google und Meta/Facebook Mitarbeitern, die vor einem Jahr in Paris gegründet wurde.&lt;/p&gt;
&lt;p&gt;Auf dem Prompt erfolgt die Kommunikation mit dem Modell in Englisch.
Manche Modelle sind ausdrücklich mehrsprachig trainiert (zum Beispiel &lt;a href=&#34;https://ollama.com/library/mixtral&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mixtral&lt;/a&gt;

),
aber wenn dies in der Anleitung zum Modell nicht angegeben ist, ist Englisch zu verwenden.&lt;/p&gt;
&lt;p&gt;Wir können dem Modell eine Anfrage in einer Zeile stellen.
Mehrzeilige Anweisungen werden mit &lt;code&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/code&gt; eingeleitet und genau so beendet.&lt;/p&gt;
&lt;p&gt;Es ist ein &lt;code&gt;instruct&lt;/code&gt;-Modell, es wird also keine Annahmen machen, sondern wir müssen Arbeitsanwendungen geben.&lt;/p&gt;
&lt;p&gt;Wir können dem Client Parameter setzen.
Dies erfolgt mit &lt;code&gt;/&lt;/code&gt;-Kommandos, &lt;code&gt;/help&lt;/code&gt; für eine Übersicht.&lt;/p&gt;
&lt;p&gt;Modelle haben Parameter.
Ein wichtiger Parameter ist &lt;code&gt;num_ctx&lt;/code&gt; (manchmal auch n_ctx).
Er bestimmt die Anzahl der Token, die das Modell als Kontextspeicher für die Antwortgenerierung verwendet.&lt;/p&gt;
&lt;p&gt;Ein Embedding ist ein vieldimensionaler Vektor, der Bedeutung von Worten codiert.
Es belegt etwa 1 Kilobyte an Speicher.
Ein Token ist ein Zeiger auf ein Embedding, aber im Kontext der Antwortgenerierung wird das Token kopiert.
Ein Kontext von 65536 belegt also in etwa 64 MB Speicher.
In englischer Sprache entspricht ein Wort in etwa 1.3 Tokens.&lt;/p&gt;
&lt;p&gt;Unser Beispieltext hat, nachdem wir vorne und hinten alles das wegschneiden,
was Projekt Gutenberg als Disclaimer hinzugefügt hat,
eine Größe von circa 14.000 Worten:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ wc leiber-64-square.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    1824   13853   84236 leiber-64-square.txt
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wenn wir dem Modell einen Kontext von 65536 Token geben, dann sollte es mit der Geschichte gut zurechtkommen.
&lt;strong&gt;HINWEIS:&lt;/strong&gt;* Es heißt &lt;code&gt;/set parameter num_ctx 65536&lt;/code&gt;, nicht &lt;code&gt;/set num_ctx 65536&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ ollama run mistral:instruct
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; /set verbose
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Set &amp;#39;verbose&amp;#39; mode.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; /set parameter num_ctx &lt;span class=&#34;m&#34;&gt;65536&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Set parameter &amp;#39;num_ctx&amp;#39; to &amp;#39;65536&amp;#39;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;... You are an english teacher.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... Summarize the following story,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... providing an overview over the main characters of the story,
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... and a paragraph for each scene or major event that happens in the course of
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... the story.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... As a conclusion, provide context: What is the story about?
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... The story:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wir setzen also &lt;code&gt;/set verbose&lt;/code&gt;, um Statistiken zu bekommen.
Wir setzen dann den Parameter &lt;code&gt;/set parameter num_ctx 65536&lt;/code&gt;, um dem Modell genug Arbeitskontext zu geben.
Danach leiten wir mit &lt;code&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/code&gt; einen mehrzeiligen Input ein.
Dieser wird durch &lt;code&gt;&amp;quot;&amp;quot;&amp;quot;&lt;/code&gt; auf einer neuen Zeile genau so abgeschlossen.&lt;/p&gt;
&lt;p&gt;In einem anderen Fenster laden wir nun die Story in den Paste-Buffer:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(venv) kk:keks kris$ cat leiber-64-square.txt | pbcopy
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(venv) kk:keks kris$
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Diese kann nun in den Ollama-Prompt gepasted werden.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... Sandra said, &amp;#34;Well, there&amp;#39;s something you can&amp;#39;t build into a
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... machine--ego.&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... &amp;#34;Oh, I don&amp;#39;t know about that,&amp;#34; said Simon Great.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;... &amp;#34;&amp;#34;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Die generierte Antwort des Modells lautet:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;This story is about a chess tournament featuring an electronic computing
machine named the Machine. The Machine is entering its first international
grandmaster chess tournament, and the large hall where the event takes
place is filled with energetic dark-suited men who are either playing
chess or discussing it. There are signs featuring various combinations of
letters such as FIDE, WBM, USCF, USSF, USSR, and UNESCO, and many clocks
bedside table size with red flags and wheels on their faces are present to
keep track of each player&amp;rsquo;s moves. The Machine is programmed by a
psychologist named Simon Great, who has been out of tournament chess for
twenty years but is now making a comeback.&lt;/p&gt;
&lt;p&gt;The main characters in the story are Sandra Lea Grayling, a journalist for
the &lt;em&gt;Chicago Space Mirror&lt;/em&gt;, and Dr. Krakatower, a former grandmaster of
chess who is also a special correspondent for the London Times. The
Machine is also a character, as it plays against various human opponents
throughout the tournament.&lt;/p&gt;
&lt;p&gt;The story unfolds over the course of several days, with each scene or
major event taking place during one of the nine rounds of the tournament.
In the first round, the Machine plays against Bela Grabo and wins the
game. This causes a stir among the players and spectators, as many believe
that the Machine is too good to be true. In the second round, the Machine
faces off against Votbinnik and again emerges victorious. This pattern
continues throughout the tournament, with the Machine consistently
outplaying its human opponents.&lt;/p&gt;
&lt;p&gt;Dr. Krakatower struggles throughout the tournament, losing several games
and finding himself in last place. However, he manages to draw his game
against Sherevsky in the next to last round, which gives him a small
glimmer of hope. In the final round, the Machine plays against Willie
Angler, who has been consistently strong throughout the tournament. The
outcome of this match will determine the winner of the tournament.&lt;/p&gt;
&lt;p&gt;As the story reaches its conclusion, it is revealed that Angler had
intentionally played a flawed move in his game against the Machine, as he
had discovered an error in the programming of the Machine&amp;rsquo;s opening moves.
This tactic pays off, and Angler wins the game and the tournament. The
final standing shows that Angler and Votbinnik are tied for first place,
with the Machine in second.&lt;/p&gt;
&lt;p&gt;The story concludes with a discussion between Simon Great, Willie Angler,
and Dr. Krakatower about the future of chess and computer programming. It
is suggested that grandmaster chess without computers will become less
popular, as players will increasingly rely on computers to aid them in
their games. The story also touches on the idea of man-machine symbiosis,
with the implication that future grandmasters may be a combination of
human and machine. The story serves as a commentary on the changing nature
of chess and the role of technology in society.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;und&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;total duration:       3m33.240299458s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;load duration:        20.467748958s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval count:    22580 token(s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval duration: 1m58.450477s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;prompt eval rate:     190.63 tokens/s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval count:           634 token(s)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval duration:        1m14.263155s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;eval rate:            8.54 tokens/s
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wir haben eine recht gute Evaluation Rate: 190 Token/s.
Die Generierung der Antwort ist langsamer, auch wegen des großen Kontexts, den wir gesetzt haben: 8.5 Token/s.&lt;/p&gt;
&lt;p&gt;Eine Laufzeit von 3 Minuten bei einem Mehrverbrauch von 43 Watt entspricht einem Energieaufwand von 2.15 Wh.
Bei einem Preis von 32 Cent pro 1000 Wh (1 kWh) sind das 2.15/1000 * 32 = .0672 Cent zur Generierung der Ausgabe.&lt;/p&gt;
&lt;h1 id=&#34;selbst-coden&#34;&gt;
    &lt;a href=&#34;#selbst-coden&#34;&gt;
	Selbst coden
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Es gibt eine Ollama Python Bibliothek.
Diese tut nicht mehr, als Requests an &lt;code&gt;ollama serve&lt;/code&gt; zu senden:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ollama/ollama-python&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ollama-python&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/ollama/ollama/tree/main/docs&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ollama API Dokumentation&lt;/a&gt;

, api.md&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://docs.mistral.ai/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mistral Model Documentation&lt;/a&gt;

, die Code-Beispiele dort gehen davon aus,
daß man deren Server verwendet. Das tun wir nicht, wir verwenden Ollama und eine lokale Instanz.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Die REST API ist in &lt;code&gt;api.md&lt;/code&gt; im Ollama Quelltext-Tree auf Github dokumentiert.&lt;/p&gt;
&lt;p&gt;Die &lt;code&gt;ollama.chat()&lt;/code&gt;-Funktion (und auch die gleichnamige Funktion der Mistral API, die gegen deren Instanz arbeitet),
hat einen Parameter &lt;code&gt;messages&lt;/code&gt; (Plural, eine Liste).
Das LLM ist stateless.
Es kann sich nicht an vorhergehende Nachrichten erinnern.
Daher muss man dem Modell bei jedem Request alle vorhergehenden Fragen und Antworten und auch den Systemprompt mitsenden.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;o&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;ollama&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Client&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;host&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;127.0.0.1&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;response&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;o&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;chat&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;model&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;mistral:instruct&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;messages&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;system&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;instructions&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_message&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;assistant&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;old_answer&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;role&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;user&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;s2&#34;&gt;&amp;#34;content&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;message&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;p&#34;&gt;},&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;],&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Genauso muss man &lt;code&gt;options={}&lt;/code&gt; mitsenden, wenn man zum Beispiel mehr Kontext braucht.&lt;/p&gt;
&lt;p&gt;Die Anleitung zu Mistral gibt bessere
&lt;a href=&#34;https://docs.mistral.ai/guides/prompting_capabilities/#summarization&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Summarization Prompts&lt;/a&gt;


als Beispiel und erklärt im hinteren Teil mehr zu Tokens, Tokenization und zum direkten Umgang mit dem LLM.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>MySQL: Latency and IOPS</title>
      <link>https://blog.koehntopp.info/2024/04/21/mysql-latency-and-iops.html</link>
      <pubDate>Sun, 21 Apr 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/04/21/mysql-latency-and-iops.html</guid>
      <description>&lt;p&gt;When talking about storage performance, we often hear three terms that are important in describing storage performance.
They are&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;bandwidth&lt;/li&gt;
&lt;li&gt;latency&lt;/li&gt;
&lt;li&gt;I/O operations per second (IOPS)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;When you talk to storage vendors and cloud providers,
they will gladly provide you with numbers on bandwidth and IOPS,
but latency numbers will be hard to come by.
To evaluate storage, especially for MySQL, you need just one number,
and that is the 99.5 percentile commit latency for a random 16 KB disk write.
But let&amp;rsquo;s start at the beginning.&lt;/p&gt;
&lt;h1 id=&#34;bandwidth&#34;&gt;
    &lt;a href=&#34;#bandwidth&#34;&gt;
	Bandwidth
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The bandwidth of an IO subsystem is the amount of data it can read or write per second.
For good benchmarking numbers, this is usually measured while doing large sequential writes.
A benchmark would, for example, write and read megabyte sized blocks sequentially to a benchmark files,
and then later read them back.&lt;/p&gt;
&lt;p&gt;Many disk subsystems have caches, and caches have capacities.
The benchmark will exercise the cache and measure cache speed,
unless you manage to disable the caches.
Or deplete them, by creating a system workload large enough to exceed the cache limit.
For example, on a server with 128 GB of memory,
your benchmark will either have to disable these caches,
or benchmark with a file of 384 GB or larger to actually measure storage system performance.&lt;/p&gt;
&lt;p&gt;Writes can be forced to disk, at the filesystem level, by using the means of &lt;code&gt;fdatasync()&lt;/code&gt;, &lt;code&gt;O_DIRECT&lt;/code&gt; or &lt;code&gt;O_SYNC&lt;/code&gt;,
depending on what you want to measure and what your operating system and drivers provide.
But if the storage itself provides caches, it may be that these are persistent (such as battery backed memory),
and while that counts as persistent, it may not be the storage performance we want to measure.
It could be that this is what we get until the cache is full,
and then we get different numbers from the next tier of storage.
Depending on what we need for our evaluation,
we might need to deplete or disable this cache layer to get numbers from the tier we care about.&lt;/p&gt;
&lt;p&gt;Strangely, read benchmarking is harder – we often can easily bypass writes caches by asking for write-though behavior.
But if data is in memory, our read request will never reach the actual storage under test.
Instead it will be served by some higher, faster tier of the storage subsystem.
That&amp;rsquo;s good in normal operations, but bad if we want to find out worst-case performance guarantees.&lt;/p&gt;
&lt;p&gt;From an uncached enterprise harddisk you would expect on the upside of 200 MB/sec streaming write bandwidth,
from an uncached enterprise flash twice that, around 400 MB/sec written.
For short time or from specialized storage you can get up to 10x that, but sustained it is often disappointingly low.&lt;/p&gt;
&lt;p&gt;By bundling storage in a striped RAID-0 variant, you can get a lot more.
By providing an abundance of battery-backed memory,
you can get speeds that saturate your local bus speed or whatever network is in the path.&lt;/p&gt;
&lt;h1 id=&#34;latency&#34;&gt;
    &lt;a href=&#34;#latency&#34;&gt;
	Latency
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Write and read latency is the amount of time it takes to write a piece of data.
For a database application developer,
write latency usually amounts to &amp;ldquo;how long to I have to wait for a reasonably sized COMMIT to return&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;To better understand database write latency, we need to understand database writes.
The long version of that is in explained in
&lt;a href=&#34;https://blog.koehntopp.info/2020/07/27/mysql-transactions.html&#34;&gt;MySQL Transactions - the physical side&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;The short version is that MySQL prepares a transaction in memory in the log buffer,
and on commit writes the log buffer to the redo log.
This is a sequentially structured, on-disk ring buffer that accepts the write.
A commit will return once data is in there (plus replication shenanigans, if applicable).
For a fast database, it is mandatory for the redo log to be on fast, persistent storage.
Writes to the database happen in relatively tiny blocks, much smaller than actual database pages.&lt;/p&gt;
&lt;p&gt;Later, out of the critical path, the database writes out the actual modified data pages as 16 KB random writes.
This is important,
but it happens a long time after the commit in a batched fashion, often minutes after the actual commit.&lt;/p&gt;
&lt;p&gt;Still, a filesystem benchmark that uses randomly written 16 KB pages
usually characterizes the behavior of a storage subsystem in a way
that good predictions of its real world performance can be made.
So run a &lt;code&gt;fio&lt;/code&gt; benchmark that writes single-threadedly to a very large test file,
doing random-writes with a 16 KB block size,
and look for the &lt;code&gt;clat&lt;/code&gt; numbers and the latency histogram in the benchmark.&lt;/p&gt;
&lt;p&gt;It might look like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;  write: IOPS=2454, BW=38.4MiB/s (40.2MB/s)(11.2GiB/300001msec)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;    clat percentiles (usec):
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;     |  1.00th=[  202],  5.00th=[  237], 10.00th=[  249], 20.00th=[  269],
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;     | 30.00th=[  285], 40.00th=[  302], 50.00th=[  314], 60.00th=[  330],
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;     | 70.00th=[  347], 80.00th=[  396], 90.00th=[  482], 95.00th=[  570],
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;     | 99.00th=[ 2212], 99.50th=[ 2966], 99.90th=[ 6915], 99.95th=[ 7832],
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;     | 99.99th=[ 9503]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Be sure to check the units, here &lt;code&gt;usec&lt;/code&gt; (µs, microseconds, 1E-06 sec).
&lt;code&gt;fio&lt;/code&gt; changes them around as needed.
Then look at the numbers in the clat histogram.&lt;/p&gt;
&lt;p&gt;You will see relatively linear numbers, here up to the 95th percentile,
and then a sudden and steep increase.
Most storages are bimodal, and you will see &amp;ldquo;good&amp;rdquo; behavior and numbers in the low percentiles,
and then numbers from the &amp;ldquo;bad&amp;rdquo; writes above.
It is important to treat both numbers as differently and remember the cutoff percentile as well.
This storage has a clat of about 0.57 ms, until the 95th percentile,
and then 2.0 ms or more for about 5% of all writes.
That&amp;rsquo;s not good, but these numbers are from a specific multithreaded test, not single-threaded writing,
and I just included them to show what they would look like.&lt;/p&gt;
&lt;p&gt;For reference, a local NVME disk should give you &amp;lt;100 µs for the good writes,&lt;br&gt;
and present a cutoff at the 99.90th percentile
(&lt;a href=&#34;https://blog.koehntopp.info/2019/06/13/adventures-in-storageland.html#some-nvme&#34;&gt;data from 2019&lt;/a&gt;

).&lt;/p&gt;
&lt;p&gt;A good disk-based NetApp filer connected with FC/AL, as sold in 2012,
would present itself at ~500 µs write latency,
and with a very high cutoff at the 99.5th or 99.9th percentile
You would be mostly talking to the battery backed storage in that unit,
so even with hard disks in it, it would be decent enough to run a busy database on it.
If your storage is worse, latency-wise, than this 12-year-old piece of hardware,
you will probably not be happy with it under load for database workloads.&lt;/p&gt;
&lt;h1 id=&#34;iops&#34;&gt;
    &lt;a href=&#34;#iops&#34;&gt;
	IOPS
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;&amp;ldquo;I/O Operations Per Second&amp;rdquo; sounds a lot like latency, but is not.
It is the total I/O budget of your storage.
For old enterprise harddisks with a 5 ms seek time, you get around 200 IOPS from a single hard-disk.
With a disk array, a multiple of that – more if you have more spindles.
That is why in the old times before flash,
DBAs strongly preferred arrays from many tiny disks over arrays from few large disks.
That is also why disk-based database write-performance is completely dependent on the presence of battery backed storage.&lt;/p&gt;
&lt;p&gt;With modern flash and NVME, paths to the actual storage in the flash chips are parallel.
This is one of the big advantages of NVME over SSD or SATA, in fact.
A single enterprise NVME flash drive can provide you with up to 800.000 IOPS.&lt;/p&gt;
&lt;p&gt;But that is not a latency number.
A single commit will still take around 1/20.000 sec, around 50µs.
So if you execute single row insert/commit pairs in a loop, you will not see more than 20.000 commit/s,
even if the single NVME drive can do 40x that.
To leverage the full potential of the drive, you will need to access it 40-way parallel.
Most databases cannot do that.&lt;/p&gt;
&lt;p&gt;That is, because the workload itself that a database executes is inherently dependent on the order of commits.&lt;/p&gt;
&lt;p&gt;Each transaction creates a number of locks that are necessary for the transaction to be executed correctly.
Rows that are being written to are exclusively locked (X-locked),
rows that are being referenced by foreign key constraints can be share-locked (S-locked),
and additional locks may be taken out explicitly.
Most people are running MySQL in a simplified model (for example using group replication) where only X-locks matter,
and the set of primary keys that are written to (and hence get X-locked) is the write-set.&lt;/p&gt;
&lt;p&gt;Two transactions are potentially parallel-executable when the intersection of their write-set is empty,
that is, when they write to row sets that are non-overlapping.
Most execution models for MySQL (expecially regarding
&lt;a href=&#34;https://blog.koehntopp.info/2021/11/08/mysql-parallel-replication.html&#34;&gt;parallel replication&lt;/a&gt;

)
will try to execute transactions in parallel until they find an overlap.
Then they will block until all transactions are done, and start the next batch of parallel transactions.
This is not optimal, but simple, and prevents re-ordering of transactions in a way that is easy for developers to understand.
It will also not break heartbeat writes that are often used to check for replication delay.&lt;/p&gt;
&lt;p&gt;In reality,
the execution-width of such a transaction stream varies wildly and is completely subject to what the applications do.
For execution guarantees and service-level objectives,
when using MySQL,
the IOPS budget of the storage is immaterial.
We can only make guarantees for the database based on storage latency.
That is not a number you will find in the AWS catalog.
So go, measure.&lt;/p&gt;
&lt;p&gt;In the workloads I have seen, over a longer stretch of time I have often seen a degree of parallel execution hovering around 3-5.
So your 2012 Netapp filer with 500 µs commit latency will, if the IOPS budget is big enough,
execute around 2000 sequential commits/s, and will perform with around 6000-10.000 IOPS.
You can guarantee only 2000 commit/s, because that is worst case performance,
and as a DBA you do not control application workload.&lt;/p&gt;
&lt;h1 id=&#34;jitter&#34;&gt;
    &lt;a href=&#34;#jitter&#34;&gt;
	Jitter
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Jitter is the amount of variance you get in latency.
Most of the time, we care a lot about jitter, especially with transactional workloads.&lt;/p&gt;
&lt;p&gt;Jitter matters, because if we hum along with 10.000 write-commit/s, and we get a hiccup of 1/10 s (100ms),
we are likely looking at 1000 stalled processes in &lt;code&gt;SHOW PROCESSLIST&lt;/code&gt;.
That is, if our &lt;code&gt;max_connections&lt;/code&gt; is too low, we die.
Also, even if we don&amp;rsquo;t die, the applications people will hate us.&lt;/p&gt;
&lt;p&gt;You can see the effect of jitter or lock pileups, for example by running &lt;code&gt;innotop -m Q -d 0.1&lt;/code&gt; for a minute.
If things are fine, the number of shown active, non-idle connections will be relatively constant
and smaller than the number of CPU threads available to your machine.&lt;/p&gt;
&lt;h1 id=&#34;tldr&#34;&gt;
    &lt;a href=&#34;#tldr&#34;&gt;
	TL;DR
    &lt;/a&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Bandwidth is the MB/s you get from your storage.
&lt;ul&gt;
&lt;li&gt;Work with 200 MB/s for disk, 400 MB/s for bulk flash, and celebrate burst speeds of 4 GB/s for a short time.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Latency, for MySQL, is how long you wait for a 16 KB random-write to happen in fio.
&lt;ul&gt;
&lt;li&gt;2012&amp;rsquo;s NetApp gives you 500 µs, 0.5 ms. Today&amp;rsquo;s NVME gives you 100 µs, 0.1 ms.&lt;/li&gt;
&lt;li&gt;The cloud with very remote storage often gives you 1-2 ms.&lt;/li&gt;
&lt;li&gt;commit-rate = 1/latency is the number of turns per second you get from a for-loop running &amp;ldquo;insert-commit&amp;rdquo;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;IOPS is the total, parallel IO budget for your database.
&lt;ul&gt;
&lt;li&gt;IOPS/commit-rate is the required degree of parallelism needed to eat the whole buffet, that is, use up all IOPS.&lt;/li&gt;
&lt;li&gt;Transaction parallelism in MySQL is application-dependent,
and is usually defined by how long a run of intersection-free write-sets you can find.&lt;/li&gt;
&lt;li&gt;For the cases and workloads I have seen (webshops), it varies wildly over time, and is often 4-ish.&lt;/li&gt;
&lt;li&gt;A single MySQL instance will usually not be able
to consume all IOPS offered by even a single enterprise NVME drive (800k IOPS).
This would require a 40-wide parallel path, 10x more than what workloads typically can offer.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Jitter matters.
&lt;ul&gt;
&lt;li&gt;That is why we look at 99th percentile and higher for completion latency (clat) in fio.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Cloud storage often sucks.
&lt;ul&gt;
&lt;li&gt;1 ms or even 3 ms clat give you 300-1000 commit/s, in a loop.
Often that is borderline insufficient.
You can weaken persistence guarantees (&lt;code&gt;innodb_flush_log_at_trx_commit&lt;/code&gt;),
complicate your model by introducing other technologies (that are faster, because they have weaker persistence guarantees),
or run MySQL yourself on i3 instances with local storage (but that is not why you chose the cloud).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Guarantees can be made only on things you control, and that may be bandwidth and latency, but never parallelism.
&lt;ul&gt;
&lt;li&gt;Parallelism is controlled by the application, not by the DBA.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Die Sache mit den Kreisen</title>
      <link>https://blog.koehntopp.info/2024/04/03/die-sache-mit-den-kreisen.html</link>
      <pubDate>Wed, 03 Apr 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/04/03/die-sache-mit-den-kreisen.html</guid>
      <description>&lt;p&gt;Der Sohn brauchte Kreisfunktionen für Dinge in Minecraft.
Ich habe ihm ein paar Notizen gemacht.&lt;/p&gt;
&lt;h1 id=&#34;anatomie-eines-kreises&#34;&gt;
    &lt;a href=&#34;#anatomie-eines-kreises&#34;&gt;
	Anatomie eines Kreises
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/04/kreis-01.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;Der Kreis hat einen Radius 1, einen Durchmesser von 2, das heißt, er belegt das Quadrat von &lt;code&gt;(-1, -1)&lt;/code&gt; bis &lt;code&gt;(1, 1)&lt;/code&gt;.
Der Mittelpunkt &lt;strong&gt;M&lt;/strong&gt; ist in der Mitte vom Koordinatensystem, bei &lt;code&gt;(0,0)&lt;/code&gt;.
Das nennt man einen Einheitskreis.&lt;/p&gt;
&lt;p&gt;Aus dem Einheitskreis kann man durch Verschieben und durch Verkleinern oder Vergrößern jeden anderen Kreis erzeugen.
Man sagt, alle Kreise sind zueinander isomorph - von gleicher (iso) Form (morph).&lt;/p&gt;
&lt;p&gt;Der Radius &lt;strong&gt;r&lt;/strong&gt; ist die Linie vom Mittelpunkt &lt;strong&gt;M&lt;/strong&gt; zum Rand des Kreises.
Diese Linie ist im Einheitskreis immer genau 1 lang.&lt;/p&gt;
&lt;p&gt;Der Durchmesser &lt;strong&gt;d&lt;/strong&gt; ist die Linie vom einen Rand des Kreises durch die Mitte &lt;strong&gt;M&lt;/strong&gt; zum gegenüberliegenden Punkt auf dem Rand des Kreises.
Bei einem Radius von 1 ist der Durchmesser natürlich 2, und generell ist &lt;code&gt;d = 2 * r&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Bei Winkeln ist es so, daß in der Mathematik und Geometrie Null Grad immer rechts,
bei der Position &lt;code&gt;(1, 0)&lt;/code&gt; ist (auf der positiven X Achse) und dann links herum (gegen den Uhrzeigersinn) gedreht wird.
Bei Computergrafiken kann alles Mögliche passieren, wie es der jeweiligen Hardware angenehm ist.
Dann muss man die übliche Umrechnung von Weltkoordinaten in Anzeigekoordinaten vornehmen.&lt;/p&gt;
&lt;h1 id=&#34;pi-grad-und-rad&#34;&gt;
    &lt;a href=&#34;#pi-grad-und-rad&#34;&gt;
	Pi, Grad und rad
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Das Verhältnis von Umfang u des Kreises zu Durchmesser d ist immer genau gleich,
und es ist π (Pi).
Das heißt, ein Kreis mit dem Durchmesser &lt;code&gt;d=2&lt;/code&gt; (dem Radius &lt;code&gt;r=1&lt;/code&gt;) hat den Umfang von &lt;code&gt;u/d = math.Pi&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;math&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;3.141592653589793&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;22&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;7&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;3.142857142857143&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Pi ist eine irrationale Zahl.
Das heißt, sie ist nicht als Ratio, als Verhältnis zweier ganzer Zahlen, als Bruch darstellbar.
Der Bruch 22/7 kommt einigermaßen nahe, aber Pi ist kein Bruch.&lt;/p&gt;
&lt;p&gt;Pi ist auch Nicht-Abbrechend (sonst wäre Pi ja als Bruch von Zehnteln, Hundersteln, Tausensteln, &amp;hellip; darstellbar)
und nicht periodisch (also nix mit 3.1415926 1415926 1415926 &amp;hellip;),
sondern unendlich und nicht-periodisch.&lt;/p&gt;
&lt;p&gt;Für das Rechnen im täglichen Gebrauch reicht es &amp;ldquo;22/7&amp;rdquo; und 3.1415926 auswendig zu lernen.&lt;/p&gt;
&lt;p&gt;Der Umfang eines Kreises ist also &lt;code&gt;u = π*d = 2*π*r&lt;/code&gt;.
Das (&lt;code&gt;u = 2πr&lt;/code&gt;) muss man auswendig wissen.&lt;/p&gt;
&lt;p&gt;Wenn wir also eine kreisförmige Bahnstrecke mit dem Radius 1 m (Durchmesser 2 m) bauen,
und die Bahn von links aus linksrum im Kreis fahren lassen,
dann hat sie, nachdem sie einmal im Kreis gefahren ist,
eine Entfernung von genau 2π Meter zurückgelegt.
Sie hat ja den Umfang des Kreises abgefahren,
und der ist ja genau 2π Meter = 6.283 m = 6 Meter 28 cm und 3 mm.&lt;/p&gt;
&lt;p&gt;In diesem Sinn kann man Winkel in Grad angeben (0 Grad, 90 Grad, 180 Grad, 270 Grad, 360 Grad)
oder in Fahrstrecke auf dem Umfang (0π, 0.5π, 1π, 1.5π, 2π).
Das nennt man Radians oder rad.
In der Geometrie verwendet man beides, Grad und rad,
und die Mathematikfunktionen in Python und jeder anderen Programmiersprache arbeiten per Default immer mit rad.
Darum ist das wichtig, das zu verstehen.&lt;/p&gt;
&lt;p&gt;Wir können das leicht ineinander umrechnen.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;to_grad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;rad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;rad&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;180.0&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;/&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to_grad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pi&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;90.0&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;to_rad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;grad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;float&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;   &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;grad&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pi&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;180.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;to_rad&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;360&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;mf&#34;&gt;6.283185307179586&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;kreisfunktionen&#34;&gt;
    &lt;a href=&#34;#kreisfunktionen&#34;&gt;
	Kreisfunktionen
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/04/kreis-02.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;Wenn wir jetzt eine Linie vom Mittelpunkt des Kreises M zum Rand zeichnen,
dann ist die Länge dieser Linie immer genau r,
und der Winkel von der Startposition ist 𝛂 (alpha).&lt;/p&gt;
&lt;p&gt;Die Koordinaten des Punktes auf dem Rand des Kreises sind definiert als &lt;code&gt;x = cos(𝛂)&lt;/code&gt; und &lt;code&gt;y = sin(𝛂)&lt;/code&gt;.
Das heißt, die Mathematiker sagen:
&amp;ldquo;Wir wollen zwei Funktionen haben, die zusammen die Punkte des Randes eines Kreises mit dem Radius 1 beschreiben,
sodaß&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;points&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pi&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pi&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;180&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;genau die Koordinaten dieser Punkte sind.&lt;/p&gt;
&lt;p&gt;Die Mathematiker haben sich dann ziemlich lange damit beschäftigt, wie diese Funktionen aussehen.
Also, wie man &lt;code&gt;sin()&lt;/code&gt; und &lt;code&gt;cos()&lt;/code&gt; ausrechnen kann.
Das wollen wir heute nicht besprechen, weil es &amp;ldquo;unendliche Annäherungen&amp;rdquo; (Taylor-Reihen) sind,
also beliebig genaue Schätzungen.
Die Mathematik dazu ist spannend, aber für uns heute nicht notwendig.&lt;/p&gt;
&lt;p&gt;Wir haben in Computern inzwischen Hardware-Sin und -Cos Funktionen, die recht schnell sind,
und für bestimmte Winkel kann man außerdem die Ergebnisse mit Ganzzahl-Rechnung abschätzen.
In Spielen auf kleiner Hardware kann man auch mit Nachschlagetabellen arbeiten.
Das ist genau genug, sodass man das auf dem Bildschirm nicht sieht.&lt;/p&gt;
&lt;h1 id=&#34;kreis-zeichnen-pygame&#34;&gt;
    &lt;a href=&#34;#kreis-zeichnen-pygame&#34;&gt;
	Kreis zeichnen (Pygame)
    &lt;/a&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;math&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;time&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pygame&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;pygame&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;init&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;height&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;800&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;600&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;screen&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pygame&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;set_mode&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;height&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;black&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;white&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;255&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;center&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;width&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;//&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;height&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;//&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;250&lt;/span&gt;  &lt;span class=&#34;c1&#34;&gt;# Durchmesser = 500&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;points&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;angle&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;360&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;10&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;c1&#34;&gt;# Das Pygame Koordinatensystem ist x nach Rechts, aber y nach Unten.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;x&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;radians&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;angle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;center&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;int&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;radians&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;angle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;radius&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;center&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;points&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;append&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;len&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;points&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;event&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pygame&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;get&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;event&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;pygame&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;QUIT&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;pygame&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;quit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;screen&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;fill&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;black&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;pygame&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;draw&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;lines&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;screen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;white&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;points&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;pygame&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;display&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;flip&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;time&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sleep&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;pygame&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;quit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Das Resultat mit der Schrittweite 45:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/04/kreis-03.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;Das Resultat mit der Schrittweite 10 sieht schon recht rund aus:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/04/kreis-04.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;h1 id=&#34;öffnungsweite-für-einen-winkel-alpha&#34;&gt;
    &lt;a href=&#34;#%c3%b6ffnungsweite-f%c3%bcr-einen-winkel-alpha&#34;&gt;
	Öffnungsweite für einen Winkel alpha
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/04/kreis-05.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;Gegeben die Position der Punkte bei 0 Grad (1,0) (die Startposition) und bei 𝛂 Grad &lt;code&gt;(cos(𝛂),sin(𝛂))&lt;/code&gt;,
können wir nun die Linie zwischen diesen beiden Punkten zeichnen &lt;code&gt;line(start=(0,1), end=(cos(𝛂), sin(𝛂))&lt;/code&gt;
und ihre Länge ausrechnen.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;math&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;linelength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;x1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y1&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;x2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sqrt&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;x2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;x1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;+&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;y2&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;y1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;**&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;linelength&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Die Länge der Linie beträgt: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;length&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;und das ergibt:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; python3 kreis.py
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Die Länge der Linie beträgt: 0.6180339887498948
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Als Zeichnung:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/04/kreis-06.png&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;numpy&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;np&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;matplotlib.pyplot&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;as&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;plt&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;math&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.3&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pi&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;1.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mf&#34;&gt;0.0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;startstr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;(&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;, &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sin&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;math&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;cos&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;alpha&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;endstr&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;(&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;, &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;.2f&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;)&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;right_angle&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;np&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;array&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]])&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]],&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;k-&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Hypotenuse: d&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_angle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;right_angle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]],&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;r--&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Gegenkathete: Δy&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;([&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;right_angle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]],&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;right_angle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]],&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;b--&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Ankathete: Δx&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;go&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Start &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;startstr&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;plot&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;ro&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;label&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Ende &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endstr&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;startstr&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;horizontalalignment&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;],&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;endstr&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;horizontalalignment&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;right_angle&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Δx&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;horizontalalignment&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&lt;/span&gt;&lt;span class=&#34;mf&#34;&gt;0.05&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;Δy&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verticalalignment&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;text&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;((&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;start&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;end&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;2&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;d&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;verticalalignment&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;center&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;horizontalalignment&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;left&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;axis&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;equal&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;grid&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;True&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;xlabel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;X&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ylabel&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Y&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;legend&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Illustration des Satzes von Pythagoras&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;plt&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;show&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;exit&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Damit kannst Du für einen Kameraöffnungswinkel und eine Entfernung ausrechnen,
wie viele Blöcke eine Textur groß sein muss,
ohne dass man die Ränder sehen kann.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Editing Remotely in PyCharm</title>
      <link>https://blog.koehntopp.info/2024/03/18/editing-remotely-in-pycharm.html</link>
      <pubDate>Mon, 18 Mar 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/03/18/editing-remotely-in-pycharm.html</guid>
      <description>&lt;p&gt;A friend asks me on IRC:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Do you happen to know how I can edit code locally on my PyCharm (MacOS, Professional)
but run it remotely in a virtual environment?
I know how to do that in VS Code, but I don&amp;rsquo;t know how to do it in PyCharm, even with ssh configured and tested.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;The TL;DR is that this specific person has disabled the FTP/SFTP/Webdav Plugin in an attempt to configure PyCharm
in a way that it doesn&amp;rsquo;t upload development data to Jetbrains Servers or similar.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The bundled FTP/SFTP/Webdav Plugin in Pycharm is required for the preferred deployment method.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Jetbrains has several options for editing code locally, but deploying and running it remotely.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Convert a local repository for remote deployment, and have it uploaded in an &amp;ldquo;rsync&amp;rdquo;-like fashion for each save to disk.
This is not &amp;ldquo;rsync,&amp;rdquo; because it also provides remote debugging and other features that reach further than synchronisation.&lt;/li&gt;
&lt;li&gt;Run a headless version of Pycharm remotely using &amp;ldquo;Jetbrains Gateway,&amp;rdquo;
showing the display locally, but running the editor remotely over ssh.&lt;/li&gt;
&lt;li&gt;Use Fleet, the VS Code imitation by Jetbrains.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;rsync-deployment&#34;&gt;
    &lt;a href=&#34;#rsync-deployment&#34;&gt;
	&amp;ldquo;Rsync Deployment&amp;rdquo;
    &lt;/a&gt;
&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;Create a new project locally, using a local interpreter of your choice.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Create a normal local project, not caring about remote edit.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Convert the project to a new interpreter, using &amp;ldquo;Add Interpreter&amp;rdquo; in Settings→Project→Python Interpreter.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Click on &amp;lsquo;Add Interpreter&amp;hellip;&amp;rsquo;, select &amp;lsquo;On SSH&amp;hellip;&amp;rsquo;&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Choose an existing SSH Server (or add a new one)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Here we select the remote box to work on. In our case, we are running on &lt;code&gt;server.local&lt;/code&gt; as the user &lt;code&gt;kris&lt;/code&gt;,
using SSH agent authentication.
If the configuration we want were not present, we&amp;rsquo;d select &amp;lsquo;SSH Connection: [ ] New&amp;rsquo; instead of an existing config.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Let the probe complete.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Selecting a SSH interpreter will spawn a remote Python version probe. We need to let this run and complete.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Trying to set a remote work directory is useless at this stage.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-06.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;In my version of PyCharm (PyCharm 2023.3.4), trying to edit the remote sync folder in the final set is possible,
but is being ignored later.
It will initially always use a random directory name in /tmp for remote execution, no matter how I configure it here.
This is likely a bug.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;Review Remote Interpreter Setup&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-07.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Review the chosen interpreter. It should now say something about &amp;ldquo;Remote Python&amp;rdquo;,
and show the version number as detected for the remote box.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;Fix the Mappings&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-08.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Go to Settings→Build, Execution, Deployment→Deployment, select your configuration, select the tab &amp;ldquo;Mappings&amp;rdquo; and
check the &amp;ldquo;Deployment Path&amp;rdquo;.
In my PyCharm, this is always a random path in &lt;code&gt;/tmp&lt;/code&gt;, no matter what I do in the previous step 3.
I correct this to the directory I want this deployed in, here &lt;code&gt;/home/kris/Source/keks&lt;/code&gt;, then click &amp;ldquo;Ok&amp;rdquo;.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;8&#34;&gt;
&lt;li&gt;Verify that it works&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-09.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Printing &lt;code&gt;sys.version_info&lt;/code&gt; shows us that we are indeed running on the Python Version of the remote host.
We could also call &lt;code&gt;sys_info = os.uname()&lt;/code&gt;, and print &lt;code&gt;sys_info.nodename&lt;/code&gt; to check the name of the box.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;For my friend none of this worked. The entire SSH option was not shown,
and the option to define SFTP upload was not offered.
Further debugging showed that my friend had tried to secure his installation against unwanted data upload,
disabling all remote AI functionality and also the
&lt;a href=&#34;https://www.jetbrains.com/help/pycharm/2023.1/sharing-your-ide-settings.html#IDE_settings_sync&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Jetbrains Settings Sync&lt;/a&gt;

.
In doing that, they also inadvertantly disabled the &amp;ldquo;SSH/SFTP/Webdav&amp;rdquo; bundled plugin.&lt;/p&gt;
&lt;h1 id=&#34;using-jetbrains-gateway&#34;&gt;
    &lt;a href=&#34;#using-jetbrains-gateway&#34;&gt;
	Using &amp;ldquo;Jetbrains Gateway&amp;rdquo;
    &lt;/a&gt;
&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;When closing all project windows, PyCharm will default to the project selection screen.
This will offer the creation of new local projects, and also access to &amp;ldquo;SSH&amp;rdquo; projects,
&amp;ldquo;Jetbrains Space&amp;rdquo; projects, &amp;ldquo;Dev Containers&amp;rdquo;.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-10.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;PyCharms project selection screen, &amp;ldquo;Welcome to PyCharm&amp;rdquo;.
Choosing &amp;ldquo;SSH&amp;rdquo; sllows you to create remote projects directly.
This will not use the synchronisation method above, but start a remote headless PyCharm.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;Provide SSH connection information.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-11.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;We are then being asked to provide SSH connection information, and can again choose from our default targets.
Again, we use &lt;code&gt;kris@server.local&lt;/code&gt; with agent authentication.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;Select IDE version and directory.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-12.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;We are then being asked to choose an IDE version, and a directory.
The directory must exist (and is ideally empty).&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;This step can take some time to complete.
It will make the remote host download a version of the IDE and run it headless,
and will then configure Jetbrains Gateway locally.
Ultimately, it will hand off development from PyCharm to the local Gateway and the remotely running PyCharm.&lt;/p&gt;
&lt;p&gt;Gateway acts as the local display of the remote IDE, using SSH as a remote procedure call mechanism.
Depending on the SSH connection latency, this can be quite laggy.
In older versions of Gateway, it was also prone to losing synchronization – this version seems to behave better.&lt;/p&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;Validate functionality and hostname&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-13.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Writing a short test program and running it quickly validates that we are on the correct version of Python
and on the correct host.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;5&#34;&gt;
&lt;li&gt;Check processlist&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;a href=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-14.jpg&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-14.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;A quick glance at the processlist of the remote hosts shows us what is going on:
A headless version of Pycharm has been downloaded to $HOME/.cache/JetBrains and is doing the work.
Locally, Jetbrains Gateway is the display for the remote instance.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;6&#34;&gt;
&lt;li&gt;Check connection and ressources&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-15.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Cloud development instances are sometimes optimized for cost, not for comfort.
Gateway offers a way to check remote resources, including Ping and Memory.&lt;/em&gt;&lt;/p&gt;
&lt;ol start=&#34;7&#34;&gt;
&lt;li&gt;Other Providers&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/03/pycharm-16.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Gateway also offers additional providers for remote development, which can be installed and configured.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;fleet&#34;&gt;
    &lt;a href=&#34;#fleet&#34;&gt;
	Fleet
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Fleet is a new editing environment from Jetbrains that tries to emulate VC Code in look and feel.
Unlike PyCharm, it has no direct language support, but connects to one or more language servers.
It needs extensions and language servers to become a useful editor with syntax support and analytics.&lt;/p&gt;
&lt;p&gt;It can natively edit remote files.&lt;/p&gt;
&lt;p&gt;I am not comfortable using it, and have therefore not tested it.&lt;/p&gt;
&lt;h1 id=&#34;preference&#34;&gt;
    &lt;a href=&#34;#preference&#34;&gt;
	Preference
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;For my deployment scenarios, I prefer to work with the primary approach
of converting a local project to a remote deployment using the &amp;ldquo;rsync&amp;rdquo; approach.
It is less sensitive to latency and less fragile than the &amp;ldquo;Gateway&amp;rdquo; approach, and offers much the same functionality for me.&lt;/p&gt;
&lt;p&gt;People using standard clouds more than I do might fare better with &amp;ldquo;Gateway,&amp;rdquo; now that it is stable.&lt;/p&gt;
&lt;p&gt;People using multiple languages in the same project or dependent on LSP and language servers might like Fleet better.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Dynamically loading Classes in Java</title>
      <link>https://blog.koehntopp.info/2024/03/03/dynamically-loading-classes-in-java.html</link>
      <pubDate>Sun, 03 Mar 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/03/03/dynamically-loading-classes-in-java.html</guid>
      <description>&lt;p&gt;The son needed to dynamically load some Java class into Minecraft,
and then call a method on this.
The dynamically loaded class may have additional dependencies.
I wanted to see how this works, so I sketched a quick example.
You can follow along &lt;a href=&#34;https://github.com/isotopp/JavaTests&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;on GitHub&lt;/a&gt;

.&lt;/p&gt;
&lt;h1 id=&#34;project-layout&#34;&gt;
    &lt;a href=&#34;#project-layout&#34;&gt;
	Project Layout
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Using IntelliJ, we are creating a project using Maven which has three submodules.
The layout:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; tree
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|-- dependent
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|   |-- pom.xml    &amp;lt;--- per submodule pom.xml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|   `-- src
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|       `-- main
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|           `-- java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|               `-- de
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                   `-- koehntopp
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                       `-- java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                           `-- Dependent.java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|-- external
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|   |-- pom.xml    &amp;lt;--- per submodule pom.xml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|   `-- src
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|       `-- main
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|           `-- java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|               `-- de
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                   `-- koehntopp
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                       `-- java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                           `-- External.java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|-- main
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|   |-- pom.xml    &amp;lt;--- per submodule pom.xml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|   `-- src
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|       `-- main
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|           `-- java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|               `-- de
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                   `-- koehntopp
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                       `-- java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;|                           `-- Main.java
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;`-- pom.xml   &amp;lt;--- top level pom.xml
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;22 directories, 8 files
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The top level &lt;code&gt;pom.xml&lt;/code&gt; will define the submodules:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;project&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;xmlns=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;na&#34;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;na&#34;&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;modelVersion&amp;gt;&lt;/span&gt;4.0.0&lt;span class=&#34;nt&#34;&gt;&amp;lt;/modelVersion&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;de.koehntopp.java&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;JavaTests&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.0-SNAPSHOT&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;packaging&amp;gt;&lt;/span&gt;pom&lt;span class=&#34;nt&#34;&gt;&amp;lt;/packaging&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;maven.compiler.source&amp;gt;&lt;/span&gt;17&lt;span class=&#34;nt&#34;&gt;&amp;lt;/maven.compiler.source&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;maven.compiler.target&amp;gt;&lt;/span&gt;17&lt;span class=&#34;nt&#34;&gt;&amp;lt;/maven.compiler.target&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;project.build.sourceEncoding&amp;gt;&lt;/span&gt;UTF-8&lt;span class=&#34;nt&#34;&gt;&amp;lt;/project.build.sourceEncoding&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;modules&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;module&amp;gt;&lt;/span&gt;main&lt;span class=&#34;nt&#34;&gt;&amp;lt;/module&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;module&amp;gt;&lt;/span&gt;external&lt;span class=&#34;nt&#34;&gt;&amp;lt;/module&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;module&amp;gt;&lt;/span&gt;dependent&lt;span class=&#34;nt&#34;&gt;&amp;lt;/module&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/modules&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/project&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Each submodule then needs to have its own &lt;code&gt;pom.xml&lt;/code&gt;, will produce its own &lt;code&gt;target/&lt;/code&gt; directory with its own &lt;code&gt;.jar&lt;/code&gt; file.
We are not trying to bundle all these files into one &amp;ldquo;fat&amp;rdquo; jar because that was not required.&lt;/p&gt;
&lt;p&gt;In order to be able to define submodules, we also need to specify a &lt;code&gt;&amp;lt;packaging /&amp;gt;&lt;/code&gt; method. The default is &lt;code&gt;jar&lt;/code&gt;,
but for submodules we need to use &lt;code&gt;pom&lt;/code&gt;.&lt;/p&gt;
&lt;h1 id=&#34;dependentjava&#34;&gt;
    &lt;a href=&#34;#dependentjava&#34;&gt;
	&lt;code&gt;Dependent.java&lt;/code&gt;
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The class &lt;code&gt;Dependent&lt;/code&gt; is a simple &amp;ldquo;Hello, world!&amp;rdquo; style program.
It looks like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;de.koehntopp.java&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Dependent&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;sayHello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Hello from Dependent!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;That is, we have a class with a single public, static method &lt;code&gt;sayHello()&lt;/code&gt; that says hello.
The &lt;code&gt;pom.xml&lt;/code&gt; for this is default, as generated by IntelliJ.&lt;/p&gt;
&lt;h1 id=&#34;externaljava&#34;&gt;
    &lt;a href=&#34;#externaljava&#34;&gt;
	&lt;code&gt;External.java&lt;/code&gt;
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The &lt;code&gt;External&lt;/code&gt; class prints its own &amp;ldquo;Hello&amp;rdquo; message, and also calls the static method from &lt;code&gt;Dependent&lt;/code&gt;.
It looks like this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;de.koehntopp.java&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;External&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;New Hello from External!&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Dependent&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;sayHello&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Ruft die Methode aus der Dependent-Klasse auf&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To compile, we need to declare a dependency in Maven:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;project&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;xmlns=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;na&#34;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;na&#34;&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;modelVersion&amp;gt;&lt;/span&gt;4.0.0&lt;span class=&#34;nt&#34;&gt;&amp;lt;/modelVersion&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;de.koehntopp.java&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;external&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.0-SNAPSHOT&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;maven.compiler.source&amp;gt;&lt;/span&gt;17&lt;span class=&#34;nt&#34;&gt;&amp;lt;/maven.compiler.source&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;maven.compiler.target&amp;gt;&lt;/span&gt;17&lt;span class=&#34;nt&#34;&gt;&amp;lt;/maven.compiler.target&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;project.build.sourceEncoding&amp;gt;&lt;/span&gt;UTF-8&lt;span class=&#34;nt&#34;&gt;&amp;lt;/project.build.sourceEncoding&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;dependencies&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;de.koehntopp.java&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;dependent&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.0-SNAPSHOT&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/dependencies&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/project&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This gives the compiler knowledge about the class &lt;code&gt;Dependent&lt;/code&gt; at compile time.&lt;/p&gt;
&lt;h1 id=&#34;dynamically-loading-code-in-mainjava&#34;&gt;
    &lt;a href=&#34;#dynamically-loading-code-in-mainjava&#34;&gt;
	Dynamically loading code in &lt;code&gt;Main.java&lt;/code&gt;
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The &lt;code&gt;Main&lt;/code&gt; class loads code dynamically using a &lt;code&gt;ClassLoader&lt;/code&gt;, then calls the code using reflection.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;package&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;de.koehntopp.java&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;java.io.File&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;java.net.URL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;java.net.URLClassLoader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;java.security.CodeSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;java.security.ProtectionDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;java.util.ArrayList&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nn&#34;&gt;java.util.List&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// $ mvn clean package&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// ...&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// $ java -jar main/target/main-...jar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;//&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Beispiel-Ausgabe:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// file:/Users/kris/IdeaProjects/JavaTests/./dependent/target/dependent-1.0-SNAPSHOT.jar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// file:/Users/kris/IdeaProjects/JavaTests/./external/target/external-1.0-SNAPSHOT.jar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// file:/Users/kris/IdeaProjects/JavaTests/./main/target/main-1.0-SNAPSHOT.jar&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Klasse wurde geladen von: file:/Users/kris/IdeaProjects/JavaTests/target/classes/&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// New Hello from External!&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Hello from Dependent!&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;Main&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;public&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;args&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Start-Ordner&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;currentDir&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Liste der jars, die von searchForJars() gefüllt wird&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;urls&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ArrayList&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;searchForJars&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;currentDir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;urls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;urls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;url&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// classLoader durchsucht die gefundenen jars in `urls`.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URLClassLoader&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;classLoader&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URLClassLoader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;urls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toArray&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;),&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Main&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getClassLoader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Lade de.joehntopp.java.External&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;externalClass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;forName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;de.koehntopp.java.External&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;classLoader&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Debug: Wir wollen drucken, von wo die Klasse geladen wurde.&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ProtectionDomain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;protectionDomain&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;externalClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getProtectionDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;CodeSource&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;codeSource&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;protectionDomain&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getCodeSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;codeSource&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;?&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;codeSource&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getLocation&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;System&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;out&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;println&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;Klasse wurde geladen von: &amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;+&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;location&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Aufruf von External.main(String[] args)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;externalClass&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;main&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;String&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{});&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;private&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;static&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kt&#34;&gt;void&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;nf&#34;&gt;searchForJars&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;List&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;URL&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;urls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kd&#34;&gt;throws&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Exception&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;files&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;dir&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;listFiles&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;files&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;!=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;null&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;File&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;files&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;isDirectory&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;searchForJars&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;urls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;// Rekursiver Aufruf für Unterverzeichnisse&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;else&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getName&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;endsWith&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;.jar&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                    &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;urls&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;add&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;file&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toURI&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;().&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;toURL&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;());&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;                &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;            &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;To find the &lt;code&gt;jar&lt;/code&gt; with the &lt;code&gt;External&lt;/code&gt; class, we start to search for any &lt;code&gt;jar&lt;/code&gt; file recursively under &lt;code&gt;&amp;quot;.&amp;quot;&lt;/code&gt;.
This is done in &lt;code&gt;searchForJar(dir, urls)&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We are using the &lt;code&gt;dir&lt;/code&gt; directory to list all files in it,
then walk through the found files.
If the current file is a directory, we recursively descend into it.&lt;/p&gt;
&lt;p&gt;If the current file has a name ending in &lt;code&gt;&amp;quot;.jar&amp;quot;&lt;/code&gt;, we add it to the &lt;code&gt;urls&lt;/code&gt; list.&lt;/p&gt;
&lt;p&gt;Using the list of jars, we create a &lt;code&gt;classLoader&lt;/code&gt;.
Using the &lt;code&gt;classLoader&lt;/code&gt;, we load the requested class as &lt;code&gt;externalClass&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We then ask &lt;code&gt;externalClass&lt;/code&gt; for its &lt;code&gt;main(String[] args)&lt;/code&gt; method using &lt;code&gt;getMethod&lt;/code&gt;.
We cannot simply ask for &lt;code&gt;main&lt;/code&gt;, because a class in Java can have more than one implementation of &lt;code&gt;main&lt;/code&gt; with different signatures.&lt;/p&gt;
&lt;p&gt;The found method is then invoked as static (the first parameter of &lt;code&gt;.invoke()&lt;/code&gt;, &lt;code&gt;this&lt;/code&gt;, is &lt;code&gt;null&lt;/code&gt;).
The second and following parameters are the arguments, here an empty &lt;code&gt;String[]&lt;/code&gt; cast to &lt;code&gt;Object&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id=&#34;calling-with-java--jar&#34;&gt;
    &lt;a href=&#34;#calling-with-java--jar&#34;&gt;
	Calling with &lt;code&gt;java -jar&lt;/code&gt;
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;To be able to call the &lt;code&gt;Main&lt;/code&gt; class from its &lt;code&gt;jar&lt;/code&gt;, we need to add the line&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Main-Class: de.koehntopp.java.Main
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;to the &lt;code&gt;MANIFEST.MF&lt;/code&gt; file of the &lt;code&gt;jar&lt;/code&gt;.
This is quickly and elegantly done in Maven with&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-xml&#34; data-lang=&#34;xml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;project&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;xmlns=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;na&#34;&gt;xmlns:xsi=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;         &lt;span class=&#34;na&#34;&gt;xsi:schemaLocation=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;#34;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;modelVersion&amp;gt;&lt;/span&gt;4.0.0&lt;span class=&#34;nt&#34;&gt;&amp;lt;/modelVersion&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;de.koehntopp.java&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;main&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.0-SNAPSHOT&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;maven.compiler.source&amp;gt;&lt;/span&gt;17&lt;span class=&#34;nt&#34;&gt;&amp;lt;/maven.compiler.source&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;maven.compiler.target&amp;gt;&lt;/span&gt;17&lt;span class=&#34;nt&#34;&gt;&amp;lt;/maven.compiler.target&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;project.build.sourceEncoding&amp;gt;&lt;/span&gt;UTF-8&lt;span class=&#34;nt&#34;&gt;&amp;lt;/project.build.sourceEncoding&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/properties&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;build&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;plugins&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;plugin&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.maven.plugins&lt;span class=&#34;nt&#34;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;maven-jar-plugin&lt;span class=&#34;nt&#34;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.3.0&lt;span class=&#34;nt&#34;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;lt;archive&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;lt;manifest&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;lt;addClasspath&amp;gt;&lt;/span&gt;true&lt;span class=&#34;nt&#34;&gt;&amp;lt;/addClasspath&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                            &lt;span class=&#34;nt&#34;&gt;&amp;lt;mainClass&amp;gt;&lt;/span&gt;de.koehntopp.java.Main&lt;span class=&#34;nt&#34;&gt;&amp;lt;/mainClass&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/manifest&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/archive&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nt&#34;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nt&#34;&gt;&amp;lt;/plugin&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nt&#34;&gt;&amp;lt;/plugins&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nt&#34;&gt;&amp;lt;/build&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;&amp;lt;/project&amp;gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;building-and-running&#34;&gt;
    &lt;a href=&#34;#building-and-running&#34;&gt;
	Building and running
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;We can build this with&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; mvn clean
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; mvn package
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;from the top level directory.&lt;/p&gt;
&lt;p&gt;We can then run it with&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; java -jar main/target/main-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;file:/Users/kris/IdeaProjects/JavaTests/./dependent/target/dependent-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;file:/Users/kris/IdeaProjects/JavaTests/./external/target/external-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;file:/Users/kris/IdeaProjects/JavaTests/./main/target/main-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Klasse wurde geladen von: file:/Users/kris/IdeaProjects/JavaTests/./external/target/external-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;New Hello from External!
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Hello from Dependent!
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;debugging-the-class-loading&#34;&gt;
    &lt;a href=&#34;#debugging-the-class-loading&#34;&gt;
	Debugging the class loading
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;To better understand what happens, we can run it with&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; java -verbose:class -jar main/target/main-1.0-SNAPSHOT.jar &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;grep -v &lt;span class=&#34;s1&#34;&gt;&amp;#39;shared objects file&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[0.020s][info][class,load] sun.nio.cs.UTF_8$Encoder source: jrt:/java.base
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[0.029s][info][class,load] de.koehntopp.java.Main source: file:/Users/kris/IdeaProjects/JavaTests/main/target/main-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;file:/Users/kris/IdeaProjects/JavaTests/./dependent/target/dependent-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;file:/Users/kris/IdeaProjects/JavaTests/./external/target/external-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;file:/Users/kris/IdeaProjects/JavaTests/./main/target/main-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[0.033s][info][class,load] java.net.URLClassLoader$1 source: jrt:/java.base
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[0.040s][info][class,load] java.io.FilePermissionCollection$$Lambda/0x00000090010435e0 source: java.io.FilePermissionCollection
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[0.040s][info][class,load] de.koehntopp.java.External source: file:/Users/kris/IdeaProjects/JavaTests/./external/target/external-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[0.041s][info][class,load] java.lang.invoke.LambdaForm$MH/0x0000009001001800 source: __JVM_LookupDefineClass__
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Klasse wurde geladen von: file:/Users/kris/IdeaProjects/JavaTests/./external/target/external-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[0.043s][info][class,load] java.lang.invoke.LambdaForm$MH/0x0000009001002c00 source: __JVM_LookupDefineClass__
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;New Hello from External!
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[0.043s][info][class,load] de.koehntopp.java.Dependent source: file:/Users/kris/IdeaProjects/JavaTests/./dependent/target/dependent-1.0-SNAPSHOT.jar
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Hello from Dependent!
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;By adding the parameter &lt;code&gt;-verbose:class&lt;/code&gt; to the java call, we get a list of classes loaded when they are loaded.
We see that only &lt;code&gt;Main&lt;/code&gt; is loaded initially.
The classloader output is interspersed with our own debugging.&lt;/p&gt;
&lt;p&gt;Eventually, &lt;code&gt;External&lt;/code&gt; is loaded and then run.&lt;/p&gt;
&lt;p&gt;Only when &lt;code&gt;External&lt;/code&gt; instantiates its &lt;code&gt;Dependent&lt;/code&gt; class to call the static method, &lt;code&gt;Dependent&lt;/code&gt; is loaded.
We can see that,
because the class loader debug output referencing the &lt;code&gt;Dependent&lt;/code&gt; class comes after the &lt;code&gt;&amp;quot;New Hello from External!&amp;quot;&lt;/code&gt; message.&lt;/p&gt;
&lt;h1 id=&#34;creating-instances&#34;&gt;
    &lt;a href=&#34;#creating-instances&#34;&gt;
	Creating Instances
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;It is also possible to create instances, and then call them.
For example, in a plugin loader for Minecraft:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;try&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Object&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pluginClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;newInstance&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;Method&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;pluginClass&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;getMethod&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;onEnable&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;method&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;invoke&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;obj&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;k&#34;&gt;catch&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(...&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;        &lt;/span&gt;&lt;span class=&#34;n&#34;&gt;e&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;printStackTrace&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;        
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;    &lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;summary&#34;&gt;
    &lt;a href=&#34;#summary&#34;&gt;
	Summary
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;In this tiny example, we have created a multi-target Maven project with static dependencies between the subprojects.
We created the main jar with a &lt;code&gt;Main-Class&lt;/code&gt; property in the manifest to conveniently run the jar.
We are loading and calling &lt;code&gt;External&lt;/code&gt; from &lt;code&gt;Main&lt;/code&gt; dynamically,
and we are loading and calling &lt;code&gt;Dependent&lt;/code&gt; from &lt;code&gt;External&lt;/code&gt; statically, using a maven dependency.&lt;/p&gt;
&lt;p&gt;We could do the class loader dance a second time to load and call &lt;code&gt;Dependent&lt;/code&gt; dynamically as well,
if we wanted to.&lt;/p&gt;
&lt;p&gt;See also:&lt;/p&gt;
&lt;dl&gt;
&lt;dt&gt;&lt;a href=&#34;https://blog.koehntopp.info/2005/10/08/dynamisch-geladener-code.html&#34;&gt;Dynamisch geladener Code&lt;/a&gt;

&lt;/dt&gt;
&lt;dd&gt;Article from 2005 in German language, which discusses a similar problem in C.&lt;/dd&gt;
&lt;/dl&gt;
</description>
    </item>
    
    <item>
      <title>Breaking Changes in Hugo 123</title>
      <link>https://blog.koehntopp.info/2024/03/01/breaking-changes-in-hugo-123.html</link>
      <pubDate>Fri, 01 Mar 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/03/01/breaking-changes-in-hugo-123.html</guid>
      <description>&lt;p&gt;I had my GitHub pipeline for this blog running with &lt;code&gt;latest&lt;/code&gt;.
Recently, that broke.&lt;/p&gt;
&lt;p&gt;Checking on the reasons for that, I found that I ran into two breaking changes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Incomplete date specifications are now an error.&lt;/li&gt;
&lt;li&gt;Slightly more typesafe date handling from front matter.&lt;/li&gt;
&lt;li&gt;Hugo switches the page reference model to logical paths, breaking &lt;code&gt;ref&lt;/code&gt; and &lt;code&gt;relref&lt;/code&gt; shortcodes with &lt;code&gt;REF_NOT_FOUND&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is easily fixed with two mass commits.&lt;/p&gt;
&lt;h1 id=&#34;incomplete-date-specifications-are-now-an-error&#34;&gt;
    &lt;a href=&#34;#incomplete-date-specifications-are-now-an-error&#34;&gt;
	Incomplete date specifications are now an error
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;In my front matter, I have code such as this:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nt&#34;&gt;author&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;isotopp&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;title&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Breaking Changes in Hugo 123&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line hl&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;date&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;2024-03-01T05:06:07Z&amp;#34;&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;feature-img&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;l&#34;&gt;assets/img/background/rijksmuseum.jpg&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;toc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt; &lt;/span&gt;&lt;span class=&#34;kc&#34;&gt;true&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;tags&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;lang_en&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;w&#34;&gt;&lt;/span&gt;- &lt;span class=&#34;l&#34;&gt;hugo&lt;/span&gt;&lt;span class=&#34;w&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;There were quite a number of instances where the date code in question was incomplete, missing seconds.
Previous versions of Hugo accepted this, Hugo 0.123 rejects it correctly.
I had to scan through the entire repo, and add &lt;code&gt;:00&lt;/code&gt; seconds to fix this.&lt;/p&gt;
&lt;h1 id=&#34;hugo-switches-the-page-reference-model-to-logical-paths&#34;&gt;
    &lt;a href=&#34;#hugo-switches-the-page-reference-model-to-logical-paths&#34;&gt;
	Hugo switches the page reference model to logical paths
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The definition of a logical path is &lt;a href=&#34;https://gohugo.io/getting-started/glossary/#logical-path&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt;

.
A longer explainer is &lt;a href=&#34;https://gohugo.io/methods/page/path/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;here&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;It basically is the page or resource identifier, without extension and language identifier,
converting to lower-case, and replacing spaces with hyphens.
This can have surprising results with page bundles
(directories that are seen as pages, containing an &lt;code&gt;index.md&lt;/code&gt; and images).&lt;/p&gt;
&lt;p&gt;In my particular case, the easiest fix was to move from&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;ref &amp;#34;/content/posts/2024-03-01-2024-03-01-breaking-changes-in-hugo-123.md&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;to&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;relref &amp;#34;2024-03-01-breaking-changes-in-hugo-123.md&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;which is less ambiguous and easier to type.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Python: Slots</title>
      <link>https://blog.koehntopp.info/2024/02/19/python-slots.html</link>
      <pubDate>Tue, 20 Feb 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/02/19/python-slots.html</guid>
      <description>&lt;p&gt;I am playing a bit with &lt;code&gt;__slots__&lt;/code&gt; in Python, and I am trying to understand if I am holding them wrongly.&lt;/p&gt;
&lt;p&gt;I am defining a small test program with two classes, both having 20 instance variables with long names,
holding a bit of string data.
I make one million instances and put them into a list.
Then I am trying to measure the size of this in memory.&lt;/p&gt;
&lt;p&gt;Supposedly using &lt;code&gt;__slots__&lt;/code&gt; the instances should save me a lot of memory,
and for a single instance they seem to do that.
For a large list, they save a bit of memory, but not a lot.&lt;/p&gt;
&lt;h1 id=&#34;the-code&#34;&gt;
    &lt;a href=&#34;#the-code&#34;&gt;
	The Code
    &lt;/a&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;ch&#34;&gt;#! /usr/bin/env python&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;random&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;string&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;sys&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;kn&#34;&gt;from&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;pympler&lt;/span&gt; &lt;span class=&#34;kn&#34;&gt;import&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;SlotTest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;vm&#34;&gt;__slots__&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_00&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_01&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_02&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_03&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_04&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_05&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_06&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_07&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_08&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_09&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_10&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_11&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_12&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_13&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_14&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_15&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_16&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_17&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_18&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_19&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;fm&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;random&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;choices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ascii_lowercase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nb&#34;&gt;setattr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DictTest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;fm&#34;&gt;__init__&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;join&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;random&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;choices&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;string&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;ascii_lowercase&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;k&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;))&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nb&#34;&gt;setattr&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;:&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;02&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;v&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;if&lt;/span&gt; &lt;span class=&#34;vm&#34;&gt;__name__&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;__main__&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1_000_000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;DictTest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;as_d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;SlotTest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;_&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)]&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;as_s&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;delta_size&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as_d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;as_s&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Size of list: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getsizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Size of instance: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getsizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Deep size of instance: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Total size (with deep size of objects): &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_d&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Size of list: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getsizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Size of instance: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;sys&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;getsizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Deep size of instance: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;asizeof&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;s&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;])&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Total size (with deep size of objects): &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;as_s&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;print&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;Delta Size: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;delta_size&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;the-result&#34;&gt;
    &lt;a href=&#34;#the-result&#34;&gt;
	The Result
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;This prints&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Size of list: 8448728 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Size of instance: 56 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Deep size of instance: 3328 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Total size (with deep size of objects): 1736450328 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Size of list: 8448728 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Size of instance: 192 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Deep size of instance: 1632 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Total size (with deep size of objects): 1640448728 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Delta Size: 96001600 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We find:
The &lt;code&gt;DictTest&lt;/code&gt; instance is 3328 bytes in size, the &lt;code&gt;SlotTest&lt;/code&gt; instance only 1632 bytes, according to pympler.
Using &lt;code&gt;sys.getsizeof()&lt;/code&gt;, we severely underestimate the actual memory usage.&lt;/p&gt;
&lt;p&gt;We also find &lt;code&gt;(1640448728*100)/1736450328 = 94.5&lt;/code&gt;, so the Slots version is still 94.5% the size of the Dict version,
while &lt;code&gt;(1632*100)/3328 = 49.0&lt;/code&gt;, so the individual Slots instance is less than half of the Dict instance.
What happens here?&lt;/p&gt;
&lt;p&gt;The string &amp;ldquo;a_key_with_a_very_long_name_xx&amp;rdquo; has 30 characters, and we have 20 of them.
Each string associated with a key has 20 characters.
In the end we store &lt;code&gt;(20+30) * 20 = 1000&lt;/code&gt; characters per object.&lt;/p&gt;
&lt;p&gt;Out of these, 600 characters are identical in every instance (the key names),
and 400 characters are different in every instance (the randomly generated values).&lt;/p&gt;
&lt;p&gt;Clearly, I don&amp;rsquo;t yet fully understand what goes on here.&lt;/p&gt;
&lt;h1 id=&#34;the-math&#34;&gt;
    &lt;a href=&#34;#the-math&#34;&gt;
	The Math
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;One million Slots objects should be &lt;code&gt;1000000 * 1632 = 1632000000&lt;/code&gt; bytes.
The report says 1640448728 bytes, and the list itself indeed occupies around 8 MB when you measure.
This checks out.&lt;/p&gt;
&lt;p&gt;One million Dict objects should be &lt;code&gt;1000000 * 3328 = 3328000000&lt;/code&gt; bytes.
The report says 1736450328 bytes, which is around half the expected size.
This is almost as efficient as the Slots version, and something seems to be optimizing here,
but I don&amp;rsquo;t understand what goes on.&lt;/p&gt;
&lt;p&gt;The documentation praises Slots as a lot smaller, a lot faster and more typesafe than Dicts,
but while Slots are somewhat smaller, they are not a lot smaller.&lt;/p&gt;
&lt;p&gt;I do get why you&amp;rsquo;d want an exception for &lt;code&gt;self.doesntexist = 1&lt;/code&gt; in many cases, so there&amp;rsquo;s that.&lt;/p&gt;
&lt;h1 id=&#34;trying-perl&#34;&gt;
    &lt;a href=&#34;#trying-perl&#34;&gt;
	Trying perl
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Ok, knowing how Perl optimizes things internally, I am trying to compare:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-perl&#34; data-lang=&#34;perl&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;ch&#34;&gt;#!/usr/bin/env perl&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;strict&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;warnings&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;use&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;Devel::Size&lt;/span&gt; &lt;span class=&#34;sx&#34;&gt;qw(total_size)&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;sub&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;random_string&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;my&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$length&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;shift&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nb&#34;&gt;join&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;a&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#39;z&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;rand&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;26&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;package&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;DictTest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;sub&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;my&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$class&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;shift&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;my&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$self&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;bless&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{},&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$class&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;my&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;19&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nv&#34;&gt;$self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;a_key_with_a_very_long_name_$i&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;main::&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;random_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$self&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;my&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1_000_000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;my&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;@d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;map&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt; &lt;span class=&#34;nn&#34;&gt;DictTest&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;k&#34;&gt;new&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;..&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;my&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$as_d&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;total_size&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;\&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;@d&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;print&lt;/span&gt; &lt;span class=&#34;s&#34;&gt;&amp;#34;Total size for DictTest: $as_d bytes\n&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;I get an object size of around 1904 bytes.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; perl probe.pl
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Total size for DictTest: 1904001334 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Suddenly, Python does not look so bad by comparison.&lt;/p&gt;
&lt;h1 id=&#34;trying-php-naively&#34;&gt;
    &lt;a href=&#34;#trying-php-naively&#34;&gt;
	Trying PHP naively
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Using PHP 8.3.2, we can try the same using PHP&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#! /usr/bin/env php
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;php&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DictTest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;fm&#34;&gt;__construct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;o&#34;&gt;@&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;a_key_with_a_very_long_name_&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;randomString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;randomString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$abc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;abcdefghijklmnopqrstuvwxyz&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$l&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$abc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nv&#34;&gt;$res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$abc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$l&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$objects&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Measure memory before creating objects
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$memoryBefore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;memory_get_usage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$objects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DictTest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Measure memory after creating objects
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$memoryAfter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;memory_get_usage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Calculate the difference
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$memoryUsed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$memoryAfter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$memoryBefore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Approximate total size for DictTest: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;$memoryUsed&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In order for this to work, we have to silence the warning in the dynamic instance variable assignment
(or very verbosely define the 20 instance variables like we had to do in the Python Slots version).
We also had to raise the memory limit of PHP to 4096 MB.&lt;/p&gt;
&lt;p&gt;We get&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; php probe.php
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Approximate total size for DictTest: 3481174608 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;So in PHP, we get around 3481 bytes (or 3.4 KB) per object.&lt;/p&gt;
&lt;h1 id=&#34;smarter-php&#34;&gt;
    &lt;a href=&#34;#smarter-php&#34;&gt;
	Smarter PHP
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;I have been told that the warning I silenced with the &lt;code&gt;@&lt;/code&gt; is there for a reason and not just cosmetic.
When I declare properties statically, I am writing a lot of very verbose and ugly code,
but PHP will internally much more efficient structures.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-php&#34; data-lang=&#34;php&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;#! /usr/bin/env php
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;&amp;lt;?&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;php&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;class&lt;/span&gt; &lt;span class=&#34;nc&#34;&gt;DictTest&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$a_key_with_a_very_long_name_00&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;omitted&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;brevity&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$a_key_with_a_very_long_name_19&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;public&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;fm&#34;&gt;__construct&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;a_key_with_a_very_long_name_00&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;randomString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;...&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;omitted&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;brevity&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                &lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;a_key_with_a_very_long_name_19&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$this&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;randomString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;private&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;randomString&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$abc&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;abcdefghijklmnopqrstuvwxyz&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;nv&#34;&gt;$l&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;strlen&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$abc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;);&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$length&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;            &lt;span class=&#34;nv&#34;&gt;$res&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;.=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$abc&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;nx&#34;&gt;rand&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$l&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$res&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$n&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;1000000&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;$objects&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[];&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Measure memory before creating objects
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$memoryBefore&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;memory_get_usage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$n&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;++&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;nv&#34;&gt;$objects&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;new&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;DictTest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Measure memory after creating objects
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$memoryAfter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nx&#34;&gt;memory_get_usage&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;();&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;// Calculate the difference
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$memoryUsed&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$memoryAfter&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;-&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$memoryBefore&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;Approximate total size for DictTest: &lt;/span&gt;&lt;span class=&#34;si&#34;&gt;$memoryUsed&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt; bytes&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;\n&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;resulting in a total memory usage of&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; php probe.php
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Approximate total size for DictTest: 1369174120 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This indeed brings us down to 1369 bytes per object.&lt;/p&gt;
&lt;h1 id=&#34;an-overview&#34;&gt;
    &lt;a href=&#34;#an-overview&#34;&gt;
	An Overview
    &lt;/a&gt;
&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Version&lt;/th&gt;
&lt;th&gt;Size per Object&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Python Slots&lt;/td&gt;
&lt;td&gt;1632&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Python Dicts&lt;/td&gt;
&lt;td&gt;1736 effective&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Perl Dicts&lt;/td&gt;
&lt;td&gt;1904&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PHP Dicts&lt;/td&gt;
&lt;td&gt;3481&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;PHP declared&lt;/td&gt;
&lt;td&gt;1369&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;I do know that Perl compresses hash keys with a lookup table.
When you have an Array of Hashes with one million hashes,
it does not store one million copies of the same identical 20 hash keys.
It instead has a secret internal hash that translates the key into an integer,
and then transparently creates hashes keyed by these integers.&lt;/p&gt;
&lt;p&gt;This is also what I thought &lt;code&gt;__slots__&lt;/code&gt; would do in Python, and indeed the resulting object size is comparable.&lt;/p&gt;
&lt;p&gt;The single object sizes of PHP (which does not do such hash key compression)
and Python &lt;code&gt;__dict__&lt;/code&gt; based objects are also comparable, around 3.4 KB per object.
PHP with statically declared instance variables does apply a number of optimizations,
and comes in at 1.6 KB per object, up there with Python and Perl.&lt;/p&gt;
&lt;p&gt;The Python &amp;ldquo;list of objects&amp;rdquo; is much smaller than expected, though,
so there seems to be an optimization that does some slot-ification
or hash key compression in Python for large numbers of identical objects.&lt;/p&gt;
&lt;h1 id=&#34;countertesting-with-pure-dicts&#34;&gt;
    &lt;a href=&#34;#countertesting-with-pure-dicts&#34;&gt;
	Countertesting with pure Dicts
    &lt;/a&gt;
&lt;/h1&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;k&#34;&gt;def&lt;/span&gt; &lt;span class=&#34;nf&#34;&gt;hash_test&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;():&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{}&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;i&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;range&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;mi&#34;&gt;20&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;):&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;sa&#34;&gt;f&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;a_key_with_a_very_long_name_&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;{&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;i&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;random_string&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    &lt;span class=&#34;k&#34;&gt;return&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;h&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This results in the following values for sizing:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Sizing hash_test
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Size of list: 8448728 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Size of instance: 464 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Deep size of instance: 3504 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Total size (with deep size of objects): 3512448728 bytes
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can see that the optimization is not happening for normal dictionaries.
Here we get circa 3.5 KB dict size.
This is comparable to what PHP with dynamic instance variables reports,
and also consistent with the size of a single hash.&lt;/p&gt;
&lt;h1 id=&#34;some-possible-explanations&#34;&gt;
    &lt;a href=&#34;#some-possible-explanations&#34;&gt;
	Some possible explanations
    &lt;/a&gt;
&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;Florian Laws pointed me to the Medium-Article
&lt;a href=&#34;https://medium.com/@bdov_/https-medium-com-bdov-python-objects-part-iii-string-interning-625d3c7319de&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Python Objects Part III: String Interning&lt;/a&gt;

.&lt;/li&gt;
&lt;li&gt;Nico Erfurth pointed me to the Youtube-Video
&lt;a href=&#34;https://www.youtube.com/watch?v=xKk7IXm0XO0&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;How we are making Python 3.11 faster - presented by Mark Shannon&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;Raymond Hettinger: &amp;ldquo;Modern Python Dictionaries: A confluence of a dozen great ideas&amp;rdquo;, PyCon 2017](&lt;a href=&#34;https://www.youtube.com/watch?v=npw4s1QTmPg&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;https://www.youtube.com/watch?v=npw4s1QTmPg&lt;/a&gt;

)&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://peps.python.org/pep-0412/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;PEP 412 – Key-Sharing Dictionary&lt;/a&gt;

 by Mark Shannon, 2012&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>The Matrix Trashfire</title>
      <link>https://blog.koehntopp.info/2024/02/13/the-matrix-trashfire.html</link>
      <pubDate>Tue, 05 Dec 2023 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/02/13/the-matrix-trashfire.html</guid>
      <description>&lt;p&gt;For reasons, I tried to evaluate the distributed Matrix chat and their clients.
That did not work out very well.&lt;/p&gt;
&lt;h1 id=&#34;onboarding-experience&#34;&gt;
    &lt;a href=&#34;#onboarding-experience&#34;&gt;
	Onboarding experience
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;I was told that the default Matrix chat client is called Elements, so I looked it up on the iOS App store.
Unfortunately, there are two, &amp;ldquo;Element&amp;rdquo; and &amp;ldquo;Element X.&amp;rdquo;
No explanation is given, and no preference is stated.
&amp;ldquo;Element&amp;rdquo; is categorized business, &amp;ldquo;Element X&amp;rdquo; is in &amp;ldquo;Social Networking.&amp;rdquo;
Are they not the same?
They seem to be from the same company, though.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Element and Element X in the app store. Which one to use?&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Ok, let&amp;rsquo;s open the descriptions.
They are identical, except for one sentence at the start:
&amp;ldquo;Element X is the future Element.&amp;rdquo;
So it&amp;rsquo;s a beta?
Why is it not labeled as a Beta?&lt;/p&gt;
&lt;p&gt;On the desktop, going to &lt;a href=&#34;https://matrix.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matrix.org&lt;/a&gt;

 plus two additional clicks take you to
&lt;a href=&#34;https://matrix.org/ecosystem/clients/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;the client page&lt;/a&gt;

, which offers&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The client page offers you, among others, both clients and also states which is available on what platform.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;So apparently &amp;ldquo;Element X&amp;rdquo; is beta and not yet available on all platforms. I open the macOS App Store and&amp;hellip;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;macOS does not offer Element, only Element X.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Apparently matrix.org lied to me.
Element X is available on iOS and macOS, Element is not.&lt;/p&gt;
&lt;p&gt;Ok, let&amp;rsquo;s install Element X and try:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Element X wants me to sign in to matrix.org. There is no &amp;lsquo;sign up&amp;rsquo; Button. There is no sign-up menu.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The client wants me to log in to matrix.org. There is no button to make an account. There is no menu to make an account.
There is zero onboarding for new users.&lt;/p&gt;
&lt;p&gt;Ok, let&amp;rsquo;s go to matrix.org again, and see.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;The matrix.org Website is not very helpful. But when you notice the burger menu, there is actually a &amp;ldquo;Try Matrix&amp;rdquo; button.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;The matrix.org website is a very empty clean screen that is not very helpful. There is a burger menu, though,
and if you open it, you get a &amp;ldquo;Try Matrix&amp;rdquo; button.
This leads to another screen that tells you to use your organizations server instance (What organization? I&amp;rsquo;m alone!),
or install a server,
or choose a public server.
If you opt for Public Servers, you land here:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-06.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;matrix.org server instances, alphabetically sorted, with little additional information.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Matrix.org is conspicuously absent from this list.
The rest I do not know anything about.&lt;/p&gt;
&lt;p&gt;I can now research what server instance I want to join.
Unfortunately, I do not get information about what their country is.
I can&amp;rsquo;t see if they are subject to GDPR rules.
I don&amp;rsquo;t know if they are owned by a company or run by a single private person.
There is no indication how many users they have.&lt;/p&gt;
&lt;p&gt;I can dig through their privacy policies and rules, except that some don&amp;rsquo;t provide any.&lt;/p&gt;
&lt;p&gt;Scrolling down, I end up with the option to onboard to this:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-07.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Servers marked as vulnerable, unavailable and with profanity in their name.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Why in heaven or earth would anybody put unavailable or vulnerable servers into an onboarding listing?
Isn&amp;rsquo;t this supposed a &amp;ldquo;secure&amp;rdquo; messenger?&lt;/p&gt;
&lt;h1 id=&#34;trying-to-use-it-nontheless&#34;&gt;
    &lt;a href=&#34;#trying-to-use-it-nontheless&#34;&gt;
	Trying to use it, nontheless
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;I made an &amp;ldquo;isotopp&amp;rdquo; account at &lt;a href=&#34;https://chat.tchncs.de/#/login&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;tchncs.de&lt;/a&gt;

.
The password is generated and stored in Bitwarden.
A validation mail is sent to a unique address at koehntopp.de and arrives.&lt;/p&gt;
&lt;p&gt;I try to login not being validated, using Bitwarden.
The login is rejected.&lt;/p&gt;
&lt;p&gt;I validate the email.
The server says I am validated.&lt;/p&gt;
&lt;p&gt;I try to login, using Bitwarden.
The login is rejected.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-09.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I am trying to recover the password for the account which I just validated, using the email from the verification mail.
The account is unknown.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I click on &amp;ldquo;forgotten password&amp;rdquo;, and supply the mail adress the validation mail was sent to.
&amp;ldquo;This email address was not found.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Okay, since my account does not exist, I create it again:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-10.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;I recreate my account, using the same mail address. As you can see, the first registration mail still is in the account.
I take the validation URL, which is longer than 80 characters, and use it to successfully validate, again.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;I create the account again, using the same parameters.
The account validation mail is sent to my address.
The old account validation mail is also still in the account.
I take the new URL, which is longer than 80 characters, and use it to successfully validate my account, again.&lt;/p&gt;
&lt;p&gt;This time I accidentally left the &amp;ldquo;create account&amp;rdquo; window open.
This window is now suddenly logged in.
Turns out, you MUST NOT, UNDER ANY CIRCUMSTANCES, close the &amp;ldquo;create account&amp;rdquo; window until the account is validated,
or it is simply not created.
This is not stated anywhere.&lt;/p&gt;
&lt;p&gt;To confirm the account works and the password in Bitwarden is stored successfully,
I log out and log in again.&lt;/p&gt;
&lt;p&gt;I get this:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-11.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Unable to verify this device&lt;/strong&gt;
It looks like you don&amp;rsquo;t have a Security Key or any other devices you can verify against.
This device will not be able to access old encrypted messages.
In order to verify your identity on this device, you&amp;rsquo;ll need to reset your verification keys.*&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;What does that even mean?&lt;/p&gt;
&lt;h1 id=&#34;trying-element-x-with-my-account&#34;&gt;
    &lt;a href=&#34;#trying-element-x-with-my-account&#34;&gt;
	Trying Element X with my account
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Starting Element X, it tries to onboard me to Matrix.org.
I select &amp;ldquo;Change Server&amp;rdquo;, and get a form field where it says &amp;ldquo;matrix.org&amp;rdquo;.
I am overwriting it with &amp;ldquo;chat.tchncs.de&amp;rdquo;, which supposedly is my server.
At least that is what it says in the web client.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-12.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;That is not accepted.&lt;/p&gt;
&lt;p&gt;I take the URL from the browser and paste that instead.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-13.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;That is also not accepted, but I can learn more.
I click.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-14.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;The what?&lt;/p&gt;
&lt;p&gt;Turns out, while the Chat is running on &amp;ldquo;chat.tchncs.de&amp;rdquo;, this is not the &amp;ldquo;Identity Provider.&amp;rdquo;
That one is called &amp;ldquo;tchncs.de&amp;rdquo;.
You only learn this when you open your config menu in the web chat and look at Identifer shown there.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-15.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;Once you enter this, Element X and the web chat get hectic.
There is a new client, and both clients want to authenticate that the new device is legit.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-16.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;For that purpose, they display a set of Emojis, which look differently in the web client and the application,
and ask me if they are the same.
Helpful Emoji names are shown under the Emoji, and they are identical.
I simply click yes.&lt;/p&gt;
&lt;p&gt;After that, both clients can see my Chat, but the Element X Client still has no access to any chat history.
That is, because the client is unverified (so is the web client).&lt;/p&gt;
&lt;p&gt;When I close any client, I have to re-login, re-compare the Emojis, and all chat history is gone.&lt;/p&gt;
&lt;h1 id=&#34;after-onboarding&#34;&gt;
    &lt;a href=&#34;#after-onboarding&#34;&gt;
	After onboarding
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Why have I been trying this?&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-08.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;A friend was trying to use a Matrix messenger on their phone, and waited 9 hours for this to complete.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;A friend of mine was trying to re-install a Matrix messenger on their phone, and landed on the screen above.
This hung for 9 hours without any message or failure indication.
The application cannot detect if somebody is using the wrong recovery key for a different account.&lt;/p&gt;
&lt;p&gt;The friend tried to use an Android application, but the application was complaining about the account not being verified.
That is, the mail address in use was not confirmed, and for that reason the client would not be showing any chats.
At the same time, these chats were being sent to the unconfirmed mail address,
unencrypted,
as a reminder that he was missing out.&lt;/p&gt;
&lt;p&gt;According to him, you can&amp;rsquo;t delete a half-made unconfirmed account.
You also can&amp;rsquo;t rename an account.&lt;/p&gt;
&lt;p&gt;Apparently, you cannot create invite links for private chat rooms,
only invite people.
To do that, vector.im uses the very same dark patterns that LinkedIn uses to convince you to share your address book.&lt;/p&gt;
&lt;p&gt;With the unique mail-address used to sign up to Matrix, I am unfindable because only Matrix uses this specific mail address.&lt;/p&gt;
&lt;p&gt;Outside of Element, there are very few clients, most of them very old and not being updated within the last few years.&lt;/p&gt;
&lt;p&gt;All in all, this is a mess, and my recommendation is to avoid Matrix for at least two years.
It is not secure, it is actively user-hostile, and looks not well managed.&lt;/p&gt;
&lt;p&gt;This is a project in severe need of management changes, a thorough UX evaluation.
The design needs changes that make onboarding and usage smoother, encourage secure workflows,
keep accounts available, and encourage secure practice.
It also needs careful curation of servers and clients.
At the moment it is a trash fire.&lt;/p&gt;
&lt;h1 id=&#34;matrix-responds&#34;&gt;
    &lt;a href=&#34;#matrix-responds&#34;&gt;
	Matrix responds
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Added on 14-Feb-2024:
People at Matrix.org and Matrix developers have picked this up and responded in a very constructive way.
They cannot address all things because they are not in the realm of Matrix, but part of Element.
So far, no responses from Element.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://mastodon.matrix.org/@matrix/111924190165706931&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matrix writes&lt;/a&gt;

:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-17.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;well, this is a trashfire indeed.
Thanks for writing this up.
You&amp;rsquo;ve caught Element in the middle of their migration to Element X, and there&amp;rsquo;s a lot of legit feedback here:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Both E &amp;amp; EX should be in the macOS app store.&lt;/li&gt;
&lt;li&gt;EX should clearly be labelled WIP in appstores.
-It&amp;rsquo;s a mistake that matrix.org hurls people to servers.joinmatrix.org (which is not run by us);
until recently it defaulted to matrix.org for convenience.&lt;/li&gt;
&lt;li&gt;Keeping the &amp;ldquo;create account&amp;rdquo; window open is a pure bug.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://mastodon.matrix.org/@matrix/111924227099676114&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The continue&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-18.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;ul&gt;
&lt;li&gt;Verification UX in Element is a disaster, and being reworked in EX:
&lt;a href=&#34;https://github.com/element-hq/element-meta/blob/develop/docs/FTUE.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github link&lt;/a&gt;

&lt;/li&gt;
&lt;li&gt;Element Android failing to compute a recovery key is clearly a bug too.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Your other complaints about Element UX (e.g. user discovery by email;
specifying the server URL) are also very familiar.&lt;/p&gt;
&lt;p&gt;It&amp;rsquo;s not true to say vector.im uses &amp;ldquo;the very same dark patterns as LinkedIn&amp;rdquo; for contact discovery though;
&lt;a href=&#34;https://github.com/matrix-org/matrix-spec-proposals/blob/hs/hash-identity/proposals/2134-identity-hash-lookup.md&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github link&lt;/a&gt;


explains how it works (and is strictly opt-in).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Matrix Director of Program Development &lt;a href=&#34;https://mamot.fr/@thibaultamartin/111924256997285624&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Thibault A. Martin responds&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/element-19.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Hej @isotopp I&amp;rsquo;m one of the maintainers of the matrix.org website.&lt;/p&gt;
&lt;p&gt;Your post provides a very valuable perspective.
I gathered the following gripes that we can address on the website itself in this issue:
&lt;a href=&#34;https://github.com/matrix-org/matrix.org/issues/2178&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Matrix.Org Issue 2178&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;If you have the time to let me know if I got things right,
that would be very useful!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Thanks for picking this up, people!
I very much hope that Matrix and Element eventually turn into something useful.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Snake Oil</title>
      <link>https://blog.koehntopp.info/2024/02/10/snake-oil.html</link>
      <pubDate>Sat, 10 Feb 2024 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/02/10/snake-oil.html</guid>
      <description>&lt;p&gt;Dieser Text ist auch in
&lt;a href=&#34;https://blog.koehntopp.info/2024/02/09/schlangenoel.html&#34;&gt;deutscher Sprache&lt;/a&gt;

 vorhanden.&lt;/p&gt;
&lt;p&gt;This week was &amp;ldquo;Broken Security Software Advertising Week.&amp;rdquo;&lt;/p&gt;
&lt;h1 id=&#34;fortigate-and-ivanti&#34;&gt;
    &lt;a href=&#34;#fortigate-and-ivanti&#34;&gt;
	Fortigate and Ivanti
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;First off, &lt;strong&gt;today&lt;/strong&gt; was Fortigate patch day:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;CVE-2024-23113, CVSSV3 Score 9.8, Unauthorized Code Execution, &amp;ldquo;Format String Bug&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;A use of &lt;a href=&#34;https://cwe.mitre.org/data/definitions/134.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;externally-controlled format string&lt;/a&gt;

 vulnerability
in FortiOS &lt;code&gt;fgfmd&lt;/code&gt; daemon may allow a remote unauthenticated attacker to execute arbitrary code or
commands via specially crafted requests.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;This is a case where a C function accepts a format string like &lt;code&gt;&amp;quot;Blah %s Nonsense&amp;quot;&lt;/code&gt;,
to assemble a log message or a command for a &lt;code&gt;system()&lt;/code&gt; call.
However, the developer did not statically set the format parameter of the command to a format string
(&lt;code&gt;snprintf(buffer, length, &amp;quot;Blah %s Nonsense&amp;quot;, user_input)&lt;/code&gt;),
but instead took the user input as the format
(&lt;code&gt;snprintf(buffer, length, user_input))&lt;/code&gt;.
The user input can thus be used to do all sorts of things.&lt;/p&gt;
&lt;p&gt;This is a mistake automatically detected by the usual source code scanners.
If you try to commit or merge something like this in a modern development environment,
the scanner will thoroughly humiliate you,
the commit will be rejected, and you will be assigned a security training.&lt;/p&gt;
&lt;p&gt;This means this type of error does not occur in a contemporary development environment anymore.&lt;/p&gt;
&lt;p&gt;Also, &lt;strong&gt;yesterday&lt;/strong&gt; was Fortigate patch day:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;CVE-2024-21762, CVSSV3 Score 9.6, Unauthorized Code Execution, &amp;ldquo;Out of Bounds Write&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;A &lt;a href=&#34;https://cwe.mitre.org/data/definitions/787.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;out-of-bounds write&lt;/a&gt;

 vulnerability
in FortiOS may allow a remote unauthenticated attacker to execute arbitrary code or command via specially crafted HTTP requests.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;This is a mistake easily made in C or other languages without index checking when accessing arrays.
In C, for example, one can access memory before the array using negative indices,
and if an error code is -1, but the error code is not checked after a function call, then everything goes up in flames.&lt;/p&gt;
&lt;p&gt;This type of error is not always found by source code scanners with a static analyzer,
but most cases should be flagged by the scanner as a code smell.&lt;/p&gt;
&lt;p&gt;Well, unfortunately, &lt;strong&gt;the day before yesterday&lt;/strong&gt; was also a Fortigate patch day.
&lt;a href=&#34;https://www.bleepingcomputer.com/news/security/fortinet-warns-of-new-fortisiem-rce-bugs-in-confusing-disclosure/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BleepingComputer reports&lt;/a&gt;

:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In this instance, due to an issue with the API which we are currently investigating,
rather than an edit, this resulted in two new CVEs being created, duplicates of the original CVE-2023-34992,
FortiNet told BleepingComputer.&lt;/p&gt;
&lt;p&gt;However, it turns out that CVE-2024-23108 and CVE-2024-23109 are actually patch bypasses for the CVE-2023-34992
flaw discovered by Horizon3 vulnerability expert Zach Hanley.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So, this was a patch for a patch because the mitigation didn&amp;rsquo;t work,
and Fortinet got confused with the CVE numbers due to the sheer volume of them currently open.&lt;/p&gt;
&lt;p&gt;Meanwhile, the US CISA (Cybersecurity and Infrastructure Security Agency)
is demanding all US institutions to shut down Ivanti VPN (formerly Juniper Pulse Secure):&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&amp;ldquo;CISA is requiring all Federal agencies to disconnect Ivanti products by Friday at midnight
(Ivanti Connect Secure &amp;amp; Ivanti Policy Secure).
This is roughly 48-hours notice, to not patch, but rip it out!
Ivanti is an American company.
This is unprecedented.&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;While the
&lt;a href=&#34;https://www.cisa.gov/news-events/directives/supplemental-direction-v1-ed-24-01-mitigate-ivanti-connect-secure-and-ivanti-policy-secure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;original directive&lt;/a&gt;


could initially be interpreted as an update, re-installation, and reconfiguration, this hope has now been dashed.&lt;/p&gt;
&lt;p&gt;The patches mentioned are not suitable for fixing the error.
&lt;a href=&#34;https://infosec.exchange/@briankrebs/111863433959430768&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Brian Krebs has summarized this issue&lt;/a&gt;

:&lt;/p&gt;
&lt;p&gt;Meanwhile, someone opened up the Ivanti image and took a look inside.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Versions of software that have been routinely outdated for more than a decade in the current image.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;As curl developer Stefan Eissing phrases it, these are &amp;ldquo;corpse parts and zombie software.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;And, as expected, a few days after the CISA-mandated patch frenzy,
&lt;a href=&#34;https://www.bleepingcomputer.com/news/security/ivanti-patch-new-connect-secure-auth-bypass-bug-immediately/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BleepingComputer headlines again&lt;/a&gt;

:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Ivanti: Patch new Connect Secure auth bypass bug immediately&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The flaw (CVE-2024-22024) is due to an XXE
(&lt;a href=&#34;https://cwe.mitre.org/data/definitions/611.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;XML eXternal Entities&lt;/a&gt;

) weakness in the gateways&amp;rsquo; SAML component
that lets remote attackers gain access to restricted resources on unpatched appliances in low-complexity
attacks without requiring user interaction or authentication.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SAML, Security Assertion Markup Language, is an XML notation for access rights in Single Sign-On systems.
Because it&amp;rsquo;s an XML notation, it can have these &lt;code&gt;&amp;amp;blablub;&lt;/code&gt; things – Entities – that are replaced by other text.
With External Entities, the replacement text is not locally fixed but is downloaded from the net.&lt;/p&gt;
&lt;p&gt;What does this mean in the context of SAML?
It means that the access rights in the document are not necessarily fixed;
an attacker can load Entity definitions from the net.
Depending on where the Entity is used, it can partially or completely rewrite the SAML file and grant different rights.&lt;/p&gt;
&lt;p&gt;XML parsers are well understood,
and XXE is something that can be reliably scanned for automatically with a source code scanner.
This type of error is easily avoidable in modern development environments.&lt;/p&gt;
&lt;h1 id=&#34;antivirus-and-endpoint-security&#34;&gt;
    &lt;a href=&#34;#antivirus-and-endpoint-security&#34;&gt;
	Antivirus and Endpoint Security
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;This is not an exception and is not limited to VPN gateways,
but rather manufacturers of security software happily rely on
&amp;ldquo;security-relevant software with privileges, and programming methods from the 90s of the last millennium.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Examples from this blog:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2017/10/20/aslr.html&#34;&gt;ASLR&lt;/a&gt;

: macOS Trend Micro Binary without ASLR, every exploit (yes, there are some)
automatically stable across the entire fleet.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2018/06/18/websense-dlp-gives-instant-root.html&#34;&gt;Websense DLP gives instant root&lt;/a&gt;

:
WebSense DLP ships outdated software versions and an exploitable kernel module, probably missing QA and defective shipping process.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is so widespread in endpoint security that, for example,
&lt;a href=&#34;https://mastodon.social/@joxean&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@joxean&lt;/a&gt;


has written an entire book about it:
&lt;a href=&#34;https://www.amazon.de/Antivirus-Hackers-Handbook-English-ebook/dp/B014MJ6AKS&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Antivirus Hacker&amp;rsquo;s Handbook&lt;/a&gt;

.
It describes how to find vulnerabilities of this kind in every – literally every – AV software.&lt;/p&gt;
&lt;p&gt;This is systematic: It is due to the way this software is designed and developed, and it cannot be fixed with patches.&lt;/p&gt;
&lt;p&gt;I know this because I played this game for a few years with a company Mac:
I used the so-called &amp;ldquo;security tools&amp;rdquo; that Corp installed on my Mac to gain privileges on my Mac.&lt;/p&gt;
&lt;p&gt;The whole process is reliably repeatable, and I never had to invest more than a slow Friday afternoon in any case.
And I am not even a &amp;ldquo;security researcher,&amp;rdquo; just an amateur with reverse engineering experience from the C64 era.&lt;/p&gt;
&lt;p&gt;It is this software, which is supposed to protect, ending up making the computer vulnerable.
When someone like Fefe talks about &lt;a href=&#34;https://blog.fefe.de/?q=Schlangen&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;snake oil&lt;/a&gt;

, it is to be taken literally.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Snake_oil&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Snake-Oil&lt;/a&gt;

 is a term used to describe deceptive marketing,
health care fraud, or a scam.
Similarly, snake oil salesman is a common label used to describe someone who sells, promotes,
or is a general proponent of some valueless or fraudulent cure, remedy, or solution.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;a-list-of-problems-and-outdated-processes&#34;&gt;
    &lt;a href=&#34;#a-list-of-problems-and-outdated-processes&#34;&gt;
	A List of Problems and Outdated Processes
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;We are talking about critically security-relevant software here,
which is supposed to prevent the intrusion of malware and attackers on computers,
or is supposed to detect such attacks, or has authentication or some other form of security-relevant function.&lt;/p&gt;
&lt;p&gt;It runs at critical points, often with privileges, and when it fails, it is not just one machine,
but often an entire company that is critically exposed.&lt;/p&gt;
&lt;p&gt;Such software should be developed with tools and methods that are state-of-the-art
and undergo critical inspection with regard to correctness, freedom from errors, and currency of dependencies.&lt;/p&gt;
&lt;p&gt;However, we see errors that suggest deficiencies in the development process at all points.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We are seeing critical errors that would not have to have major problematic impact
if the software had been written with minimal rights from the outset.
But running parsers for complex, unknown data formats that may contain potentially malicious payloads with privileges?
And then turning off elementary security mechanisms such as ASLR?
That means setting up for maximum damage.
It is not a winnable position.&lt;/li&gt;
&lt;li&gt;Doing all this in 2024 in C, when Go or Rust could have been used? Not particularly smart either.&lt;/li&gt;
&lt;li&gt;Packing your deliverables with software that, in the case of Ivanti, has been without patches for up to two decades?
Correct would be to have an automated release process that assembles a new release from the latest versions of everything
and tests it automatically.
What Ivanti delivers is not just &amp;ldquo;not state-of-the-art,&amp;rdquo; it is grossly negligent.&lt;/li&gt;
&lt;li&gt;Delivering all this in an encrypted image, instead of with a &amp;ldquo;SBOM of Shame&amp;rdquo;
is soon to be a federal crime in the USA, and the EU is on the same path. Good.
(An SBOM is a Software Bill Of Materials, a list of the dependencies used and their versions.)&lt;/li&gt;
&lt;li&gt;A &amp;ldquo;Format String Bug&amp;rdquo; or an &amp;ldquo;XML External Entities Vulnerability&amp;rdquo; are trivial errors that source code scanners can detect.
Such source scanners are being advertised by these security firms themselves or even developed in-house.
But these tools are not in use internally, because otherwise, such code could never have made it into a product.
This does not require AI; in part, these are better regular expressions, sometimes a bit of static analysis.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As external observers, based on the demonstrated error patterns,
we are witnessing a failure along the entire software development chain:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;At the architecture level (not minimizing rights),&lt;/li&gt;
&lt;li&gt;at the tool level (no scanners for trivial errors, outdated dependencies, no automation in build and release),&lt;/li&gt;
&lt;li&gt;at the packaging level (the defective permissions in Websense, for example),&lt;/li&gt;
&lt;li&gt;and at every other point where one can infer the process from the errors observed from the outside.
&lt;ul&gt;
&lt;li&gt;For example, &amp;ldquo;no functioning code review and audit&amp;rdquo;
(&amp;ldquo;statically compiled-in backdoor passwords,&amp;rdquo; as are a persistent problem at Cisco, fall under this).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;These are thus management errors in the leadership of software companies that produce security-critical software.
It is the responsibility of management to establish and control processes that ensure a minimum level of quality.&lt;/p&gt;
&lt;p&gt;The notion &amp;ldquo;software errors, nothing can be done about it&amp;rdquo; is incorrect –
there are entire classes of errors that can be definitively avoided through architecture,
automatic scanning,
education,
review,
and testing.
It is the responsibility of management to establish and control such processes.&lt;/p&gt;
&lt;p&gt;All in all, one can only conclude that irresponsible hack shops without fundamental software development processes
are masquerading as &amp;ldquo;security&amp;rdquo; companies.
They are packaging radioactive toxic waste in glossy packages,
thereby building a highway for nation-state actors into the heart of critical infrastructures.&lt;/p&gt;
&lt;p&gt;In some cases, the nature of the error borders on deliberate sabotage, or,
to put it another way, it could hardly be worse with deliberate sabotage.&lt;/p&gt;
&lt;h1 id=&#34;1010-no-notes&#34;&gt;
    &lt;a href=&#34;#1010-no-notes&#34;&gt;
	10/10, no notes
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;On IRC, my friends joke:
&amp;ldquo;Are you a 10/10 company?&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Security vulnerabilities are not only assigned a unique number, the CVE number,
but they also receive a severity grade,
the &lt;a href=&#34;https://en.wikipedia.org/wiki/Common_Vulnerability_Scoring_System&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CVSS-Score&lt;/a&gt;

.
A 10/10 is the maximum grade, but basically, anything above 8 is considered
&lt;a href=&#34;https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;a total loss and complete process failure&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;There is now a historical CVE database that can be
&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/cvssscoremin-9/cvssscoremax-10/vulnerabilities.html?page=1&amp;amp;cvssscoremin=9&amp;amp;cvssscoremax=10&amp;amp;order=3&amp;amp;trc=40515&amp;amp;sha=2721cbf47ba1e57d8b65ae1c3cf8883295fd04d7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;sorted by CVSS score&lt;/a&gt;

,
and also narrowed down to companies like
&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/vendor_id-3080/Fortinet.html?page=1&amp;amp;cvssscoremin=9&amp;amp;order=3&amp;amp;trc=103&amp;amp;sha=0ba96ce0b5ea0195196988ef1d381bdd33622c49&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fortinet&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;We then see for Fortinet a series of 12 errors with a 10/10 rating,
specifically 2x in 2024, 1x in 2021, 1x in 2019, 3x in 2017, 4x in 2016, and once in 2005.
This can also be summarized as &amp;ldquo;no improvement is observable.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Security is a process,&amp;rdquo; it is often said.
For Business Continuity Management, I once wrote down what that means:
&lt;a href=&#34;https://blog.koehntopp.info/2023/02/18/this-is-not-a-drill.html&#34;&gt;This is not a Drill. This is just Tuesday&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Similar considerations can be made for secure software development processes,
and there are even ready-made process blueprints available for this purpose.
Furthermore, as I have shown, the patterns of errors can reveal the weaknesses in the internal development process
with regard to security best practices.
The numbers of CVEs and CVSS scores can indicate whether a company has improved its posture.&lt;/p&gt;
&lt;p&gt;If it is apparent that this has not been the case over the years, how can a purchasing decision be made positively?
Something to think about.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/meerschweinchen-anne.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Some things can only be made bearable with cute guinea pig photos.&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Schlangenöl</title>
      <link>https://blog.koehntopp.info/2024/02/09/schlangenoel.html</link>
      <pubDate>Fri, 09 Feb 2024 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/02/09/schlangenoel.html</guid>
      <description>&lt;p&gt;This text also has a version in
&lt;a href=&#34;https://blog.koehntopp.info/2024/02/10/snake-oil.html&#34;&gt;english language&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Diese Woche war &amp;ldquo;Kaputte Security Software Werbewoche&amp;rdquo;.&lt;/p&gt;
&lt;h1 id=&#34;fortigate-und-ivanti&#34;&gt;
    &lt;a href=&#34;#fortigate-und-ivanti&#34;&gt;
	Fortigate und Ivanti
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Zunächst einmal war &lt;strong&gt;heute&lt;/strong&gt; Fortigate Patchday:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;CVE-2024-23113, CVSSV3 Score 9.8, Unauthorized Code Execution, &amp;ldquo;Format String Bug&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;A use of &lt;a href=&#34;https://cwe.mitre.org/data/definitions/134.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;externally-controlled format string&lt;/a&gt;

 vulnerability
in FortiOS &lt;code&gt;fgfmd&lt;/code&gt; daemon may allow a remote unauthenticated attacker to execute arbitrary code or
commands via specially crafted requests.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Das ist ein Fall, wo eine C-Funktion einen Formatstring mit &lt;code&gt;&amp;quot;Bla %s Fasel&amp;quot;&lt;/code&gt; annimmt,
um etwa eine Log-Nachricht oder ein Kommando für einen &lt;code&gt;system()&lt;/code&gt; Aufruf zusammenzubauen.
Der Entwickler hat jedoch den Format-Parameter des Kommandos nicht statisch auf einen Formatstring gesetzt
(&lt;code&gt;snprintf(buffer, length, &amp;quot;Bla %s Fasel&amp;quot;, benutzereingabe)&lt;/code&gt;),
sondern stattdessen die Benutzereingabe als Format genommen
(&lt;code&gt;snprintf(buffer, length, benutzereingabe)&lt;/code&gt;).
Die Benutzereingabe kann so verwendet werden, um alles Mögliche zu tun.&lt;/p&gt;
&lt;p&gt;Das ist ein Fehler, der von den üblichen Sourcecodescannern automatisch erkannt wird,
und wenn man in einer modernen Entwicklungsumgebung versucht, so etwas zu comitten oder zu mergen,
dann wird man vom Scanner ganz furchtbar erniedrigt, der Commit zurückgewiesen und man bekommt ein Security-Training zugewiesen.&lt;/p&gt;
&lt;p&gt;Will sagen, dieser Fehler tritt in einer zeitgemäßen Development-Umgebung nicht mehr auf.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Auch gestern&lt;/strong&gt; war Fortigate Patchday:&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;CVE-2024-21762, CVSSV3 Score 9.6, Unauthorized Code Execution, &amp;ldquo;Out of Bounds Write&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&amp;ldquo;A &lt;a href=&#34;https://cwe.mitre.org/data/definitions/787.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;out-of-bounds write&lt;/a&gt;

 vulnerability
in FortiOS may allow a remote unauthenticated attacker to execute arbitrary code or command via specially crafted HTTP requests.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Das ist ein Fehler, der in C oder anderen Sprachen ohne Indexprüfung beim Zugriff auf Arrays gerne gemacht wird.
In C kann man zum Beispiel mit negativen Indices auf Speicher vor dem Array zugreifen, und
wenn ein Error-Code &lt;code&gt;-1&lt;/code&gt; ist, aber nach einem Funktionsaufruf der Error-Code nicht geprüft wird,
dann brennt alles nieder.&lt;/p&gt;
&lt;p&gt;Diese Sorte Fehler wird von Source Code Scannern mit statischem Analyzer nicht immer gefunden,
aber meistens und alle Fälle, wo das nicht passiert, sollten von dem Ding eigentlich als Code Smell angemerkt werden.&lt;/p&gt;
&lt;p&gt;Nun. Leider war &lt;strong&gt;auch vorgestern&lt;/strong&gt; Fortigate Patchday.
&lt;a href=&#34;https://www.bleepingcomputer.com/news/security/fortinet-warns-of-new-fortisiem-rce-bugs-in-confusing-disclosure/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;BleepingComputer schreibt&lt;/a&gt;

:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;In this instance, due to an issue with the API which we are currently investigating,
rather than an edit, this resulted in two new CVEs being created, duplicates of the original CVE-2023-34992,
FortiNet told BleepingComputer.&lt;/p&gt;
&lt;p&gt;However, it turns out that CVE-2024-23108 and CVE-2024-23109 are actually patch bypasses for the CVE-2023-34992
flaw discovered by Horizon3 vulnerability expert Zach Hanley.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Das war also ein Patch für einen Patch, weil die Mitigation nicht funktioniert hat und
Fortinet kam mit den CVE-Nummern durcheinander, weil gerade so viele davon offen sind.&lt;/p&gt;
&lt;p&gt;Unterdessen fordert die US CISA (Cybersecurity and Infrastructure Security Agency) von allen US-Institutionen das
Abschalten von Ivanti VPN (vormals Juniper Pulse Secure):&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&amp;ldquo;CISA is requiring all Federal agencies to disconnect Ivanti products by Friday at midnight
(Ivanti Connect Secure &amp;amp; Ivanti Policy Secure).
This is roughly 48-hours notice, to not patch, but rip it out!
Ivanti is an American company.
This is unprecedented.&amp;rdquo;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Während man
&lt;a href=&#34;https://www.cisa.gov/news-events/directives/supplemental-direction-v1-ed-24-01-mitigate-ivanti-connect-secure-and-ivanti-policy-secure&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;die Originaldirektive&lt;/a&gt;


ursprünglich noch als Update und Reinstallation sowie Neukonfiguration lesen konnte
hat sich diese Hoffnung mittlerweile zerschlagen.&lt;/p&gt;
&lt;p&gt;Die Patches, von denen dort die Rede ist, sind nicht geeignet, den Fehler zu beheben.
&lt;a href=&#34;https://infosec.exchange/@briankrebs/111863433959430768&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Brian Krebs hat das zusammengefasst&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Unterdessen hat jemand das Ivanti Image mal aufgemacht und reingesehen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Versionen von Software, die routinemäßig seit mehr als einer Dekade veraltet sind in einem aktuellen Image.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Das sind, wie curl-Entwickler Stefan Eissing formuliert &amp;ldquo;Leichenteile und Zombie Software&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Und, es kommt, wie es kommen muss:
Einige Tage nach der von CISA vorgeschriebenen Patchorgie
&lt;a href=&#34;https://www.bleepingcomputer.com/news/security/ivanti-patch-new-connect-secure-auth-bypass-bug-immediately/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;titelt BleepingComputer erneut&lt;/a&gt;

:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Ivanti: Patch new Connect Secure auth bypass bug immediately&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The flaw (CVE-2024-22024) is due to an XXE
(&lt;a href=&#34;https://cwe.mitre.org/data/definitions/611.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;XML eXternal Entities&lt;/a&gt;

) weakness in the gateways&amp;rsquo; SAML component
that lets remote attackers gain access to restricted resources on unpatched appliances in low-complexity
attacks without requiring user interaction or authentication.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;SAML, Security Assertion Markup Language, ist eine XML-Notation für Zugriffsrechte in Single-Sign-On Systemen.
Weil es eine XML-Notation ist, kann es dort diese &lt;code&gt;&amp;amp;blablub;&lt;/code&gt;-Dinger geben – Entities – die durch anderen Text ersetzt werden.
Bei External Entities liegt der Ersetzungstext nicht lokal fest, sondern wird aus dem Netz nachgeladen.&lt;/p&gt;
&lt;p&gt;Was heißt das im Kontext von SAML? Es bedeutet, die Zugriffsrechte sind im Dokument also nicht zwingend festgenagelt,
sondern ein Angreifer kann Entity Definitionen aus dem Netz nachladen.
Je nachdem, wo die Entity verwendet wird, kann man damit die SAML-Datei in Teilen oder ganz umschreiben und sich andere Rechte geben.&lt;/p&gt;
&lt;p&gt;XML-Parser sind gut verstanden und XEE sind ein Ding, auf das man mit einem Sourcecode-Scanner zuverlässig automatisch scannen kann.
Diese Sorte Fehler ist in modernen Entwicklungsumgebungen gut auszuschließen.&lt;/p&gt;
&lt;h1 id=&#34;antivirus-und-endpoint-security&#34;&gt;
    &lt;a href=&#34;#antivirus-und-endpoint-security&#34;&gt;
	Antivirus und Endpoint Security
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Das ist alles keine Ausnahme und auch nicht auf VPN-Gateways beschränkt,
sondern Hersteller von Security Software setzen fröhlich auf
&amp;ldquo;Security-Relevante Software mit Privilegien, und Programmiermethoden aus den 90er Jahren des letzten Jahrtausends&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Beispiele aus diesem Blog:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2017/10/20/aslr.html&#34;&gt;ASLR&lt;/a&gt;

: MacOS Trend Micro Binary mit ohne ASLR, jeder Exploit
(ja, es gibt welche) ist automatisch stabil über die ganze Flotte.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.koehntopp.info/2018/06/18/websense-dlp-gives-instant-root.html&#34;&gt;Websense DLP gives instant root&lt;/a&gt;

:
WebSense DLP veraltete Softwareversionen und exploitbares Kernelmodul, vermutlich fehlende QA und defekter Shipping Prozess.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Das ist bei Endpoint Security so verbreitet, daß zum Beispiel
&lt;a href=&#34;https://mastodon.social/@joxean&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;@joxean&lt;/a&gt;

 ein ganzes Buch darüber geschrieben hat:
&lt;a href=&#34;https://www.amazon.de/Antivirus-Hackers-Handbook-English-ebook/dp/B014MJ6AKS&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;The Antivirus Hacker&amp;rsquo;s Handbook&lt;/a&gt;

.
beschreibt, wie man Sicherheitslücken dieser Art in jeder, wirklich jeder AV Software findet.&lt;/p&gt;
&lt;p&gt;Das ist systematisch:
Es liegt an der der Art und Weise, wie diese Software designt und entwickelt wird,
und es ist auch mit Patchs nicht zu beheben.&lt;/p&gt;
&lt;p&gt;Ich weiß das, weil ich dieses Spiel einige Jahre mit einem Firmen-Mac gespielt habe:
Ich habe die sogenannten &amp;ldquo;Security Tools&amp;rdquo; verwendet, die Corp auf meinem Mac installiert, um auf meinem Mac Privilegien zu bekommen.&lt;/p&gt;
&lt;p&gt;Der ganze Prozess ist zuverlässig wiederholbar,
und ich habe in keinem Fall mehr als einen langsamen Freitagnachmittag dafür investieren müssen.
Dabei bin ich noch nicht einmal &amp;ldquo;Security-Researcher&amp;rdquo;,
sondern nur ein Amateur mit Reverse-Engineering Erfahrung aus dem C64-Zeitalter.&lt;/p&gt;
&lt;p&gt;Es ist diese Software, die angeblich schützen soll, die am Ende dazu führt, daß der Rechner angreifbar wird.
Wenn jemand wie Fefe von &lt;a href=&#34;https://blog.fefe.de/?q=Schlangen&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Schlangenöl&lt;/a&gt;

 redet, dann ist das wortwörtlich zu verstehen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/schlangenoel-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;


&lt;em&gt;&lt;a href=&#34;https://en.wikipedia.org/wiki/Snake_oil&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Snake-Oil&lt;/a&gt;

 is a term used to describe deceptive marketing,
health care fraud, or a scam.
Similarly, snake oil salesman is a common label used to describe someone who sells, promotes,
or is a general proponent of some valueless or fraudulent cure, remedy, or solution.&lt;/em&gt;&lt;/p&gt;
&lt;h1 id=&#34;eine-problemliste-und-veraltete-prozesse&#34;&gt;
    &lt;a href=&#34;#eine-problemliste-und-veraltete-prozesse&#34;&gt;
	Eine Problemliste und veraltete Prozesse
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Wir reden hier von kritisch security-relevanter Software,
die das Eindringen von Schadsoftware und Angreifern auf Rechnern verhindern soll,
oder die solche Angriffe erkennen soll,
oder die Authentisierung oder sonst eine Form von sicherheitsrelevanter Funktion hat.&lt;/p&gt;
&lt;p&gt;Sie läuft an kritischer Stelle, oft mit Privilegien und wenn sie versagt, ist meist nicht nur eine Maschine,
sondern eine ganze Firma kritisch exponiert.&lt;/p&gt;
&lt;p&gt;Solche Software sollte eigentlich mit Werkzeugen und Methoden, die Stand der Technik sind, entwickelt werden
und besonderer Beobachtung hinsichtlich Korrektheit, Fehlerfreiheit und Aktualität von Dependencies unterliegen.&lt;/p&gt;
&lt;p&gt;Wir sehen jedoch Fehler, die auf Defizite im Entwicklungsprozeß an allen Stellen schließen lassen.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Wir sehen kritische Fehler, die keine groß problematischen Auswirkungen haben müßten,
wenn die Software von vorher herein rechteminimal geschrieben worden wäre.
Aber Parser für komplexe, unbekannte Datenformate, die potenziell bösartige Payloads enthalten,
mit Privilegien laufen zu lassen?
Und dann noch elementare Sicherheitsmechanismen des Betriebssystems abschalten?
Das bedeutet, sich für Maximalschaden aufzustellen.
Es ist keine gewinnbare Position.&lt;/li&gt;
&lt;li&gt;Das alles in 2024 in C zu tun, wenn man Go oder Rust zur Verfügung hätte?
Auch nicht sonderlich schlau.&lt;/li&gt;
&lt;li&gt;Seine Deliverables mit Software vollzupacken, die im Fall von Ivanti bis zu zwei Dekaden
ohne Patches auf dem Buckel hat, anstatt einen automatisierten Release-Prozess zu haben, der ein neues
Release aus den neusten Versionen von allem zusammenschraubt und automatisch testet?
Das ist nicht nur &amp;ldquo;nicht Stand der Technik&amp;rdquo;, sondern es ist grob fahrlässig.&lt;/li&gt;
&lt;li&gt;Das alles dann in einem verschlüsselten Image auszuliefern, statt mit einer &amp;ldquo;SBOM of Shame&amp;rdquo;
(Software Bill Of Materials, eine Liste der verwendeten Dependencies und ihrer Versionen)
ist bald schon ein Federal Crime in den USA, und auch die EU ist auf diesem Weg.
Gut so.&lt;/li&gt;
&lt;li&gt;Ein &amp;ldquo;Format String Bug&amp;rdquo; oder eine &amp;ldquo;XML External Entities Vulnerability&amp;rdquo; sind triviale Fehler,
die Source Code Scanner erkennen können, wie sie von diesen Securityfirmen selbst beworben
oder gar im eigenen Haus entwickelt werden.
Aber offensichtlich sind diese Werkzeuge im Hause nicht im Einsatz, denn sonst hätte solcher Code niemals in
ein Produkt gelangen können.
Dazu braucht es keine KI, teilweise sind das bessere Regular Expressions, manchmal ein bisschen statische Analyse.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Wir beobachten hier als Außenstehende auf der Grundlage der gezeigten Fehlerbilder ein
Versagen entlang der gesamten Software Development Chain:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Auf der Architektur-Ebene (nicht rechteminimal),&lt;/li&gt;
&lt;li&gt;auf der Tool-Ebene (keine Scanner für triviale Fehler, veraltete Dependencies, keine Automation beim Build und Release)&lt;/li&gt;
&lt;li&gt;auf der Packaging-Ebene (die defekten Permissions bei Websense zum Beispiel)&lt;/li&gt;
&lt;li&gt;und an jeder anderen Stelle, bei der man von außen durch die Fehler auf den Prozess rückschließen kann.
&lt;ul&gt;
&lt;li&gt;Zum Beispiel &amp;ldquo;kein funktionierender Code-Review und Audit&amp;rdquo;
(&amp;ldquo;statisch einkompilierte Backdoor-Passworte&amp;rdquo;, wie sie bei Cisco das Dauer-Fehlerbild sind, fallen darunter).&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Es sind mithin Managementfehler bei der Führung von Software-Häusern, die sicherheitskritische Software herstellen.
Es ist Aufgabe des Managements Prozesse einzurichten und zu steuern, die ein Mindestmaß an Qualität sicherstellen.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Softwarefehler, kann man nichts machen&amp;rdquo; stimmt so nicht – es gibt ganze Klassen von Fehlern,
die man durch Architektur,
durch automatisches Scannen,
durch Ausbildung,
durch Review,
und durch Testen sicher ausschließen kann,
und es ist die Aufgabe des Managements, solche Prozesse einzurichten und zu steuern.&lt;/p&gt;
&lt;p&gt;Alles in allem kann man nur zu dem Ergebnis kommen,
daß hier verantwortungslose Hackerbuden ohne elementare Software-Entwicklungsprozesse als &amp;ldquo;Security&amp;rdquo;-Firmen auftreten
und radioaktiven Giftmüll in Hochglanzpackungen abfüllen,
um so eine Autobahn für Nation State Actors ins Herz von kritischen Infrastrukturen zu bauen.&lt;/p&gt;
&lt;p&gt;Teilweise grenzt die Art der Fehler an mutwillige Sabotage,
beziehungsweise könnte man es auch mit mutwilliger Sabotage kaum schlimmer machen.&lt;/p&gt;
&lt;h1 id=&#34;1010-no-notes&#34;&gt;
    &lt;a href=&#34;#1010-no-notes&#34;&gt;
	10/10, no notes
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Im Chat witzeln Freunde von mir:
&amp;ldquo;Are you a 10/10 company?&amp;rdquo;&lt;/p&gt;
&lt;p&gt;Security-Lücken wird nicht nur eine eindeutige Nummer zugewiesen, die CVE-Nummer, sondern
sie bekommen auch einen Schweregrad, den &lt;a href=&#34;https://en.wikipedia.org/wiki/Common_Vulnerability_Scoring_System&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CVSS-Score&lt;/a&gt;

.
Eine 10/10 ist der Maximalgrad, aber im Grunde ist alles über 8
ein &lt;a href=&#34;https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Totalschaden und komplettes Prozessversagen&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Es gibt nun eine historische CVE-Datenbank, die man
&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/cvssscoremin-9/cvssscoremax-10/vulnerabilities.html?page=1&amp;amp;cvssscoremin=9&amp;amp;cvssscoremax=10&amp;amp;order=3&amp;amp;trc=40515&amp;amp;sha=2721cbf47ba1e57d8b65ae1c3cf8883295fd04d7&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;nach CVSS sortieren kann&lt;/a&gt;

,
und auch auf Firmen wie
&lt;a href=&#34;https://www.cvedetails.com/vulnerability-list/vendor_id-3080/Fortinet.html?page=1&amp;amp;cvssscoremin=9&amp;amp;order=3&amp;amp;trc=103&amp;amp;sha=0ba96ce0b5ea0195196988ef1d381bdd33622c49&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Fortinet einschränken&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Wir sehen dann für Fortinet eine Reihe von 12 Fehlern mit 10/10, und zwar
2x in 2024, 1x in 2021, 1x in 2019, 3x in 2017, 4x in 2016 und einmal in 2005.
Das kann man auch mit &amp;ldquo;Besserung ist nicht erkennbar&amp;rdquo; zusammenfassen.&lt;/p&gt;
&lt;p&gt;&amp;ldquo;Security ist ein Prozess&amp;rdquo; heißt es.
Für Business Continuity Management habe ich einmal aufgeschrieben, was das bedeutet:
&lt;a href=&#34;https://blog.koehntopp.info/2023/02/18/this-is-not-a-drill.html&#34;&gt;This is not a Drill. This is just Tuesday&lt;/a&gt;

.&lt;/p&gt;
&lt;p&gt;Analoge Überlegungen kann man auch für sichere Software-Entwicklungsprozesse anstellen,
und es gibt sogar fertige Prozess-Blueprints dafür.
Weiterhin kann man, wie ich gezeigt habe, an den Fehlerbildern erkennen, welche Schwächen der interne Entwicklungsprozess
hinsichtlich Security Best-Practices hat,
und an den CVE-Anzahlen und CVSS-Scores erkennen, ob eine Firma ihre Posture verbessert hat.&lt;/p&gt;
&lt;p&gt;Wenn das erkennbar über Jahre nicht der Fall ist, wie kann dann eine Kaufentscheidung positiv beschieden werden?
Denkt mal darüber nach.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/meerschweinchen-anne.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Manche Dinge sind nur durch niedliche Meerschweinchenfotos erträglich zu machen.&lt;/em&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Wie ChatGPT funktioniert</title>
      <link>https://blog.koehntopp.info/2024/02/06/wie-chatgpt-funktioniert.html</link>
      <pubDate>Tue, 06 Feb 2024 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/02/06/wie-chatgpt-funktioniert.html</guid>
      <description>&lt;p&gt;Es gibt einen wunderbaren Artikel von Stephen Wolfram,
&lt;a href=&#34;https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What Is ChatGPT Doing … and Why Does It Work?&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Dies ist ein etwa ein Jahr alter und langer Text, und man muss dran bleiben, wenn man ihn verstehen möchte.
Er erklärt wie ChatGPT intern funktioniert, warum das so viel Ressourcen kostet,
und er erklärt auch, daß wir keine Ahnung haben, wieso das &amp;ldquo;funktioniert&amp;rdquo;.
Er zeigt aber auch, was ChatGPT alles prinzipbedingt niemals erreichen kann, und auch nicht lernen wird.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-01.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&#34;https://writings.stephenwolfram.com/2023/02/what-is-chatgpt-doing-and-why-does-it-work/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;What is ChatGPT doing…&lt;/a&gt;


von Stephen Wolfram vom 14. Februar 2023.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Stephen Wolfram ist ein Informatiker und Physiker,
der einen recht guten Prolog-Interpreter mit Regeln zur Termumformung und Fakten gefüttert hat,
und dies unter dem Namen Mathematica vertreibt.&lt;/p&gt;
&lt;p&gt;Prolog ist eine deklarative Sprache, die vor 30 Jahren die Grundlage regelbasierter künstlicher Intelligenz-Forschung war.
Deklarative Sprachen wie SQL oder Prolog schreiben keine Programme, die dem Computer sagen, was zu tun ist,
sondern sie beschreiben das gewünschte Ergebnis.
Ein Programmgenerator, der Planer, versucht dann einen Ausführungspfad zu finden,
der das beschriebene Ergebnis auf eine effiziente Weise findet.&lt;/p&gt;
&lt;p&gt;Die Idee hinter diesem Ansatz in der KI-Forschung war, daß man die Welt regelbasiert beschreiben könnte,
ein Welt-Wissensmodell bauen und daß so &amp;ldquo;Intelligenz&amp;rdquo; entsteht.
Das war ein Fehlschlag, aber Mathematica ist eines der beeindruckendsten Arbeitssysteme für Mathematik,
Physik-Visualisierung und Modellierung und alle verwandten Arbeiten.
Eine private Lizenz ist teuer, aber ich gönne mir die,
weil es so einen Heidenspaß macht mit dem Ding zu arbeiten und Sachen auszuprobieren.
Rein optisch und von der Arbeitsweise ist Jupyter ein gnadenloser Mathematica-Clone,
aber in Mathematica steckt eine komplett andere Sprache (etwas, das mal ein Prolog war) und eine viel, viel größere Bibliothek.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-02.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ein Mathematica Arbeitsblatt, das die Approximation von Rechteckwellen durch Fouriersynthese zeigt,
indem es eine Formelschar generiert und plotted.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-03.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Wir generieren daraus Audio, stellen das Audio dar, und spielen es ab.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wolfram geht in seinem Text auf einen der simpelsten Textgeneratoren ein (und zeigt, wie man ihn in Mathematica realisiert) –
ein Zeichenfrequenz-Zähler, der Wikipedia-Seiten konsumiert und zeigt,
wie oft (normiert, also in %) jeder Buchstabe in der Seite auftaucht.&lt;/p&gt;
&lt;p&gt;Er vergleicht die Seiten von &amp;ldquo;Cat&amp;rdquo; und &amp;ldquo;Dog&amp;rdquo; und zeigt, daß in der &amp;ldquo;Dog&amp;rdquo;-Seite natürlich die o-Wahrscheinlichkeit höher ist,
aber daß beide für Englisch charakteristische Buchstabenhäufigkeiten haben.
Er greift sich dann die Häufigkeiten von Buchstabenpaaren (Bi-Grammen) und zeigt an der Spalte für den Buchstaben &amp;ldquo;q&amp;rdquo;,
daß &amp;ldquo;q&amp;rdquo; quasi immer von &amp;ldquo;u&amp;rdquo; gefolgt wird, und man kann das sehen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-04.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Entlang der X-Achse die ersten Buchstaben von Paaren,
entlang der Y-Achse die zweiten Buchstaben.
Je roter und dunkler das Feld, umso häufiger die Kombination.
Die Spalte &amp;ldquo;q&amp;rdquo; ist ganz weiß, mit Ausnahme der &amp;ldquo;qu&amp;rdquo;-Kombination.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Nimmt man mehr Kontext, also statt Paaren Dreiergruppen (Tri-Gramme) oder noch längere Gruppen,
dann bekommt man irgendwann fast aussprechbare oder reale englische Worte.
Schon 4-Gramme produzieren gute Worte.
Englisch hat also einen Buchstabenkontext von circa 4-5.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-05.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Reihe von Worten, die aus Nachfolgewahrscheinlichkeiten von Bi-, Tri- und n-Grammen erzeugt worden ist.
Ab einer Länge von etwa 4 entstehen oft gültige Worte der englischen Sprache.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Würde man das mit chinesischen Schriftzeichen machen,
bekäme man aus einem Grundwortschatz von einigen tausend Worten auf diese Weise Sätze.
Viele chinesische Begriffe haben ein Schriftzeichen, manche zur Klärung der Bedeutung zwei.
ChatGPT macht das genau so.&lt;/p&gt;
&lt;p&gt;Dort sind es keine Schriftzeichen, sondern Token.
Aber ein Token entspricht ziemlich genau der Funktion, die ein Schriftzeichen in Chinesisch hat.
Und es sind fast genau so viele – in der Größenordnung von Zehntausenden.
Davon sind viele Begriffe Ein-Token und einige Mehr-Token.&lt;/p&gt;
&lt;p&gt;Bigramme auf Token produzieren Dinge wie dies hier: Wortsalat.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-06.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Reihe von Wortfolgen, die alle zufällig generiert wurden, auf der Basis von Wortfolgewahrscheinlichkeiten,
die über Bi-Grammen, also Wortpaaren, errechnet worden sind.
Alle Beispiel starten mit dem Wort &amp;ldquo;cat&amp;rdquo;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Stellt man mehr Kontext, arbeitet man also mit n-Grammen für n=3, 4, …,
dann bekommt man eher Dinge, die wie korrekte Sätze aussehen.&lt;/p&gt;
&lt;p&gt;Man bekommt auch eine kombinatorische Explosion:
Statt 26, 26*26, 26*26*26, &amp;hellip; Wahrscheinlichkeiten zum Abspeichern hat man jetzt zum Beispiel 40.000 als Basis.
Und bei einem großen Kontext – statt 4 oder 5 eher was bei 100 – hat man dann mit 40.000 hoch 100 zu tun.&lt;/p&gt;
&lt;p&gt;Also, nicht – weil man das so nicht verarbeiten kann,
und ein wenig Arbeit in die Speicherung von dünn besetzten Matrizen und große Datenmengen stecken muss.
Aber das ist ein lösbares Problem, auch wenn es Aufwand erfordert, der auf der Mathematik nicht sichtbar ist.&lt;/p&gt;
&lt;p&gt;Wolfram erklärt dann &amp;ldquo;Modellierung durch Interpolation&amp;rdquo;.
Er hat Messwerte, die den Weg eines geworfenen Balls durch den Raum beschreiben,
und will dann nacheinander eine Gerade, eine Parabel oder &amp;ldquo;was Kompliziertes&amp;rdquo; da hindurchlegen.&lt;/p&gt;
&lt;p&gt;Er nutzt dieses Beispiel, um viele Dinge um den Modellbegriff zu erklären:
Einmal gibt es verschiedene Wege, um den Fehler zu messen,
also die Abweichung der interpolierten Linie von den Messwerten zu beschreiben.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-07.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Die Messwerte eines Ballwurfes, und die verschiedenen hindurch interpolierten Kurven.
Eine Gerade, eine Parabel und &amp;ldquo;was Kompliziertes&amp;rdquo;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Dann setzt die &amp;ldquo;Beweglichkeit&amp;rdquo; der Funktion, die zur Interpolation genutzt wird, dem Modell Grenzen.
Egal, welche Koeffizienten man findet – die &amp;ldquo;komplizierte&amp;rdquo; Funktion aus dem letzten Beispiel hat immer große Fehler.
Sie kann keinen Fit ergeben.&lt;/p&gt;
&lt;p&gt;Die zweite Funktion, die Parabel, ist immer ein guter Fit.
Das ist so, weil das real-weltliche Phänomen sich aus Gründen tatsächlich parabolisch verhält,
bis es durch Luftwiderstand gestört wird.
In jedem Modell stecken Annahmen – und die können, wenn sie falsch sind, – das Modell unmöglich machen.&lt;/p&gt;
&lt;p&gt;Er geht dann zu neuronalen Netzen über und diskutiert, wie diese aufgebaut sind,
und welche Mathematik da drin steckt und wofür man sie einsetzen kann.
Es sind Geradengleichungen, mx+b, und Summen, aber sehr, sehr viele.
Sein Beispiel ist die Schrifterkennung.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-08.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Ein Datentyp in Mathematica sind zweidimensionale Bitmaps – Bilder.
Hier sind es handgeschriebene Ziffern.
Man kann diese in eine Menge (einen weiteren Datentyp) tun, und dann einem NetModel (dem Datentyp für ein Neurales Netz) vorwerfen.
Dieses spezielle NetModel gibt dann als Ausgabe die erkannten Ziffern.
Dies ist eine Anwendung eines NN als Classifier, also als ein Ding, das erkennen und gruppieren kann.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-09.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Auf ein Bitmuster einer gut lesbaren 2 wird sukzessive ein immer stärkerer Gaussian Blur angewendet.
Die resultierende Eingabemenge wird in das NetModel-Objekt verfüttert und man bekommt &amp;ldquo;2, 2, 2, 1, 1, 1, 1, 1, 1&amp;rdquo; als Ausgabe.
Das Modell bricht bei schlechten Daten irgendwann zusammen.
Als Mensch erkennt man mehr Ziffern korrekt als 2, aber am Ende wird es wirklich sehr unlesbar.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wolfram macht dann weiter und diskutiert das Konzept der Nähe oder Ähnlichkeit, indem er mit Voronoi-Maps herumexperimentiert.
Er stellt sich jetzt die Aufgabe, eine bestimmte Funktion mit zwei Parametern x und y, die die Werte -1, 0 und +1 liefert,
zu &amp;ldquo;lernen&amp;rdquo; und durch ein neuronales Netz zu produzieren.
Er benutzt das, um zu zeigen, wie man Koeffizienten einer Näherungsfunktion findet,
indem man simple Geradengleichungsrechner (Neuronen) verknüpft.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-10.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Von einem NN erkannte handgeschriebene Ziffern nach Ähnlichkeit sortiert und angeordnet.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-11.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Reihe von zufällig auf einer Ebene verteilte Punkte und die von ihnen &amp;ldquo;beherrschten&amp;rdquo; Gebiete:
Jeder Punkt der Ebene wird dem orangen Punkt zugeordnet, der ihm nach irgendeiner Distanzmetrik am nächsten ist.
Es entsteht eine Partition, eine Aufteilung, der Karte in Zonen um die Punkte.
Es sieht aus wie Seifenblasen, die aneinander kleben und gerade Schnittflächen bilden.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-12.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Die Aufgabe: Ein simples Voronoi, das drei Punkte mit den Werten +1, 0 und -1 auf einer Ebene verteilt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-13.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Die 3D-Darstellung desselben Diagramms.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Er nimmt dann die vorherigen Gedanken zur Interpolation wieder auf.
Dazu erfindet er ohne weitere Erläuterung eine Aneinanderreihung von &amp;ldquo;Neuronen&amp;rdquo;, schreibt Koeffizienten dran,
und diskutiert verschiedene mögliche Abstandsberechnungsfunktionen (Fehler-Meßfunktionen).
Wenn man die Mathematik und den Prozess der Suche nach den passenden Koeffizienten mal wegläßt,
kommt man am Ende bei einer Näherung des Wunsch-Graphen an, die so aussieht.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-14.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Das von Wolfram gewählte neuronale Netz.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-16.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Das Resultat weicht vom Wunschergebnis ab, ist aber eine gute Näherung.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Er diskutiert und demonstriert dann durch Simulation, daß man bestimmte Dinge nicht darstellen kann,
wenn man nicht genügend Neuronen hat.
Das zu modellierende Subjekt ist zu kompliziert, sodaß der mögliche Parameterraum nicht groß genug ist:
Eine Gerade kann keine Parabel annähern.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-16.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Verschiedene NN und die resultierenden Näherungen.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Es geht dann in einen längeren Exkurs, in dem er die Anatomie der Netze zu erklären, die da verwendet werden.
Man erkennt, daß die Modelle Schichten haben und daß sie keine Rückflüsse haben:
Daten fließen immer von der oberen Schicht in die unmittelbar darunter liegende – es gibt keine Rückflüsse und auch kein Überspringen.&lt;/p&gt;
&lt;p&gt;Man erkennt auch, daß generell größere Modelle bessere Ergebnisse liefern.
Wolfram gibt zu, daß wir nicht wissen, wie groß ein NN für ein bestimmtes Problem sein muss.
Wir wissen auch nicht, wie die konkrete Verschaltung der Schichten aussehen sollte,
oder muss, um gute Ergebnisse zu liefern.&lt;/p&gt;
&lt;p&gt;Er versucht immerhin, die Inhalte der Schichten zu verstehen und ihnen Bedeutung zuzuweisen,
aber auch das ist nicht wirklich Wissenschaft und teilweise Kaffeesatzlesen.
Fast alles am Bau von NN ist &amp;ldquo;Erfahrung&amp;rdquo; und &amp;ldquo;Empirik&amp;rdquo; ohne viel Theorie dahinter.&lt;/p&gt;
&lt;p&gt;Wir können Daten aus Schichten von NN herausziehen und sie nach einer Abstandsfunktion sortieren lassen,
und die Anordnung ergibt für unsere menschlichen Hirne irgendwie Sinn.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-18.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Hunde und Katzenbilder nach einer Abstandsfunktion eines NN sortiert.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wir können auch die Neuronen einiger Schichten nehmen, die Koeffizienten in einer Bildmatrix anordnen,
und bekommen vereinfachte Bilder von den Dingen, die da gespeichert oder erkannt werden sollen.&lt;/p&gt;
&lt;p&gt;Aber wir haben keine Funktionstheorie oder Mathematik von NN und Kognition.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-19.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Aus einer Schicht aus dem NN eines Katzen-Hunde-Sortierers herausgezogene Daten ergeben Katzenbilder.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wolfram beschäftigt sich weiter mit dem Training von NN, der Datenbeschaffung und der Auszeichnung von Daten.
Das Korpus von Trainingsdaten muss groß und zuverlässig ausgezeichnet sein.
Wir brauchen also viele Katzenbilder (Dafür gibt es das Internet!) und Hundebilder,
und diese müssen von Menschen korrekt mit Tags versehen worden sein, damit ein NN das lernen kann.&lt;/p&gt;
&lt;p&gt;Er zeigt dann Verbesserungen der Koeffizienten und der Resultate über Iterationen des Lernprozesses.
&amp;ldquo;Lernen&amp;rdquo; bedeutet für ein NN, die Koeffizienten der verschiedenen Neuronen zu verändern.
Dazu nimmt man die Eingabe-Koeffizienten als &amp;ldquo;Ebene&amp;rdquo; und den Fehler als &amp;ldquo;Höhe&amp;rdquo;
und wandert dann in der so entstehenden Fehlerlandschaft auf einem zufälligen Pfad in die Täler.&lt;/p&gt;
&lt;p&gt;Das findet lokale Minima und man hofft, aus &amp;ldquo;lokalen Löchern&amp;rdquo; zu entkommen, indem man zufällige Schritte zufälliger Größen macht.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-20.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Die Berg- und Tallandschaft des Fehlergraphen und der Weg des Modells zum lokalen Minimum.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Wieder diskutiert Wolfram mögliche Layouts von NN –
nicht immer kann man jedes Neuron mit allen Neuronen der nächsten Lage verschalten und in der Tat ist das bei großen NN nie machbar.
Bestimmte Formen haben sich als besser lernfähig erwiesen:
Ein schmaler Layer der zwischen zwei breite Layers eingefügt wird scheint Ergebnisse stark zu verbessern.
Niemand weiß, warum das so ist oder hat ein Modell, das dies erklärt.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-21.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Verschiedene Formen von NN und die Ergebnisse, die sie produzieren.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Etwa in der Mitte des Textes wendet sich Wolfram generativen Modellen und LLMs zu.
Training von LLMs ist sehr, sehr einfach, weil sie einfach Text essen:
Man nimmt beliebigen Text, lässt das Modell das folgende Wort generieren und vergleicht es mit dem Wort, das hätte kommen müssen.
Daraus kann man Trainingsfeedback erzeugen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-22.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Karte, auf der englische Worte nach Ähnlichkeit angeordnet sind.
Säugetiere sind links oben, links unten sind &amp;ldquo;alligator&amp;rdquo; und &amp;ldquo;crocodile&amp;rdquo; dicht beieinander, &amp;ldquo;ant&amp;rdquo; und &amp;ldquo;bee&amp;rdquo; sind es auch.
Rechts unten Früchte.
Tiere und Früchte sind klar durch einen Graben getrennt.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Es entsteht dadurch sogar so etwas wie eine Wissens-Karte nach Ähnlichkeits-Metriken.
Das ist nicht so, weil das LLM ein Weltmodell hat.
Sondern es ist so, weil Menschen ein Weltmodell haben und wenn sie Worte gebrauchen,
bestimmte Worte &amp;ldquo;nach beieinander&amp;rdquo; in Sätzen angeordnet sind.
Ein Weltverständnis entsteht so nicht, ein gewisses Sprachverständnis wohl schon.&lt;/p&gt;
&lt;p&gt;Wieder und wieder und wieder versucht Wolfram zu einem Verständnis der Koeffizienten von LLMs oder NNs zu kommen,
oder zu irgendeiner Theorie, die die Funktionsweise von LLMs und NNs planbar und vorhersagbar macht und sich über pure Empirik erhebt.
Er macht dies mit verschiedenen Visualisierungen von Koeffizienten auf die unterschiedlichsten Weisen,
aber er findet nur quälende Muster, die wie Inhalt wirken und nichts enthüllen.&lt;/p&gt;
&lt;p&gt;&lt;p class=&#34;md__image&#34;&gt;
  &lt;img src=&#34;https://blog.koehntopp.info/uploads/2024/02/chatgpt-23.jpg&#34; alt=&#34;&#34;  /&gt;
&lt;/p&gt;

&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Eine Vergröberung einer ChatGPT Koeffizientenmatrix und Einfärbung nach bestimmten Werten erzeugt eine interessante Teal-and-Orange Batik,
die nichts bedeutet.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Am Ende geht es dann darum,
wie man mit solchen riesigen Koeffizienten-Matrizen und einem austrainierten Modell generativ arbeitet und &amp;ldquo;interessante&amp;rdquo; Texte erzeugt.
Dabei geht es auch um den Parameter der &amp;ldquo;Temperatur&amp;rdquo; und den &amp;ldquo;Seed&amp;rdquo;:&lt;/p&gt;
&lt;p&gt;Würde man ein generatives LLM mit einer Null-Temperatur laufen lassen,
würde es immer dasselbe, wahrscheinlichste Folgetoken wählen, um einen Satz zu komplettieren.
Indem man die Wahrscheinlichkeiten der Folgetoken sortiert,
und dann zufällig ein anderes wahrscheinliches Token wählt, bekommt man immer noch &amp;ldquo;gültige&amp;rdquo; Fortsetzungen, die aber variabel sind.&lt;/p&gt;
&lt;p&gt;Das Seed ist dabei der Startwert des Pseudo-Zufallszahlen-Generators,
die Temperatur die &amp;ldquo;Sprungweite&amp;rdquo; vom wahrscheinlichsten Wert weg.
Auch hierzu gibt es keine Theorie, wir wissen nur, daß &amp;ldquo;0.8 ein guter Wert ist&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Wolfram schließt:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;So … What Is ChatGPT Doing, and Why Does It Work?&lt;/p&gt;
&lt;p&gt;The basic concept of ChatGPT is at some level rather simple.
Start from a huge sample of human-created text from the web, books, etc.
Then train a neural net to generate text that’s “like this.”
And in particular, make it able to start from a “prompt” and then continue with text that’s “like what it’s been trained with”.&lt;/p&gt;
&lt;p&gt;As we’ve seen, the actual neural net in ChatGPT is made up of very simple elements — though billions of them.
And the basic operation of the neural net is also very simple, consisting essentially
of passing input derived from the text it’s generated so far “once through its elements” (without any loops, etc.)
for every new word (or part of a word) that it generates.&lt;/p&gt;
&lt;p&gt;But the remarkable—and unexpected—thing is that this process can produce text that’s successfully “like” what’s out there on the web,
in books, etc.
And not only is it coherent human language, it also “says things” that “follow its prompt” making use of content it’s “read”.
It doesn&amp;rsquo;t always say things that “globally make sense”
(or correspond to correct computations because it’s just saying things that “sound right” based on what things “sounded like” in its training material).&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Das ist der Stochastische Papagei, von dem bei LLMs gerne mal die Rede ist.
Er ist wortwörtlich gemeint.&lt;/p&gt;
&lt;p&gt;Ein LLM reproduziert Versatzstücke aus Texten, die es verarbeitet hat,
auf der Basis von Auftretenswahrscheinlichkeiten von &amp;ldquo;großes n&amp;rdquo;-Grammen von chinesischen Schriftzeichen (&amp;ldquo;Token&amp;rdquo;).
n ist dabei gerne groß zweistellig.&lt;/p&gt;
&lt;p&gt;Ein Konzept von Korrektheit gibt es nicht.
Wir wissen auch nicht, wie es das geben kann, denn es gibt keine Theorie.&lt;/p&gt;
&lt;p&gt;Die Idee, daß ein LLM in &amp;ldquo;full autopilot&amp;rdquo; Mode irgendwas Funktionales in irgendeiner Gesellschaft leisten kann – Arbeiten kann – ist lächerlich.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Es reproduziert und würfelt.&lt;/li&gt;
&lt;li&gt;Es hat kein Weltmodell.&lt;/li&gt;
&lt;li&gt;Es kennt keine Grenzen in den Termen von Ethik, Moral, Physik oder Logik.&lt;/li&gt;
&lt;li&gt;Es reiht nur Token aneinander.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Ein LLM kann Menschen Arbeit abnehmen, indem es bestimmte Standardfunktionen erleichtert,
und es ist wahrscheinlich ein ausgezeichneter Sprachübersetzer,
und sicher ein wunderbarer Imitator, denn das ist, als was es konstruiert ist.&lt;/p&gt;
&lt;p&gt;Aber Imitation schafft nicht.&lt;/p&gt;
&lt;p&gt;Die Redewendung des &amp;ldquo;Blurry JPEG of the Internet&amp;rdquo; ist wieder exakt zutreffend,
denn das ist, was der Konstruktionsprozeß eines LLM produziert – eine verlustbehaftete Kompression von Wort-Folge-Wahrscheinlichkeiten.&lt;/p&gt;
&lt;p&gt;In meiner beruflichen Karriere habe ich um mich herum eine Reihe von KI-Projekten in kommerzieller Anwendung gelingen und scheitern sehen.
Das Muster, daß sich dabei ergeben hat, bestätigt sich auch bei LLMs:&lt;/p&gt;
&lt;p&gt;Wann immer meine Arbeitgeber KI eingesetzt haben, um Menschen full-auto zu ersetzen ist das Projekt ein unmitigiertes Desaster gewesen,
das der Firma geschadet und den Kunden Leid zugefügt hat.&lt;/p&gt;
&lt;p&gt;Wann immer meine Arbeitgeber KI eingesetzt haben um Menschen zu augmentieren war das Projekt eine Effizienzsteigerung
um eine halbe Größenordnung (den Faktor 3-5), die durch Feedback menschlicher Entscheidungen in den Trainingskorpus noch verbessert werden konnte.
Dabei war oft entscheidend, Confidence-Werte (aus der Modell-Fehler-Metrik abgeleitete Werte) herauszuführen und für Menschen sichtbar zu machen.&lt;/p&gt;
&lt;p&gt;Die Grundidee dahinter ist, daß wir eine Maschine bauen, die wir zwingen eine Entscheidung zu treffen, egal wie groß die Fehlermetrik ist.
Wenn die Maschine sich sicher ist, daß ein Standardfall in einer oder ander Weise vorliegt, ist das wahrscheinlich gut.
Wenn die Maschine aber eine hohe Fehlermetrik anzeigt, dann erzwingen wir eine Entscheidung, die wahrscheinlich zufällig ist.&lt;/p&gt;
&lt;p&gt;Hier ist es gut, den Fall herauszunehmen und Menschen vorzulegen.
Anders als die KI haben diese ein Weltmodell, und insbesondere ein Modell der ganzen Welt inklusive all der Informationsquellen,
Kontexte und Eskalationsstufen, die dem KI-Modell nicht zugänglich sind.
Menschen können Dinge auf Weisen kontextualisieren und umordnen, die einem Reproduktions-Papagei nicht möglich sind.
Und diese Menschen sind glücklicher, schneller und effektiver, wenn sie mit den Standardfällen nichts zu tun haben.&lt;/p&gt;
&lt;p&gt;Wir können KI erfolgreich einsetzen, wenn wir es nach diesem Modell tun.&lt;/p&gt;
&lt;p&gt;Wir können die Hölle auf Erden erschaffen, indem wir Menschen einer unkontrollierten Papagei-KI aussetzen,
die nach zufällig aufgerufenen Reproduktionen vorheriger Fälle entscheidet, ohne Ausweg.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>JusProg ist nur der Anfang</title>
      <link>https://blog.koehntopp.info/2024/01/16/jusprog-ist-nur-der-anfang.html</link>
      <pubDate>Tue, 16 Jan 2024 01:02:03 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/01/16/jusprog-ist-nur-der-anfang.html</guid>
      <description>&lt;p&gt;Es ist also dies hier passiert:
&lt;a href=&#34;https://lilithwittmann.medium.com/wen-sch%C3%BCtzen-eigentlich-jugendschutzprogramme-7f13fb8ebc51&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Wen schützen eigentlich Jugendschutzprogramme?&lt;/a&gt;


Lilith Wittmann nimmt den Filter von JusProg e.V. auseinander und es ist eine einzige Eskalation:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Die Filterkriterien sind nicht nachvollziehbar.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Gefilterte Websites wissen nichts von ihrer Einstufung.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Die Einstufungen sind systematisch falsch, und man kann eine politische Richtung erkennen.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Das ist JusProg e.V. aber eigentlich egal, denn es sind ja auch viele Websites nicht geblockt worden.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Die Website für den Download ist ein kompromittiertes Wordpress.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Eventuell hat das Wordpress Malware verteilt, aber JusProg e.V. kann das nicht ausschließen und auch nicht nachvollziehen, weil sie die Software nicht im Griff hat.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Die Infektion mit Malware war JusProg e.V. bekannt, und sie haben versucht, daran herumzudoktern, aber erfolglos. Das besorgt sie aber nicht besonders.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Was passiert hier, und warum zerfetzt Lilith Wittmann ausgerechnet JusProg?
Dazu müssen wir ein wenig ausholen und fast 30 Jahre zurückschauen.&lt;/p&gt;
&lt;h1 id=&#34;warum-jugendschutz&#34;&gt;
    &lt;a href=&#34;#warum-jugendschutz&#34;&gt;
	Warum Jugendschutz?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Der Jugendschutz im Allgemeinen ist eine im Grundgesetz verankerte staatliche Aufgabe.
Er ist nicht einfach etwas, das der Staat nicht machen kann.&lt;/p&gt;
&lt;p&gt;Ausnahmen vom Jugendschutz sind klar geregelt und sind im Wesentlichen das &amp;ldquo;Elternprivileg&amp;rdquo;.
Erziehungsberechtigte, und nur diese, dürfen für Ihr Kind – im Rahmen bestimmter Grenzen – frei entscheiden,
was ihr Kind wann darf oder nicht darf.
Darum darf Deine Mutter Dich mit drei Jahren an ihrem Bier probieren lassen,
wenn Du interessiert wissen willst, was sie da trinkt.
Und darum darf Dein Vater Dich mit 6 Jahren Harry Potter Teil 4 und Folgende sehen lassen,
wenn Du unbedingt sehen möchtest wie es weiter geht.&lt;/p&gt;
&lt;p&gt;Lehrer an Schulen dürfen das nicht.
Das Elternprivileg gilt nicht für sie.
Sie müssen also, wenn Schüler Medien in irgendeiner Form zu sich nehmen wollen,
dies im Rahmen des grundgesetzlich vorgeschriebenen und gesetzlich ausgestalteten Jugendschutzes tun,
wenn sie sich von Klagen durch besorgte Bürger frei stellen wollen.&lt;/p&gt;
&lt;p&gt;Internet an Schulen ist für die Schule auf viele Weisen ein Risiko,
und Haftung auf der Basis von Verletzungen des Jugendschutzes ist eines davon.&lt;/p&gt;
&lt;p&gt;Schlimmer noch, auch Anbieter von Medien jeder Art unterliegen den Regelungen des Jugendschutzes.
Niemand kann Filme, Hörspiele, Bücher, aber auch keine Webseiten oder Computerspiele anbieten,
ohne dabei den Jugendschutz zu berücksichtigen.
Alle diese Dinge brauchen eine Einordnung und eine wirksame Zugriffsbeschränkung,
sonst Klage und, schlimmer, schlechte Presse.&lt;/p&gt;
&lt;h1 id=&#34;pre-internet-jugendschutz&#34;&gt;
    &lt;a href=&#34;#pre-internet-jugendschutz&#34;&gt;
	Pre-Internet Jugendschutz
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Das hat in der Vergangenheit bis in die späten 90er Jahre wunderbar funktioniert.
Hauptsächlich deswegen, weil es keine kostenlosen und damit unfinanzierten Veröffentlichungen gab.
Und weil deswegen Veröffentlichung stark ge-gateway-ed war –
man konnte kein Buch, kein Spiel und schon gar kein Hörspiel oder keinen Film machen und dann verbreiten,
ohne durch einen Mediator zu gehen.
Also einen Verlag, eine Rundfunkanstalt oder einen anderen Vertriebs- und Verbreitungspartner,
der dabei dann auch massenhaft redaktionelle Bearbeitung betrieben hat,
und natürlich dabei auch die Formalien wie Anmeldungen bei Verwertungsgesellschaften oder Bewertung durch den Jugendschutz vorgenommen hat.&lt;/p&gt;
&lt;p&gt;Weil Inhalte grundsätzlich nie kostenlos waren, hat das nicht nur die Verfügbarkeit von Inhalten eingeschränkt,
sondern auch diese Formalien mit finanziert.
Auch wichtig: Es hat die Anzahl der Stellen reduziert, mit denen die staatlichen Stellen und ihre Organe zu tun hatten,
und durch die Pflicht zur kommerziellen Viabilität wurde auch eine Vorauswahl getroffen.&lt;/p&gt;
&lt;p&gt;Seit den späten 90er Jahren haben wir mediatorfreie Kommunikation.
Jeder Mensch kann mit genau gar keinem Aufwand Medien produzieren und publizieren.
Das kann durch Editieren eines existierenden Wikis passieren – das hat Brockhaus das Genick gebrochen.&lt;/p&gt;
&lt;p&gt;Es kann auch durch das Betreiben und Veröffentlichen eines Blogs, durch das Schreiben von Posts und Threads in Social Media,
durch das Aufnehmen und Verbreiten von Podcasts über diese Blogs,
oder halt durch das Produzieren von Filmen mit massiv verbilligten Produktionsmitteln geschehen.
Das letztere hat zum Beispiel zu &amp;ldquo;In the Pirkinning&amp;rdquo; und zu &amp;ldquo;Prelude to Axanar&amp;rdquo; geführt hat,
und dann zu entsprechenden rechtlichen Reaktionen von Rechte-Inhabern.&lt;/p&gt;
&lt;h1 id=&#34;drei-gründe-für-das-zusammenbrechen-des-jugendschutzes-im-internet&#34;&gt;
    &lt;a href=&#34;#drei-gr%c3%bcnde-f%c3%bcr-das-zusammenbrechen-des-jugendschutzes-im-internet&#34;&gt;
	Drei Gründe für das Zusammenbrechen des Jugendschutzes im Internet
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Es führt auch zu einem Zusammenbruch der deutschen Idee von Jugendschutz.
Das deutsche Jugendschutz-Konstrukt ist überhaupt nicht darauf eingerichtet,
mit mediatorfreier, massenhafter und weltweiter Generierung von Content klarzukommen.
Das sind drei unabhängige Probleme, die alle auch einzeln zum Zusammenbruch führen.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Mediatorfrei&lt;/strong&gt; heißt, daß kein Verlag oder Aggregator zwingend involviert ist.
Ich habe einen Inhalt, ich stelle den irgendwo hin und Du kannst den finden, herunterladen und konsumieren.
Die Idee von JusProg und anderen Filterprogrammen ist immer das Konzept eines installierbaren Zwangs-Mediators,
dem Filter, der den direkten Zugriff auf bestimmte Inhalte verhindert.
Das setzt bestimmte Dinge voraus, wir werden da gleich noch drauf eingehen.&lt;/p&gt;
&lt;p&gt;Und &lt;strong&gt;massenhaft&lt;/strong&gt; heißt, daß es keine Vorauswahl gibt.
Nicht durch einen Mediator, etwa einen Verlag mit einem Editor, der das gut finden muss, was Du publizieren willst.
Aber auch nicht finanziell – die Grundkosten sind so niedrig, daß effektiv jede Person alles publizieren kann,
was diese Person publizieren möchte.
Und auch nicht durch eine Lizenz – man muss im Internet nicht wie beim deutschen BTX der späten 80er Jahre
als Anbieter statt Nutzer registrieren lassen, damit man Dinge schreiben darf und mehr tun kann als konsumieren.&lt;/p&gt;
&lt;p&gt;Massenhaft hat zur Folge, dass die Anzahl und Menge der produzieren Medien die Bewertungskapazität der zur Verfügung stehenden qualifizierten Bewerter massiv übersteigt.
Damit ist nicht nur keine Diskussion über individuelle Bewertungen mehr möglich,
sondern Bewertungen müssen schematisch nach Syntax, nicht Semantik erfolgen.
Sie können nicht einmal mehr stichprobenhaft auf Korrektheit kontrolliert werden.&lt;/p&gt;
&lt;p&gt;Und &lt;strong&gt;weltweit&lt;/strong&gt; heißt, daß sowohl Inhalte als auch ihre Klassifizierung die Grenzen eines homogenen Kulturraumes weit überschreiten.
Eine sinnvolle Einigung über Klassifikationen ist nicht mehr möglich.
Teilweise ist nicht einmal eine Unterhaltung über Dimensionen und Skalen einer Klassifikation möglich.&lt;/p&gt;
&lt;p&gt;Schon innerhalb Deutschlands sind die Maßstäbe der Inhaltsbewertung traditionell massiv uneinheitlich.
Der bayrische Rundfunk hat zum Beispiel die Ausstrahlung bestimmter Folgen &amp;ldquo;Scheibenwischer&amp;rdquo; verweigert,
und sich aus dem Netz der ARD verabschiedet.
Auch die inzwischen eingestellte Sendung &amp;ldquo;Sesamstraße&amp;rdquo; war in Bayern nicht verfügbar.&lt;/p&gt;
&lt;p&gt;Wenn es um Inhalte im Internet geht, ist aber republikweit entlang bestimmter politischer Bruchlinien schon lange massiv keine sinnvolle Einigung möglich.
Weltweit noch viel weniger.
Man stelle sich ein Inhaltsbewertungssystem vor, das sowohl für Schweden, Spanien, Saudi-Arabien, die USA und Thailand funktioniert.&lt;/p&gt;
&lt;p&gt;Jede Form von inhaltlicher Bewertung kann sich also nur an objektiven Kriterien orientieren:
&amp;ldquo;Nippel sichtbar&amp;rdquo;, &amp;ldquo;Messer, Gewalt, Blut sichtbar&amp;rdquo;, oder halt der berühmte &amp;ldquo;körperbezogene Penisneigungswinkel&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;In einem solchen System ist das Foto eines durchschnittlichen Gummifetischisten dann halt unkritisch, weil
keine Haut sichtbar ist (keine Nacktheit), die Pose nicht sexuell suggestiv ist (kein Sex),
keine Gewalt zu sehen ist (keine Gewalt) und auch keine unangemessene Sprache verwendet wird (keine Flüche oder verbotene Worte).
Zugleich werden ein Haufen Stakeholder protestieren und dieses Bild irgendwie klassifiziert sehen wollen.&lt;/p&gt;
&lt;h1 id=&#34;jugendschutz-ist-nicht-systematisch-objektivierbar-und-automatisierbar&#34;&gt;
    &lt;a href=&#34;#jugendschutz-ist-nicht-systematisch-objektivierbar-und-automatisierbar&#34;&gt;
	Jugendschutz ist nicht systematisch objektivierbar und automatisierbar
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Es geht darum, welche Inhalte unserem Nachwuchs wie und mit welcher Bewertung präsentiert werden,
denn das ist, was Erziehung ist – die Vermittlung von Werten.
Daher ist jede Bewertung, die sich an Syntax (objektiv sichtbaren Merkmalen) orientiert zum Scheitern verurteilt.&lt;/p&gt;
&lt;p&gt;Und in dem Moment, wo Jugendschutz automatisierbar ist, haben wir eine Maschine gebaut,
die erfolgreich eine bestimmte moralische Bewertung in irgendeinem bestimmten moralischen System vornehmen kann,
also unseren Nachfolger als Menschheit geschaffen.
Wir können von der Bühne des Universums abtreten und denen die Realität überlassen.&lt;/p&gt;
&lt;p&gt;Mögen sie erfolgreicher und anpassungsfähiger sein als wir.&lt;/p&gt;
&lt;p&gt;Das ist natürlich keine Einsicht oder Position, die ein Politiker in einem öffentlichen Diskurs einnehmen kann,
also sehen wir seit wortwörtlich 30 Jahren denselben dysfunktionalen Kram ohne einen Millimeter Fortschritt in irgendeiner Richtung.&lt;/p&gt;
&lt;h1 id=&#34;der-default-ist-ab-18&#34;&gt;
    &lt;a href=&#34;#der-default-ist-ab-18&#34;&gt;
	Der Default ist &amp;ldquo;ab 18&amp;rdquo;
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Wie dem auch sei – rein rechtlich ist es so, daß jeder Inhalt in jedem Medium, das für Deutsche erreichbar ist,
eine Bewertung haben muss oder eine Ausnahmeregelung greifen muss (etwa für Nachrichten).
Das führt nicht nur zu Youtube-Kanälen, in denen Damen mit freiem Oberkörper Nachrichten verlesen,
sondern auch dazu, daß mir eine DVD mit einer Aufnahme der Zauberflöte nur gegen Vorlage des Personalausweises ausgehändigt wurde,
weil sie bei Amazon ohne Jugendschutz-Klassifikation hinterlegt war – der Default für alle Inhalte ist immer &amp;ldquo;ab 18&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Inhalte brauchen also zwingend eine Klassifikation,
damit sie für Jugendliche hinter einem echten oder hypothetisch installierten Filter überhaupt sichtbar werden.
Diese Klassifikation kann durch den Anbieter selbst erfolgen – das ist diese &amp;ldquo;age.xml&amp;rdquo;-Datei, von der Lilith Wittmann redet.
Oder halt durch Dritte, und da kaum jemand eine solche &amp;ldquo;age.xml&amp;rdquo;-Datei mit Selbstbewertung erzeugt,
generiert JusProg als Dritter diese Bewertung.&lt;/p&gt;
&lt;p&gt;Das machte vor dem Internet total Sinn:
Da alle Inhalte kommerziell waren, waren Anbieter von Inhalten und ihre Mediatoren daran interessiert, Inhalte bewertet zu sehen
und dabei die Bewertung auch so niedrig wie möglich anzusetzen, damit die Inhalte so vielen Menschen als möglich zugänglich werden.&lt;/p&gt;
&lt;p&gt;Im Internet ist das nicht so:
Ich habe gar kein Interesse daran, daß meine kostenlosen Inhalte so vielen Menschen wie möglich zugänglich werden,
sondern sie sollen &lt;em&gt;den richtigen&lt;/em&gt; Menschen zugänglich sein.
Mein Markt und meine Reichweite sind so groß, daß alles andere sogar ein Problem wäre
und für mich selbst zu Skalierbarkeitsproblemen führen würde.
Ich würde in für meine Mission nicht relevanten Interaktionen mit unwichtigen Menschen ertrinken.&lt;/p&gt;
&lt;p&gt;Damit ist die Motivationsgrundlage entfallen, die das deutsche Jugendschutzsystem vor dem Internet am Laufen gehalten hat.&lt;/p&gt;
&lt;h1 id=&#34;aber-wir-brauchen-bewertungen--für-unsere-sites&#34;&gt;
    &lt;a href=&#34;#aber-wir-brauchen-bewertungen--f%c3%bcr-unsere-sites&#34;&gt;
	Aber wir brauchen Bewertungen – für unsere Sites
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Die Mitglieder von JusProg e.V. sind traditionelle Medienanbieter.
Lilith Wittmann nennt Mitglieder und stellt die Motivation klar:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;[JusProg eV] wurde mit dem Ziel gegründet, eine solche Software bereitzustellen.
Seine Mitglieder sind große deutsche Digitalunternehmen wie z.B. Vodafone oder RTL.
Die finanzieren das gerne.
Denn solange es ein anerkanntes Jugendschutzprogramm gibt, können sie eben auf viele andere Jugendschutzmaßnahmen verzichten.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Die Mission ist also, die Inhalte der Mitglieder kostengünstig aus dem Schußfeld des Jugendschutzgesetzes herauszuholen,
nicht effektiven Jugendschutz zu leisten.
Das wäre auch, wie oben gezeigt, systematisch sehr schwierig, wenn nicht unmöglich.&lt;/p&gt;
&lt;p&gt;Damit das eine glaubhafte Wirksamkeitsfiktion erzeugt, müssen nicht nur die Webseiten der Mitglieder eine Bewertung erhalten.
Sondern alle.
Das erfolgt&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;geheim&lt;/strong&gt;, die Liste der Bewertungen ist nicht öffentlich, und die Kriterien sind es auch nicht.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ohne Benachrichtigung&lt;/strong&gt; der Bewerteten.
Deine Website ist durch JusProg bewertet, aber Du weißt es nicht.
Für eine solche Benachrichtigung müßte man Ansprechpartner und Kommunikationswege identifizieren können,
das ist aber nicht einheitlich automatisierbar.
Und wäre es das, dann hat man die Benachrichtigten am Hacken, die mit einem über die Bewertung diskutieren wollen,
was Zeit und Geld kostet und nicht skalierbar ist.&lt;/li&gt;
&lt;li&gt;und damit systematisch folgefalsch mit den beobachteten Problemen,
auf der Grundlage intransparenter syntaktischer Kriterien, und eventuell auch mit einer nicht offengelegten politischen Agenda.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Das ist natürlich nicht nur kein Jugendschutz, sondern auch Demokratiegift,
weil nun auf die gesamte Bevölkerung ein Zwangsmediator ausgerollt wird,
dem man sich nicht entziehen kann (darf),
weil man ja ein Jugendlicher sein könnte.
Und weil es Inhalte gibt, die nach JSchG nicht einmal Erwachsenen zugänglich gemacht werden dürfen.&lt;/p&gt;
&lt;p&gt;Daher wäre es im Grunde ideal, die zwar grundgesetzlich vorgeschriebene Idee des Jugendschutzes im Internet als zu Recht gescheitert anzusehen.
JusProg wäre dann ein Feigenblatt,
mit dem kommerzielle Medienanbieter sich durch Generierung und Installation einer &amp;ldquo;age.xml&amp;rdquo;-Datei haftungsrechtlich freikaufen können,
und dann installiert einfach niemand JusProg.&lt;/p&gt;
&lt;p&gt;So ist es aber nicht.
Dieser Status Quo ist einmal durch Installation von JusProg in öffentlichen Netzen eingerissen worden,
wie Lilith Wittmann korrekt anmerkt.&lt;/p&gt;
&lt;p&gt;Zum anderen ist da der feuchte Traum, jeden Internetbenutzer mit einem elektronischen Ausweisdokument jederzeit identifizieren zu können,
der gerade in der EU in eIDAS, Verimi und vielen anderen Dingen wieder auflebt.
Dabei kommen die Interessen
von &amp;ldquo;Bedarfsträgern&amp;rdquo;,
die Interessen von Leuten mit politischem Filterwillen,
der &amp;ldquo;Jugendschutz&amp;rdquo; als Legitimierungsfeigenblatt,
und die kommerziellen Interessen der Werbeindustrie zusammen, die Identität als staatlich zwangsverordneten Supercookie mitnutzen will.&lt;/p&gt;
&lt;p&gt;Das darf so nicht passieren.
Daher muss nicht nur JusProg sterben.
Aber es ist nur ein Baustein in einer Entwicklung, die fraktal falsch ist.&lt;/p&gt;
&lt;p&gt;Das ist der Grund, warum Lilith da überall drauf haut.
Und darum sollten wir ihr alle auf jede denkbare Art Beistand leisten.
Gerade jetzt, wo um uns herum eine politische Ideologie auflebt, die nur darauf wartet, solche Mechanismen auf tödliche Weise zu missbrauchen.&lt;/p&gt;
&lt;h1 id=&#34;siehe-auch&#34;&gt;
    &lt;a href=&#34;#siehe-auch&#34;&gt;
	Siehe auch
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Seit 27 Jahren kein Fortschritt im Diskurs:
&lt;a href=&#34;https://blog.koehntopp.info/1997/05/14/sperrungen-im-internet.html&#34;&gt;Sperrungen im Internet&lt;/a&gt;

&lt;/p&gt;
&lt;p&gt;Seit 15 Jahren kein Fortschritt im Diskurs:
&lt;a href=&#34;https://blog.koehntopp.info/2009/08/06/jugendschutzfilter-saugen-und-daf-r-gibt-es-einen-grund.html&#34;&gt;Jugendschutzfilter saugen und dafür gibt es einen Grund&lt;/a&gt;

 –
Warum wir nicht einfach alles &amp;ldquo;ab 18&amp;rdquo; machen können und warum damit ein Haufen Leuten mit unproblematischen Inhalten notlos Arbeit aufgebürdet wird.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Deploying websites - an escalation</title>
      <link>https://blog.koehntopp.info/2024/01/09/deploying-websites.html</link>
      <pubDate>Tue, 09 Jan 2024 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2024/01/09/deploying-websites.html</guid>
      <description>&lt;p&gt;We are still playing minecraft.
This time it is a highly modded Fabric server, which requires more memory than the old box had.
The new box has 12 cores, 128 GB of memory, and two nice SSD.
It is pretty nifty.&lt;/p&gt;
&lt;h1 id=&#34;a-simple-problem-easily-solved-by-ansible&#34;&gt;
    &lt;a href=&#34;#a-simple-problem-easily-solved-by-ansible&#34;&gt;
	A simple problem, easily solved by Ansible.
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The machine also needs some kind of webserver to run websites.
An easy problem to solve, naturally.&lt;/p&gt;
&lt;p&gt;A bit of Ansible, deploy a few config files into the system and be done with it.&lt;/p&gt;
&lt;p&gt;Only, these are different types of websites, and over time additional sites are being added.
When a new website is being added, we need to collect all website names
and generate an
&lt;a href=&#34;https://httpd.apache.org/docs/2.4/mod/mod_md.html#mdomain&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;MDomain&lt;/code&gt;&lt;/a&gt;


statement in the config for Apache&amp;rsquo;s
&lt;a href=&#34;https://httpd.apache.org/docs/2.4/mod/mod_md.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;mod_md&lt;/code&gt;&lt;/a&gt;

.
This module will then automatically request the necessary certificates for the webserver&amp;rsquo;s TLS.&lt;/p&gt;
&lt;p&gt;Collecting all domain names from the configuration files can be done in Ansible, but it kind of hurts.
Ansible works best when you run it to deploy a few templated config files, and then have services doing the actual work.&lt;/p&gt;
&lt;p&gt;It is also more complicated than this, because we have different types of websites.
Initially we had only&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;static sites&lt;/code&gt; (&lt;code&gt;https://example.com&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;We also needed &lt;code&gt;redirect_sites&lt;/code&gt; (&lt;code&gt;https://www.example.com&lt;/code&gt; -&amp;gt; &lt;code&gt;https://example.com&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;We also needed reverse proxies for applications (&lt;code&gt;https://grafana.example.com&lt;/code&gt; -&amp;gt; &lt;code&gt;https://localhost:3000&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;We also need a Discord bot.&lt;/li&gt;
&lt;li&gt;Then we also needed the &lt;code&gt;wsgi_site&lt;/code&gt; deployed.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;But a &lt;code&gt;wsgi_site&lt;/code&gt; needs to be redeployed when the code has changed on GitHub.
Also, initial deployment of a &lt;code&gt;wsgi_site&lt;/code&gt; needs to create a user,
and initial checkout of the code into the users home,
and installation of the requirements.&lt;/p&gt;
&lt;p&gt;After a code update, the server needs to be restarted.&lt;/p&gt;
&lt;h1 id=&#34;this-actually-needs-a-shell-script&#34;&gt;
    &lt;a href=&#34;#this-actually-needs-a-shell-script&#34;&gt;
	This actually needs a shell script
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Okay, let&amp;rsquo;s not do this in Ansible.
Let&amp;rsquo;s write a simple and easy shell script for this.&lt;/p&gt;
&lt;p&gt;That kind of worked, initially, but quickly fell apart when the number of variants grew,
also error checking became complicated.&lt;/p&gt;
&lt;p&gt;Ultimately, it broke when we needed to collect and store per-site config parameters as a JSON, and act on it.
The moment you write shell functions with parameters, traps and other bells and whistles,
it is time to cut your losses and start over differently.
In this case, in Python.&lt;/p&gt;
&lt;h1 id=&#34;enter-deploy-a-python-cli-application&#34;&gt;
    &lt;a href=&#34;#enter-deploy-a-python-cli-application&#34;&gt;
	Enter &lt;code&gt;deploy&lt;/code&gt;, a Python CLI application
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;In the current intermediate stage, this is a Python script of 32 KB and around 1000 lines.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@bigbox ~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# wc -l Source/deploy/deploy &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;951&lt;/span&gt; Source/deploy/deploy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;and&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;root@bigbox ~&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;#  ls -l Source/deploy/deploy&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;-rwxr-xr-x. &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; root root &lt;span class=&#34;m&#34;&gt;31428&lt;/span&gt; Jan  &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; 18:42 Source/deploy/deploy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;It understands the five types of server outlined above, and can handle a number of different operations for them.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;create&lt;/code&gt; makes a new server-config.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;delete&lt;/code&gt; throws it away.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We store them in a central directory, &lt;code&gt;/etc/projects&lt;/code&gt;, as JSON files.
For each site type, we accept a number of parameters:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;--type&lt;/code&gt;, the five types above.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--username&lt;/code&gt;, a Unix User we create for the site.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--github&lt;/code&gt; The source code repository URL.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--hostname&lt;/code&gt; If necessary, this is inferred from the username and the default domain.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--projectdir&lt;/code&gt; Only necessary for anomalously structured Python code.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--to_host&lt;/code&gt; Only for redirects.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;--port&lt;/code&gt; Only for proxies.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We now can do&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# deploy show projects&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- grafana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- learn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# deploy show grafana&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*** PROJECT /etc/projects/grafana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- github    : None
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- hostname  : grafana.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- port      : &lt;span class=&#34;m&#34;&gt;3000&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- project   : grafana
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt;      : proxy
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;The &lt;code&gt;deploy create --type proxy --hostname grafana.example.com --port 3000&lt;/code&gt; has created an apache configuration,
built the TLS configuration and restarted the &lt;code&gt;httpd.service&lt;/code&gt; to update things.&lt;/p&gt;
&lt;p&gt;We can also do more complicated things:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# deploy create --type wsgi_site --user learn --github ... learn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;... creates /etc/project/learn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# deploy show learn&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;*** PROJECT /etc/projects/learn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- github    : git@github.com:.../learn.git
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- home      : /home/learn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- hostname  : learn.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- project   : learn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- projectdir: learn
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- pubkey    : ssh-rsa AAAAB3...cfudtTQ&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt; root@bigbox
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- &lt;span class=&#34;nb&#34;&gt;type&lt;/span&gt;      : wsgi_site
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;- username  : learn
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This will create a Linux user, set up a checkout of the GitHub, install requirements, set up a WSGI Apache configuration,
configure TLS, and restart the server as needed.&lt;/p&gt;
&lt;p&gt;We can now &lt;code&gt;deploy update learn&lt;/code&gt; or &lt;code&gt;deploy restart learn&lt;/code&gt; to check out a new version and restart the server,
and we can also &lt;code&gt;deploy logs learn&lt;/code&gt; to tail the server logs for this site.&lt;/p&gt;
&lt;h1 id=&#34;it-is-still-ugly&#34;&gt;
    &lt;a href=&#34;#it-is-still-ugly&#34;&gt;
	It is still ugly
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Because this started out as a shell script, it still is ugly.
There are multiple levels of giant case-branches in this.
To become a proper solution, it needs a cleaner structure, in a more object-oriented fashion.&lt;/p&gt;
&lt;p&gt;But already it works better than the shell script it initially was,
has better error handling and can handle borderline cases more safely.&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/isotopp/deploy&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Github&lt;/a&gt;

.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Restic</title>
      <link>https://blog.koehntopp.info/2023/12/30/restic.html</link>
      <pubDate>Sat, 30 Dec 2023 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2023/12/30/restic.html</guid>
      <description>&lt;p&gt;Ich hatte Grund, mich mit &lt;a href=&#34;&#34;&gt;Restic&lt;/a&gt;

 für Backup auseinander zu setzen.&lt;/p&gt;
&lt;h1 id=&#34;warum-restic&#34;&gt;
    &lt;a href=&#34;#warum-restic&#34;&gt;
	Warum &lt;code&gt;restic&lt;/code&gt;?
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;&lt;code&gt;restic&lt;/code&gt; ist eine Datensicherung in ein Repository,
das intern als ein Content-Addressable Storage aufgebaut ist.
Das heißt, daß innerhalb des Backups Datenstücke liegen,
die genau ihre (SHA256-) Prüfsumme als Dateinamen haben.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;root@server:/backup/restic/data/fc# sha256sum fcec*7a5b
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;fcec25d3e3165d159b4dac3867d1a1831707d582215c1fa30e0277cd57dc7a5b  fcec25d3e3165d159b4dac3867d1a1831707d582215c1fa30e0277cd57dc7a5b
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Die Prüfsumme einer Datei im &lt;code&gt;data&lt;/code&gt;-Verzeichnis eines &lt;code&gt;restic&lt;/code&gt;-Repos.
Sie entspricht genau dem Namen der Datei.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Dies führt zu einer Datenstruktur in &lt;code&gt;restic&lt;/code&gt;, die nicht ganz unähnlich der in einem
&lt;code&gt;.git&lt;/code&gt;-Repository ist, und auch zu einer starken Deduplizierung von Daten.
Dateien, die in mehr als einer Generation des Backups unverändert vorkommen,
werden automatisch erkannt und nicht mehrfach gespeichert.
Stattdessen wird nur ein Reference-Count erhöht.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;restic&lt;/code&gt; verschlüsselt Daten, Metadaten und Dateinamen genau wie Datei-Inhalte,
prüft die Integrität des Backups über diese Content-Prüfsummen und
stellt die Sicherung über mehrere Such- und Zugriffsmöglichkeiten zur Verfügung.&lt;/p&gt;
&lt;p&gt;Man kann sich &lt;code&gt;restic&lt;/code&gt; wie Apple Time Machine vorstellen:
Stündliche Backups, die in wenigen Sekunden durchlaufen,
und die immer ein komplettes Image produzieren,
auch wenn sie nur inkrementell Platz und Zeit verbrauchen.
Anders als Time Machine (oder ZFS Snapshots) ist die Lösung jedoch
unabhängig vom verwendeten Dateisystem, und unterstützt ein breites Angebot
von Backend-Storages.&lt;/p&gt;
&lt;h1 id=&#34;situation&#34;&gt;
    &lt;a href=&#34;#situation&#34;&gt;
	Situation
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Der neue Dedi ist ein E5-1650 v3 mit 12 Threads und 128 GB RAM bei Hetzner.
Er führt stündlich ein &lt;code&gt;restic&lt;/code&gt; auf die Hetzner Storagebox durch,
und weiterhin einmal täglich ein &lt;code&gt;restic&lt;/code&gt; nach Hause aus.&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-cronexp&#34; data-lang=&#34;cronexp&#34;&gt;10 * * * * /root/bin/run-restic
34 1 * * * /root/bin/run-restic-to-home
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;em&gt;Crontab mit den Backup-Jobs.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Zu sichern ist ein LVM2 mit einem recht kleinen &lt;code&gt;/var/www&lt;/code&gt;, &lt;code&gt;/etc&lt;/code&gt; und der Kram auf &lt;code&gt;/home&lt;/code&gt;, der zum Glück noch überschaubar groß ist.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# df -t xfs -h&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Filesystem              Size  Used Avail Use% Mounted on
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/dev/mapper/vg0-root     20G  4.0G   17G  20% /
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/dev/mapper/vg0-home    200G   40G  160G  20% /home
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Situation mit den Dateisystemen auf dem Dedi.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Real erfolgen faktisch alle Änderungen am Content immer unter Usern in &lt;code&gt;/home&lt;/code&gt;,
sodaß vor allen Dingen die Sicherung dieser Partition dringend ist.
Speziell der Minecraft-Spieluser hat eine Menge Churn,
weil dort im Home alle Server-Instanzen liegen, auf denen gearbeitet wird.&lt;/p&gt;
&lt;p&gt;Die lokale Sicherung erfolgt mit einem sftp-Backend auf die Hetzner Storagebox,
das Backup nach Hause verwendet ebenfalls das sftp-Backend.&lt;/p&gt;
&lt;h1 id=&#34;sshconfig&#34;&gt;
    &lt;a href=&#34;#sshconfig&#34;&gt;
	.ssh/config
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Damit alles nicht so weh tut, verwenden wir einen speziellen Backup-Key,
der nur zur Datensicherung verwendet wird, und der nur die Funktion hat,
ein paßwortloses Login auf den Backup-Zielen zu erlauben.&lt;/p&gt;
&lt;p&gt;Wir generieren den Key mit&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ssh-keygen -t rsa -b 4096 -N &amp;#34;&amp;#34; -f ~/.ssh/id_backup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;und konfigurieren ihn gleich in zwei &lt;code&gt;Host&lt;/code&gt;-Matchblocks rein:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# cat .ssh/config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ServerAliveInterval &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ServerAliveCountMax &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;HashKnownHosts no
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;TCPKeepAlive yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;KeepAlive yes
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Host storagebox
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Hostname uxxxxxx.your-storagebox.de
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        User uxxxxxx
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Port &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        IdentityFile /root/.ssh/id_backup
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Host restic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Hostname home.example.com
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        User resticuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Port &lt;span class=&#34;m&#34;&gt;22&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        IdentityFile /root/.ssh/id_backup
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dadurch können wir die Backup-Ziele korrekt vorkonfiguriert
über den Namen des Matchblocks ansprechen, also mit &lt;code&gt;storagebox&lt;/code&gt; und &lt;code&gt;restic&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Den Key müssen wir nun auch in der &lt;code&gt;authorized_keys&lt;/code&gt; der Ziele hinterlegen.
Das geht genauso wie von
&lt;a href=&#34;https://docs.hetzner.com/robot/storage-box/backup-space-ssh-keys/#upload&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Hetzner dokumentiert&lt;/a&gt;

.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# cat .ssh/id_backup.pub | ssh -p23 uXXXXX@uXXXXX.your-storagebox.de install-ssh-key&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;uXXXXX@uXXXXX.your-storagebox.de&lt;span class=&#34;err&#34;&gt;&amp;#39;&lt;/span&gt;s password:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Test mit &lt;code&gt;ssh -p23 -i ~/.ssh/id_backup uXXXXX@uXXXXX.your-storagebox.de&#39;s password&lt;/code&gt;.
Man landet in der restricted Shell der Storagebox,
und kann zum Beispiel mit &lt;code&gt;help&lt;/code&gt; eine Kommandoliste bekommen.&lt;/p&gt;
&lt;h1 id=&#34;restic-handhaben&#34;&gt;
    &lt;a href=&#34;#restic-handhaben&#34;&gt;
	Restic handhaben
    &lt;/a&gt;
&lt;/h1&gt;
&lt;h2 id=&#34;restic-initialisieren&#34;&gt;
    &lt;a href=&#34;#restic-initialisieren&#34;&gt;
	Restic initialisieren
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Damit &lt;code&gt;restic&lt;/code&gt; Dinge tun kann, muss man das Repository, in dem die Backups landen,
erst einmalig initialisieren.
Dabei wird auch ein Verschlüsselungspaßwort festgelegt, das nicht verloren gehen darf.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# restic -r sftp://storagebox/restic init&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;enter password &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; new repository:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;enter password again:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;created restic repository 1c28ea9e7b at /restic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Please note that knowledge of your password is required to access
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;the repository. Losing your password means that your data is
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;irrecoverably lost.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Dies erzeugt eine Verzeichnishierarchie in &lt;code&gt;/restic&lt;/code&gt; auf der Storagebox.&lt;/p&gt;
&lt;h2 id=&#34;restic-ausführen&#34;&gt;
    &lt;a href=&#34;#restic-ausf%c3%bchren&#34;&gt;
	Restic ausführen
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Das Backup-Script kann nun ausgeführt werden.
Man kann dies zu Fuß tun, wie ich hier, oder
&lt;a href=&#34;https://github.com/creativeprojects/resticprofile&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;resticprofile&lt;/a&gt;


bemühen.&lt;/p&gt;
&lt;p&gt;Ich sichere tatsächlich nicht &lt;code&gt;/home&lt;/code&gt;, sondern erzeuge einen LVM2-Snapshot,
von dem die Sicherung durchgeführt wird, bevor er released wird.&lt;/p&gt;
&lt;p&gt;Dadurch ist &lt;code&gt;/home&lt;/code&gt; unveränderlich während der Sicherung,
und die Konsistenz des Backups ist besser.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;#!/usr/bin/bash
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;cp&#34;&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Some basic config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;SNAPLV&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;snap
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nv&#34;&gt;SNAPMOUNT&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/snapshot-of-home
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RESTIC_REPOSITORY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sftp://storagebox/restic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RESTIC_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;secret_password
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# only use up to 4 cpus.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Make this safe to run in a crontab&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; -e
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; -o pipefail
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PATH&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;/root/.local/bin:/root/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /root
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Show free space&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ssh -p &lt;span class=&#34;m&#34;&gt;23&lt;/span&gt; -i /root/.ssh/id_backup storagebox df -m
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Delete old backups&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;restic forget &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --keep-daily &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --keep-monthly &lt;span class=&#34;m&#34;&gt;12&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --keep-within 2d &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --keep-tag keep &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --prune
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# Actually perform a backup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 1. Snapshot and mount it&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lvcreate -s -n &lt;span class=&#34;nv&#34;&gt;$SNAPLV&lt;/span&gt; -L10G /dev/vg0/home
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;mount -t xfs -o nouuid /dev/vg0/&lt;span class=&#34;nv&#34;&gt;$SNAPLV&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$SNAPMOUNT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 2. Actual backup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;restic backup &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --json &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --exclude-caches &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --iexclude-file /root/bin/restic-excludes &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  &lt;span class=&#34;nv&#34;&gt;$SNAPMOUNT&lt;/span&gt; /var/www /etc /root &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;jq &lt;span class=&#34;s1&#34;&gt;&amp;#39;. | select(.message_type == &amp;#34;summary&amp;#34; )&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 3. Get rid of the snapshot&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;umount &lt;span class=&#34;nv&#34;&gt;$SNAPMOUNT&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;lvremove -f /dev/vg0/&lt;span class=&#34;nv&#34;&gt;$SNAPLV&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Alle &lt;code&gt;restic&lt;/code&gt;-Subkommandos haben die Option &lt;code&gt;--json&lt;/code&gt; auszugeben, was man dann
mit
&lt;a href=&#34;https://github.com/tomnomnom/gron&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;gron&lt;/code&gt;&lt;/a&gt;


oder
&lt;a href=&#34;https://github.com/jqlang/jq&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;jq&lt;/code&gt;&lt;/a&gt;


konsumieren kann.&lt;/p&gt;
&lt;p&gt;In diesem Script erzeugen wir mit &lt;code&gt;lvcreate -s&lt;/code&gt; einen Snapshot der &lt;code&gt;/home&lt;/code&gt;-Partition.
Dieser wird dann in &lt;code&gt;/snapshot-of-home&lt;/code&gt; gemounted.
Weil ich xfs verwendet und das versehentliches doppeltes Mounten eines Verzeichnisses verhindert,
muss ich dies mit der Option &lt;code&gt;nouuid&lt;/code&gt; tun.&lt;/p&gt;
&lt;p&gt;Ich kann jetzt das &lt;code&gt;restic backup&lt;/code&gt;-Kommando laufen lassen.
Dies erfolgt unter anderem mit der Option &lt;code&gt;--json&lt;/code&gt; und wir fischen den &lt;code&gt;summary&lt;/code&gt;-Block am Ende raus,
ohne die Progress Reports weiter zu beachten.&lt;/p&gt;
&lt;p&gt;Die Option &lt;code&gt;--exclude-caches&lt;/code&gt; tut genau das:
&lt;a href=&#34;https://bford.info/cachedir/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CACHEDIR.TAG&lt;/a&gt;

 Verzeichnisse ignorieren.
Außerdem werden die Patterns in einer Exclude-Datei mit &lt;code&gt;--iexclude-file&lt;/code&gt; ebenfalls ignoriert.
Das Prefix &lt;code&gt;i&lt;/code&gt; steht hier für &lt;code&gt;ignore-case&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Am Ende melden wir den Snapshot wieder ab, und schmeißen ihn weg.&lt;/p&gt;
&lt;h2 id=&#34;garbage-collection&#34;&gt;
    &lt;a href=&#34;#garbage-collection&#34;&gt;
	Garbage Collection
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Am Anfang des Scripts wird einmal
&lt;code&gt;restic forget --prune&lt;/code&gt;
bemüht.
Dies sind die Regeln, nach denen alte Backups verworfen werden:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Wir heben alle Backups 2 Tage auf.&lt;/li&gt;
&lt;li&gt;Wir heben alle Backups mit dem Tag &lt;code&gt;keep&lt;/code&gt; unbegrenzt auf.&lt;/li&gt;
&lt;li&gt;Wir heben 30 Tage lang das neuste Backup jeden Tages auf.&lt;/li&gt;
&lt;li&gt;Wir heben 12 Monate lang das neuste Backup jeden Monats auf.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Auf diese Weise haben wir bis zu einem Jahr Historie.
Dabei ist noch einmal in Erinnerung zu rufen, daß Dinge, die sich nicht ändern,
nur einmal gespeichert werden, weil &lt;code&gt;restic&lt;/code&gt; dedupliziert.&lt;/p&gt;
&lt;p&gt;Die Deduplizierung ist sehr effektiv:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# restic stats&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;enter password &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; repository:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;repository 3d26efdc opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;version 2, compression level auto&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:00&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; index files loaded
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;scanning...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Stats in restore-size mode:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;     Snapshots processed:  &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;        Total File Count:  &lt;span class=&#34;m&#34;&gt;2431309&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;              Total Size:  1.827 TiB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# df -Th /restic/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Filesystem             Type  Size  Used Avail Use% Mounted on
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/dev/mapper/vg0-restic xfs   250G   57G  194G  23% /restic
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;1.8 TB Daten werden von 57 GB Plattenplatz repräsentiert.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Das &lt;code&gt;--prune&lt;/code&gt; nach dem Forget gibt Plattenplatz wieder frei.
Dabei kann es vorkommen, daß&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Der Linkcount einer Datei erniedrigt wird, sonst nichts.&lt;/li&gt;
&lt;li&gt;Daten frei markiert werden, aber als ungenutzter Datei in einem 16 MB &amp;ldquo;Pack&amp;rdquo; rumstehen.&lt;/li&gt;
&lt;li&gt;Der freie Platz im &amp;ldquo;Pack&amp;rdquo; so groß wird, daß das Pack neu geschrieben wird.&lt;/li&gt;
&lt;li&gt;Das Pack komplett frei wird und gelöscht werden kann.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;remove &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; snapshots:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ID        Time                 Host        Tags        Paths
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;dac0526f  2023-12-27 13:10:01  bigbox                  /etc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                       /snapshot-of-home
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                       /var/www
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; snapshots
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:00&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; files deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; snapshots have been removed, running prune
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;loading indexes...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;loading all snapshots...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;finding data that is still in use &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; snapshots
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:02&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; snapshots
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;searching used packs...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;collecting packs &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; deletion and repacking
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:00&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;3499&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;3499&lt;/span&gt; packs processed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;to repack:          &lt;span class=&#34;m&#34;&gt;1517&lt;/span&gt; blobs / 466.577 MiB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;this removes:       &lt;span class=&#34;m&#34;&gt;1341&lt;/span&gt; blobs / 444.158 MiB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;to delete:           &lt;span class=&#34;m&#34;&gt;138&lt;/span&gt; blobs / 65.741 MiB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;total prune:        &lt;span class=&#34;m&#34;&gt;1479&lt;/span&gt; blobs / 509.899 MiB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;remaining:        &lt;span class=&#34;m&#34;&gt;174653&lt;/span&gt; blobs / 54.827 GiB
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;unused size after prune: 2.728 GiB &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;4.98% of remaining size&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;repacking packs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:01&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; packs repacked
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;rebuilding index
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:00&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;3468&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;3468&lt;/span&gt; packs processed
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;deleting obsolete index files
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:00&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; files deleted
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;removing &lt;span class=&#34;m&#34;&gt;34&lt;/span&gt; old packs
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:00&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;34&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;34&lt;/span&gt; files deleted
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Eine detaillierte Statistik zeigt an, wie viel Platz &lt;code&gt;--prune&lt;/code&gt; reclaimed hat,
und wie viel Platz noch innerhalb der Dateien ungenutzt frei ist.
Er wird bei einem späteren &lt;code&gt;--prune&lt;/code&gt; freigegeben.&lt;/p&gt;
&lt;h2 id=&#34;snapshots-anzeigen&#34;&gt;
    &lt;a href=&#34;#snapshots-anzeigen&#34;&gt;
	Snapshots anzeigen
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Snapshots anzeigen geht mit &lt;code&gt;restic snapshots&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# restic snapshots&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;enter password &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; repository:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;repository 3d26efdc opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;version 2, compression level auto&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ID        Time                 Host        Tags        Paths
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0b981e61  2023-12-25 14:21:06  bigbox                  /etc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                       /snapshot-of-home
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                       /var/www
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;e4e36825  2023-12-25 23:10:01  bigbox                  /etc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                       /snapshot-of-home
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                       /var/www
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;99153462&lt;/span&gt;  2023-12-29 15:10:01  bigbox                  /etc
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                       /snapshot-of-home
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;                                                       /var/www
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;------------------------------------------------------------------------
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;m&#34;&gt;51&lt;/span&gt; snapshots
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Wir können auch mit &lt;code&gt;restic ls&lt;/code&gt; das Verzeichnis des Snapshots listen lassen,
oder mit &lt;code&gt;restic dump&lt;/code&gt; eine einzelne Datei ausgeben lassen.&lt;/p&gt;
&lt;h2 id=&#34;suche&#34;&gt;
    &lt;a href=&#34;#suche&#34;&gt;
	Suche
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Wir können einen Snapshot nach einzelnen Dateien durchsuchen.
Zum Beispiel wollen wir sehen, ob wir das File &lt;code&gt;/home/snackbag/snackbag/extras/snacksmp/v15-fast.zip&lt;/code&gt; im Backup haben.&lt;/p&gt;
&lt;p&gt;Gesichert worden ist es als &lt;code&gt;/snapshot-of-home/...&lt;/code&gt;.
Also&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# restic find &amp;#39;/snapshot-of-home/snackbag/snackbag/extras/snacksmp/v15-fast.zip&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Found matching entries in snapshot fbb371bd from 2023-12-29 13:10:01
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/snapshot-of-home/snackbag/snackbag/extras/snacksmp/v15-fast.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Found matching entries in snapshot 498bfd63 from 2023-12-29 14:10:02
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/snapshot-of-home/snackbag/snackbag/extras/snacksmp/v15-fast.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Found matching entries in snapshot &lt;span class=&#34;m&#34;&gt;99153462&lt;/span&gt; from 2023-12-29 15:10:01
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/snapshot-of-home/snackbag/snackbag/extras/snacksmp/v15-fast.zip
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Found matching entries in snapshot c5d9b64a from 2023-12-29 16:10:01
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;/snapshot-of-home/snackbag/snackbag/extras/snacksmp/v15-fast.zip
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Zum Restore brauchen wir die Snapshot-ID (also zum Beispiel: &lt;code&gt;c5d9b64a&lt;/code&gt;) der Version, die wir haben wollen.
Die Ausgabe ist chronologisch, also brauchen wir die letzte ID.&lt;/p&gt;
&lt;p&gt;Suche geht auch mit Wildcards:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# restic find --json &amp;#39;*/v15-fast.zip&amp;#39; | gron&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.hits &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;[]&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;{}&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.atime &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2023-12-18T12:53:17+01:00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.ctime &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2023-12-18T14:39:47.875074144+01:00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.device_id &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 64773&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.gid &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 1013&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.group &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;snackbag&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.inode &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 67328639&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.links &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 1&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.mode &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 420&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.mtime &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;2023-12-18T12:53:17+01:00&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.path &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;/snapshot-of-home/snackbag/snackbag/extras/snacksmp/v15-fast.zip&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.permissions &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;-rw-r--r--&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.size &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 53774271&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.type &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;file&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.uid &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; 1013&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.matches&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.user &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;snackbag&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;json&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;50&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;.snapshot &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;c5d9b64aad4248840801f599baedc95467c49a2b8634a86d75be5bbd9d130bce&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Oder mit &lt;code&gt;jq&lt;/code&gt; statt &lt;code&gt;gron&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# restic find --json &amp;#39;*/v15-fast.zip&amp;#39; | jq &amp;#39;.[].snapshot&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;fbb371bd16a2db6c2b619d14f9c7beb8e52b7f40d212b3eafb1b1f145f731478&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;498bfd639d6ae59c926a63812aaced6dc5b541ca1302c5334913044f3b8333e6&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;9915346249d0ed02d35e43a81a46d184b75f6c00ec00133c0446a4b4a9cc8eb5&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;c5d9b64aad4248840801f599baedc95467c49a2b8634a86d75be5bbd9d130bce&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;restore&#34;&gt;
    &lt;a href=&#34;#restore&#34;&gt;
	Restore
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Restore dann:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# mkdir workspace&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# restic restore \&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&amp;gt; --target workspace &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;&amp;gt; --include &lt;span class=&#34;s1&#34;&gt;&amp;#39;*/v15-fast.zip&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;c5d9b64aad4248840801f599baedc95467c49a2b8634a86d75be5bbd9d130bce
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;repository 3d26efdc opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;version 2, compression level auto&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:00&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; index files loaded
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;restoring &amp;lt;Snapshot c5d9b64a of &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;/snapshot-of-home /var/www /etc&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; at 2023-12-29 16:10:01.934599035 +0100 CET by root@bigbox&amp;gt; to workspace
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Summary: Restored &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; files/dirs &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;51.283 MiB / 51.283 MiB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; in 0:02
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# find workspace/ -type f&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;workspace/snapshot-of-home/snackbag/snackbag/extras/snacksmp/v15-fast.zip
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;fuse-mount&#34;&gt;
    &lt;a href=&#34;#fuse-mount&#34;&gt;
	FUSE-Mount
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Das ist sehr viel schneller als ein Mount,
aber ein FUSE-Mount kann auch hilfreich sein:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# restic mount /mnt/restic&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;repository 3d26efdc opened &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;version 2, compression level auto&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;0:00&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; 100.00%  &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; / &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; index files loaded
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Now serving the repository at /mnt/restic
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Use another terminal or tool to browse the contents of this folder.
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;When finished, quit with Ctrl-c here or umount the mountpoint.
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;In einem 2. Fenster dann:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# cd /mnt/restic/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ls -F&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;hosts/  ids/  snapshots/  tags/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ls -F ids/&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;ids/:
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0167ffd2/  152ea32f/  2ff8540c/  59f8f55b/  9afe61d3/  d58d50fa/  f22e171d/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;023a782d/  1561f1c8/  33e09326/  5eec2b8c/  a0020775/  d7c8e648/  f80f9e4f/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;02478085/  1b36de2d/  3f0bce8d/  61e02a5b/  a075cdd8/  d972654b/  fbb371bd/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;04216185/  1c253586/  451b146d/  6fcc9fbf/  aa916fab/  dd761561/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0b981e61/  1c64b318/  4961c739/  89aef175/  b4d945ee/  e1b58661/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0caeffbd/  2342db66/  498bfd63/  90a9861c/  be0f439a/  e4e36825/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0d7e65d4/  2566d92a/  4e2ba289/  954210a2/  c0fcfe70/  eb8ce869/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;0ee4d0c9/  2cddb602/  5415cd2d/  99153462/  c5d9b64a/  ee6ad425/
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# cd ids/c5d9b64a&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ls&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;etc  snapshot-of-home  var
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# ls etc | head -3&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;adjtime
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aliases
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;aliases.db
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;sftp-für-restic-aufsetzen&#34;&gt;
    &lt;a href=&#34;#sftp-f%c3%bcr-restic-aufsetzen&#34;&gt;
	&lt;code&gt;sftp&lt;/code&gt; für &lt;code&gt;restic&lt;/code&gt; aufsetzen
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;Die Sicherung vom (als kompromittiert anzusehenden) Minecraft-Server nach Hause muss passend gesichert werden.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Wir legen einen &lt;code&gt;resticuser&lt;/code&gt; nur für die Sicherung dieses Servers an.&lt;/li&gt;
&lt;li&gt;Er wird in der &lt;code&gt;/etc/ssh/sshd_config&lt;/code&gt; auf &lt;code&gt;sftp-internal&lt;/code&gt; constrained.&lt;/li&gt;
&lt;li&gt;Der &lt;code&gt;.ssh/authorized_keys&lt;/code&gt; dieses Users wird hinterlegt,
und als unveränderlich markiert, um Manipulationen zu erschweren.&lt;/li&gt;
&lt;li&gt;Der &lt;code&gt;sftp&lt;/code&gt;-User bekommt ein &lt;code&gt;chroot(2)&lt;/code&gt; ins Datenverzeichnis und kann nicht auf sein eigenes Home zugreifen.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# useradd -m -c &amp;#34;Restic Backup von Minecraft&amp;#34; resticuser&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# mkdir ~resticuser/.ssh&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# scp .../id_backup.pub ~resticuser/.ssh/authorized_keys&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# chown -R resticuser:resticuser ~resticuser&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# chattr +i ~/.ssh/authorized_keys&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# tail -5 /etc/ssh/sshd_config&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Match User resticuser
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ChrootDirectory /backup/minecraft_backup
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    ForceCommand internal-sftp
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    AllowTcpForwarding no
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    X11Forwarding no
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;    
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# mkdir /backup/minecraft_backup/restic&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# chown -R resticuser:resticuser /backup/minecraft_backup&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Eine modifizierte Version von &lt;code&gt;run-restic&lt;/code&gt; von oben sollte nun Daten in diesen Speicher schieben können.&lt;/p&gt;
&lt;h1 id=&#34;rest-server&#34;&gt;
    &lt;a href=&#34;#rest-server&#34;&gt;
	&lt;code&gt;rest-server&lt;/code&gt;
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;(via &lt;a href=&#34;https://github.com/mgumz&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Mathias Gumz&lt;/a&gt;

)&lt;/p&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/restic/rest-server&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;&lt;code&gt;rest-server&lt;/code&gt;&lt;/a&gt;

 ist ein Unterprojekt von &lt;code&gt;restic&lt;/code&gt;,
das ein Server-Backend für das REST-Protokoll von &lt;code&gt;restic&lt;/code&gt; implementiert.
Es hat einen &lt;code&gt;--append-only&lt;/code&gt; Modus, mit dem man Backups aus unsicheren Quellen annehmen kann,
ohne daß die Backup-Quelle das Backup zerstören oder löschen kann.
Natürlich müssen &lt;code&gt;forget&lt;/code&gt; und &lt;code&gt;prune&lt;/code&gt; dann lokal auf dem Server getriggert werden und nicht durch den Backup-Prozess.&lt;/p&gt;
&lt;p&gt;Das Projekt kommt mit einer umfangreichen Installationsanleitung und mit offiziellen Docker-Images,
sodass das Aufsetzen eines Servers mit wenigen Handgriffen getan ist.&lt;/p&gt;
&lt;p&gt;Der Aufruf sieht im Wesentlichen so aus:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ lvcreate -L 100G -n testing hdd
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ mkfs -t xfs /dev/hdd/testing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ mkdir /backup/testing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ mount /dev/hdd/testing /backup/testing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; /backup/testing
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ htpasswd -B -c .htpasswd kris
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;Password: keks
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ cp /etc/apache2/md/domains/&lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;privkey,pubcert&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;.pem .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ rest-server &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --append-only &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --tls &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --tls-cert pubcert.pem &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --tls-key privkey.pem &lt;span class=&#34;se&#34;&gt;\ &lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;  --path /backup/testing/ &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --max-size &lt;span class=&#34;m&#34;&gt;107374182400&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;  --listen &lt;span class=&#34;s1&#34;&gt;&amp;#39;192.168.1.10:8000&amp;#39;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;&lt;em&gt;Testweises Starten von &lt;code&gt;rest-server&lt;/code&gt; mit lokalen Kopien der bei &amp;ldquo;Let&amp;rsquo;s Encrypt&amp;rdquo; generierten Zertifikate und ein Test-Repository.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Der Beispielaufruf startet den &lt;code&gt;rest-server&lt;/code&gt; auf Port 8000 der Testmaschine.
Er verwendet Kopien der von &amp;ldquo;mod_md&amp;rdquo; generierten &amp;ldquo;Let&amp;rsquo;s Encrypt&amp;rdquo;-Zertifikate aus &lt;code&gt;/etc/apache/md/domains&lt;/code&gt;,
und greift auf ein &amp;ldquo;append-only&amp;rdquo;-Repository in &lt;code&gt;/backup/testing&lt;/code&gt; zu.
Die Größe des Repository ist auf 100 GB (100 * 1024^3 Bytes) limitiert.&lt;/p&gt;
&lt;p&gt;Wir können das Repository unter dem Namen &lt;code&gt;rest:https://home.example.com:8000&lt;/code&gt; ansprechen.
Also&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-bash&#34; data-lang=&#34;bash&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RESTIC_REPOSITORY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;rest:https://home.example.com:8000
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$   &lt;span class=&#34;nb&#34;&gt;export&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;RESTIC_PASSWORD&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;keks
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ restic init
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;$ restic backup --exclude-caches /etc 
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;zum Sichern ein paar mal laufen lassen und dann &lt;code&gt;restic snapshots&lt;/code&gt; zum Ansehen der Backups.&lt;/p&gt;
&lt;p&gt;Löschen von Backups mit &lt;code&gt;forget&lt;/code&gt; und &lt;code&gt;prune&lt;/code&gt; ist durch den Client nicht mehr machbar.&lt;/p&gt;
&lt;p&gt;Stattdessen kann man das Backup lokal als &lt;code&gt;-r /backup/testing&lt;/code&gt; ansprechen und per Cron
das entsprechende &lt;code&gt;forget --prune --keep...&lt;/code&gt;-Regel laufen lassen.
Dabei muß man sicherstellen, daß die Datei-Eigentümer sauber bleiben,
am Besten indem man &lt;code&gt;rest-server&lt;/code&gt; und den &lt;code&gt;forget&lt;/code&gt;-Cronjob unter demselben
Owner laufen läßt.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>x86_64 binaries on M1</title>
      <link>https://blog.koehntopp.info/2023/12/05/x86_64-binaries-on-m1.html</link>
      <pubDate>Tue, 05 Dec 2023 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2023/12/05/x86_64-binaries-on-m1.html</guid>
      <description>&lt;p&gt;I installed a Python 2.7.18 with &lt;code&gt;pyenv&lt;/code&gt; on Apple Silicon,
and I needed that binary to be pure &lt;code&gt;x86_64&lt;/code&gt;.
This was necessary because I needed to load dynamic libraries that were only available in Intel format.&lt;/p&gt;
&lt;p&gt;It is not possible to load &lt;code&gt;x86_64&lt;/code&gt; libraries into an ARM binary.
If you build a multi-arch binary, you need to remember to request Intel every time you run a Python script
which tries to load the Intel-only shared library.
With an Intel-only binary, this will work every time without additional configuration.&lt;/p&gt;
&lt;h1 id=&#34;calling-the-intel-code-in-a-multi-architecture-binary&#34;&gt;
    &lt;a href=&#34;#calling-the-intel-code-in-a-multi-architecture-binary&#34;&gt;
	Calling the Intel code in a multi-architecture binary
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The &lt;code&gt;file&lt;/code&gt; command will tell you if a binary is multi-architecture:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; file /bin/ls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/bin/ls: Mach-O universal binary with 2 architectures: [x86_64:Mach-O 64-bit executable x86_64] [arm64e:Mach-O 64-bit executable arm64e]
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/bin/ls (for architecture x86_64):	Mach-O 64-bit executable x86_64
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/bin/ls (for architecture arm64e):	Mach-O 64-bit executable arm64e
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;You can manually call the Intel code:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; arch -arch x86_64 ls
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Applications		Movies		Music
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;If you call a binary this way, the first time this will trigger the installation of Rosetta2
(the Intel to ARM JIT compiler) on the Mac.&lt;/p&gt;
&lt;h1 id=&#34;compiling-for-intel-on-m1&#34;&gt;
    &lt;a href=&#34;#compiling-for-intel-on-m1&#34;&gt;
	Compiling for Intel on M1
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;By default, we compile for ARM (M1), and only for this architecture:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; cat hello.c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;#&lt;/span&gt;include &amp;lt;stdio.h&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;go&#34;&gt;int main(void) {
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;	printf(&amp;#34;Hello!\n&amp;#34;);
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; cc -o hello hello.c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; file hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;hello: Mach-O 64-bit executable arm64
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We can call the compiler for Intel, and get an Intel-only binary:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; arch -arch x86_64 cc -o hello hello.c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; file hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;hello: Mach-O 64-bit executable x86_64
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; ./hello
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Hello!
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;compiling-python-for-intel-only&#34;&gt;
    &lt;a href=&#34;#compiling-python-for-intel-only&#34;&gt;
	Compiling Python for Intel only
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The &lt;code&gt;pyenv&lt;/code&gt; installation process uses &lt;code&gt;python-build&lt;/code&gt;.
This, by default, uses the &lt;code&gt;readline&lt;/code&gt; and &lt;code&gt;openssl&lt;/code&gt; versions provided by Homebrew to build.
On my system, these are for ARM, so the Python will build and then fail in the linker stage.&lt;/p&gt;
&lt;p&gt;There is an option to force a build ignoring the Homebrew-provided components, &lt;code&gt;PYTHON_BUILD_SKIP_HOMEBREW&lt;/code&gt;.
This is a boolean variable: it is sufficient to set it to any value.
So:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;kk:~ kris$ PYTHON_BUILD_SKIP_HOMEBREW=1 arch -arch x86_64 pyenv install 2.7.18
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Downloading openssl-1.1.1v.tar.gz...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-&amp;gt; https://www.openssl.org/source/openssl-1.1.1v.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Installing openssl-1.1.1v...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Installed openssl-1.1.1v to /Users/kris/.pyenv/versions/2.7.18
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Downloading readline-8.0.tar.gz...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-&amp;gt; https://ftpmirror.gnu.org/readline/readline-8.0.tar.gz
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Installing readline-8.0...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Installed readline-8.0 to /Users/kris/.pyenv/versions/2.7.18
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Downloading Python-2.7.18.tar.xz...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;-&amp;gt; https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tar.xz
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Installing Python-2.7.18...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;patching file configure
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;patching file configure.ac
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;patching file setup.py
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Installed Python-2.7.18 to /Users/kris/.pyenv/versions/2.7.18
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;This is indeed the desired binary:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; file ~/.pyenv/versions/2.7.18/bin/python2
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/Users/kris/.pyenv/versions/2.7.18/bin/python2: Mach-O 64-bit executable x86_64
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;building-a-virtualenv-for-intel-python-2718&#34;&gt;
    &lt;a href=&#34;#building-a-virtualenv-for-intel-python-2718&#34;&gt;
	Building a &lt;code&gt;virtualenv&lt;/code&gt; for Intel Python 2.7.18
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;The virtual environment for Python 2.7 has to be built with an old version of the &lt;code&gt;virtualenv&lt;/code&gt; command,
which is compatible with the old Python:&lt;/p&gt;
&lt;p&gt;We make a &lt;code&gt;testdir&lt;/code&gt;, enter it and set the local Python version to the required version.
We then install an old version of the &lt;code&gt;virtualenv&lt;/code&gt; command, using &lt;code&gt;pip&lt;/code&gt;, globally into the old Python version.
This can then be used to create a virtual environment.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; mkdir testdir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; testdir
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; pyenv &lt;span class=&#34;nb&#34;&gt;local&lt;/span&gt; 2.7.18
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; python --version
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Python 2.7.18
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; which python
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;/Users/kris/.pyenv/shims/python
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Now the installation of &lt;code&gt;virtualenv&lt;/code&gt; into our Python 2.7.18 instance:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; pip --version
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;pip 19.2.3 from /Users/kris/.pyenv/versions/2.7.18/lib/python2.7/site-packages/pip (python 2.7)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; pip install --user virtualenv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;We now can call this version of &lt;code&gt;virtualenv&lt;/code&gt; for installation:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; archaeology
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; ~/.local/bin/virtualenv venv
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;created virtual environment CPython2.7.18.final.0-64 in 102ms
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;source&lt;/span&gt; venv/bin/activate
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(venv) kk:testdir kris$ python --version
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Python 2.7.18
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(venv) kk:testdir kris$ python
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Python 2.7.18 (default, Dec  5 2023, 12:09:45)
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;[GCC Apple LLVM 15.0.0 (clang-1500.0.40.1)] on darwin
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Type &amp;#34;help&amp;#34;, &amp;#34;copyright&amp;#34;, &amp;#34;credits&amp;#34; or &amp;#34;license&amp;#34; for more information.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h1 id=&#34;profit&#34;&gt;
    &lt;a href=&#34;#profit&#34;&gt;
	Profit!
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;And that gives us an ancient Python in a foreign machine language, so we can continue with our
software archaeology project.&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(venv) $ arch -arch x86_64 pip install cx_Oracle==7.3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Collecting cx_Oracle==7.3
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Successfully built cx-Oracle
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Installing collected packages: cx-Oracle
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;Successfully installed cx-Oracle-7.3.0
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;Note that this will still need an &lt;code&gt;ORACLE_HOME&lt;/code&gt; pointing to your instantclient directory,
and the &lt;code&gt;dylib&lt;/code&gt; files linked from the Python libdir to the instantclient installation.&lt;/p&gt;
&lt;p&gt;So:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;ORACLE_HOME&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;~/instantclient*
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;export ORACLE_HOME=&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;$ORACLE_HOME&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;&lt;/span&gt; &amp;gt;&amp;gt; ~/.bash_profile
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;err&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; ~/.pyenv/versions/2.7.18/lib
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;$&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; i in ~/instantclient*/*.dylib*&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;do&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;   &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; 
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;   ln -s &lt;span class=&#34;nv&#34;&gt;$i&lt;/span&gt; .
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;k&#34;&gt;done&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;With the proper &lt;code&gt;~/instantclient*/network/admin/TNSNAMES.ORA&lt;/code&gt; you can now&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-console&#34; data-lang=&#34;console&#34;&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;(venv) $ python2
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;...
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&lt;/span&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; import cx_Oracle
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; &lt;span class=&#34;nv&#34;&gt;c&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; cx_Oracle.Connection&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;sys&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;oracle&amp;#34;&lt;/span&gt;, &lt;span class=&#34;s2&#34;&gt;&amp;#34;ORCL&amp;#34;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;gp&#34;&gt;&amp;gt;&lt;/span&gt;&amp;gt;&amp;gt; c
&lt;/span&gt;&lt;/span&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;cl&#34;&gt;&lt;span class=&#34;go&#34;&gt;&amp;lt;cx_Oracle.Connection to sys@ORCL&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</description>
    </item>
    
    <item>
      <title>A Revolution Devours Its Children</title>
      <link>https://blog.koehntopp.info/2023/11/11/a-revolution-devours-its-children.html</link>
      <pubDate>Sat, 11 Nov 2023 05:06:07 +0000</pubDate>
      
      <guid>https://blog.koehntopp.info/2023/11/11/a-revolution-devours-its-children.html</guid>
      <description>&lt;p&gt;Initially published in c&amp;rsquo;t 26/23, page 70.
All my texts are made available in this blog after some time.
The version shown is the raw edit of the article text without pictures and illustrations.&lt;/p&gt;
&lt;p&gt;Hier ist das Original &lt;a href=&#34;https://blog.koehntopp.info/2023/11/11/eine-revolution-frisst-ihre-kinder.html&#34;&gt;in deutscher Sprache&lt;/a&gt;

.&lt;/p&gt;
&lt;h1 id=&#34;a-revolution-devours-its-children&#34;&gt;
    &lt;a href=&#34;#a-revolution-devours-its-children&#34;&gt;
	A Revolution Devours Its Children
    &lt;/a&gt;
&lt;/h1&gt;
&lt;p&gt;by Kristian Köhntopp&lt;/p&gt;
&lt;h2 id=&#34;departure-from-traditional-open-source-licenses&#34;&gt;
    &lt;a href=&#34;#departure-from-traditional-open-source-licenses&#34;&gt;
	Departure from Traditional Open Source Licenses
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Open source once set out to guarantee users the greatest possible freedom in the operation of software and to challenge the software titans.
Meanwhile, however, these have learned to use the documented freedoms to their advantage.&lt;/p&gt;
&lt;p&gt;There is unrest in the open-source community: In recent times,
it can be observed that established software companies with a large user base are restricting the freedoms of their users by
changing licenses of their open source projects.
The most recent example is HashiCorp, a company specialized in software for cloud infrastructure,
which has placed its core products under the BSL v1.1 (Business Source License), a formally non-open license.
The response was immediate:
the software has since been forked as OpenTofu and is now under the auspices of the Linux Foundation.&lt;/p&gt;
&lt;p&gt;HashiCorp is not the first company to do this: some time ago,
RedHat changed the positioning of CentOS as a free alternative to RedHat Enterprise Linux (RHEL)
and recently restricted the release of the RHEL source codes through an EULA (End User License Agreement),
Elastic has put ElasticSearch and Kibana under the formally non-open SSPL (Server Side Public License),
and MongoDB is also only available under the SSPL.&lt;/p&gt;
&lt;h2 id=&#34;four-freedoms-and-a-certification&#34;&gt;
    &lt;a href=&#34;#four-freedoms-and-a-certification&#34;&gt;
	Four Freedoms and a Certification
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Open Source and Free Software existed even before these terms were coined.
However, the actual &amp;ldquo;Open Source Revolution&amp;rdquo; began in the 1990s with the Linux kernel and the resulting distributions.
The term &amp;ldquo;Open Source&amp;rdquo; was coined by Bruce Perens and Eric Raymond,
formalized in the Open Source Definition and the Debian Free Software Guidelines.&lt;/p&gt;
&lt;p&gt;Both are refinements and clarifications of the original &amp;ldquo;Four Freedoms&amp;rdquo; in the mother of all open-source licenses,
the GNU General Public License (GPL), which are:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Freedom 0: The freedom to run the program for any purpose.&lt;/li&gt;
&lt;li&gt;Freedom 1: The freedom to study how the program works and adapt it to your data processing needs.
This implies access to the source code.&lt;/li&gt;
&lt;li&gt;Freedom 2: The freedom to redistribute the program.
However, the GPL requires that the source code of the program, which corresponds to the redistributed program, is also offered.&lt;/li&gt;
&lt;li&gt;Freedom 3: The freedom to improve the program and distribute these improvements under the original license.
This also implies access to the source code and the right to modify it.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;While the GPLv2 is the license that first codified these freedoms,
a whole range of licenses quickly developed that are all &amp;ldquo;Open Source&amp;rdquo;
according to the OSI guidelines (Open Source Initiative) or the DFSG (Debian Free Software Guidelines),
all of which are free but some are incompatible with the GPL.
This, in particular, filled many Usenet newsgroups with ongoing discussions throughout the late 90s.&lt;/p&gt;
&lt;h2 id=&#34;the-lamp-stack-a-wild-mix-of-licenses&#34;&gt;
    &lt;a href=&#34;#the-lamp-stack-a-wild-mix-of-licenses&#34;&gt;
	The LAMP Stack: A Wild Mix of Licenses
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;The well-known LAMP stack for web development is also an example of the license confusion that can occur with open source.
LAMP includes the Linux Kernel, the Apache web server, the MySQL database, and the PHP programming language.
Each of these components has different licenses.&lt;/p&gt;
&lt;p&gt;While the Linux Kernel is licensed under GPLv2, the Apache web server is under Apache License 2.
This is a permissive license,
meaning it lacks provisions that enforce changes to the original program to be distributed under the same license as the original program.&lt;/p&gt;
&lt;p&gt;MySQL has two licenses:
The database can be used under the GPL, subject to the provisions and freedoms mentioned above.
However, the copyright holder is a company (originally MySQL, then SUN, and now Oracle) that holds all rights.
Developers must assign the rights to their patches to Oracle via a Contributor License Agreement (CLA).
This allows Oracle to also offer the source code under a commercial license.&lt;/p&gt;
&lt;p&gt;And PHP has been under the PHP License since version 4.
This is also a permissive license that allows the use and distribution of PHP with or without modifications,
as source code or executable program, but contains restrictions regarding the use of the &amp;ldquo;PHP&amp;rdquo; trademark.&lt;/p&gt;
&lt;p&gt;This leads to an important question from the late 90s:
What happens when you mix software with different licenses and distribute them together in a distribution or link them together in a translation process?&lt;/p&gt;
&lt;p&gt;The GNU Project quickly clarified that the boundaries of the license are the process boundaries.
If you develop a program under another license and link it with GNU software so that the result is executed in the same process afterward,
this is legally okay only if the other license is compatible with the GPL.&lt;/p&gt;
&lt;p&gt;Although the GPL is an open-source license, not many licenses are compatible with the GPL.
This is because the GPL contains freedom-preserving restrictions:
you can&amp;rsquo;t restrict the execution of the software (&amp;ldquo;Not in nuclear missiles!&amp;rdquo;).
And a program that contains GPL components must also be offered in source code with all changes.
This means not just the GPL components, but all components in this process space.&lt;/p&gt;
&lt;h2 id=&#34;the-debate-over-the-infectious-gpl&#34;&gt;
    &lt;a href=&#34;#the-debate-over-the-infectious-gpl&#34;&gt;
	The Debate Over the &amp;ldquo;Infectious&amp;rdquo; GPL
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;The obligation to publish the source code then led to another discussion in the early 2000s.
At that time, Linux and Open Source became so prominent that they could not be ignored,
and many startups flirted with Open Source.
Although the GPL was the most widely used license at the time, it is not an attractive prospect for investors
to have to release all the company&amp;rsquo;s software sources under the GPL.&lt;/p&gt;
&lt;p&gt;It was during this time that the anti-open-source slogan of the &amp;ldquo;viral&amp;rdquo; or &amp;ldquo;contagious&amp;rdquo; GPL originated,
which is nonsense at its core:
On the one hand, the GPL is easy to contain because it ends clearly defined at process boundaries;
on the other hand, the provisions of the GPL make sense because they make direct exploitation of others&amp;rsquo; work more difficult
(&amp;ldquo;Quid pro quo: If you benefit from Open Source, then you should contribute in the same way.&amp;rdquo;).&lt;/p&gt;
&lt;h2 id=&#34;gplv3-against-software-patents&#34;&gt;
    &lt;a href=&#34;#gplv3-against-software-patents&#34;&gt;
	GPLv3 Against Software Patents
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;In response to venture capitalists who brought another threat to Open Source into play, a reaction became necessary:
software patents.
If startups have to release their software under the GPL,
they might restrict their intellectual property in other ways to later collect licensing fees.
At the time, software patents were positioned as a real threat.&lt;/p&gt;
&lt;p&gt;The justification for version 3 of the GPL directly addresses this, and GPLv3 includes provisions that,
in simplified terms, state:
&amp;ldquo;If you use patents to sue users of any GPLv3-licensed software, then your right to use any GPLv3 software is terminated.&amp;rdquo;
This clause is effective, and it has led to, among other things,
Apple avoiding any form of GPLv3-licensed software in its products
and progressively replacing any GPL software in Apple products with software licensed differently.&lt;/p&gt;
&lt;p&gt;The provision that the GPL ends at process boundaries is sometimes problematic for the GNU project as well,
and so there are variants of the GPL and exceptions.
For example, code generated by GPL-covered programs is not protected by the GPL:
This allows code generators such as gcc, bison, and flex.
And for some libraries, including glibc, there is the LGPL, also called &amp;ldquo;Lesser GPL,&amp;rdquo;
which allows the libraries to be linked against non-GPL software.&lt;/p&gt;
&lt;h2 id=&#34;gpl-instead-of-lgpl-as-a-weapon&#34;&gt;
    &lt;a href=&#34;#gpl-instead-of-lgpl-as-a-weapon&#34;&gt;
	&amp;ldquo;GPL Instead of LGPL&amp;rdquo; as a Weapon
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Conversely, some companies have used the GPL as a weapon.
For example, libraries like &amp;ldquo;libmysqlclient.so&amp;rdquo; were available under the LGPL up to MySQL 3.23,
but from version 4 onwards, they are under the GPL.
Therefore, if one links this library into their commercial program and wants to distribute it,
they must buy a commercial MySQL license under the dual-licensing program.
MySQL summarized this in the slogan, &amp;ldquo;If you are free, we are free. If you are commercial, we are commercial.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;This was a problem for a while for the programming language PHP,
which linked against this library to access the database as part of the LAMP stack but has a formally non-GPL-compatible license.
PHP countered this problem by reimplementing the protocol as &amp;ldquo;mysqlnd,&amp;rdquo;
and in parallel, MySQL solved the problem by defining a license exception for PHP (and others).&lt;/p&gt;
&lt;h2 id=&#34;less-gpl-more-mit-bsd-and-apache&#34;&gt;
    &lt;a href=&#34;#less-gpl-more-mit-bsd-and-apache&#34;&gt;
	Less GPL, More MIT, BSD, and Apache
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;All these confusions are one reason why &amp;ldquo;modern&amp;rdquo; open-source software often no longer uses the GPL
but prefers other licenses such as MIT, BSD, or Apache.
They make a number of capital-financed business models around open source simpler,
especially if you want to build a company around a product that is open source in name only.
From 2005 onwards, business models based on open source began to flourish.
This has worked well enough for 15 years to grow the number of projects significantly.&lt;/p&gt;
&lt;p&gt;Some of these projects do not rely on individual companies as sponsors:
PHP, KDE, and Postgres, for example, are stable and large-scale OSS projects
that are not backed by a single large company and its venture capital investors –
they all feature a broad and deeply rooted base of contributors.&lt;/p&gt;
&lt;p&gt;In recent years, cracks have appeared: RedHat, Elastic, MongoDB, MariaDB (a MySQL fork), HashiCorp,
and many others have changed their licenses or restructured to exclude a specific use case.
Since this constitutes a violation of Freedom 0, they are no longer open-source projects in the sense of OSI and DFSG.&lt;/p&gt;
&lt;h2 id=&#34;the-elephant-in-the-room-is-the-cloud&#34;&gt;
    &lt;a href=&#34;#the-elephant-in-the-room-is-the-cloud&#34;&gt;
	The Elephant in the Room is the Cloud
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;Amazon Web Services (AWS) is a system and a company that epitomizes a business model:
It monetizes the aspect of &amp;ldquo;operations,&amp;rdquo; which is often neglected and underfunded in companies,
and aims not to develop software for third parties but primarily to operate it.&lt;/p&gt;
&lt;p&gt;Amazon has been very successful with this model:
For some time now, more new installations of MySQL (and MongoDB, Postgres, Elastic, and many other databases)
have been running in its data centers than locally with clients (&amp;ldquo;on-premise&amp;rdquo;).
This is a class of systems that are notoriously hard to operate because errors in operation can irreparably ruin data.
Of course, one can roll back a faulty database version to the previous one,
but the data destroyed by the error is still permanently lost.&lt;/p&gt;
&lt;p&gt;The systematic underestimation of the costs and effort operations require is
what makes the principle of &amp;ldquo;Software as a Service&amp;rdquo; (SaaS) successful.
SaaS providers are selling not just a service,
but primarily an operational concept for this service that allows smooth and uninterrupted operation right after commissioning.
Because the operational concept is tested and prescribed, the quality of the service can be standardized,
measured, and then stable contracts can be entered into with third parties.&lt;/p&gt;
&lt;p&gt;Customers welcome this because operating software is a problem at least as challenging as developing software.
Many customers do not want to deal with this.
Often, they accept availabilities, response times, and costs that were completely unacceptable in their own in-house teams before.
All of this just to get the complex task of &amp;ldquo;operating the databases&amp;rdquo; out of the house –
this shows how uncomfortable companies are with dealing with &amp;ldquo;operations.&amp;rdquo;&lt;/p&gt;
&lt;p&gt;The operation of this software by AWS is not covered by a commercial agreement between the software manufacturer and Amazon,
but is based on the Freedom 0 of the GPL:
Amazon is allowed to run the software for any purpose, including as a service for others.
As a result, Amazon collects the money for the operation of these installations,
but the actual software developer, the manufacturing company or group, gets nothing from it.
This is not a sustainable financing model, but it is covered by the GPL and very advantageous for AWS,
so there is no incentive for them to change anything.&lt;/p&gt;
&lt;h2 id=&#34;business-source-license-as-an-early-reaction&#34;&gt;
    &lt;a href=&#34;#business-source-license-as-an-early-reaction&#34;&gt;
	Business Source License as an Early Reaction
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;The issue of cloud services exploiting open-source software without contributing back to the developers was recognized early on:
The &amp;ldquo;Business Source License&amp;rdquo; (BSL) was first mentioned in the blog of Monty Widenius,
a key figure behind MariaDB, as early as 2013, and MariaDB has been using it for certain components since 2016,
with slight changes after suggestions from Bruce Perens, resulting in version 1.1 in 2017.
Other products followed suit and adopted the BSL: Couchbase, Uptrace, Kurtosis, Sentry, CockroachDB,
and recently all HashiCorp core products.&lt;/p&gt;
&lt;p&gt;The idea behind the BSL is that the software remains freely usable and the source code available,
but with restrictions.
The most important restriction usually means &amp;ldquo;AWS is not allowed to use this,&amp;rdquo;
phrased as &amp;ldquo;The software may not be offered as SaaS for third parties.&amp;rdquo;
Thus, one can use the software as before.
It can also be operated on AWS itself, or it can be provided within one&amp;rsquo;s own organization for other departments.&lt;/p&gt;
&lt;p&gt;However, one will not be able to buy the operation of the software as a service from a cloud operator,
but only from the creator of the software itself (e.g., via AWS Marketplace).
This limitation is intended to ensure the financing the development of the software
by preventing AWS from completely diverting this stream of money for itself.
The BSL comes with another rule stating that code changes must be released under a recognized open-source license (usually the Apache 2.0 license or GPL).
There is a time limit for that: a maximum of four years, ensuring that older versions of the software are always true open source.&lt;/p&gt;
&lt;p&gt;Formally, BSL software is not open source in the OSI or DFSG sense because, unlike the GPL,
Freedom 0 (&amp;ldquo;run for any purpose&amp;rdquo;) is restricted.
Therefore, it is also referred to as &amp;ldquo;Source Available.&amp;rdquo;
The Server Side Public License used by MongoDB, Elastic, and Kibana follows the same idea, only differently:
the SSPL is a variant of AGPLv3 that also restricts Freedom 0 and prohibits operating the software for third parties
(&amp;ldquo;as a Service&amp;rdquo;) unless a commercial license is acquired.&lt;/p&gt;
&lt;h2 id=&#34;non-free-free-software&#34;&gt;
    &lt;a href=&#34;#non-free-free-software&#34;&gt;
	Non-Free Free Software
    &lt;/a&gt;
&lt;/h2&gt;
&lt;p&gt;The fundamental idea behind the GPL&amp;rsquo;s freedoms is give and take:
&amp;ldquo;You can use our software, but you have to play nice in return.&amp;rdquo;
The ever-growing dominance of AWS is making it increasingly difficult for open-source creators to earn a living from their development work –
AWS offers their software as a service and integrates it with other services.
Freedom 0 of free software here turns against the creators of the software.&lt;/p&gt;
&lt;p&gt;The BSL and SSPL are reactions to this.
Formally, they are not free software, according to OSI or DFSG.
But perhaps it is time for open source to once again face changes and new threats,
adapting licenses and definitions for the new era, as has already happened with GPLv3 and AGPL.&lt;/p&gt;
&lt;p&gt;Perhaps the FSF, OSI, and Debian will not move and will insist on their definitions of &amp;ldquo;free software.&amp;rdquo;
But this does not deter developers of software under BSL and SSPL:
their software is already &amp;ldquo;almost free&amp;rdquo; and, due to their special rule,
will formally become free software according to the old definition after a few years.
There is no reason to reject BSL or SSPL, except for fundamentalism towards free software.
However, if those who care about the open-source idea do not want AWS to be the only company with a successful open-source business model,
then change is necessary.
Otherwise, users will soon find themselves back with dull, traditional commercial software,
the kind they used to get from companies like Microsoft and Oracle.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>

